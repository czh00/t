<!DOCTYPE html>
<html lang="zh-Hant">
<head>
	<meta charset="UTF-8">
	<meta content="width=device-width, initial-scale=1.0" name="viewport">
	<title>時間</title>
	<style>
		:root { --page-background-color: #000; } /* 定義頁面背景色的CSS變數，預設為黑色 */
		*, *::before, *::after { box-sizing: border-box; } /* 所有元素的盒模型都使用邊框盒模型 */
		body {
			margin: 0; /* 移除body預設外邊距 */
			overflow: hidden; /* 隱藏超出視口的部分，防止滾動條出現 */
			display: flex; /* 使用Flexbox佈局 */
			flex-direction: column; /* 垂直排列子元素 */
			justify-content: center; /* 水平居中對齊子元素 */
			align-items: center; /* 垂直居中對齊子元素 */
			min-height: 100vh; /* 最小高度為視口高度的100% */
			width: 100vw; /* 寬度為視口寬度的100% */
			position: relative; /* 相對定位，用於子元素的絕對定位 */
			font-family: 'Inter', sans-serif; /* 設定字體為Inter或無襯線字體 */
			background-color: var(--page-background-color); /* 使用CSS變數設定背景色 */
		}
		#dateTimeDisplay {
			font-family: 'Segoe UI', Arial, sans-serif; /* 設定日期時間顯示的字體 */
			font-weight: bold; /* 字體加粗 */
			text-align: center; /* 文字居中對齊 */
			padding: 10px; /* 內邊距 */
			text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5); /* 文字陰影效果 */
			position: absolute; /* 絕對定位 */
			transition: transform 1s ease-in-out; /* 轉換效果的過渡動畫 */
			transform: translate(-50%, -50%); /* 將元素中心點移到父元素中心 */
			left: 50%; /* 距離左邊50% */
			top: 50%; /* 距離頂部50% */
			cursor: default; /* 鼠標樣式為預設 */
			z-index: 10; /* Z軸層級，確保在其他元素之上 */
		}
		.time-text {
			font-size: 32vw; /* 時間文字大小，根據視口寬度調整 */
			margin-bottom: -10vw; /* 負外邊距，使行間距更緊湊 */
			position: relative; /* 相對定位 */
			display: inline-block; /* 行內塊級元素 */
			white-space: nowrap; /* 防止文字換行 */
			padding-right: 8vw; /* 右側內邊距 */
		}
		.time-seconds {
			font-size: 6vw; /* 秒數文字大小 */
			cursor: pointer; /* 鼠標樣式為手型 */
			position: absolute; /* 絕對定位 */
			right: 0; /* 距離右邊0 */
			bottom: 6vw; /* 距離底部6vw */
			text-align: right; /* 文字右對齊 */
			width: 6vw; /* 寬度 */
		}
		.time-ampm {
			font-size: 5vw; /* 上午/下午文字大小 */
			position: absolute; /* 絕對定位 */
			top: 11vw; /* 距離頂部11vw */
			right: 0; /* 距離右邊0 */
			text-align: right; /* 文字右對齊 */
			width: 8vw; /* 寬度 */
		}
		.gregorian-date-text {
			font-size: 10vw; /* 公曆日期文字大小 */
			margin-top: -2vw; /* 負上外邊距 */
			margin-bottom: -3vw; /* 負下外邊距 */
			display: block; /* 塊級元素 */
			white-space: nowrap; /* 防止文字換行 */
			cursor: pointer; /* 鼠標樣式為手型 */
			position: relative; /* 相對定位 */
			z-index: 1; /* Z軸層級 */
		}
		.lunar-and-jieqi-line {
			display: flex; /* 使用Flexbox佈局 */
			justify-content: center; /* 水平居中對齊子元素 */
			align-items: center; /* 垂直居中對齊子元素 */
			font-size: 6.4vw; /* 農曆和節氣行文字大小 */
			white-space: nowrap; /* 防止文字換行 */
			width: 92vw; /* 寬度 */
			margin: 0 auto; /* 水平居中 */
			overflow: hidden; /* 隱藏超出容器的部分 */
			position: relative; /* 相對定位 */
			z-index: 1; /* Z軸層級 */
		}
		.lunar-date-static-text { flex-shrink: 0; text-align: right; cursor: pointer; } /* 不縮小 | 文字右對齊 | 鼠標樣式為手型 */
		.jieqi-holiday-marquee-container {
			flex-grow: 1; /* 佔滿剩餘空間 */
			overflow: hidden; /* 隱藏超出容器的部分 */
			position: relative; /* 相對定位 */
			text-align: left; /* 文字左對齊 */
			min-width: 0; /* 最小寬度為0 */
			cursor: pointer; /* 鼠標樣式為手型 */
		}
		.jieqi-holiday-marquee-inner {
			display: flex; /* 使用Flexbox佈局 */
			flex-wrap: nowrap; /* 不換行 */
			width: fit-content; /* 寬度適應內容 */
			will-change: transform; /* 提示瀏覽器transform屬性將會改變，優化動畫性能 */
		}
		.jieqi-holiday-marquee-content, .jieqi-holiday-marquee-content-duplicate { display: inline-block; white-space: nowrap; flex-shrink: 0; } /* 行內塊級元素 | 防止文字換行 | 不縮小 */
		.jieqi-holiday-marquee-container.scrolling .jieqi-holiday-marquee-inner { animation-name: marquee; animation-timing-function: linear; animation-iteration-count: infinite; } /* 應用marquee動畫 | 線性動畫 | 無限次重複動畫 */
		@keyframes marquee { from { transform: translateX(0); } to { transform: translateX(-50%); } } /* 從原始位置開始 | 移動到左側50%的位置 */
		.noscript-message { font-size: 0.5em; color: #FFB3BA; margin-top: 10px; } /* 字體大小 | 文字顏色 | 上外邊距 */
		.modal {
			display: none; /* 預設隱藏 */
			position: fixed; /* 固定定位 */
			z-index: 100; /* Z軸層級，確保在所有元素之上 */
			left: 0; top: 0; width: 100%; height: 100%; /* 佔滿整個視口 */
			overflow: auto; /* 內容溢出時顯示滾動條 */
			background-color: rgba(0, 0, 0, 0.7); /* 半透明黑色背景 */
		}
		.modal.is-active { display: flex; justify-content: center; align-items: center; } /* 顯示為Flexbox佈局 | 水平居中對齊子元素 | 垂直居中對齊子元素 */
		.modal-content {
			background-color: #333; /* 背景色 */
			margin: auto; /* 自動外邊距，實現水平垂直居中 */
			padding: 10px; /* 內邊距 */
			border: 1px solid #888; /* 邊框 */
			width: 90%; /* 寬度 */
			max-width: 600px; /* 最大寬度 */
			border-radius: 10px; /* 圓角邊框 */
			box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5); /* 陰影效果 */
			color: #00FF00; /* 文字顏色 */
			text-align: center; /* 文字居中對齊 */
			display: flex; /* 使用Flexbox佈局 */
			flex-direction: column; /* 垂直排列子元素 */
			gap: 15px; /* 子元素之間的間距 */
			max-height: 90vh; /* 最大高度為視口高度的90% */
			overflow-y: auto; /* 垂直方向內容溢出時顯示滾動條 */
		}
		.setting-item { margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; flex-wrap: nowrap; } /* 下外邊距 | 使用Flexbox佈局 | 子元素兩端對齊 | 垂直居中對齊子元素 | 不換行 */
		.setting-item label { font-size: 1.2em; flex-shrink: 0; margin-right: 10px; } /* 字體大小 | 不縮小 | 右外邊距 */
		.switch { position: relative; display: inline-block; width: 60px; height: 34px; margin-left: auto; margin-right: 10px; flex-shrink: 0; } /* 相對定位 | 行內塊級元素 | 寬度 | 高度 | 左外邊距自動 | 右外邊距 | 不縮小 */
		.switch input { opacity: 0; width: 0; height: 0; } /* 隱藏輸入框 | 寬度為0 | 高度為0 */
		.slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; } /* 絕對定位 | 鼠標樣式為手型 | 位置 | 背景色 | 過渡動畫 | 圓角邊框 */
		.slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; } /* 絕對定位 | 內容為空 | 尺寸 | 位置 | 背景色 | 過渡動畫 | 圓形 */
		input:checked + .slider { background-color: #00FF00; } /* 選中時滑塊背景色 */
		input:focus + .slider { box-shadow: 0 0 1px #00FF00; } /* 聚焦時滑塊陰影 */
		input:checked + .slider:before { transform: translateX(26px); } /* 滑塊移動 */
		.setting-item input[type="color"] { width: 40px; height: 34px; border: none; padding: 0; background: none; cursor: pointer; flex-shrink: 0; } /* 尺寸 | 無邊框 | 無內邊距 | 無背景 | 鼠標樣式為手型 | 不縮小 */
		.action-button { background-color: #555; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 1.1em; margin-top: 0px; } /* 背景色 | 文字顏色 | 內邊距 | 無邊框 | 圓角邊框 | 鼠標樣式為手型 | 字體大小 | 上外邊距 */
		.action-button:hover { background-color: #777; } /* 鼠標懸停時背景色 */
		.button-group { display: flex; justify-content: center; gap: 10px; margin-top: 0px; white-space: nowrap; } /* 使用Flexbox佈局 | 水平居中對齊子元素 | 子元素之間的間距 | 上外邊距 | 防止文字換行 */
		.calendar-settings-container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: space-around; width: 100%; } /* 使用Flexbox佈局 | 允許換行 | 子元素之間的間距 | 子元素兩端對齊 | 寬度佔滿父元素 */
		.gregorian-settings-column, .lunar-settings-column { flex: 1; min-width: 80px; padding: 10px; border: 1px solid #555; border-radius: 8px; background-color: #444; text-align: left; } /* 佔滿剩餘空間 | 最小寬度 | 內邊距 | 邊框 | 圓角邊框 | 背景色 | 文字左對齊 */
		.gregorian-settings-column h3, .lunar-settings-column h3 { text-align: center; margin-top: 0; } /* 文字居中對齊 | 移除上外邊距 */
		.lunar-date-clickable, .lunar-shichen-clickable { cursor: pointer; } /* 鼠標樣式為手型 */
		.yiji-content p, .jieqi-content p { margin-bottom: 10px; font-size: 1.5em; line-height: 1.6; } /* 下外邊距 | 字體大小 | 行高 */
		.yiji-content strong, .jieqi-content strong { color: #FFD700; } /* 文字顏色 */
		.calendar-header { display: flex; justify-content: space-between; align-items: center; padding: 0 10px; } /* 使用Flexbox佈局 | 子元素兩端對齊 | 垂直居中對齊子元素 | 水平內邊距 */
		.calendar-header h2 { margin: 0; font-size: 1.5em; color: #00FF00; } /* 移除外邊距 | 字體大小 | 文字顏色 */
		.calendar-header button { background: none; border: none; color: #00FF00; font-size: 2em; cursor: pointer; } /* 無背景 | 無邊框 | 文字顏色 | 字體大小 | 鼠標樣式為手型 */
		.calendar-content { background-color: #2c2c2c; margin: auto; padding: 20px; border: 1px solid #888; width: 95%; max-width: 800px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.6); color: #e0e0e0; text-align: center; display: flex; flex-direction: column; gap: 15px; max-height: 90vh; } /* 背景色 | 居中 | 內邊距 | 邊框 | 尺寸 | 圓角 | 陰影 | 文字顏色 | 文字居中 | Flexbox佈局 | 垂直排列 | 間距 | 最大高度 */
		.calendar-weekdays, .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; } /* 使用Grid佈局 | 7列等寬 | 網格間距 */
		.calendar-weekdays div { font-weight: bold; color: #aaa; padding-bottom: 5px; } /* 字體加粗 | 文字顏色 | 底部內邊距 */
		.calendar-day { background-color: #444; border-radius: 5px; padding: 5px; min-height: 60px; display: flex; flex-direction: column; justify-content: space-between; align-items: center; font-size: 0.9em; border: 1px solid #555; } /* 背景色 | 圓角 | 內邊距 | 最小高度 | Flexbox佈局 | 垂直排列 | 兩端對齊 | 垂直居中 | 字體大小 | 邊框 */
		.calendar-day.other-month { color: #777; background-color: #3a3a3a; } /* 其他月份的日期文字顏色 | 其他月份的日期背景色 */
		.calendar-day.is-today { border-color: #00FF00; box-shadow: 0 0 5px #00FF00; } /* 今天日期的邊框顏色 | 今天日期的陰影效果 */
		.calendar-day .gregorian-day { font-size: 1.2em; font-weight: bold; } /* 公曆日期文字大小 | 字體加粗 */
		.calendar-day .lunar-day { font-size: 0.8em; color: #ccc; } /* 農曆日期文字大小 | 文字顏色 */
		.weekly-calendar-content { background-color: #2c2c2c; margin: auto; padding: 15px; border: 1px solid #888; width: 98%; max-width: 1200px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.6); color: #e0e0e0; text-align: center; display: flex; flex-direction: column; gap: 10px; max-height: 90vh; } /* 背景色 | 居中 | 內邊距 | 邊框 | 尺寸 | 圓角 | 陰影 | 文字顏色 | 文字居中 | Flexbox佈局 | 垂直排列 | 間距 | 最大高度 */
		.weekly-calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; } /* 使用Grid佈局 | 7列等寬 | 網格間距 */
		.weekly-calendar-day { background-color: #444; border-radius: 8px; padding: 10px; min-height: 100px; display: flex; flex-direction: column; align-items: center; border: 1px solid #555; } /* 背景色 | 圓角 | 內邊距 | 最小高度 | Flexbox佈局 | 垂直排列 | 垂直居中 | 邊框 */
		.weekly-calendar-day.is-today { border-color: #00FF00; box-shadow: 0 0 8px #00FF00; } /* 今天日期的邊框顏色 | 今天日期的陰影效果 */
		.weekly-day-header { font-weight: bold; font-size: 1.1em; margin-bottom: 5px; } /* 字體加粗 | 字體大小 | 下外邊距 */
		.weekly-gregorian-day { font-size: 1.5em; font-weight: bold; } /* 公曆日期文字大小 | 字體加粗 */
		.weekly-lunar-day { font-size: 0.9em; color: #ccc; margin-top: 5px; } /* 農曆日期文字大小 | 文字顏色 | 上外邊距 */
		.yearly-calendar-content { background-color: #2c2c2c; margin: auto; padding: 15px; border: 1px solid #888; width: 98%; max-width: 1400px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.6); color: #e0e0e0; display: flex; flex-direction: column; gap: 10px; max-height: 95vh; } /* 背景色 | 居中 | 內邊距 | 邊框 | 尺寸 | 圓角 | 陰影 | 文字顏色 | Flexbox佈局 | 垂直排列 | 間距 | 最大高度 */
		.yearly-calendar-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; overflow-y: auto; padding: 10px; } /* Grid佈局 | 自動調整列數 | 間距 | 垂直滾動 | 內邊距 */
		.yearly-month-container { background-color: #3a3a3a; border-radius: 8px; padding: 10px; border: 1px solid #555; } /* 背景色 | 圓角 | 內邊距 | 邊框 */
		.yearly-month-header { font-size: 1.2em; font-weight: bold; text-align: center; margin-bottom: 10px; color: #00FF00; } /* 字體大小 | 字體加粗 | 文字居中 | 下外邊距 | 文字顏色 */
		.yearly-weekdays, .yearly-day-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px; text-align: center; } /* Grid佈局 | 7列等寬 | 間距 | 文字居中 */
		.yearly-weekdays div { font-size: 0.8em; color: #aaa; } /* 字體大小 | 文字顏色 */
		.yearly-day { font-size: 0.9em; padding: 2px; border-radius: 3px; } /* 字體大小 | 內邊距 | 圓角 */
		.yearly-day.is-today { background-color: #00FF00; color: #000; font-weight: bold; } /* 今天日期的背景色 | 文字顏色 | 字體加粗 */
		#background-scanline-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; background-color: transparent; display: none; } /* 固定定位 | 位置 | 尺寸 | 禁用鼠標事件 | Z軸層級 | 透明背景 | 預設隱藏 */
		#background-scanline-overlay.active.pattern-a { display: block; background-image: repeating-linear-gradient(to bottom, transparent, transparent 2px, rgba(0,0,0,0.3) 2px, rgba(0,0,0,0.3) 4px); } /* 顯示 | 背景圖 */
		#background-scanline-overlay.active.pattern-b { display: block; background-image: repeating-linear-gradient(to bottom, rgba(0,0,0,0.3) 0, rgba(0,0,0,0.3) 2px, transparent 2px, transparent 4px); } /* 顯示 | 背景圖 */
		#text-scanline-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 50; background-color: transparent; display: none; } /* 固定定位 | 位置 | 尺寸 | 禁用鼠標事件 | Z軸層級 | 透明背景 | 預設隱藏 */
		#text-scanline-overlay.active.pattern-a { display: block; background-image: repeating-linear-gradient(to bottom, transparent, transparent 2px, var(--page-background-color) 2px, var(--page-background-color) 4px); } /* 顯示 | 背景圖 */
		#text-scanline-overlay.active.pattern-b { display: block; background-image: repeating-linear-gradient(to bottom, var(--page-background-color) 0, var(--page-background-color) 2px, transparent 2px, transparent 4px); } /* 顯示 | 背景圖 */
		#fullscreen-icon { position: fixed; top: 20px; right: 20px; width: 32px; height: 32px; cursor: pointer; z-index: 200; opacity: 0.5; transition: opacity 0.3s ease; } /* 固定定位 | 位置 | 尺寸 | 鼠標樣式 | Z軸層級 | 透明度 | 過渡動畫 */
		#fullscreen-icon svg { width: 100%; height: 100%; fill: #fff; } /* 尺寸 | SVG填充顏色 */
		#fullscreen-icon:hover { opacity: 1; } /* 鼠標懸停時完全不透明 */
	</style>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/lunar-javascript/1.7.0/lunar.min.js"></script>
</head>
<body>
    <div id="content-wrapper">
        <div id="background-scanline-overlay"></div>
        <div id="text-scanline-overlay"></div>
        <div id="dateTimeDisplay">
            <div class="time-text" id="timeTextContainer">
                <span id="hoursMinutesDisplay"></span> <span class="time-seconds" id="secondsDisplay"></span> <span class="time-ampm" id="amPmDisplay"></span>
            </div>
            <div class="gregorian-date-text" id="gregorianDateDisplay"></div>
            <div class="lunar-and-jieqi-line" id="lunarAndJieqiLine">
                <span class="lunar-date-static-text" id="lunarDateDisplay"></span>
                <div class="jieqi-holiday-marquee-container" id="jieqiHolidayMarqueeContainer">
                    <div class="jieqi-holiday-marquee-inner" id="jieqiHolidayMarqueeInner">
                        <span class="jieqi-holiday-marquee-content"></span> <span class="jieqi-holiday-marquee-content-duplicate"></span>
                    </div>
                </div>
            </div>
        </div>
        <noscript><div class="noscript-message">您的瀏覽器不支援或已禁用 JavaScript。</div></noscript>
        <div class="modal" id="settingsModal"> <!-- 設定 Modal -->
            <div class="modal-content">
                <h2>顯示設定</h2>
                <div class="calendar-settings-container">
                    <div class="gregorian-settings-column">
                        <h3>公曆</h3>
                        <div class="setting-item"><label for="textColor">時間</label> <label class="switch" title="切換上午/下午格式"><input id="showAmPm" type="checkbox"> <span class="slider"></span></label> <input id="textColor" type="color" value="#00FF00"></div>
                        <div class="setting-item"><label for="showGregorianYear">年</label> <label class="switch"><input id="showGregorianYear" type="checkbox"> <span class="slider"></span></label> <input id="gregorianYearColor" type="color" value="#00FF00"></div>
                        <div class="setting-item"><label for="showGregorianMonth">月</label> <label class="switch"><input id="showGregorianMonth" type="checkbox"> <span class="slider"></span></label> <input id="gregorianMonthColor" type="color" value="#00FF00"></div>
                        <div class="setting-item"><label for="showGregorianDay">日</label> <label class="switch"><input id="showGregorianDay" type="checkbox"> <span class="slider"></span></label> <input id="gregorianDayColor" type="color" value="#00FF00"></div>
                        <div class="setting-item"><label for="showGregorianWeekday">周</label> <label class="switch"><input id="showGregorianWeekday" type="checkbox"> <span class="slider"></span></label> <input id="gregorianWeekdayColor" type="color" value="#00FF00"></div>
                    </div>
                    <div class="lunar-settings-column">
                        <h3>農曆</h3>
                        <div class="setting-item"><label for="showMinguoYear">年</label> <label class="switch"><input id="showMinguoYear" type="checkbox"> <span class="slider"></span></label> <input id="minguoYearColor" type="color" value="#00FF00"></div>
                        <div class="setting-item"><label for="showLunarMonth">月</label> <label class="switch"><input id="showLunarMonth" type="checkbox"> <span class="slider"></span></label> <input id="lunarMonthColor" type="color" value="#00FF00"></div>
                        <div class="setting-item"><label for="showLunarDay">日</label> <label class="switch"><input id="showLunarDay" type="checkbox"> <span class="slider"></span></label> <input id="lunarDayColor" type="color" value="#00FF00"></div>
                        <div class="setting-item"><label for="showLunarShiChen">時</label> <label class="switch"><input id="showLunarShiChen" type="checkbox"> <span class="slider"></span></label> <input id="lunarShiChenColor" type="color" value="#00FF00"></div>
                        <div class="setting-item"><label for="showJieqi">節氣</label> <label class="switch"><input id="showJieqi" type="checkbox"> <span class="slider"></span></label> <input id="jieqiColor" type="color" value="#00FF00"></div>
                        <div class="setting-item"><label for="showHolidays">節日</label> <label class="switch"><input id="showHolidays" type="checkbox"> <span class="slider"></span></label> <input id="holidayColor" type="color" value="#0000FF"></div>
                    </div>
                </div>
                <div class="setting-item"><label for="backgroundColor">背景特效與顏色</label> <label class="switch" title="切換背景掃描線特效"><input id="enableBackgroundScanline" type="checkbox"> <span class="slider"></span></label> <input id="backgroundColor" type="color" value="#000000"></div>
                <div class="setting-item"><label for="enableTextScanline">文字掃描線特效</label> <label class="switch"><input id="enableTextScanline" type="checkbox"> <span class="slider"></span></label></div>
                <div class="setting-item"><label for="enableMovement">隨機移動特效</label> <label class="switch"><input id="enableMovement" type="checkbox"> <span class="slider"></span></label></div>
                <div class="button-group"><button class="action-button" id="restoreDefaultsBtn">恢復預設</button> <button class="action-button" id="randomColorsBtn">隨機顏色</button> <button class="action-button" id="doneBtn">完成</button></div>
            </div>
        </div>
        <div class="modal" id="jieqiDetailsModal"> <!-- 節氣/節日 Modal -->
            <div class="modal-content jieqi-content">
                <h2>節氣與節日資訊</h2>
                <div id="jieqiDetailsContent" style="text-align: left;"></div><button class="action-button" id="closeJieqiDetailsBtn">關閉</button>
            </div>
        </div>
        <div class="modal" id="yijiDetailsModal"> <!-- 宜忌 Modal -->
            <div class="modal-content yiji-content">
                <h2>宜忌資訊</h2>
                <div id="yijiDetailsContent" style="text-align: left;"></div><button class="action-button" id="closeYijiDetailsBtn">關閉</button>
            </div>
        </div>
        <div class="modal" id="calendarModal"> <!-- 月曆 Modal -->
            <div class="calendar-content">
                <div class="calendar-header"><button id="prevMonthBtn">&lt;</button><h2 id="calendarMonthYear"></h2><button id="nextMonthBtn">&gt;</button></div>
                <div class="calendar-weekdays" id="calendarWeekdays"></div>
                <div class="calendar-grid" id="calendarGrid"></div><button class="action-button" id="closeCalendarBtn">關閉</button>
            </div>
        </div>
        <div class="modal" id="weeklyCalendarModal"> <!-- 周曆 Modal -->
            <div class="weekly-calendar-content">
                <div class="calendar-header"><button id="prevWeekBtn">&lt;</button><h2 id="weeklyCalendarTitle"></h2><button id="nextWeekBtn">&gt;</button></div>
                <div class="weekly-calendar-grid" id="weeklyCalendarGrid"></div><button class="action-button" id="closeWeeklyCalendarBtn">關閉</button>
            </div>
        </div>
        <div class="modal" id="yearlyCalendarModal"> <!-- 年曆 Modal -->
            <div class="yearly-calendar-content">
                <div class="calendar-header"><button id="prevYearBtn">&lt;</button><h2 id="yearlyCalendarTitle"></h2><button id="nextYearBtn">&gt;</button></div>
                <div class="yearly-calendar-grid" id="yearlyCalendarGrid"></div><button class="action-button" id="closeYearlyCalendarBtn">關閉</button>
            </div>
        </div>
    </div>
    <div id="fullscreen-icon" title="全螢幕/退出全螢幕"> <!-- 全螢幕圖示 -->
        <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"></path></svg>
    </div>
	<script>
		let lastSecondTensDigit = -1; // 用於追蹤秒數的十位數變化，觸發隨機移動和掃描線模式切換
		let scanlinePatternIsA = true; // 用於追蹤當前掃描線模式是A還是B
		let lastMarqueeContent = ''; // 用於判斷跑馬燈內容是否需要更新，避免不必要的DOM操作
		let calendarDate = new Date(); // 月曆顯示的當前日期
		let weeklyCalendarDate = new Date(); // 周曆顯示的當前日期
		let yearlyCalendarDate = new Date(); // 年曆顯示的當前日期
		let yearlyDataCache = { year: -1, holidays: [], jieqi: [] }; // 用於快取年度節日和節氣資料
		const defaultDisplaySettings = { // 預設顯示設定物件
			showAmPm: true, showGregorianYear: true, showGregorianMonth: true, showGregorianDay: true, showGregorianWeekday: true,
			showMinguoYear: true, showLunarMonth: true, showLunarDay: true, showLunarShiChen: true, showJieqi: true, showHolidays: true,
			textColor: '#00FF00', backgroundColor: '#000000', gregorianYearColor: '#00FF00', gregorianMonthColor: '#00FF00',
			gregorianDayColor: '#00FF00', gregorianWeekdayColor: '#00FF00', minguoYearColor: '#00FF00', lunarMonthColor: '#00FF00',
			lunarDayColor: '#00FF00', lunarShiChenColor: '#00FF00', jieqiColor: '#00FF00', holidayColor: '#00FFFF',
			enableTextScanline: false, enableBackgroundScanline: false, enableMovement: true
		};
		let displaySettings = { ...defaultDisplaySettings }; // 當前顯示設定，初始化為預設值

		function saveSettings() { try { localStorage.setItem('displaySettings', JSON.stringify(displaySettings)); } catch (e) { console.error("儲存設定至 localStorage 失敗:", e); } } // 將當前設定儲存到 localStorage
		function loadSettings() { // 從 localStorage 載入設定
			try {
				const settingsJson = localStorage.getItem('displaySettings'); // 從 localStorage 獲取設定字串
				if (settingsJson) { displaySettings = Object.assign({ ...defaultDisplaySettings }, JSON.parse(settingsJson)); } // 合併載入的設定與預設設定
			} catch (e) { console.error("從 localStorage 解析設定失敗:", e); displaySettings = { ...defaultDisplaySettings }; } // 載入失敗時使用預設設定
		}
		function updateSettingsModalUI() { // 更新設定彈出視窗的UI元素狀態
			for (const key in displaySettings) { // 遍歷所有設定
				const element = document.getElementById(key); // 獲取對應ID的元素
				if (element) { // 如果元素存在
					if (element.type === 'checkbox') { element.checked = displaySettings[key]; } // 如果是複選框，設定其選中狀態
					else if (element.type === 'color') { element.value = displaySettings[key]; } // 如果是顏色選擇器，設定其值
				}
			}
		}
		function getShengXiaoEmoji(shengXiaoName) { const emojiMap = { '鼠': '🐭', '牛': '🐮', '虎': '🐅', '兔': '🐰', '龍': '🐉', '蛇': '🐍', '馬': '🐎', '羊': '🐑', '猴': '🐒', '雞': '🐔', '狗': '🐶', '豬': '🐖' }; return emojiMap[shengXiaoName] || shengXiaoName; } // 根據生肖名稱返回對應的Emoji
		function getJieqiDescription(jieqiName) { const descriptions = { '立春': '春季開始，萬物復甦，氣溫回升。', '雨水': '降雨增多，草木萌動，春耕開始。', '驚蟄': '春雷響動，驚醒冬眠動物，氣溫漸升。', '春分': '晝夜等長，春意盎然，南北半球氣溫趨於平衡。', '清明': '氣候清爽明朗，萬物潔淨，是掃墓祭祖的日子。', '穀雨': '雨水滋潤，穀物生長，是播種移苗的好時節。', '立夏': '夏季開始，萬物繁茂，氣溫明顯升高。', '小滿': '麥類等夏熟作物籽粒開始飽滿，但尚未成熟。', '芒種': '有芒作物（如麥、稻）成熟，可以收穫和播種。', '夏至': '北半球白晝最長，陽氣最盛，是盛夏的開始。', '小暑': '天氣開始炎熱，但還未到最熱的時候。', '大暑': '一年中最炎熱的時期，濕熱交蒸。', '立秋': '秋季開始，氣溫逐漸下降，但仍有暑熱。', '處暑': '暑氣漸退，天氣轉涼，但仍有「秋老虎」。', '白露': '天氣轉涼，水氣凝結成露珠，天氣漸寒。', '秋分': '晝夜等長，秋高氣爽，是收穫的季節。', '寒露': '氣溫更低，露水更多，天氣轉冷。', '霜降': '天氣漸冷，露水凝結成霜，是秋季的最後一個節氣。', '立冬': '冬季開始，萬物收藏，氣溫顯著下降。', '小雪': '開始降雪，但雪量不大，氣溫持續走低。', '大雪': '降雪量增多，天氣更冷，冰凍現象常見。', '冬至': '北半球白晝最短，夜晚最長，是數九寒天的開始。', '小寒': '天氣寒冷，尚未達到最冷。', '大寒': '一年中最寒冷的時期，嚴寒冰凍。' }; return descriptions[jieqiName] || '此節氣無詳細說明。'; } // 根據節氣名稱返回詳細描述
		function getHolidays(year) { // 獲取指定年份的節日列表
			const holidays = [ { name: '元旦', date: new Date(year, 0, 1) }, { name: '和平紀念日', date: new Date(year, 1, 28) }, { name: '兒童節', date: new Date(year, 3, 4) }, { name: '清明節', date: new Date(year, 3, 4) }, { name: '勞動節', date: new Date(year, 4, 1) }, { name: '國慶日', date: new Date(year, 9, 10) }, { name: '聖誕節', date: new Date(year, 11, 25) } ]; // 公曆節日
			const lunarHolidays = [{m:1,d:1,n:'農曆新年'}, {m:5,d:5,n:'端午節'}, {m:7,d:15,n:'中元節'}, {m:8,d:15,n:'中秋節'}, {m:9,d:9,n:'重陽節'}]; // 農曆節日
			lunarHolidays.forEach(lh => { const solarDate = Lunar.fromYmd(year, lh.m, lh.d).getSolar(); holidays.push({ name: lh.n, date: new Date(solarDate.getYear(), solarDate.getMonth() - 1, solarDate.getDay()) }); }); // 計算農曆節日的公曆日期
			const nextLunarNewYearSolar = Lunar.fromYmd(year + 1, 1, 1).getSolar(); // 下一年農曆新年
			holidays.push({ name: '除夕', date: new Date(nextLunarNewYearSolar.getYear(), nextLunarNewYearSolar.getMonth() - 1, nextLunarNewYearSolar.getDay() - 1) }); // 計算除夕
			holidays.sort((a, b) => a.date.getTime() - b.date.getTime()); // 根據日期排序
			return holidays; // 返回節日列表
		}
		function getJieqiForYear(year) { // 獲取指定年份的節氣列表
			const jieqiNameMap = { '小寒': '小寒', '大寒': '大寒', '立春': '立春', '雨水': '雨水', '惊蛰': '驚蟄', '春分': '春分', '清明': '清明', '谷雨': '穀雨', '立夏': '立夏', '小满': '小滿', '芒种': '芒種', '夏至': '夏至', '小暑': '小暑', '大暑': '大暑', '立秋': '立秋', '处暑': '處暑', '白露': '白露', '秋分': '秋分', '寒露': '寒露', '霜降': '霜降', '立冬': '立冬', '小雪': '小雪', '大雪': '大雪', '冬至': '冬至' }; // 簡轉繁對照表
			const lunar = Lunar.fromYmd(year, 1, 1); // 獲取該年的一個lunar實例
			const jieqiTable = lunar.getJieQiTable(); // 從實例中獲取全年的節氣表
			return Object.entries(jieqiTable).map(([name, dateStr]) => ({ name: jieqiNameMap[name] || name, date: new Date(dateStr) })).sort((a, b) => a.date.getTime() - b.date.getTime()); // 將節氣表轉換為物件陣列並排序
		}
		function convertYiJiToTraditional(yijiArray) { // 轉換宜忌為繁體中文
			// 常用簡轉繁單字對照表，確保轉換的覆蓋範圍和準確性
			const s2tMap = {
				'开': '開', '纳': '納', '财': '財', '挂': '掛','梁': '樑', '动': '動', '种': '種', '启': '啟', '钻': '鑽','订': '訂', '竖': '豎', '门': '門', '词': '詞', '讼': '訟','发': '髮', '养': '養', '马': '馬', '经': '經', '络': '絡','盖': '蓋', '会': '會', '学': '學', '习': '習', '艺': '藝','医': '醫', '装': '裝', '帐': '帳', '殓': '殮', '结': '結','网': '網', '渔': '漁', '猎': '獵', '亲': '親', '进': '進', '扫': '掃',
			};

			// 遍歷宜忌陣列中的每一個詞
			return yijiArray.map(item => {
				// 使用 trim() 移除詞彙前後可能存在的空白字元
				const trimmedItem = item.trim();
				let traditionalItem = '';
				// 遍歷詞中的每一個字元
				for (let i = 0; i < trimmedItem.length; i++) {
					// 如果在對照表裡找到對應的繁體字，就用繁體字，否則用原來的字
					traditionalItem += s2tMap[trimmedItem[i]] || trimmedItem[i];
				}
				return traditionalItem;
			});
		}
		function getShiChen(h) { const shichenMap = { 23: '子', 0: '子', 1: '丑', 2: '丑', 3: '寅', 4: '寅', 5: '卯', 6: '卯', 7: '辰', 8: '辰', 9: '巳', 10: '巳', 11: '午', 12: '午', 13: '未', 14: '未', 15: '申', 16: '申', 17: '酉', 18: '酉', 19: '戌', 20: '戌', 21: '亥', 22: '亥' }; return shichenMap[h] || ''; } // 根據小時數獲取對應的時辰
		function getDetailedTimePeriod(hour) { const periodMap = { 0: '凌晨', 1: '凌晨', 2: '凌晨', 3: '凌晨', 4: '凌晨', 5: '清晨', 6: '清晨', 7: '清晨', 8: '清晨', 9: '上午', 10: '上午', 11: '上午', 12: '中午', 13: '下午', 14: '下午', 15: '下午', 16: '下午', 17: '傍晚', 18: '傍晚', 19: '夜晚', 20: '夜晚', 21: '夜晚', 22: '夜晚', 23: '深夜' }; return periodMap[hour] || ''; } // 根據小時數獲取詳細時間段描述
		function updateMarquee(combinedJieqiHolidayText) { // 更新節氣/節日跑馬燈顯示
			const marqueeContainer = document.getElementById('jieqiHolidayMarqueeContainer'), marqueeInner = document.getElementById('jieqiHolidayMarqueeInner');
			if (!marqueeContainer || !marqueeInner) return;
			const contentSpan = marqueeInner.querySelector('.jieqi-holiday-marquee-content'), duplicateSpan = marqueeInner.querySelector('.jieqi-holiday-marquee-content-duplicate');
			if (!contentSpan || !duplicateSpan) return;
			contentSpan.innerHTML = combinedJieqiHolidayText;
			requestAnimationFrame(() => { // 在下一幀動畫中執行
				const contentWidth = contentSpan.scrollWidth, containerWidth = marqueeContainer.offsetWidth;
				if (contentWidth > containerWidth) { // 如果內容寬度大於容器寬度，則滾動
					duplicateSpan.innerHTML = combinedJieqiHolidayText;
					marqueeContainer.classList.add('scrolling');
					marqueeInner.style.animationDuration = `${contentWidth / 50}s`;
					marqueeInner.style.animationPlayState = 'running';
				} else { // 否則停止滾動
					duplicateSpan.innerHTML = '';
					marqueeContainer.classList.remove('scrolling');
					marqueeInner.style.animationPlayState = 'paused';
				}
			});
		}
		function updateDateTime() { // 更新主畫面日期時間顯示
			const now = new Date();
			const backgroundOverlay = document.getElementById('background-scanline-overlay'), textOverlay = document.getElementById('text-scanline-overlay');
			const secondTensDigit = Math.floor(now.getSeconds() / 10);
			if (secondTensDigit !== lastSecondTensDigit) { // 每10秒觸發一次
				if(displaySettings.enableMovement) { moveRandomly(); }
				scanlinePatternIsA = !scanlinePatternIsA;
				lastSecondTensDigit = secondTensDigit;
			}
			backgroundOverlay.classList.toggle('active', displaySettings.enableBackgroundScanline); // 更新背景掃描線
			if (displaySettings.enableBackgroundScanline) { backgroundOverlay.classList.toggle('pattern-a', scanlinePatternIsA); backgroundOverlay.classList.toggle('pattern-b', !scanlinePatternIsA); }
			textOverlay.classList.toggle('active', displaySettings.enableTextScanline); // 更新文字掃描線
			if (displaySettings.enableTextScanline) { textOverlay.classList.toggle('pattern-a', !scanlinePatternIsA); textOverlay.classList.toggle('pattern-b', scanlinePatternIsA); }
			document.documentElement.style.setProperty('--page-background-color', displaySettings.backgroundColor);
			const parts = new Intl.DateTimeFormat('zh-Hant', { hour: 'numeric', minute: '2-digit', second: '2-digit', hour12: displaySettings.showAmPm }).formatToParts(now);
			const hourPart = parts.find(p => p.type === 'hour')?.value.padStart(2, '0') || '00', minutePart = parts.find(p => p.type === 'minute')?.value || '00', secondPart = parts.find(p => p.type === 'second')?.value || '00';
			document.getElementById('hoursMinutesDisplay').textContent = `${hourPart}:${minutePart}`;
			document.getElementById('secondsDisplay').textContent = secondPart;
			const amPmText = displaySettings.showAmPm ? getDetailedTimePeriod(now.getHours()) : '';
			document.getElementById('amPmDisplay').textContent = amPmText;
			document.getElementById('amPmDisplay').style.display = amPmText ? 'block' : 'none';
			document.getElementById('timeTextContainer').style.color = displaySettings.textColor;
			let gregorianParts = []; // 組合公曆日期
			if (displaySettings.showGregorianYear) gregorianParts.push(`<span class="gregorian-year-target" style="color: ${displaySettings.gregorianYearColor}; cursor: pointer;">${now.getFullYear()}年<\/span>`);
			if (displaySettings.showGregorianMonth) gregorianParts.push(`<span style="color: ${displaySettings.gregorianMonthColor};">${(now.getMonth() + 1).toString().padStart(2, '0')}月<\/span>`);
			if (displaySettings.showGregorianDay) gregorianParts.push(`<span style="color: ${displaySettings.gregorianDayColor};">${now.getDate().toString().padStart(2, '0')}日<\/span>`);
			if (displaySettings.showGregorianWeekday) gregorianParts.push(`<span class="weekday-target" style="color: ${displaySettings.gregorianWeekdayColor}; cursor: pointer;">周${['日', '一', '二', '三', '四', '五', '六'][now.getDay()]}<\/span>`);
			document.getElementById('gregorianDateDisplay').innerHTML = gregorianParts.join('');
			document.getElementById('gregorianDateDisplay').style.display = gregorianParts.length > 0 ? 'block' : 'none';
			let lunarParts = [], combinedJieqiHolidayText = ''; // 處理農曆、節氣、節日
			if (typeof Lunar !== 'undefined') {
				const currentYear = now.getFullYear(); // 獲取當前年份
				if (yearlyDataCache.year !== currentYear) { // 如果快取的年份不是今年，則更新快取
					yearlyDataCache = { year: currentYear, holidays: getHolidays(currentYear), jieqi: getJieqiForYear(currentYear) };
				}
				const solar = Solar.fromDate(now), lunar = solar.getLunar();
				if (displaySettings.showMinguoYear) lunarParts.push(`<span class="lunar-year-target" style="color: ${displaySettings.minguoYearColor}; cursor: pointer;">${now.getFullYear() - 1911}年${getShengXiaoEmoji(lunar.getYearShengXiao())}<\/span>`);
				if (displaySettings.showLunarMonth) lunarParts.push(`<span style="color: ${displaySettings.lunarMonthColor};">${lunar.getMonthInChinese().replace('闰', '閏')}月<\/span>`);
				if (displaySettings.showLunarDay) lunarParts.push(`<span class="lunar-day-target lunar-date-clickable" style="color: ${displaySettings.lunarDayColor};">${lunar.getDayInChinese()}<\/span>`);
				if (displaySettings.showLunarShiChen) lunarParts.push(`<span class="lunar-shichen-target lunar-shichen-clickable" style="color: ${displaySettings.lunarShiChenColor};">${getShiChen(now.getHours())}時<\/span>`);
				
				const allJieqis = yearlyDataCache.jieqi; // 從快取中獲取節氣
				let jieQiText = '', currentJieqiInfo = allJieqis.find(jq => jq.date.toDateString() === now.toDateString());
				if (!currentJieqiInfo) { currentJieqiInfo = allJieqis.find(jq => jq.date > now); }
				if (displaySettings.showJieqi && currentJieqiInfo) {
					const diffTime = currentJieqiInfo.date.getTime() - now.getTime();
					const daysUntil = Math.ceil(diffTime / 86400000);
					jieQiText = (daysUntil === 0) ? `${currentJieqiInfo.name}` : `${daysUntil}➡${currentJieqiInfo.name}`;
				}
				const holidays = yearlyDataCache.holidays; // 從快取中獲取節日
				let holidayText = '', currentHolidayInfo = holidays.find(h => h.date.toDateString() === now.toDateString());
				if (!currentHolidayInfo) { currentHolidayInfo = holidays.find(h => h.date > now); }
				if (displaySettings.showHolidays && currentHolidayInfo) {
					const diffTime = currentHolidayInfo.date.getTime() - now.getTime();
					const daysUntil = Math.ceil(diffTime / 86400000);
					holidayText = (daysUntil === 0) ? `${currentHolidayInfo.name}` : `${daysUntil}➡${currentHolidayInfo.name}`;
				}
				let marqueeParts = [];
				if(jieQiText) marqueeParts.push(`<span style="color: ${displaySettings.jieqiColor};">${jieQiText}<\/span>`);
				if(holidayText) marqueeParts.push(`<span style="color: ${displaySettings.holidayColor};">${holidayText}<\/span>`);
				combinedJieqiHolidayText = marqueeParts.join(' ');
				
				const marqueeContainer = document.getElementById('jieqiHolidayMarqueeContainer'); // 將詳細資訊存儲到data屬性中
				marqueeContainer.dataset.jieqiName = currentJieqiInfo ? currentJieqiInfo.name : '';
				marqueeContainer.dataset.jieqiDate = currentJieqiInfo ? currentJieqiInfo.date.toISOString() : '';
				marqueeContainer.dataset.daysUntilNextJieqi = currentJieqiInfo ? Math.ceil((currentJieqiInfo.date.getTime() - now.getTime()) / 86400000) : '';
				marqueeContainer.dataset.currentHolidayName = holidays.find(h => h.date.toDateString() === now.toDateString())?.name || '';
				const nextHolidayInfo = holidays.find(h => h.date > now);
				marqueeContainer.dataset.nextHolidayName = nextHolidayInfo ? nextHolidayInfo.name : '';
				marqueeContainer.dataset.nextHolidayDate = nextHolidayInfo ? nextHolidayInfo.date.toISOString() : '';
				marqueeContainer.dataset.nextHolidayDaysUntil = nextHolidayInfo ? Math.ceil((nextHolidayInfo.date.getTime() - now.getTime()) / 86400000) : '';
			}
			document.getElementById('lunarDateDisplay').innerHTML = lunarParts.join('');
			document.getElementById('lunarDateDisplay').style.display = lunarParts.length > 0 ? 'inline-block' : 'none';
			const marqueeIsVisible = displaySettings.showJieqi || displaySettings.showHolidays;
			document.getElementById('jieqiHolidayMarqueeContainer').style.display = marqueeIsVisible ? 'block' : 'none';
			if (marqueeIsVisible && lastMarqueeContent !== combinedJieqiHolidayText) { updateMarquee(combinedJieqiHolidayText); lastMarqueeContent = combinedJieqiHolidayText; }
			else if (!marqueeIsVisible && lastMarqueeContent !== '') { updateMarquee(''); lastMarqueeContent = ''; }
		}
		function moveRandomly() { // 隨機移動日期時間顯示元素
			const displayElement = document.getElementById('dateTimeDisplay'), viewportWidth = window.innerWidth, viewportHeight = window.innerHeight;
			const elementRect = displayElement.getBoundingClientRect(), safeMargin = 20;
			const maxX = (viewportWidth - elementRect.width) / 2 - safeMargin, maxY = (viewportHeight - elementRect.height) / 2 - safeMargin;
			const newTargetX = Math.random() * (maxX * 2) - maxX, newTargetY = Math.random() * (maxY * 2) - maxY;
			displayElement.style.transform = `translate(calc(-50% + ${newTargetX}px), calc(-60% + ${newTargetY}px))`;
		}
		function resetPosition() { document.getElementById('dateTimeDisplay').style.transform = `translate(-50%, -60%)`; } // 重設日期時間顯示元素的位置
		function restoreDefaults() { displaySettings = { ...defaultDisplaySettings }; saveSettings(); updateSettingsModalUI(); scanlinePatternIsA = true; if (displaySettings.enableMovement) { moveRandomly(); } else { resetPosition(); } lastMarqueeContent = ''; updateDateTime(); } // 恢復所有設定為預設值
		function getRandomColor() { return '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0'); } // 獲取一個隨機的十六進制顏色碼
		function setRandomColors() { for (const key in displaySettings) { if (key.toLowerCase().includes('color')) { displaySettings[key] = getRandomColor(); } } saveSettings(); updateSettingsModalUI(); updateDateTime(); } // 設定所有顏色相關的設定為隨機顏色
		function generateCalendar(year, month) { // 生成月曆
			const grid = document.getElementById('calendarGrid'), monthYear = document.getElementById('calendarMonthYear'), weekdays = document.getElementById('calendarWeekdays');
			if(!grid || !monthYear || !weekdays) return;
			grid.innerHTML = ''; weekdays.innerHTML = '';
			['日', '一', '二', '三', '四', '五', '六'].forEach(day => { const el = document.createElement('div'); el.textContent = day; weekdays.appendChild(el); });
			monthYear.textContent = `${year}年 ${month + 1}月`;
			const firstDay = new Date(year, month, 1).getDay(), daysInMonth = new Date(year, month + 1, 0).getDate(), today = new Date();
			for (let i = 0; i < 42; i++) {
				const cell = document.createElement('div'); cell.classList.add('calendar-day');
				const dayNum = i - firstDay + 1;
				if (dayNum > 0 && dayNum <= daysInMonth) {
					const date = new Date(year, month, dayNum), lunar = Solar.fromDate(date).getLunar();
					cell.innerHTML = `<div class="gregorian-day">${dayNum}<\/div><div class="lunar-day">${lunar.getDay() === 1 ? lunar.getMonthInChinese().replace('闰', '閏') + '月' : lunar.getDayInChinese()}<\/div>`;
					if (today.getFullYear() === year && today.getMonth() === month && dayNum === today.getDate()) { cell.classList.add('is-today'); }
				} else { cell.classList.add('other-month'); }
				grid.appendChild(cell);
			}
		}
		function generateWeekCalendar(baseDate) { // 生成周曆
			const grid = document.getElementById('weeklyCalendarGrid'), title = document.getElementById('weeklyCalendarTitle');
			if (!grid || !title) return;
			grid.innerHTML = '';
			const today = new Date(), startOfWeek = new Date(baseDate);
			startOfWeek.setDate(baseDate.getDate() - baseDate.getDay());
			const endOfWeek = new Date(startOfWeek); endOfWeek.setDate(startOfWeek.getDate() + 6);
			title.textContent = `${startOfWeek.getFullYear()}年${startOfWeek.getMonth() + 1}月${startOfWeek.getDate()}日 - ${endOfWeek.getFullYear()}年${endOfWeek.getMonth() + 1}月${endOfWeek.getDate()}日`;
			const weekdays = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'];
			for (let i = 0; i < 7; i++) {
				const day = new Date(startOfWeek); day.setDate(startOfWeek.getDate() + i);
				const cell = document.createElement('div'); cell.classList.add('weekly-calendar-day');
				if (day.toDateString() === today.toDateString()) { cell.classList.add('is-today'); }
				const lunar = Solar.fromDate(day).getLunar();
				cell.innerHTML = `<div class="weekly-day-header">${weekdays[i]}<\/div><div class="weekly-gregorian-day">${day.getDate()}<\/div><div class="weekly-lunar-day">${lunar.getDay() === 1 ? lunar.getMonthInChinese().replace('闰', '閏') + '月' : lunar.getDayInChinese()}<\/div>`;
				grid.appendChild(cell);
			}
		}
		function generateYearCalendar(year) { // 生成年曆
			const grid = document.getElementById('yearlyCalendarGrid'), title = document.getElementById('yearlyCalendarTitle');
			if (!grid || !title) return;
			grid.innerHTML = ''; title.textContent = `${year}年`;
			const today = new Date(), weekdays = ['日', '一', '二', '三', '四', '五', '六'];
			for (let month = 0; month < 12; month++) {
				const monthContainer = document.createElement('div'); monthContainer.classList.add('yearly-month-container');
				const monthHeader = document.createElement('div'); monthHeader.classList.add('yearly-month-header'); monthHeader.textContent = `${month + 1}月`; monthContainer.appendChild(monthHeader);
				const weekdaysDiv = document.createElement('div'); weekdaysDiv.classList.add('yearly-weekdays');
				weekdays.forEach(day => { const el = document.createElement('div'); el.textContent = day; weekdaysDiv.appendChild(el); });
				monthContainer.appendChild(weekdaysDiv);
				const dayGrid = document.createElement('div'); dayGrid.classList.add('yearly-day-grid');
				const firstDay = new Date(year, month, 1).getDay(), daysInMonth = new Date(year, month + 1, 0).getDate();
				for (let i = 0; i < firstDay; i++) { dayGrid.appendChild(document.createElement('div')); }
				for (let day = 1; day <= daysInMonth; day++) {
					const cell = document.createElement('div'); cell.classList.add('yearly-day'); cell.textContent = day;
					if (today.getFullYear() === year && today.getMonth() === month && day === today.getDate()) { cell.classList.add('is-today'); }
					dayGrid.appendChild(cell);
				}
				monthContainer.appendChild(dayGrid);
				grid.appendChild(monthContainer);
			}
		}
		window.onload = function () { // 頁面載入完成後執行
			loadSettings();
			updateSettingsModalUI();
			updateDateTime();
			setInterval(updateDateTime, 1000);
			if (!displaySettings.enableMovement) { resetPosition(); }
			document.querySelectorAll('.modal').forEach(modal => { // 處理所有彈出視窗的關閉邏輯
				const closeButton = modal.querySelector('.action-button[id^="close"], .action-button[id^="done"]');
				if (closeButton) { closeButton.onclick = () => modal.classList.remove('is-active'); }
				modal.addEventListener('click', (event) => { if (event.target === modal) { modal.classList.remove('is-active'); } });
			});
			document.getElementById('prevMonthBtn').onclick = () => { calendarDate.setMonth(calendarDate.getMonth() - 1); generateCalendar(calendarDate.getFullYear(), calendarDate.getMonth()); };
			document.getElementById('nextMonthBtn').onclick = () => { calendarDate.setMonth(calendarDate.getMonth() + 1); generateCalendar(calendarDate.getFullYear(), calendarDate.getMonth()); };
			document.getElementById('prevWeekBtn').onclick = () => { weeklyCalendarDate.setDate(weeklyCalendarDate.getDate() - 7); generateWeekCalendar(weeklyCalendarDate); };
			document.getElementById('nextWeekBtn').onclick = () => { weeklyCalendarDate.setDate(weeklyCalendarDate.getDate() + 7); generateWeekCalendar(weeklyCalendarDate); };
			document.getElementById('prevYearBtn').onclick = () => { yearlyCalendarDate.setFullYear(yearlyCalendarDate.getFullYear() - 1); generateYearCalendar(yearlyCalendarDate.getFullYear()); };
			document.getElementById('nextYearBtn').onclick = () => { yearlyCalendarDate.setFullYear(yearlyCalendarDate.getFullYear() + 1); generateYearCalendar(yearlyCalendarDate.getFullYear()); };
			document.querySelectorAll('.switch input[type="checkbox"]').forEach(toggle => { // 處理所有開關
				toggle.onchange = (event) => {
					displaySettings[event.target.id] = event.target.checked;
					if (event.target.id === 'enableMovement' && !event.target.checked) { resetPosition(); }
					saveSettings(); lastMarqueeContent = ''; updateDateTime();
				};
			});
			document.querySelectorAll('input[type="color"]').forEach(colorInput => { // 處理所有顏色選擇器
				colorInput.oninput = (event) => { displaySettings[event.target.id] = event.target.value; saveSettings(); updateDateTime(); };
			});
			document.getElementById('restoreDefaultsBtn').onclick = restoreDefaults;
			document.getElementById('randomColorsBtn').onclick = setRandomColors;
			document.getElementById('dateTimeDisplay').addEventListener('click', function(event) { // 主顯示區域的點擊事件委派
				const target = event.target;
				if (target.closest('#secondsDisplay')) { document.getElementById('settingsModal').classList.add('is-active'); updateSettingsModalUI(); }
				else if (target.closest('.lunar-day-target') || target.closest('.lunar-shichen-target')) {
					const now = new Date();
					const lunar = Solar.fromDate(now).getLunar();
					const isShiChen = !!target.closest('.lunar-shichen-target');
					let yijiHtml = '';

					if (isShiChen) {
						const timeYi = convertYiJiToTraditional(lunar.getTimeYi()).join('、') || '無';
						const timeJi = convertYiJiToTraditional(lunar.getTimeJi()).join('、') || '無';
						yijiHtml = `<p><strong>時辰：<\/strong> ${getShiChen(now.getHours())}時<\/p><p style="margin-top: 15px;"><strong>宜：<\/strong> ${timeYi}<\/p><p style="margin-top: 15px;"><strong>忌：<\/strong> ${timeJi}<\/p>`;
					} else {
						const dayYi = convertYiJiToTraditional(lunar.getDayYi()).join('、') || '無';
						const dayJi = convertYiJiToTraditional(lunar.getDayJi()).join('、') || '無';
						yijiHtml = `<p><strong>農曆日期：<\/strong> ${lunar.getMonthInChinese().replace('闰', '閏')}月${lunar.getDayInChinese()}<\/p><p style="margin-top: 15px;"><strong>宜：<\/strong> ${dayYi}<\/p><p style="margin-top: 15px;"><strong>忌：<\/strong> ${dayJi}<\/p>`;
					}
					
					document.getElementById('yijiDetailsContent').innerHTML = yijiHtml + `<p style="margin-top: 15px; font-size: 0.9em; color: #aaa;">宜忌僅供參考，請勿過度迷信。<\/p>`;
					document.getElementById('yijiDetailsModal').classList.add('is-active');
				}
				else if (target.closest('#jieqiHolidayMarqueeContainer')) {
					const marqueeEl = target.closest('#jieqiHolidayMarqueeContainer');
					const jieqiName = marqueeEl.dataset.jieqiName, jieqiDateStr = marqueeEl.dataset.jieqiDate, daysUntilJieqi = marqueeEl.dataset.daysUntilNextJieqi;
					const currentHoliday = marqueeEl.dataset.currentHolidayName, nextHolidayName = marqueeEl.dataset.nextHolidayName, nextHolidayDateStr = marqueeEl.dataset.nextHolidayDate, daysUntilHoliday = marqueeEl.dataset.nextHolidayDaysUntil;
					let detailsHtml = '';
					if (jieqiName && jieqiDateStr) {
						const date = new Date(jieqiDateStr), formattedDate = `${date.getFullYear()}年${(date.getMonth() + 1)}月${date.getDate()}日`;
						detailsHtml += (parseInt(daysUntilJieqi) === 0) ? `<p>今天 <strong>${jieqiName}<\/strong><\/p>` : `<p>${formattedDate} <strong>${jieqiName}<\/strong> 還有${daysUntilJieqi}天<\/p>`;
						detailsHtml += `<p style="margin-top: 10px; font-size: 1.2em;">${getJieqiDescription(jieqiName)}<\/p>`;
					} else { detailsHtml += `<p>目前沒有節氣資訊。<\/p>`; }
					detailsHtml += `<hr style="margin: 20px 0; border-color: #555;">`;
					if (currentHoliday) { detailsHtml += `<p>今天 <strong>${currentHoliday}<\/strong><\/p>`; } 
					else if (nextHolidayName && nextHolidayDateStr) {
						const date = new Date(nextHolidayDateStr), formattedDate = `${date.getFullYear()}年${(date.getMonth() + 1)}月${date.getDate()}日`;
						detailsHtml += `<p>${formattedDate} <strong>${nextHolidayName}<\/strong> 還有${daysUntilHoliday}天<\/p>`;
					} else { detailsHtml += `<p>目前沒有節日資訊。<\/p>`; }
					document.getElementById('jieqiDetailsContent').innerHTML = detailsHtml;
					document.getElementById('jieqiDetailsModal').classList.add('is-active');
				}
				else if (target.closest('.gregorian-year-target') || target.closest('.lunar-year-target')) { yearlyCalendarDate = new Date(); generateYearCalendar(yearlyCalendarDate.getFullYear()); document.getElementById('yearlyCalendarModal').classList.add('is-active'); }
				else if (target.closest('.weekday-target')) { weeklyCalendarDate = new Date(); generateWeekCalendar(weeklyCalendarDate); document.getElementById('weeklyCalendarModal').classList.add('is-active'); }
				else if (target.closest('.gregorian-date-text') || target.closest('.lunar-date-static-text')) { calendarDate = new Date(); generateCalendar(calendarDate.getFullYear(), calendarDate.getMonth()); document.getElementById('calendarModal').classList.add('is-active'); }
			});
			const fullscreenIcon = document.getElementById('fullscreen-icon'), docElement = document.documentElement; // --- 全螢幕功能 ---
			function toggleFullScreen() {
				const isFullscreen = document.fullscreenElement || document.webkitFullscreenElement;
				if (!isFullscreen) { const req = docElement.requestFullscreen || docElement.webkitRequestFullscreen; if (req) { req.call(docElement).catch(err => console.warn(`無法進入全螢幕模式: ${err.message}`)); } }
				else { const exit = document.exitFullscreen || document.webkitExitFullscreen; if (exit) { exit.call(document).catch(err => console.warn(`無法退出全螢幕模式: ${err.message}`)); } }
			}
			fullscreenIcon.addEventListener('click', toggleFullScreen);
			function handleFullscreenChange() {
				const isFullscreen = document.fullscreenElement || document.webkitFullscreenElement;
				fullscreenIcon.style.display = isFullscreen ? 'none' : 'block';
				if (lastMarqueeContent) { updateMarquee(lastMarqueeContent); }
			}
			document.addEventListener('fullscreenchange', handleFullscreenChange);
			document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
			let inactivityTimer; // --- 全螢幕圖示閒置隱藏功能 ---
			function hideIconOnIdle() { fullscreenIcon.style.opacity = '0'; }
			function resetIdleTimer() {
				if (fullscreenIcon.style.display !== 'none') { fullscreenIcon.style.opacity = '0.5'; }
				clearTimeout(inactivityTimer);
				inactivityTimer = setTimeout(hideIconOnIdle, 10000);
			}
			['mousemove', 'keydown', 'touchstart'].forEach(evt => document.addEventListener(evt, resetIdleTimer));
			resetIdleTimer();
		};
	</script>
</body>
</html>
