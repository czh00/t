<!DOCTYPE html>
<html lang="zh-Hant">
<head>
	<meta charset="UTF-8">
	<meta content="width=device-width, initial-scale=1.0" name="viewport">
	<title>æ™‚é–“</title>
	<script src="https://unpkg.com/lunar-javascript@1.7.3/lunar.js"></script>
	<link href="https://fonts.cdnfonts.com/css/digital-dismay" rel="stylesheet">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
	<style>
		:root {
			--page-background-color: #000; --highlight-color: #ff5b3f; --hour-hand-color: #fff; --minute-hand-color: #fff;
			--second-hand-color: #ff5b3f; --tick-color: #fff; --number-color: #fff; --calendar-header-color: #ff5b3f;
			--calendar-weekday-color: #00ffff; --calendar-day-color: #fff; --calendar-lunar-color: #aaa;
		}
		*, *::before, *::after { box-sizing: border-box; }
		body { margin: 0; overflow: hidden; display: flex; justify-content: center; align-items: center; min-height: 100vh; width: 100vw; position: relative; font-family: 'Noto Sans TC', sans-serif; background-color: var(--page-background-color); color: #fff; }
		.modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.8); }
		.modal.is-active { display: flex; justify-content: center; align-items: center; }
		#calendarModal, #weeklyCalendarModal, #yearlyCalendarModal { z-index: 110; }
		#dateDetailsModal, #shichenDetailsModal, #weatherForecastModal, #hourlyWeatherModal, #moonPhaseModal, #zodiacModal { z-index: 120; }
		#settingsModal { z-index: 130; }
		.modal-content { background-color: #333; margin: auto; padding: 20px; border: 1px solid #888; width: 90%; max-width: 600px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); color: #e0e0e0; text-align: center; display: flex; flex-direction: column; gap: 0px; max-height: 90vh; overflow-y: auto; position: relative; }
		.modal-header { display: flex; justify-content: space-between; align-items: center; padding: 0 10px; width: 100%; }
		.modal-header h2, .modal-header h3 { margin: 0; font-size: 1.5em; color: #00FF00; flex-grow: 1; text-align: center; }
		.modal-header button { background: none; border: none; color: #00FF00; font-size: 2em; cursor: pointer; flex-shrink: 0; }
		.close-icon { position: absolute; top: 8px; right: 12px; font-size: 1.25rem; font-weight: bold; color: #fff; cursor: pointer; line-height: 1; transition: color 0.3s; z-index: 10; user-select: none; }
		.close-icon:hover { color: var(--highlight-color); }
		.action-button { background-color: #555; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 1.1em; margin-top: 0px; }
		.action-button:hover { background-color: #777; }
		.button-group { display: flex; justify-content: center; gap: 10px; margin-top: 20px; white-space: nowrap; flex-wrap: wrap; }
		.calendar-footer { display: flex; justify-content: center; gap: 10px; width: 100%; margin-top: 10px; }
		.control-icon { position: fixed; bottom: 20px; width: 32px; height: 32px; cursor: pointer; z-index: 200; opacity: 0.5; transition: opacity 0.3s ease; }
		.control-icon svg { width: 100%; height: 100%; fill: #fff; }
		.control-icon:hover { opacity: 1; }
		#edit-mode-icon { right: 104px; }
		#settings-icon { right: 62px; }
		#fullscreen-icon { right: 20px; }
		#settingsModal .modal-content { max-width: 850px; }
		.setting-item { margin-bottom: 6px; display: flex; align-items: center; flex-wrap: nowrap; gap: 10px; transition: opacity 0.3s ease; }
		.setting-item label:first-child { margin-right: auto; flex-shrink: 0;}
		.setting-item.disabled { opacity: 0.5; pointer-events: none; }
		.setting-item.disabled input, .setting-item.disabled select, .setting-item.disabled button { pointer-events: none; }
		.switch { position: relative; display: inline-block; width: 48px; height: 27px; flex-shrink: 0; }
		.switch input { opacity: 0; width: 0; height: 0; }
		.slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 27px; }
		.slider:before { position: absolute; content: ""; height: 21px; width: 21px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
		input:checked + .slider { background-color: #00FF00; }
		input:focus + .slider { box-shadow: 0 0 1px #00FF00; }
		input:checked + .slider:before { transform: translateX(21px); }
		.setting-item input[type="color"] { width: 32px; height: 27px; border: none; padding: 0; background: none; cursor: pointer; flex-shrink: 0; }
		.setting-item input[type="text"] { background-color: #555; color: white; border: 1px solid #888; border-radius: 4px; padding: 5px; font-size: 0.9em; max-width: 100px; }
		.setting-item button { background: none; border: none; cursor: pointer; padding: 0 5px; display: inline-flex; align-items: center; }
		.setting-item button svg { width: 24px; height: 24px; stroke: white; }
		.setting-controls { display: flex; align-items: center; gap: 5px; }
		.interval-selector-group { display: flex; align-items: center; gap: 2px; }
		.interval-select { background-color: #555; color: white; border: 1px solid #888; border-radius: 4px; padding: 5px; font-size: 0.9em; }
		.interval-select-label { color: #ccc; font-size: 0.9em; margin: 0; padding: 0 2px; }
		.random-color-btn { background: #555; border: 1px solid #888; border-radius: 5px; cursor: pointer; padding: 0; font-size: 1.2em; line-height: 1; }
		.random-color-btn:hover { background: #777; }
		.location-input-group { display: flex; align-items: center; gap: 5px; flex-grow: 1; }
		.location-controls-group { display: flex; align-items: center; gap: 5px; margin-left: auto; }
		.settings-columns-container { display: flex; flex-wrap: wrap; gap: 0px; justify-content: space-around; width: 100%; }
		.settings-column { flex: 1; min-width: 200px; padding: 10px; border: 1px solid #555; border-radius: 8px; background-color: #444; text-align: left; }
		.settings-column h3 { text-align: center; margin: 0; color: #00FF00; }
		.calendar-content, .weekly-calendar-content { background-color: #2c2c2c; margin: auto; padding: 20px; border: 1px solid #888; border-radius: 10px; width: 95%; max-width: 900px; }
		.yearly-calendar-content { background-color: #2c2c2c; margin: auto; padding: 20px; border: 1px solid #888; border-radius: 10px; width: 95%; max-width: 1400px; }
		.calendar-weekdays, .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
		#calendarModal .calendar-grid { max-height: 65vh; overflow-y: auto; }
		.calendar-weekdays div { font-weight: bold; padding-bottom: 5px; text-align: center; color: #aaa; }
		.calendar-day { border-radius: 5px; padding: 5px; min-height: 80px; display: flex; flex-direction: column; justify-content: flex-start; align-items: center; font-size: 0.9em; border: 1px solid #555; cursor: pointer; transition: background-color: 0.3s; }
		.calendar-day.is-today { border-color: #00FF00; box-shadow: 0 0 5px #00FF00; }
		.calendar-day .gregorian-day { font-size: 1.2em; font-weight: bold; }
		.calendar-day .lunar-day { font-size: 0.8em; color: #ccc; white-space:nowrap; }
		.calendar-day .event-indicator { font-size: 1em; padding: 1px 4px; border-radius: 3px; margin-top: 3px; display: block; text-align: center; width: 90%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; margin: 0; }
		.event-indicator.holiday { background-color: #007bff; color: white; }
		.event-indicator.jieqi { background-color: #28a745; color: white; }
		.weekly-calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
		.weekly-calendar-day { border-radius: 8px; padding: 10px; min-height: 100px; display: flex; flex-direction: column; align-items: center; border: 1px solid #555; cursor: pointer; transition: background-color: 0.3s; }
		.weekly-calendar-day.is-today { border-color: #00FF00; box-shadow: 0 0 5px #00FF00; }
		.weekly-day-header { font-weight: bold; font-size: 1.1em; margin-bottom: 5px; }
		.weekly-gregorian-day { font-size: 1.5em; font-weight: bold; }
		.weekly-lunar-day { font-size: 0.9em; color: #ccc; margin-top: 5px; }
		.weekly-calendar-day .event-indicator { font-size: 0.8em; padding: 2px 5px; border-radius: 4px; margin-top: 5px; display: block; text-align: center; width: 90%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}
		.yearly-calendar-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; overflow-y: auto; padding: 10px; max-height: 75vh; }
		.yearly-month-header { font-size: 1.2em; font-weight: bold; text-align: center; margin-bottom: 10px; color: #00FF00; cursor: pointer; }
		.yearly-weekdays, .yearly-day-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px; text-align: center; }
		.yearly-weekdays div { font-size: 0.8em; color: #aaa; }
		.yearly-day { font-size: 0.9em; padding: 2px; border-radius: 3px; position: relative; cursor: pointer; transition: background-color: 0.3s; min-height: 24px; }
		.yearly-day.is-today { background-color: #00FF00; color: #000; font-weight: bold; }
		.yearly-indicators { position: absolute; bottom: 1px; left: 50%; transform: translateX(-50%); display: flex; gap: 2px; }
		.yearly-indicators .dot { width: 4px; height: 4px; border-radius: 50%; }
		.yearly-indicators .holiday { background-color: #007bff; }
		.yearly-indicators .jieqi { background-color: #28a745; }
		.details-content { max-width: 800px; text-align: left;}
		.details-content p { margin-bottom: 10px; font-size: 1.2em; line-height: 1.6; }
		.details-content strong { color: #FFD700; }
		.details-content .yi-ji-grid { display: grid; grid-template-columns: 40px 1fr; gap: 5px 10px; text-align: left;}
		.details-content .yi-ji-grid strong { grid-column: 1; color: #FFD700; }
		.details-content .yi-ji-grid span { grid-column: 2; }
		.details-content .countdown-section { border-top: 1px solid #555; margin-top: 15px; padding-top: 15px; font-size: 1em; }
		#weatherForecastModal .modal-content, #hourlyWeatherModal .modal-content { max-width: 1000px; }
		.weather-forecast-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(90px, 1fr)); gap: 10px; width: 100%; text-align: center; }
		.forecast-day { background-color: #444; padding: 10px; border-radius: 8px; border: 1px solid #555; cursor: pointer; transition: background-color: 0.3s; }
		.forecast-day:hover { background-color: #5e5e5e; }
		.forecast-day p { margin: 2px 0; font-size: 1em; line-height: 1.4; }
		.forecast-day .day-name { font-weight: bold; color: #FFD700; }
		.forecast-day .weather-icon { margin: 5px 0; height: 2.5em; }
		.forecast-day .temp-high { color: #FFA07A; }
		.forecast-day .temp-low { color: #87CEFA; }
		.hourly-weather-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 10px; width: 100%; text-align: center; }
		.hourly-item { background-color: #444; padding: 10px; border-radius: 8px; border: 1px solid #555; }
		.hourly-item p { margin: 2px 0; font-size: 0.9em; line-height: 1.3; }
		.hourly-item .hour-time { font-weight: bold; color: #FFD700; }
		.hourly-item .weather-icon { margin: 4px 0; height: 2em; }
		.hourly-item.is-now { border-color: #00FF00; box-shadow: 0 0 8px #00FF00; }
		#moonPhaseModal .modal-content { max-width: 500px; }
		#moonPhaseModalContent { display: flex; flex-direction: column; align-items: center; gap: 20px; text-align: center; }
		#moonPhaseDisplay { display: flex; flex-direction: column; align-items: center; gap: 15px; width: 100%; }
		#moonPhaseDisplay .moon-phase-icon-large { line-height: 1; }
		#moonPhaseDisplay p { font-size: 1.1em; line-height: 1.6; max-width: 400px; margin: 0; }
		.moon-calendar-container { width: 100%; max-width: 400px; margin-top: 15px; border-top: 1px solid #555; padding-top: 15px; }
		#moonCalendarGrid .calendar-day { min-height: 65px; padding: 2px; font-size: 0.8em; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 2px; }
		#moonCalendarGrid .calendar-day .gregorian-day { font-size: 1.1em; }
		#moonCalendarGrid .moon-phase-icon-small svg, #moonCalendarGrid .moon-phase-icon-small img { width: 24px; height: 24px; }
		#moonCalendarGrid .calendar-day.is-selected { border-color: #FFD700; box-shadow: 0 0 8px #FFD700; background-color: #5a5a5a; }
		#moonCalendarGrid .lunar-day { font-size: 0.75em; color: #ccc; }
		#zodiacModal .modal-content { max-width: 800px; }
		.zodiac-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 15px; width: 100%; text-align: center; }
		.zodiac-item { background-color: #444; padding: 10px; border-radius: 8px; border: 1px solid #555; }
		.zodiac-item .zodiac-icon { height: 4em; margin-bottom: 5px; }
		.zodiac-item p { margin: 0; font-weight: bold; }
		#master-layout { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); transition: transform 1s ease-in-out; will-change: transform; z-index: 2; }
		.widget-wrapper { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); transition: transform 1s ease-in-out; will-change: transform; z-index: 10; display: inline-flex; justify-content: center; align-items: center; }
		body.edit-mode .widget-wrapper { cursor: grab; }
		#dateTimeDisplay { font-family: 'Digital Dismay', 'Noto Sans TC', sans-serif; font-weight: bold; text-align: center; padding: 10px; text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5); cursor: default; z-index: 10; }
		.time-text { font-size: 42vw; font-weight: normal; margin-bottom: -8vw; position: relative; display: inline-flex; align-items: baseline; gap: 0; white-space: nowrap; padding-right: 1vw; line-height: 0.7; }
		.time-colon { line-height: 1; display: inline-flex; align-items: center; justify-content: center; }
		.time-colon svg { fill: currentColor; position: relative; top: 0.05em; height: 0.6em; }
		.time-seconds { font-size: 8vw; font-weight: normal; position: absolute; right: 0vw; bottom: 1vw; text-align: right; width: 6vw; }
		.time-ampm { font-size: 4.2vw; font-weight: bold; position: absolute; top: 1vw; right: 0vw; text-align: right; width: 8vw; }
		#hoursDisplay, #minutesDisplay, #secondsDisplay { position: relative; }
		#hoursDisplay::before, #minutesDisplay::before, #secondsDisplay::before {
			content: '88';
			position: absolute;
			top: 0; left: 0;
			width: 100%; height: 100%;
			color: rgba(255, 255, 255, 0.1);
			z-index: -1;
			display: flex;
			justify-content: center;
			align-items: baseline;
		}
		.gregorian-date-text, .lunar-and-jieqi-line { font-family: 'Noto Sans TC', 'Inter', sans-serif; display: flex; justify-content: center; align-items: baseline; white-space: nowrap; cursor: default; position: relative; z-index: 1; width: 92vw; font-weight: 1000; padding: 0.1vw 0; line-height: 0.9; }
		.gregorian-date-text { font-size: 6.5vw; }
		.lunar-and-jieqi-line { font-size: 6.25vw; }
		.gregorian-date-parts, .lunar-date-static-text { flex-shrink: 0; }
		.gregorian-date-parts span, .lunar-date-static-text span, .lunar-date-static-text .lunar-month-target-group { cursor: pointer; }
		.lunar-date-static-text span:last-child { margin-right: 0; }
		.moon-phase-icon-target { margin-left: 0; }
		.weather-marquee-container, .jieqi-holiday-marquee-container { flex-grow: 1; overflow: hidden; position: relative; text-align: left; min-width: 0; cursor: pointer; align-self: stretch; display: flex; align-items: center; }
		.weather-marquee-inner, .jieqi-holiday-marquee-inner { display: flex; flex-wrap: nowrap; width: fit-content; will-change: transform; }
		.weather-marquee-content, .weather-marquee-content-duplicate, .jieqi-holiday-marquee-content, .jieqi-holiday-marquee-content-duplicate { display: inline-flex; align-items: baseline; white-space: nowrap; flex-shrink: 0; }
		.weather-marquee-container.scrolling .weather-marquee-inner, .jieqi-holiday-marquee-container.scrolling .jieqi-holiday-marquee-inner { animation-name: marquee; animation-timing-function: linear; animation-iteration-count: infinite; }
		@keyframes marquee { from { transform: translateX(0); } to { transform: translateX(-50%); } }
		#background-scanline-overlay, #text-scanline-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; background-color: transparent; display: none; }
		#background-scanline-overlay { z-index: -1; }
		#text-scanline-overlay { z-index: 50; }
		#background-scanline-overlay.active.pattern-a { display: block; background-image: repeating-linear-gradient(to bottom, transparent, transparent 2px, rgba(255,255,255,0.1) 2px, rgba(255,255,255,0.1) 4px); }
		#background-scanline-overlay.active.pattern-b { display: block; background-image: repeating-linear-gradient(to bottom, rgba(255,255,255,0.1) 0, rgba(255,255,255,0.1) 2px, transparent 2px, transparent 4px); }
		#text-scanline-overlay.active.pattern-a { display: block; background-image: repeating-linear-gradient(to bottom, transparent, transparent 2px, var(--page-background-color) 2px, var(--page-background-color) 4px); }
		#text-scanline-overlay.active.pattern-b { display: block; background-image: repeating-linear-gradient(to bottom, var(--page-background-color) 0, var(--page-background-color) 2px, transparent 2px, transparent 4px); }
		.weather-svg-icon { display: inline-block; vertical-align: middle; transform: translateY(-10%); }
		.zodiac-svg-icon { display: inline-block; vertical-align: middle; transform: translateY(-15%); }
		.clock-container { width: clamp(250px, 40vmin, 500px); aspect-ratio: 1 / 1; position: relative; border-radius: 50%; display: flex; justify-content: center; align-items: center; background-color: transparent; box-shadow: 0 0 0 0px var(--tick-color); flex-shrink: 0; }
		.clock-center-dot { position: absolute; width: 15px; height: 15px; background-color: var(--tick-color); border-radius: 50%; z-index: 11; cursor: pointer; transition: transform 0.2s ease; }
		.clock-center-dot:hover { transform: scale(1.1); }
		.hand { position: absolute; height: 100%; width: 100%; z-index: 10; }
		.hour-hand i { position: absolute; top: 25%; left: 50%; width: 10px; height: 25%; background-color: var(--hour-hand-color); transform: translateX(-50%); border-radius: 2px; }
		.minute-hand i { position: absolute; top: 15%; left: 50%; width: 6px; height: 35%; background-color: var(--minute-hand-color); transform: translateX(-50%); border-radius: 2px; }
		.second-hand i { position: absolute; top: 10%; left: 50%; width: 2px; height: 40%; background-color: var(--second-hand-color); transform: translateX(-50%); border-radius: 1px; }
		.tick-wrapper { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
		.tick { position: absolute; background: var(--tick-color); left: 50%; transform: translateX(-50%); }
		.tick-hour { height: 12px; width: 3px; top: 0; }
		.tick-minute { height: 6px; width: 1px; top: 0; opacity: 0.7; }
		.number { position: absolute; top: 25px; left: 50%; transform: translateX(-50%); color: var(--number-color); font-family: 'Noto Sans TC', sans-serif; font-size: clamp(0.8rem, 2.2vw, 1.4rem); font-weight: 700; }
		.number div { transform: rotate(calc(-1 * var(--rotation))); }
		.calendar-container { width: clamp(280px, 85vw, 600px); text-align: center; z-index: 10; display: flex; flex-direction: column; flex-shrink: 0; position: relative; padding: 10px; background-color: rgba(30, 30, 30, 0.5); border-radius: 10px; overflow: hidden; }
		#analog-calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; background-color: transparent; width: 100%; z-index: 1; }
		#analog-calendar-grid .weekday-header { font-weight: bold; color: var(--calendar-weekday-color); padding-bottom: 5px; text-align: center; }
		.calendar-container .calendar-day { border-color: transparent; min-height: 4vh; padding: 0.1em; display: flex; flex-direction: row; justify-content: center; align-items: center; position: relative; }
		.calendar-container .calendar-day.is-today { background-color: transparent !important; border: 1px solid var(--highlight-color); }
		.analog-day-main { display: flex; flex-direction: column; justify-content: center; align-items: center; flex-grow: 1; }
		.analog-day-events { display: flex; flex-direction: column; justify-content: space-around; align-items: center; writing-mode: vertical-rl; text-orientation: mixed; white-space: nowrap; font-size: clamp(0.65rem, 1.4vw, 0.8rem); margin-left: 3px; min-width: 1.5em; text-align: center; }
		.analog-day-events:empty { visibility: hidden; }
		.analog-day-events .event-indicator { padding: 2px 0; margin: 0; border-radius: 3px; }
		.calendar-container .calendar-day .gregorian-day { font-size: clamp(0.9rem, 1.5vw, 1.2rem); font-weight: bold; color: var(--calendar-day-color); }
		.calendar-container .calendar-day .lunar-day { font-size: clamp(0.7rem, 1vw, 0.9rem); color: var(--calendar-lunar-color); }
		.calendar-bg-month, .analog-calendar-bg-month { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: 900; color: rgba(255, 255, 255, 0.12); z-index: 0; pointer-events: none; font-family: 'Noto Sans TC', 'Inter', sans-serif; line-height: 1; transition: color 0.4s ease; }
		.calendar-content .calendar-bg-month { font-size: 20rem; top: 42%; }
		.yearly-month-container .calendar-bg-month { font-size: 10rem; top: 52%; }
		.analog-calendar-bg-month { font-size: 10rem; }
		.calendar-content, .yearly-calendar-content { position: relative; overflow: hidden; }
		.yearly-month-container { position: relative; overflow: hidden; background-color: transparent; border: 1px solid #555; }
		.calendar-day, .weekly-calendar-day { background-color: transparent !important; z-index: 1; }
		.calendar-day.other-month { color: #777; }
		.calendar-day:hover, .weekly-calendar-day:hover, .calendar-container .calendar-day:hover { background-color: rgba(94, 94, 94, 0.5) !important; }
		.calendar-day.other-month:hover { background-color: rgba(74, 74, 74, 0.5) !important; }
		.yearly-day:hover { background-color: rgba(85, 85, 85, 0.7); }
		.edit-controls-wrapper { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 2px dashed rgba(0, 255, 255, 0.5); display: none; pointer-events: none; z-index: 99; }
		body.edit-mode .edit-controls-wrapper { display: block; }
		.move-handle { position: absolute; background-color: rgba(0, 255, 255, 0.8); border: 1px solid #fff; border-radius: 50%; pointer-events: auto; z-index: 100; box-shadow: 0 0 10px rgba(0, 255, 255, 0.7); width: 40px; height: 40px; top: 50%; left: 50%; cursor: move; }
		.move-handle::before, .move-handle::after { content: ''; position: absolute; background-color: #000; }
		.move-handle::before { width: 60%; height: 10%; top: 45%; left: 20%; }
		.move-handle::after { width: 10%; height: 60%; top: 20%; left: 45%; }
		.resize-handle-x { position: absolute; top: 50%; right: -10px; transform: translateY(-50%); width: 10px; height: 40px; background-color: rgba(0, 255, 255, 0.8); border: 1px solid #fff; border-radius: 5px; cursor: ew-resize; pointer-events: auto; z-index: 101; display: none; }
		body.edit-mode .resize-handle-x { display: block; }
		#edit-mode-grid {
			display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
			background-image: 
				linear-gradient(to bottom, transparent 24px, rgba(0, 255, 255, 0.2) 24px, rgba(0, 255, 255, 0.2) 25px, transparent 25px), 
				linear-gradient(to right, transparent 24px, rgba(0, 255, 255, 0.2) 24px, rgba(0, 255, 255, 0.2) 25px, transparent 25px);
			background-size: 50px 50px; background-position: center center;
			z-index: 90; pointer-events: none;
		}
		#edit-mode-grid::before, #edit-mode-grid::after { content: ''; position: absolute; background-color: rgba(255, 0, 255, 0.5); z-index: 91; }
		#edit-mode-grid::before { top: 0; left: 50%; width: 1px; height: 100%; transform: translateX(-50%); }
		#edit-mode-grid::after { top: 50%; left: 0; width: 100%; height: 1px; transform: translateY(-50%); }
		body.edit-mode #edit-mode-grid { display: block; }
	</style>
</head>
<body>
	<div id="edit-mode-grid"></div>
	<div id="background-scanline-overlay"></div>
	<div id="text-scanline-overlay"></div>
	<div id="master-layout">
		<div id="digital-widget" class="widget-wrapper">
			<div id="dateTimeDisplay">
				<div class="time-text" id="timeTextContainer">
					<span id="hoursDisplay"></span>
					<span id="colonDisplay" class="time-colon">
						<svg viewbox="0 0 60 250"><rect x="0" y="10" width="40" height="40" rx="10" ry="10"></rect><rect x="0" y="130" width="40" height="40" rx="10" ry="10"></rect></svg>
					</span>
					<span id="minutesDisplay"></span>
					<span class="time-seconds" id="secondsDisplay"></span>
					<span class="time-ampm" id="amPmDisplay"></span>
				</div>
			</div>
			<div class="edit-controls-wrapper"><div class="move-handle"></div></div>
		</div>
		<div id="gregorian-date-widget" class="widget-wrapper">
			<div class="gregorian-date-text" id="gregorianDateDisplay">
				<span class="gregorian-date-parts" id="gregorianDateParts"></span>
				<div class="weather-marquee-container" id="weatherMarqueeContainer">
					<div class="weather-marquee-inner" id="weatherMarqueeInner"><span class="weather-marquee-content"></span><span class="weather-marquee-content-duplicate"></span></div>
				</div>
			</div>
			<div class="edit-controls-wrapper"><div class="move-handle"></div><div class="resize-handle-x"></div></div>
		</div>
		<div id="lunar-date-widget" class="widget-wrapper">
			<div class="lunar-and-jieqi-line" id="lunarAndJieqiLine">
				<span class="lunar-date-static-text" id="lunarDateDisplay"></span>
				<div class="jieqi-holiday-marquee-container" id="jieqiHolidayMarqueeContainer">
					<div class="jieqi-holiday-marquee-inner" id="jieqiHolidayMarqueeInner"><span class="jieqi-holiday-marquee-content"></span><span class="jieqi-holiday-marquee-content-duplicate"></span></div>
				</div>
			</div>
			<div class="edit-controls-wrapper"><div class="move-handle"></div><div class="resize-handle-x"></div></div>
		</div>
		<div id="analog-clock-widget" class="widget-wrapper" style="display: none;">
			<div class="clock-container">
				<div class="hand hour-hand"><i></i></div><div class="hand minute-hand"><i></i></div><div class="hand second-hand"><i></i></div>
				<div class="clock-center-dot" id="clockCenterDot" title="æŸ¥çœ‹æ™‚è¾°å®œå¿Œ"></div>
				<div id="ticks-container"></div>
			</div>
			<div class="edit-controls-wrapper"><div class="move-handle"></div></div>
		</div>
		<div id="analog-calendar-widget" class="widget-wrapper" style="display: none;">
			<div class="calendar-container">
				<div class="analog-calendar-bg-month"></div>
				<div id="analog-calendar-grid"></div>
			</div>
			<div class="edit-controls-wrapper"><div class="move-handle"></div></div>
		</div>
	</div>
	<div class="modal" id="settingsModal">
		<div class="modal-content">
			<span class="close-icon">&times;</span>
			<div class="modal-header"><h2>é¡¯ç¤ºè¨­å®š</h2></div>
			<div class="settings-columns-container">
				<div class="settings-column">
					<h3>æ•¸ä½æ™‚é–“</h3>
					<div class="setting-item"><label for="showDigitalTime">æ•¸ä½æ™‚é–“</label><div class="setting-controls"><label class="switch"><input id="showDigitalTime" type="checkbox"><span class="slider"></span></label></div></div>
					<div class="setting-item"><label for="hourColor">æ™‚</label><div class="setting-controls"><input id="hourColor" type="color"><button class="random-color-btn" data-target="hourColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<div class="setting-item"><label for="minuteColor">åˆ†</label><div class="setting-controls"><input id="minuteColor" type="color"><button class="random-color-btn" data-target="minuteColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<div class="setting-item"><label for="secondColor">ç§’</label><div class="setting-controls"><input id="secondColor" type="color"><button class="random-color-btn" data-target="secondColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<div class="setting-item"><label for="colonColor">å†’è™Ÿ</label><div class="setting-controls"><input id="colonColor" type="color"><button class="random-color-btn" data-target="colonColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<div class="setting-item"><label for="showAmPm">12/24å°æ™‚</label><div class="setting-controls"><label class="switch" title="åˆ‡æ›12/24å°æ™‚æ ¼å¼"><input id="showAmPm" type="checkbox"><span class="slider"></span></label><input id="amPmColor" type="color"><button class="random-color-btn" data-target="amPmColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<hr>
					<h3>å…¬æ›†</h3>
					<div class="setting-item"><label for="showGregorianDate">å…¬æ›†</label><div class="setting-controls"><label class="switch"><input id="showGregorianDate" type="checkbox"><span class="slider"></span></label></div></div>
					<div class="setting-item"><label for="showGregorianYear">å¹´</label><div class="setting-controls"><label class="switch"><input id="showGregorianYear" type="checkbox"><span class="slider"></span></label><input id="gregorianYearColor" type="color"><button class="random-color-btn" data-target="gregorianYearColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<div class="setting-item"><label for="showGregorianMonth">æœˆ</label><div class="setting-controls"><label class="switch"><input id="showGregorianMonth" type="checkbox"><span class="slider"></span></label><input id="gregorianMonthColor" type="color"><button class="random-color-btn" data-target="gregorianMonthColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<div class="setting-item"><label for="showGregorianDay">æ—¥</label><div class="setting-controls"><label class="switch"><input id="showGregorianDay" type="checkbox"><span class="slider"></span></label><input id="gregorianDayColor" type="color"><button class="random-color-btn" data-target="gregorianDayColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<div class="setting-item"><label for="showGregorianWeekday">å‘¨</label><div class="setting-controls"><label class="switch"><input id="showGregorianWeekday" type="checkbox"><span class="slider"></span></label><input id="gregorianWeekdayColor" type="color"><button class="random-color-btn" data-target="gregorianWeekdayColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<div class="setting-item"><label for="showWeather">å¤©æ°£è³‡è¨Š</label><div class="setting-controls"><label class="switch"><input id="showWeather" type="checkbox"><span class="slider"></span></label><input id="weatherColor" type="color"><button class="random-color-btn" data-target="weatherColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<div class="setting-item"><label for="showWeatherLocation">å¤©æ°£åœ°å€</label><div class="setting-controls"><label class="switch"><input id="showWeatherLocation" type="checkbox"><span class="slider"></span></label><input id="weatherLocationColor" type="color"><button class="random-color-btn" data-target="weatherLocationColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
				</div>
				<div class="settings-column">
					<h3>é¡æ¯”æ™‚é˜</h3>
					<div class="setting-item"><label for="showAnalogClock">é¡æ¯”æ™‚é˜</label><div class="setting-controls"><label class="switch"><input id="showAnalogClock" type="checkbox"><span class="slider"></span></label></div></div>
					<div class="setting-item"><label for="hourHandColor">æ™‚</label><div class="setting-controls"><input id="hourHandColor" type="color"><button class="random-color-btn" data-target="hourHandColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<div class="setting-item"><label for="minuteHandColor">åˆ†</label><div class="setting-controls"><input id="minuteHandColor" type="color"><button class="random-color-btn" data-target="minuteHandColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<div class="setting-item"><label for="secondHandColor">ç§’</label><div class="setting-controls"><input id="secondHandColor" type="color"><button class="random-color-btn" data-target="secondHandColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<div class="setting-item"><label for="tickColor">åˆ»åº¦</label><div class="setting-controls"><input id="tickColor" type="color"><button class="random-color-btn" data-target="tickColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<div class="setting-item"><label for="numberColor">æ™‚é–“æ•¸å­—</label><div class="setting-controls"><input id="numberColor" type="color"><button class="random-color-btn" data-target="numberColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<hr>
					<h3>è¾²æ›†</h3>
					<div class="setting-item"><label for="showLunarDate">è¾²æ›†</label><div class="setting-controls"><label class="switch"><input id="showLunarDate" type="checkbox"><span class="slider"></span></label></div></div>
					<div class="setting-item"><label for="showMinguoYear">å¹´</label><div class="setting-controls"><label class="switch"><input id="showMinguoYear" type="checkbox"><span class="slider"></span></label><input id="minguoYearColor" type="color"><button class="random-color-btn" data-target="minguoYearColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<div class="setting-item"><label for="showLunarMonth">æœˆ</label><div class="setting-controls"><label class="switch"><input id="showLunarMonth" type="checkbox"><span class="slider"></span></label><input id="lunarMonthColor" type="color"><button class="random-color-btn" data-target="lunarMonthColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<div class="setting-item"><label for="showLunarDay">æ—¥</label><div class="setting-controls"><label class="switch"><input id="showLunarDay" type="checkbox"><span class="slider"></span></label><input id="lunarDayColor" type="color"><button class="random-color-btn" data-target="lunarDayColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<div class="setting-item"><label for="showLunarShiChen">æ™‚è¾°</label><div class="setting-controls"><label class="switch"><input id="showLunarShiChen" type="checkbox"><span class="slider"></span></label><input id="lunarShiChenColor" type="color"><button class="random-color-btn" data-target="lunarShiChenColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<div class="setting-item"><label for="showJieqi">ç¯€æ°£</label><div class="setting-controls"><label class="switch"><input id="showJieqi" type="checkbox"><span class="slider"></span></label><input id="jieqiColor" type="color"><button class="random-color-btn" data-target="jieqiColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<div class="setting-item"><label for="showHolidays">ç¯€æ—¥</label><div class="setting-controls"><label class="switch"><input id="showHolidays" type="checkbox"><span class="slider"></span></label><input id="holidayColor" type="color"><button class="random-color-btn" data-target="holidayColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
				</div>
			</div>
			<div class="settings-columns-container">
				<div class="settings-column">
					<h3>æœˆæ›†</h3>
					<div class="setting-item"><label for="showAnalogCalendar">æœˆæ›†</label><div class="setting-controls"><label class="switch"><input id="showAnalogCalendar" type="checkbox"><span class="slider"></span></label></div></div>
					<div class="setting-item"><label for="calendarHeaderColor">æœˆ</label><div class="setting-controls"><input id="calendarHeaderColor" type="color"><button class="random-color-btn" data-target="calendarHeaderColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<div class="setting-item"><label for="calendarWeekdayColor">å‘¨</label><div class="setting-controls"><input id="calendarWeekdayColor" type="color"><button class="random-color-btn" data-target="calendarWeekdayColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<div class="setting-item"><label for="calendarDayColor">æ—¥</label><div class="setting-controls"><input id="calendarDayColor" type="color"><button class="random-color-btn" data-target="calendarDayColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
					<div class="setting-item"><label for="calendarLunarColor">è¾²æ›†</label><div class="setting-controls"><input id="calendarLunarColor" type="color"><button class="random-color-btn" data-target="calendarLunarColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
				</div>
				<div class="settings-column">
					<h3>é€šç”¨</h3>
					<div class="setting-item"><div class="location-input-group"><select id="countySelect" class="interval-select" style="max-width: 85px;"></select><select id="districtSelect" class="interval-select" style="max-width: 85px;"></select><input id="weatherLocation" type="text" class="interval-select" title="å¯æ‰‹å‹•è¼¸å…¥è‹±æ–‡åœ°å" placeholder="æ‰‹å‹•è¼¸å…¥(è‹±æ–‡)" style="width: 120px; margin-left: 5px;"></div><div class="location-controls-group"><button id="useCurrentLocationBtn" title="ä½¿ç”¨ç›®å‰ä½ç½®"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L12 6"/><path d="M12 18L12 22"/><path d="M20 12L22 12"/><path d="M2 12L4 12"/><circle cx="12" cy="12" r="2"/><path d="M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16z"/></svg></button></div></div>
					<div class="setting-item"><label for="enableMovement">éš¨æ©Ÿç§»å‹•</label><div class="setting-controls"><div class="interval-selector-group"><select id="movementIntervalMinutes" class="interval-select"></select><span class="interval-select-label">åˆ†</span><select id="movementIntervalSeconds" class="interval-select"></select><span class="interval-select-label">ç§’</span></div><label class="switch"><input id="enableMovement" type="checkbox"><span class="slider"></span></label></div></div>
					<div class="setting-item"><label for="enableTextScanline">æ–‡å­—æƒæç·š</label><div class="setting-controls"><div class="interval-selector-group"><select id="scanlineIntervalMinutes" class="interval-select"></select><span class="interval-select-label">åˆ†</span><select id="scanlineIntervalSeconds" class="interval-select"></select><span class="interval-select-label">ç§’</span></div><label class="switch"><input id="enableTextScanline" type="checkbox"><span class="slider"></span></label></div></div>
					<div class="setting-item"><label for="enableBackgroundScanline">èƒŒæ™¯æƒæç·š</label><div class="setting-controls"><label class="switch"><input id="enableBackgroundScanline" type="checkbox"><span class="slider"></span></label></div></div>
					<div class="setting-item"><label for="backgroundColor">èƒŒæ™¯é¡è‰²</label><div class="setting-controls"><input id="backgroundColor" type="color"><button class="random-color-btn" data-target="backgroundColor" title="éš¨æ©Ÿé¡è‰²">ğŸ¨</button></div></div>
				</div>
			</div>
			<div class="button-group"><button class="action-button" id="restoreDefaultsBtn">æ¢å¾©é è¨­</button><button class="action-button" id="randomColorsBtn">éš¨æ©Ÿé¡è‰²</button></div>
		</div>
	</div>
	<div class="modal" id="dateDetailsModal"><div class="modal-content details-content"><span class="close-icon">&times;</span><div class="modal-header"><h2 id="dateDetailsModalTitle">ç•¶æ—¥è©³æƒ…</h2></div><div id="dateDetailsModalContent"></div></div></div>
	<div class="modal" id="shichenDetailsModal"><div class="modal-content details-content"><span class="close-icon">&times;</span><div class="modal-header"><button id="prevShichenBtn">&lt;</button><h2 id="shichenDetailsModalTitle">æ™‚è¾°è©³æƒ…</h2><button id="nextShichenBtn">&gt;</button></div><div id="shichenDetailsModalContent"></div><div class="button-group"><button class="action-button" id="nowShichenBtn">ç¾åœ¨</button></div></div></div>
	<div class="modal" id="calendarModal"><div class="modal-content calendar-content"><span class="close-icon">&times;</span><div class="modal-header"><button id="prevMonthBtn">&lt;</button><h2 id="calendarMonthYear"></h2><button id="nextMonthBtn">&gt;</button></div><div class="calendar-weekdays" id="calendarWeekdays"></div><div class="calendar-grid" id="calendarGrid"></div><div class="calendar-footer"><button class="action-button" id="todayCalendarBtn">ä»Šå¤©</button></div></div></div>
	<div class="modal" id="weeklyCalendarModal"><div class="modal-content weekly-calendar-content"><span class="close-icon">&times;</span><div class="modal-header"><button id="prevWeekBtn">&lt;</button><h2 id="weeklyCalendarTitle"></h2><button id="nextWeekBtn">&gt;</button></div><div class="weekly-calendar-grid" id="weeklyCalendarGrid"></div><div class="calendar-footer"><button class="action-button" id="todayWeeklyBtn">æœ¬é€±</button></div></div></div>
	<div class="modal" id="yearlyCalendarModal"><div class="modal-content yearly-calendar-content"><span class="close-icon">&times;</span><div class="modal-header"><button id="prevYearBtn">&lt;</button><h2 id="yearlyCalendarTitle"></h2><button id="nextYearBtn">&gt;</button></div><div class="yearly-calendar-grid" id="yearlyCalendarGrid"></div><div class="calendar-footer"><button class="action-button" id="todayYearlyBtn">ä»Šå¹´</button></div></div></div>
	<div class="modal" id="weatherForecastModal"><div class="modal-content"><span class="close-icon">&times;</span><div class="modal-header"><h2 id="weatherForecastModalTitle">æœªä¾†ä¸€é€±å¤©æ°£é å ±</h2></div><div class="weather-forecast-grid" id="weatherForecastGrid"></div></div></div>
	<div class="modal" id="hourlyWeatherModal"><div class="modal-content"><span class="close-icon">&times;</span><div class="modal-header"><h2 id="hourlyWeatherModalTitle">æ¯å°æ™‚å¤©æ°£é å ±</h2></div><div class="hourly-weather-grid" id="hourlyWeatherGrid"></div><div class="button-group"><button class="action-button" id="backToWeeklyForecastBtn">è¿”å›é€±é å ±</button></div></div></div>
	<div class="modal" id="moonPhaseModal">
		<div class="modal-content details-content">
			<span class="close-icon">&times;</span>
			<div class="modal-header"><h2 id="moonPhaseModalTitle">æœˆç›¸è©³æƒ…</h2></div>
			<div id="moonPhaseModalContent">
				<div id="moonPhaseDisplay"><div class="moon-phase-icon-large" id="mainMoonIcon"></div><p id="mainMoonDescription"></p></div>
				<div class="moon-calendar-container">
					<div class="modal-header"><button id="prevMoonMonthBtn">&lt;</button><h3 id="moonCalendarMonthYear"></h3><button id="nextMoonMonthBtn">&gt;</button></div>
					<div class="calendar-weekdays" id="moonCalendarWeekdays"></div>
					<div class="calendar-grid" id="moonCalendarGrid"></div>
				</div>
			</div>
			<div class="button-group"><button class="action-button" id="todayMoonCalendarBtn">ä»Šå¤©</button></div>
		</div>
	</div>
	<div class="modal" id="zodiacModal">
		<div class="modal-content">
			<span class="close-icon">&times;</span>
			<div class="modal-header"><h2 id="zodiacModalTitle">åäºŒç”Ÿè‚–</h2></div>
			<div class="zodiac-grid" id="zodiacGrid"></div>
		</div>
	</div>
	<div id="edit-mode-icon" class="control-icon" title="ç·¨è¼¯æ¨¡å¼">
		<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
			<g class="wrench-icon"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></g>
			<g class="close-icon-svg" style="display: none;"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></g>
		</svg>
	</div>
	<div id="settings-icon" class="control-icon" title="è¨­å®š">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61-.25-1.17-.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12-.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>
	</div>
	<div id="fullscreen-icon" class="control-icon" title="å…¨è¢å¹•">
		<svg class="enter-fullscreen-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"></path></svg>
		<svg class="exit-fullscreen-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="display: none;"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"></path></svg>
	</div>
	<script>
		let settings = {}, transformState = {}; // åˆå§‹åŒ–è¨­å®šç‰©ä»¶å’Œè®Šå½¢ç‹€æ…‹ç‰©ä»¶
		let timers = { main: null, movement: null, scanline: null, weather: null, analog: null }; // åˆå§‹åŒ–æ‰€æœ‰è¨ˆæ™‚å™¨
		let state = { // åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼çš„ç‹€æ…‹ç‰©ä»¶
			scanlinePatternIsA: true, lastMarqueeContent: '', lastWeatherContent: '', // æƒæç·šæ¨£å¼ã€ä¸Šæ¬¡è·‘é¦¬ç‡ˆå…§å®¹
			calendarDate: new Date(), weeklyCalendarDate: new Date(), yearlyCalendarDate: new Date(), // å„ç¨®æ—¥æ›†çš„ç›®å‰æ—¥æœŸ
			shichenDetailDate: new Date(), moonCalendarDate: new Date(), // æ™‚è¾°å’Œæœˆç›¸è©³æƒ…çš„æ—¥æœŸ
			yearlyDataCache: { year: -1, holidays: [], jieqi: [] }, weatherDataCache: null, // å¹´åº¦è³‡æ–™å’Œå¤©æ°£è³‡æ–™çš„å¿«å–
			isDragging: false, dragTarget: null, dragType: null, startX: 0, startY: 0, // æ‹–æ›³ç‹€æ…‹ç›¸é—œè®Šæ•¸
			initialX: 0, initialY: 0, initialScale: 1, initialDist: 0, initialWidth: 0, // æ‹–æ›³åˆå§‹å€¼
			movementEnabledBeforeEdit: true, // è¨˜éŒ„é€²å…¥ç·¨è¼¯æ¨¡å¼å‰çš„ç§»å‹•è¨­å®š
		};
		const taiwanLocations = { "å°ç£": { "english": "taiwan", "districts": { "å°ç£": "taiwan" } }, "åŸºéš†å¸‚": { "english": "keelung", "districts": { "åŸºéš†å¸‚": "keelung", "ä»æ„›å€": "renai", "ä¿¡ç¾©å€": "xinyi", "ä¸­æ­£å€": "zhongzheng", "ä¸­å±±å€": "zhongshan", "å®‰æ¨‚å€": "anle", "æš–æš–å€": "nuannuan", "ä¸ƒå µå€": "qidu" } }, "è‡ºåŒ—å¸‚": { "english": "taipei", "districts": { "è‡ºåŒ—å¸‚": "taipei", "ä¸­æ­£å€": "zhongzheng", "å¤§åŒå€": "datong", "ä¸­å±±å€": "zhongshan", "æ¾å±±å€": "songshan", "å¤§å®‰å€": "da'an", "è¬è¯å€": "wanhua", "ä¿¡ç¾©å€": "xinyi", "å£«æ—å€": "shilin", "åŒ—æŠ•å€": "beitou", "å…§æ¹–å€": "neihu", "å—æ¸¯å€": "nangang", "æ–‡å±±å€": "wenshan" } }, "æ–°åŒ—å¸‚": { "english": "new taipei", "districts": { "æ–°åŒ—å¸‚": "new taipei", "æ¿æ©‹å€": "banqiao", "ä¸‰é‡å€": "sanchong", "ä¸­å’Œå€": "zhonghe", "æ°¸å’Œå€": "yonghe", "æ–°èŠå€": "xinzhuang", "æ–°åº—å€": "xindian", "åœŸåŸå€": "tucheng", "è˜†æ´²å€": "luzhou", "æ¨¹æ—å€": "shulin", "æ±æ­¢å€": "xizhi", "é¶¯æ­Œå€": "yingge", "ä¸‰å³½å€": "sanxia", "æ·¡æ°´å€": "danshui", "ç‘èŠ³å€": "ruifang", "äº”è‚¡å€": "wugu", "æ³°å±±å€": "taishan", "æ—å£å€": "linkou", "æ·±å‘å€": "shengkeng", "çŸ³ç¢‡å€": "shiding", "åªæ—å€": "pinglin", "ä¸‰èŠå€": "sanzhi", "çŸ³é–€å€": "shimen", "å…«é‡Œå€": "bali", "å¹³æºªå€": "pingxi", "é›™æºªå€": "shuangxi", "è²¢å¯®å€": "gongliao", "é‡‘å±±å€": "jinshan", "è¬é‡Œå€": "wanli", "çƒä¾†å€": "wulai" } }, "æ¡ƒåœ’å¸‚": { "english": "taoyuan", "districts": { "æ¡ƒåœ’å¸‚": "taoyuan", "æ¡ƒåœ’å€": "taoyuan", "ä¸­å£¢å€": "zhongli", "å¹³é®å€": "pingzhen", "å…«å¾·å€": "bade", "æ¥Šæ¢…å€": "yangmei", "è˜†ç«¹å€": "luzhu", "å¤§æºªå€": "daxi", "é¾æ½­å€": "longtan", "é¾œå±±å€": "guishan", "å¤§åœ’å€": "dayuan", "è§€éŸ³å€": "guanyin", "æ–°å±‹å€": "xinwu", "å¾©èˆˆå€": "fuxing" } }, "è‡ºä¸­å¸‚": { "english": "taichung", "districts": { "è‡ºä¸­å¸‚": "taichung", "ä¸­å€": "central", "æ±å€": "east", "å—å€": "south", "è¥¿å€": "west", "åŒ—å€": "north", "åŒ—å±¯å€": "beitun", "è¥¿å±¯å€": "xitun", "å—å±¯å€": "nantun", "å¤ªå¹³å€": "taiping", "å¤§é‡Œå€": "dali", "éœ§å³°å€": "wufeng", "çƒæ—¥å€": "wuri", "è±åŸå€": "fengyuan", "åé‡Œå€": "houli", "çŸ³å²¡å€": "shigang", "æ±å‹¢å€": "dongshi", "å’Œå¹³å€": "heping", "æ–°ç¤¾å€": "xinshe", "æ½­å­å€": "tanzi", "å¤§é›…å€": "daya", "ç¥å²¡å€": "shengang", "å¤§è‚šå€": "dadu", "æ²™é¹¿å€": "shalu", "é¾äº•å€": "longjing", "æ¢§æ£²å€": "wuqi", "æ¸…æ°´å€": "qingshui", "å¤§ç”²å€": "dajia", "å¤–åŸ”å€": "waipu", "å¤§å®‰å€": "daan" } }, "è‡ºå—å¸‚": { "english": "tainan", "districts": { "è‡ºå—å¸‚": "tainan", "ä¸­è¥¿å€": "west central", "æ±å€": "east", "å—å€": "south", "åŒ—å€": "north", "å®‰å¹³å€": "anping", "å®‰å—å€": "annan", "æ°¸åº·å€": "yongkang", "æ­¸ä»å€": "guiren", "æ–°åŒ–å€": "xinhua", "å·¦é®å€": "zuozhen", "ç‰äº•å€": "yujing", "æ¥ è¥¿å€": "nanxi", "å—åŒ–å€": "nanhua", "ä»å¾·å€": "rende", "é—œå»Ÿå€": "guanmiao", "é¾å´å€": "longqi", "å®˜ç”°å€": "guantian", "éº»è±†å€": "madou", "ä½³é‡Œå€": "jiali", "è¥¿æ¸¯å€": "xigang", "ä¸ƒè‚¡å€": "qigu", "å°‡è»å€": "jiangjun", "å­¸ç”²å€": "xuejia", "åŒ—é–€å€": "beimen", "æ–°ç‡Ÿå€": "xinying", "å¾Œå£å€": "houbi", "ç™½æ²³å€": "baihe", "æ±å±±å€": "dongshan", "å…­ç”²å€": "liujia", "ä¸‹ç‡Ÿå€": "xiaying", "æŸ³ç‡Ÿå€": "liuying", "é¹½æ°´å€": "yanshui", "å–„åŒ–å€": "shanhua", "å¤§å…§å€": "danei", "å±±ä¸Šå€": "shanshang", "æ–°å¸‚å€": "xingshi", "å®‰å®šå€": "anding" } }, "é«˜é›„å¸‚": { "english": "kaohsiung", "districts": { "é«˜é›„å¸‚": "kaohsiung", "æ¥ æ¢“å€": "nanzi", "å·¦ç‡Ÿå€": "zuoying", "é¼“å±±å€": "gushan", "ä¸‰æ°‘å€": "sanmin", "é¹½åŸ•å€": "yancheng", "å‰é‡‘å€": "qianjin", "æ–°èˆˆå€": "xinxing", "è‹“é›…å€": "lingya", "å‰é®å€": "qianzhen", "æ——æ´¥å€": "qijin", "å°æ¸¯å€": "xiaogang", "é³³å±±å€": "fengshan", "æ—åœ’å€": "linyuan", "å¤§å¯®å€": "daliao", "å¤§æ¨¹å€": "dashu", "å¤§ç¤¾å€": "dashe", "ä»æ­¦å€": "renwu", "é³¥æ¾å€": "niaosong", "å²¡å±±å€": "gangshan", "æ©‹é ­å€": "qiaotou", "ç‡•å·¢å€": "yanchao", "ç”°å¯®å€": "tianliao", "é˜¿è“®å€": "alian", "è·¯ç«¹å€": "luzhu", "æ¹–å…§å€": "hunei", "èŒ„è£å€": "qieding", "æ°¸å®‰å€": "yong'an", "å½Œé™€å€": "mizuo", "æ¢“å®˜å€": "ziguan", "æ——å±±å€": "qishan", "ç¾æ¿ƒå€": "meinong", "å…­é¾œå€": "liugui", "ç”²ä»™å€": "jiaxian", "æ‰æ—å€": "shanlin", "å…§é–€å€": "neimen", "èŒ‚æ—å€": "maolin", "æ¡ƒæºå€": "taoyuan", "é‚£ç‘ªå¤å€": "namasia" } }, "æ–°ç«¹ç¸£": { "english": "hsinchu county", "districts": { "æ–°ç«¹ç¸£": "hsinchu county", "ç«¹åŒ—å¸‚": "zhubei", "ç«¹æ±é®": "zhudong", "æ–°åŸ”é®": "xinpu", "é—œè¥¿é®": "guanxi", "æ¹–å£é„‰": "hukou", "æ–°è±é„‰": "xinfeng", "èŠæ—é„‰": "qionglin", "æ©«å±±é„‰": "hengshan", "åŒ—åŸ”é„‰": "beipu", "å¯¶å±±é„‰": "baoshan", "å³¨çœ‰é„‰": "emei", "å°–çŸ³é„‰": "jianshi", "äº”å³°é„‰": "wufeng" } }, "è‹—æ —ç¸£": { "english": "miaoli", "districts": { "è‹—æ —ç¸£": "miaoli", "è‹—æ —å¸‚": "miaoli city", "é ­ä»½å¸‚": "toufen", "è‹‘è£¡é®": "yuanli", "é€šéœ„é®": "tongxiao", "ç«¹å—é®": "zhunan", "å¾Œé¾é®": "houlong", "å“è˜­é®": "zhuolan", "å¤§æ¹–é„‰": "dahu", "å…¬é¤¨é„‰": "gongguan", "éŠ…é‘¼é„‰": "tongluo", "å—åº„é„‰": "nanzhuang", "é ­å±‹é„‰": "touwu", "ä¸‰ç£é„‰": "sanwan", "ä¸‰ç¾©é„‰": "sanyi", "è¥¿æ¹–é„‰": "xihu", "é€ æ©‹é„‰": "zaoqiao", "ç…æ½­é„‰": "shitan", "æ³°å®‰é„‰": "taian" } }, "å½°åŒ–ç¸£": { "english": "changhua", "districts": { "å½°åŒ–ç¸£": "changhua", "å½°åŒ–å¸‚": "changhua city", "å“¡æ—å¸‚": "yuanlin", "å’Œç¾é®": "hemei", "é¹¿æ¸¯é®": "lukang", "æºªæ¹–é®": "xihu", "ç”°ä¸­é®": "tianzhong", "åŒ—æ–—é®": "beidou", "äºŒæ—é®": "erlin", "ç·šè¥¿é„‰": "xianxi", "ä¼¸æ¸¯é„‰": "shengang", "ç¦èˆˆé„‰": "fuxing", "ç§€æ°´é„‰": "xiushui", "èŠ±å£‡é„‰": "huatan", "èŠ¬åœ’é„‰": "fenyuan", "å¤§æ‘é„‰": "dacun", "åŸ”é¹½é„‰": "puyan", "åŸ”å¿ƒé„‰": "puxin", "æ°¸é–é„‰": "yongjing", "ç¤¾é ­é„‰": "shetou", "äºŒæ°´é„‰": "ershui", "ç”°å°¾é„‰": "tianwei", "åŸ¤é ­é„‰": "pitou", "èŠ³è‹‘é„‰": "fangyuan", "å¤§åŸé„‰": "dacheng", "ç«¹å¡˜é„‰": "zhutang", "æºªå·é„‰": "xizhou" } }, "å—æŠ•ç¸£": { "english": "nantou", "districts": { "å—æŠ•ç¸£": "nantou", "å—æŠ•å¸‚": "nantou city", "åŸ”é‡Œé®": "puli", "è‰å±¯é®": "caotun", "ç«¹å±±é®": "zhushan", "é›†é›†é®": "jiji", "åé–“é„‰": "mingjian", "é¹¿è°·é„‰": "lugu", "ä¸­å¯®é„‰": "zhongliao", "é­šæ± é„‰": "yuchi", "åœ‹å§“é„‰": "guoxing", "æ°´é‡Œé„‰": "shuili", "ä¿¡ç¾©é„‰": "xinyi", "ä»æ„›é„‰": "ren'ai" } }, "é›²æ—ç¸£": { "english": "yunlin", "districts": { "é›²æ—ç¸£": "yunlin", "æ–—å…­å¸‚": "douliu", "æ–—å—é®": "dounan", "è™å°¾é®": "huwei", "è¥¿èºé®": "xiluo", "åœŸåº«é®": "tuku", "åŒ—æ¸¯é®": "beigang", "å¤å‘é„‰": "gukeng", "å¤§åŸ¤é„‰": "dapi", "è¿æ¡é„‰": "citong", "æ—å…§é„‰": "linnei", "äºŒå´™é„‰": "erlun", "å´™èƒŒé„‰": "lunbei", "éº¥å¯®é„‰": "mailiao", "æ±å‹¢é„‰": "dongshi", "è¤’å¿ é„‰": "baozhong", "è‡ºè¥¿é„‰": "taixi", "å…ƒé•·é„‰": "yuanchang", "å››æ¹–é„‰": "sihu", "å£æ¹–é„‰": "kouhu", "æ°´æ—é„‰": "shuilin" } }, "å˜‰ç¾©ç¸£": { "english": "chiayi county", "districts": { "å˜‰ç¾©ç¸£": "chiayi county", "å¤ªä¿å¸‚": "taibao", "æœ´å­å¸‚": "puzi", "å¸ƒè¢‹é®": "budai", "å¤§æ—é®": "dalin", "æ°‘é›„é„‰": "minxiong", "æºªå£é„‰": "xikou", "æ–°æ¸¯é„‰": "xingang", "å…­è…³é„‰": "liujiao", "æ±çŸ³é„‰": "dongshi", "ç¾©ç«¹é„‰": "yizu", "é¹¿è‰é„‰": "lucao", "æ°´ä¸Šé„‰": "shuishang", "ä¸­åŸ”é„‰": "zhongpu", "ç«¹å´é„‰": "zhuqi", "æ¢…å±±é„‰": "meishan", "ç•ªè·¯é„‰": "fanlu", "å¤§åŸ”é„‰": "dapu", "é˜¿é‡Œå±±é„‰": "alishan" } }, "å±æ±ç¸£": { "english": "pingtung", "districts": { "å±æ±ç¸£": "pingtung", "å±æ±å¸‚": "pingtung city", "æ½®å·é®": "chaozhou", "æ±æ¸¯é®": "donggang", "æ†æ˜¥é®": "hengchun", "è¬ä¸¹é„‰": "wandan", "é•·æ²»é„‰": "changzhi", "éºŸæ´›é„‰": "linluo", "ä¹å¦‚é„‰": "jiuru", "é‡Œæ¸¯é„‰": "ligang", "é¹½åŸ”é„‰": "yanpu", "é«˜æ¨¹é„‰": "gaoshu", "è¬å·’é„‰": "wanluan", "å…§åŸ”é„‰": "neipu", "ç«¹ç”°é„‰": "zhutian", "æ–°åŸ¤é„‰": "xinpi", "æ‹å¯®é„‰": "fangliao", "æ–°åœ’é„‰": "xinyuan", "å´é ‚é„‰": "kanding", "æ—é‚Šé„‰": "linbian", "å—å·é„‰": "nanzhou", "ä½³å†¬é„‰": "jiadong", "ç‰çƒé„‰": "liuqiu", "è»ŠåŸé„‰": "checheng", "æ»¿å·é„‰": "manzhou", "æ‹å±±é„‰": "fangshan", "ä¸‰åœ°é–€é„‰": "sandimen", "éœ§è‡ºé„‰": "wutai", "ç‘ªå®¶é„‰": "majia", "æ³°æ­¦é„‰": "taiwu", "ä¾†ç¾©é„‰": "laiyi", "æ˜¥æ—¥é„‰": "chunri", "ç…å­é„‰": "shizi", "ç‰¡ä¸¹é„‰": "mudan" } }, "å®œè˜­ç¸£": { "english": "yilan", "districts": { "å®œè˜­ç¸£": "yilan", "å®œè˜­å¸‚": "yilan city", "ç¾…æ±é®": "luodong", "è˜‡æ¾³é®": "su'ao", "é ­åŸé®": "toucheng", "ç¤æºªé„‰": "jiaoxi", "å£¯åœé„‰": "zhuangwei", "å“¡å±±é„‰": "yuanshan", "å†¬å±±é„‰": "dongshan", "äº”çµé„‰": "wujie", "ä¸‰æ˜Ÿé„‰": "sanxing", "å¤§åŒé„‰": "datong", "å—æ¾³é„‰": "nan'ao" } }, "èŠ±è“®ç¸£": { "english": "hualien", "districts": { "èŠ±è“®ç¸£": "hualien", "èŠ±è“®å¸‚": "hualien city", "é³³æ—é®": "fenglin", "ç‰é‡Œé®": "yuli", "æ–°åŸé„‰": "xincheng", "å‰å®‰é„‰": "ji'an", "å£½è±é„‰": "shoufeng", "å…‰å¾©é„‰": "guangfu", "è±æ¿±é„‰": "fengbin", "ç‘ç©—é„‰": "ruisui", "å¯Œé‡Œé„‰": "fuli", "ç§€æ—é„‰": "xiulin", "è¬æ¦®é„‰": "wanrong", "å“æºªé„‰": "zhuoxi" } }, "è‡ºæ±ç¸£": { "english": "taitung", "districts": { "è‡ºæ±ç¸£": "taitung", "è‡ºæ±å¸‚": "taitung city", "æˆåŠŸé®": "chenggong", "é—œå±±é®": "guanshan", "å‘å—é„‰": "beinan", "é¹¿é‡é„‰": "luye", "æ± ä¸Šé„‰": "chishang", "æ±æ²³é„‰": "donghe", "é•·æ¿±é„‰": "changbin", "å¤ªéº»é‡Œé„‰": "taimali", "å¤§æ­¦é„‰": "dawu", "é”ä»é„‰": "daren", "é‡‘å³°é„‰": "jinfeng", "æµ·ç«¯é„‰": "haiduan", "å»¶å¹³é„‰": "yanping", "ç¶ å³¶é„‰": "ludao", "è˜­å¶¼é„‰": "lanyu" } }, "æ¾æ¹–ç¸£": { "english": "penghu", "districts": { "æ¾æ¹–ç¸£": "penghu", "é¦¬å…¬å¸‚": "magong", "æ¹–è¥¿é„‰": "huxi", "ç™½æ²™é„‰": "baisha", "è¥¿å¶¼é„‰": "xiyu", "æœ›å®‰é„‰": "wang'an", "ä¸ƒç¾é„‰": "qimei" } }, "é‡‘é–€ç¸£": { "english": "kinmen", "districts": { "é‡‘é–€ç¸£": "kinmen", "é‡‘åŸé®": "jincheng", "é‡‘æ¹–é®": "jinhu", "é‡‘æ²™é®": "jinsha", "é‡‘å¯§é„‰": "jinning", "çƒˆå¶¼é„‰": "lieyu", "çƒåµé„‰": "wuqiu" } }, "é€£æ±Ÿç¸£": { "english": "lienchiang", "districts": { "é€£æ±Ÿç¸£": "lienchiang", "å—ç«¿é„‰": "nangan", "åŒ—ç«¿é„‰": "beigan", "è’å…‰é„‰": "juguang", "æ±å¼•é„‰": "dongyin" } }, "æ–°ç«¹å¸‚": { "english": "hsinchu", "districts": { "æ–°ç«¹å¸‚": "hsinchu", "æ±å€": "east", "åŒ—å€": "north", "é¦™å±±å€": "xiangshan" } }, "å˜‰ç¾©å¸‚": { "english": "chiayi", "districts": { "å˜‰ç¾©å¸‚": "chiayi", "æ±å€": "east", "è¥¿å€": "west" } } }; // å°ç£å„åœ°å€ä¸­è‹±æ–‡å°ç…§è¡¨
		const defaultSettings = { // å®šç¾©æ‰€æœ‰è¨­å®šçš„é è¨­å€¼
			backgroundColor: '#000000', enableMovement: true, movementIntervalMinutes: 0, movementIntervalSeconds: 10, showWeather: true, // èƒŒæ™¯ã€ç§»å‹•ã€å¤©æ°£ç›¸é—œè¨­å®š
			weatherLocation: 'taiwan', weatherColor: '#87CEFA', showWeatherLocation: true, weatherLocationColor: '#00FFFF', showDigitalTime: true, // å¤©æ°£åœ°é»ã€é¡è‰²ã€æ•¸ä½æ™‚é–“é¡¯ç¤ºè¨­å®š
			showGregorianDate: true, showLunarDate: true, showAmPm: true, showGregorianYear: true, showGregorianMonth: true, showGregorianDay: true, // å…¬è¾²æ›†ã€12/24å°æ™‚åˆ¶ã€å¹´æœˆæ—¥é¡¯ç¤ºè¨­å®š
			showGregorianWeekday: true, showMinguoYear: true, showLunarMonth: true, showLunarDay: true, showLunarShiChen: true, showJieqi: true, // æ˜ŸæœŸã€æ°‘åœ‹å¹´ã€è¾²æ›†æœˆæ—¥æ™‚è¾°ç¯€æ°£é¡¯ç¤ºè¨­å®š
			showHolidays: true, hourColor: '#00FF00', minuteColor: '#00FF00', colonColor: '#00FF00', secondColor: '#00FF00', amPmColor: '#00FF00', // ç¯€æ—¥é¡¯ç¤ºèˆ‡æ•¸ä½æ™‚é–“å„éƒ¨åˆ†é¡è‰²
			gregorianYearColor: '#00FF00', gregorianMonthColor: '#00FF00', gregorianDayColor: '#00FF00', gregorianWeekdayColor: '#00FF00', // å…¬æ›†å„éƒ¨åˆ†é¡è‰²
			minguoYearColor: '#00FF00', lunarMonthColor: '#00FF00', lunarDayColor: '#00FF00', lunarShiChenColor: '#00FF00', jieqiColor: '#00FF00', // è¾²æ›†å„éƒ¨åˆ†é¡è‰²
			holidayColor: '#00FFFF', enableTextScanline: false, enableBackgroundScanline: false, scanlineIntervalMinutes: 0, scanlineIntervalSeconds: 10, // ç¯€æ—¥é¡è‰²èˆ‡æƒæç·šæ•ˆæœè¨­å®š
			showAnalogClock: false, showAnalogCalendar: false, hourHandColor: '#ffffff', minuteHandColor: '#ffffff', secondHandColor: '#ff5b3f', // é¡æ¯”æ™‚é˜/æ—¥æ›†é¡¯ç¤ºèˆ‡æŒ‡é‡é¡è‰²
			tickColor: '#ffffff', numberColor: '#ffffff', calendarHeaderColor: '#ff5b3f', calendarWeekdayColor: '#00ffff', calendarDayColor: '#ffffff', // é¡æ¯”æ™‚é˜åˆ»åº¦ã€æ•¸å­—èˆ‡æ—¥æ›†é¡è‰²
			calendarLunarColor: '#aaaaaa', // é¡æ¯”æ—¥æ›†è¾²æ›†é¡è‰²
		};
		const defaultTransformState = { // å®šç¾©æ‰€æœ‰å…ƒä»¶çš„é è¨­ä½ç½®ã€å¤§å°
			'master': { x: 0, y: 0, scale: 1 }, 'digital': { x: 0, y: -120, scale: 1 }, 'gregorian-date': { x: 0, y: 80, scale: 1, width: 92 }, // ä¸»å®¹å™¨ã€æ•¸ä½æ™‚é–“ã€å…¬æ›†æ—¥æœŸ
			'lunar-date': { x: 0, y: 150, scale: 1, width: 92 }, 'analog-clock': { x: 0, y: -150, scale: 0.8 }, 'analog-calendar': { x: 0, y: 150, scale: 0.8 } // è¾²æ›†æ—¥æœŸã€é¡æ¯”æ™‚é˜ã€é¡æ¯”æ—¥æ›†
		};
		const qs = (selector) => document.querySelector(selector); // querySelector çš„ç¸®å¯«å‡½å¼
		const qsa = (selector) => document.querySelectorAll(selector); // querySelectorAll çš„ç¸®å¯«å‡½å¼
		const setStyle = (element, styles) => Object.assign(element.style, styles); // å¿«é€Ÿè¨­å®šå¤šå€‹ CSS æ¨£å¼çš„å‡½å¼
		function saveState() { try { localStorage.setItem('mergedClockSettings_v4', JSON.stringify(settings)); localStorage.setItem('mergedClockTransforms_v4', JSON.stringify(transformState)); } catch (e) { console.error("å„²å­˜ç‹€æ…‹å¤±æ•—:", e); } } // å°‡ç›®å‰çš„è¨­å®šå’Œä½ç½®ç‹€æ…‹å­˜åˆ° localStorage
		function loadState() { try { const storedSettings = localStorage.getItem('mergedClockSettings_v4'); settings = storedSettings ? { ...defaultSettings, ...JSON.parse(storedSettings) } : { ...defaultSettings }; const storedTransforms = localStorage.getItem('mergedClockTransforms_v4'); transformState = storedTransforms ? { ...defaultTransformState, ...JSON.parse(storedTransforms) } : { ...defaultTransformState }; } catch (e) { console.error("è§£æç‹€æ…‹å¤±æ•—:", e); settings = { ...defaultSettings }; transformState = { ...defaultTransformState }; } settings.editMode = false; } // å¾ localStorage è¼‰å…¥è¨­å®šå’Œä½ç½®ç‹€æ…‹ï¼Œè‹¥å¤±æ•—å‰‡ä½¿ç”¨é è¨­å€¼
		function updateSettingsModalUI() { for (const key in settings) { const el = document.getElementById(key); if (el) { if (el.type === 'checkbox') el.checked = settings[key]; else if (el.tagName !== 'SELECT' || !['countySelect', 'districtSelect'].includes(key)) el.value = settings[key]; } } setLocationSelectorsFromEnglish(settings.weatherLocation); } // æ ¹æ“šç›®å‰çš„ settings ç‰©ä»¶æ›´æ–°è¨­å®šé¢æ¿ä¸­çš„æ‰€æœ‰ UI å…ƒä»¶
		function restoreDefaults() { // æ¢å¾©æ‰€æœ‰è¨­å®šç‚ºé è¨­å€¼
			settings = { ...defaultSettings }; // å°‡è¨­å®šç‰©ä»¶é‡è¨­ç‚ºé è¨­å€¼
			transformState = { ...defaultTransformState }; // å°‡ä½ç½®ç‹€æ…‹ç‰©ä»¶é‡è¨­ç‚ºé è¨­å€¼
			settings.editMode = false;  // ç¢ºä¿é€€å‡ºç·¨è¼¯æ¨¡å¼
			state.movementEnabledBeforeEdit = true; // é‡è¨­ç·¨è¼¯æ¨¡å¼å‰çš„ç§»å‹•ç‹€æ…‹
			saveState(); // å„²å­˜é è¨­ç‹€æ…‹
			updateSettingsModalUI(); // æ›´æ–°è¨­å®šé¢æ¿ UI
			toggleEditModeState(); // åˆ‡æ›ç·¨è¼¯æ¨¡å¼ç‹€æ…‹ (æœƒè§¸ç™¼ applyMovement)
			applyAllSettings(); // æ‡‰ç”¨æ‰€æœ‰è¦–è¦ºè¨­å®š
			applyTransforms(); // æ‡‰ç”¨æ‰€æœ‰ä½ç½®è¨­å®š
			updateWidgetVisibility(); // æ›´æ–°å…ƒä»¶å¯è¦‹æ€§
			applyScanlineEffect(); // æ‡‰ç”¨æƒæç·šæ•ˆæœ
			updateSettingDependencies(); // æ›´æ–°è¨­å®šé …ç›®çš„é€£å‹•ç‹€æ…‹
			state.lastMarqueeContent = ''; // æ¸…é™¤è·‘é¦¬ç‡ˆå¿«å–
			state.lastWeatherContent = ''; // æ¸…é™¤å¤©æ°£å¿«å–
			updateWeather(); // ç«‹å³æ›´æ–°å¤©æ°£è³‡è¨Š
		}
		function setRandomColors() { for (const key in settings) { if (key.toLowerCase().includes('color')) settings[key] = '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0'); } saveState(); updateSettingsModalUI(); applyAllSettings(); } // å°‡æ‰€æœ‰é¡è‰²è¨­å®šç‚ºéš¨æ©Ÿå€¼
		function initializeTimers() { Object.values(timers).forEach(clearInterval); timers.main = setInterval(updateDigitalClock, 1000); timers.analog = setInterval(updateAnalogClock, 50); applyMovement(); applyScanlineEffect(); } // åˆå§‹åŒ–æ‰€æœ‰è¨ˆæ™‚å™¨
		function getEncompassingBoundingBox(elements) { // è¨ˆç®—ä¸€çµ„ DOM å…ƒç´ é›†åˆçš„æ•´é«”é‚Šç•Œæ¡†
			let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity, hasVisibleElements = false; // åˆå§‹åŒ–é‚Šç•Œå€¼
			elements.forEach(el => { if (window.getComputedStyle(el).display !== 'none') { hasVisibleElements = true; const rect = el.getBoundingClientRect(); minX = Math.min(minX, rect.left); minY = Math.min(minY, rect.top); maxX = Math.max(maxX, rect.right); maxY = Math.max(maxY, rect.bottom); } }); // éæ­·æ‰€æœ‰å¯è¦‹å…ƒç´ ä¸¦æ›´æ–°é‚Šç•Œ
			if (!hasVisibleElements) return null; // å¦‚æœæ²’æœ‰å¯è¦‹å…ƒç´ ï¼Œè¿”å› null
			return { left: minX, top: minY, right: maxX, bottom: maxY, width: maxX - minX, height: maxY - minY }; // è¿”å›è¨ˆç®—å¾Œçš„é‚Šç•Œç‰©ä»¶
		}
		function applyMovement() { // æ ¹æ“šè¨­å®šå•Ÿç”¨æˆ–åœç”¨éš¨æ©Ÿç§»å‹•
			clearInterval(timers.movement); // æ¸…é™¤èˆŠçš„ç§»å‹•è¨ˆæ™‚å™¨
			if (settings.editMode) return; // ç·¨è¼¯æ¨¡å¼ä¸‹ä¸ç§»å‹•
			if (settings.enableMovement) { // å¦‚æœå•Ÿç”¨ç§»å‹•
				const intervalMs = (parseInt(settings.movementIntervalMinutes) * 60 + parseInt(settings.movementIntervalSeconds)) * 1000; // è¨ˆç®—ç§»å‹•é–“éš”æ¯«ç§’æ•¸
				if (intervalMs > 0) { // å¦‚æœé–“éš”å¤§æ–¼ 0
					moveRandomly(); // ç«‹å³ç§»å‹•ä¸€æ¬¡
					timers.movement = setInterval(moveRandomly, intervalMs); // è¨­å®šæ–°çš„ç§»å‹•è¨ˆæ™‚å™¨
				}
			} else { // å¦‚æœåœç”¨ç§»å‹•
				if (transformState['master']) { // å°‡ä¸»å®¹å™¨æ­¸ä½
					transformState['master'].x = 0; // X åº§æ¨™æ­¸é›¶
					transformState['master'].y = 0; // Y åº§æ¨™æ­¸é›¶
				}
				applyTransforms(); // æ‡‰ç”¨æ­¸ä½å¾Œçš„è®Šå½¢
			}
		}
		function applyScanlineEffect() { // æ‡‰ç”¨æƒæç·šæ•ˆæœ
			clearInterval(timers.scanline); // æ¸…é™¤èˆŠçš„æƒæç·šè¨ˆæ™‚å™¨
			const bg = qs('#background-scanline-overlay'), txt = qs('#text-scanline-overlay'); // ç²å–æƒæç·šåœ–å±¤å…ƒç´ 
			bg.classList.toggle('active', settings.enableBackgroundScanline); // æ ¹æ“šè¨­å®šåˆ‡æ›èƒŒæ™¯æƒæç·šçš„ active class
			txt.classList.toggle('active', settings.enableTextScanline); // æ ¹æ“šè¨­å®šåˆ‡æ›æ–‡å­—æƒæç·šçš„ active class
			if (settings.enableBackgroundScanline || settings.enableTextScanline) { // å¦‚æœä»»ä¸€æƒæç·šå•Ÿç”¨
				const intervalMs = (parseInt(settings.scanlineIntervalMinutes) * 60 + parseInt(settings.scanlineIntervalSeconds)) * 1000; // è¨ˆç®—åˆ‡æ›é–“éš”
				if (intervalMs > 0) { timers.scanline = setInterval(() => { state.scanlinePatternIsA = !state.scanlinePatternIsA; updateDigitalClock(); }, intervalMs); } // è¨­å®šè¨ˆæ™‚å™¨å®šæ™‚åˆ‡æ›æƒæç·šæ¨£å¼
			}
		}
		function hexToRgba(hex, alpha = 1) { if (!hex || !hex.startsWith('#')) return `rgba(255, 255, 255, ${alpha})`; const bigint = parseInt(hex.slice(1), 16); const r = (bigint >> 16) & 255, g = (bigint >> 8) & 255, b = bigint & 255; return `rgba(${r}, ${g}, ${b}, ${alpha})`; } // å°‡ HEX é¡è‰²ç¢¼è½‰æ›ç‚º RGBA æ ¼å¼
		function applyAllSettings() { // æ‡‰ç”¨æ‰€æœ‰èˆ‡è¦–è¦ºç›¸é—œçš„è¨­å®š
			document.documentElement.style.setProperty('--page-background-color', settings.backgroundColor); // è¨­å®šé é¢èƒŒæ™¯è‰²
			['hourHandColor', 'minuteHandColor', 'secondHandColor', 'tickColor', 'numberColor', 'calendarHeaderColor', 'calendarWeekdayColor', 'calendarDayColor', 'calendarLunarColor'].forEach(key => { if (settings[key]) document.documentElement.style.setProperty('--' + key.replace(/([A-Z])/g, '-$1').toLowerCase(), settings[key]); }); // éæ­·ä¸¦è¨­å®šæ‰€æœ‰ CSS è®Šæ•¸
			const bgMonthColor = hexToRgba(settings.calendarHeaderColor, 0.12); // è¨ˆç®—æ—¥æ›†èƒŒæ™¯æœˆä»½çš„åŠé€æ˜é¡è‰²
			qsa('.calendar-bg-month, .analog-calendar-bg-month').forEach(el => el.style.color = bgMonthColor); // æ‡‰ç”¨æ—¥æ›†èƒŒæ™¯æœˆä»½é¡è‰²
			updateWeatherDisplay(); updateDigitalClock(); updateAnalogClock(); // æ›´æ–°å¤©æ°£ã€æ•¸ä½å’Œé¡æ¯”æ™‚é˜çš„é¡¯ç¤º
		}
		function moveRandomly() { // å°‡å…ƒä»¶ç¾¤çµ„éš¨æ©Ÿç§»å‹•åˆ°è¢å¹•å…§çš„ä¸€å€‹ä½ç½®
			if (settings.editMode) return; // ç·¨è¼¯æ¨¡å¼ä¸‹ä¸ç§»å‹•
			const id = 'master'; // æˆ‘å€‘åªç§»å‹•ä¸»å®¹å™¨
			if (!transformState[id]) transformState[id] = { x: 0, y: 0, scale: 1 }; // åˆå§‹åŒ–ä¸»å®¹å™¨çš„è®Šå½¢ç‹€æ…‹
			const T = transformState[id]; // ç²å–ä¸»å®¹å™¨çš„è®Šå½¢ç‹€æ…‹
			const allWidgets = qsa('.widget-wrapper'); // ç²å–æ‰€æœ‰å…ƒä»¶
			const bbox = getEncompassingBoundingBox(allWidgets); // è¨ˆç®—æ‰€æœ‰å¯è¦‹å…ƒä»¶çš„æ•´é«”é‚Šç•Œ
			if (!bbox) return; // å¦‚æœæ²’æœ‰å¯è¦‹å…ƒä»¶ï¼Œå‰‡ä¸ç§»å‹•
			const scaledWidth = bbox.width / T.scale; // è¨ˆç®—ç¸®æ”¾å¾Œçš„å¯¦éš›å¯¬åº¦
			const scaledHeight = bbox.height / T.scale; // è¨ˆç®—ç¸®æ”¾å¾Œçš„å¯¦éš›é«˜åº¦
			const margin = 10; // è¨­å®šèˆ‡è¢å¹•é‚Šç·£çš„é–“è·
			const maxX = (window.innerWidth - scaledWidth) / 2 - margin; // è¨ˆç®— X è»¸æœ€å¤§å¯ç§»å‹•ç¯„åœ
			const maxY = (window.innerHeight - scaledHeight) / 2 - margin; // è¨ˆç®— Y è»¸æœ€å¤§å¯ç§»å‹•ç¯„åœ
			if (maxX > 0 && maxY > 0) { // å¦‚æœå…ƒä»¶ç¾¤çµ„æ¯”è¢å¹•å°
				T.x = Math.random() * (maxX * 2) - maxX; // åœ¨ç¯„åœå…§ç”¢ç”Ÿéš¨æ©Ÿ X åº§æ¨™
				T.y = Math.random() * (maxY * 2) - maxY; // åœ¨ç¯„åœå…§ç”¢ç”Ÿéš¨æ©Ÿ Y åº§æ¨™
			} else { // å¦‚æœå…ƒä»¶ç¾¤çµ„æ¯”è¢å¹•å¤§
				T.x = 0; // X åº§æ¨™ç½®ä¸­
				T.y = 0; // Y åº§æ¨™ç½®ä¸­
			}
			applyTransforms(); // æ‡‰ç”¨æ–°çš„åº§æ¨™
		}
		function applyTransforms() { // å°‡ transformState ç‰©ä»¶ä¸­çš„è®Šå½¢æ‡‰ç”¨åˆ°å°æ‡‰çš„ DOM å…ƒç´ 
			const masterEl = qs('#master-layout'), T_master = transformState['master'] || defaultTransformState['master']; // ç²å–ä¸»å®¹å™¨å…ƒç´ å’Œå…¶è®Šå½¢ç‹€æ…‹
			if(masterEl) { masterEl.style.transition = state.isDragging ? 'none' : 'transform 1s ease-in-out'; masterEl.style.transform = `translate(calc(-50% + ${T_master.x}px), calc(-50% + ${T_master.y}px)) scale(${T_master.scale})`; } // æ‡‰ç”¨ä¸»å®¹å™¨çš„ä½ç§»å’Œç¸®æ”¾
			for (const id in transformState) { // éæ­·æ‰€æœ‰å…ƒä»¶çš„è®Šå½¢ç‹€æ…‹
				if (id === 'master') continue; // è·³éä¸»å®¹å™¨
				const el = qs(`#${id}-widget`); // ç²å–å…ƒä»¶
				if (el) { // å¦‚æœå…ƒä»¶å­˜åœ¨
					const T = transformState[id]; // ç²å–å…¶è®Šå½¢ç‹€æ…‹
					el.style.transition = state.isDragging ? 'none' : 'transform 1s ease-in-out'; // è¨­å®šéæ¸¡æ•ˆæœ (æ‹–æ›³æ™‚ç¦ç”¨)
					el.style.transform = `translate(calc(-50% + ${T.x}px), calc(-50% + ${T.y}px)) scale(${T.scale})`; // æ‡‰ç”¨ä½ç§»å’Œç¸®æ”¾
					const invScale = 1 / T.scale; // è¨ˆç®—åå‘ç¸®æ”¾æ¯”ä¾‹ï¼Œä»¥ä¿æŒæ§åˆ¶é …å¤§å°ä¸è®Š
					const handle = el.querySelector('.move-handle'); // ç²å–ç§»å‹•æ§åˆ¶é …
					if (handle) handle.style.transform = `translate(-50%, -50%) scale(${invScale})`; // æ‡‰ç”¨åå‘ç¸®æ”¾
					const resizeHandleX = el.querySelector('.resize-handle-x'); // ç²å–å¯¬åº¦èª¿æ•´æ§åˆ¶é …
					if (resizeHandleX) resizeHandleX.style.transform = `translateY(-50%) scale(${invScale})`; // æ‡‰ç”¨åå‘ç¸®æ”¾
					if (T.width) { const contentEl = qs(`#${id}-widget > div:first-child`); if(contentEl) contentEl.style.width = `${T.width}vw`; } // å¦‚æœæœ‰å¯¬åº¦è¨­å®šï¼Œå‰‡æ‡‰ç”¨
				}
			}
		}
		function toggleEditModeState() { // åˆ‡æ›ç·¨è¼¯æ¨¡å¼çš„ UI å’Œè¡Œç‚º
			document.body.classList.toggle('edit-mode', settings.editMode); // åˆ‡æ› body çš„ 'edit-mode' class
			const wrenchIcon = qs('#edit-mode-icon .wrench-icon'), closeIcon = qs('#edit-mode-icon .close-icon-svg'); // ç²å–ç·¨è¼¯åœ–ç¤º
			if (wrenchIcon && closeIcon) { // å¦‚æœåœ–ç¤ºå­˜åœ¨
				wrenchIcon.style.display = settings.editMode ? 'none' : 'block'; // æ ¹æ“šç·¨è¼¯æ¨¡å¼é¡¯ç¤º/éš±è—æ‰³æ‰‹åœ–ç¤º
				closeIcon.style.display = settings.editMode ? 'block' : 'none'; // æ ¹æ“šç·¨è¼¯æ¨¡å¼é¡¯ç¤º/éš±è—é—œé–‰åœ–ç¤º
			}
			qs('#edit-mode-icon').title = settings.editMode ? 'çµæŸç·¨è¼¯' : 'ç·¨è¼¯æ¨¡å¼'; // æ›´æ–°åœ–ç¤ºçš„ title
			if (settings.editMode) { // å¦‚æœé€²å…¥ç·¨è¼¯æ¨¡å¼
				state.movementEnabledBeforeEdit = settings.enableMovement; // å„²å­˜ç•¶å‰çš„ç§»å‹•è¨­å®š
				settings.enableMovement = false; // æš«æ™‚ç¦ç”¨ç§»å‹•
				qs('#enableMovement').checked = false; // æ›´æ–°è¨­å®šé¢æ¿ä¸­çš„é–‹é—œ
				if (transformState['master']) { // å°‡ä¸»å®¹å™¨æ­¸ä½åˆ°ä¸­å¿ƒ
					transformState['master'].x = 0; // X åº§æ¨™æ­¸é›¶
					transformState['master'].y = 0; // Y åº§æ¨™æ­¸é›¶
				}
				applyTransforms(); // æ‡‰ç”¨æ­¸ä½æ•ˆæœ
			} else { // å¦‚æœé€€å‡ºç·¨è¼¯æ¨¡å¼
				settings.enableMovement = state.movementEnabledBeforeEdit; // æ¢å¾©ä¹‹å‰çš„ç§»å‹•è¨­å®š
				qs('#enableMovement').checked = state.movementEnabledBeforeEdit; // æ›´æ–°è¨­å®šé¢æ¿ä¸­çš„é–‹é—œ
			}
			applyMovement(); // æ ¹æ“šæ–°çš„ç§»å‹•è¨­å®šä¾†å•Ÿå‹•æˆ–åœæ­¢è¨ˆæ™‚å™¨
			updateSettingDependencies(); // æ›´æ–°è¨­å®šé¢æ¿ä¸­é¸é …çš„é€£å‹•ç‹€æ…‹
		}
		function updateSettingDependencies() { // æ›´æ–°è¨­å®šé¢æ¿ä¸­å„é¸é …ä¹‹é–“çš„é€£å‹•ç¦ç”¨/å•Ÿç”¨ç‹€æ…‹
			const toggleSettingGroup = (parentSelector, childSelectors, isParentEnabled) => { // è¼”åŠ©å‡½å¼ï¼Œç”¨æ–¼åˆ‡æ›ä¸€çµ„å­è¨­å®šçš„ç‹€æ…‹
				const parentSwitch = qs(parentSelector); if (!parentSwitch) return; // ç²å–çˆ¶é–‹é—œ
				const isEnabled = isParentEnabled && parentSwitch.checked; // åˆ¤æ–·æ˜¯å¦æ‡‰å•Ÿç”¨å­è¨­å®š
				childSelectors.forEach(selector => { const element = qs(selector); if (!element) return; const item = element.closest('.setting-item'); if (item) { item.classList.toggle('disabled', !isEnabled); item.querySelectorAll('input, select, button').forEach(ctrl => ctrl.disabled = !isEnabled); } }); // åˆ‡æ›å­è¨­å®šçš„ disabled class å’Œ disabled å±¬æ€§
			};
			const isGregorianOn = qs('#showGregorianDate').checked, isWeatherOn = qs('#showWeather').checked, isWeatherLocationOn = qs('#showWeatherLocation').checked; // ç²å–å¹¾å€‹é—œéµè¨­å®šçš„ç‹€æ…‹
			toggleSettingGroup('#showDigitalTime', ['#hourColor', '#colonColor', '#minuteColor', '#secondColor', '#showAmPm', '#amPmColor'], true); // æ•¸ä½æ™‚é–“çš„å­è¨­å®š
			toggleSettingGroup('#showLunarDate', ['#showMinguoYear', '#minguoYearColor', '#showLunarMonth', '#lunarMonthColor', '#showLunarDay', '#lunarDayColor', '#showLunarShiChen', '#lunarShiChenColor', '#showJieqi', '#jieqiColor', '#showHolidays', '#holidayColor'], true); // è¾²æ›†çš„å­è¨­å®š
			toggleSettingGroup('#showAnalogClock', ['#hourHandColor', '#minuteHandColor', '#secondHandColor', '#tickColor', '#numberColor'], true); // é¡æ¯”æ™‚é˜çš„å­è¨­å®š
			toggleSettingGroup('#showAnalogCalendar', ['#calendarHeaderColor', '#calendarWeekdayColor', '#calendarDayColor', '#calendarLunarColor'], true); // é¡æ¯”æ—¥æ›†çš„å­è¨­å®š
			toggleSettingGroup('#showGregorianDate', ['#showGregorianYear', '#gregorianYearColor', '#showGregorianMonth', '#gregorianMonthColor', '#showGregorianDay', '#gregorianDayColor', '#showGregorianWeekday', '#gregorianWeekdayColor'], true); // å…¬æ›†çš„å­è¨­å®š
			toggleSettingGroup('#showGregorianDate', ['#showWeather'], true); // å¤©æ°£ä¾è³´æ–¼å…¬æ›†
			const areWeatherChildrenEnabled = isGregorianOn && isWeatherOn; // å¤©æ°£å­é …ç›®çš„å•Ÿç”¨æ¢ä»¶
			const locationItem = qs('#showWeatherLocation').closest('.setting-item'); // ç²å–å¤©æ°£åœ°é»è¨­å®šé …
			if (locationItem) { locationItem.classList.toggle('disabled', !areWeatherChildrenEnabled); locationItem.querySelectorAll('input, select, button').forEach(ctrl => ctrl.disabled = !areWeatherChildrenEnabled); } // è¨­å®šå¤©æ°£åœ°é»çš„å•Ÿç”¨/ç¦ç”¨
			const areLocationChildrenEnabled = isGregorianOn && isWeatherOn && isWeatherLocationOn; // åœ°é»é¸æ“‡å™¨çš„å•Ÿç”¨æ¢ä»¶
			const selectorsItem = qs('#countySelect').closest('.setting-item'); // ç²å–åœ°é»é¸æ“‡å™¨è¨­å®šé …
			if (selectorsItem) { selectorsItem.classList.toggle('disabled', !areLocationChildrenEnabled); selectorsItem.querySelectorAll('input, select, button').forEach(ctrl => ctrl.disabled = !areLocationChildrenEnabled); } // è¨­å®šåœ°é»é¸æ“‡å™¨çš„å•Ÿç”¨/ç¦ç”¨
			const weatherColorPicker = qs('#weatherColor'); // ç²å–å¤©æ°£é¡è‰²é¸æ“‡å™¨
			if (weatherColorPicker) { weatherColorPicker.disabled = !areWeatherChildrenEnabled; const randomBtn = weatherColorPicker.nextElementSibling; if(randomBtn) randomBtn.disabled = weatherColorPicker.disabled; } // è¨­å®šå¤©æ°£é¡è‰²çš„å•Ÿç”¨/ç¦ç”¨
			const locationColorPicker = qs('#weatherLocationColor'); // ç²å–åœ°é»é¡è‰²é¸æ“‡å™¨
			if (locationColorPicker) { locationColorPicker.disabled = !areLocationChildrenEnabled || !isWeatherLocationOn; const randomBtn = locationColorPicker.nextElementSibling; if(randomBtn) randomBtn.disabled = locationColorPicker.disabled; } // è¨­å®šåœ°é»é¡è‰²çš„å•Ÿç”¨/ç¦ç”¨
			const movementItem = qs('#enableMovement').closest('.setting-item'); // ç²å–ç§»å‹•è¨­å®šé …
			if (movementItem) { const isDisabled = settings.editMode; movementItem.classList.toggle('disabled', isDisabled); movementItem.querySelectorAll('input, select, button').forEach(ctrl => ctrl.disabled = isDisabled); } // åœ¨ç·¨è¼¯æ¨¡å¼ä¸‹ç¦ç”¨ç§»å‹•è¨­å®š
			const itemsToUpdate = [ // å®šç¾©éœ€è¦æ ¹æ“šå…¶å°æ‡‰é–‹é—œç‹€æ…‹æ›´æ–°çš„é¡è‰²é¸æ“‡å™¨
				{ switchId: 'showAmPm', colorId: 'amPmColor' }, { switchId: 'showGregorianYear', colorId: 'gregorianYearColor' },
				{ switchId: 'showGregorianMonth', colorId: 'gregorianMonthColor' }, { switchId: 'showGregorianDay', colorId: 'gregorianDayColor' },
				{ switchId: 'showGregorianWeekday', colorId: 'gregorianWeekdayColor' }, { switchId: 'showMinguoYear', colorId: 'minguoYearColor' },
				{ switchId: 'showLunarMonth', colorId: 'lunarMonthColor' }, { switchId: 'showLunarDay', colorId: 'lunarDayColor' },
				{ switchId: 'showLunarShiChen', colorId: 'lunarShiChenColor' }, { switchId: 'showJieqi', colorId: 'jieqiColor' },
				{ switchId: 'showHolidays', colorId: 'holidayColor' },
			];
			itemsToUpdate.forEach(({ switchId, colorId }) => { // éæ­·ä¸¦æ›´æ–°é€™äº›é¡è‰²é¸æ“‡å™¨çš„ç‹€æ…‹
				const switchEl = qs(`#${switchId}`), colorEl = qs(`#${colorId}`); // ç²å–é–‹é—œå’Œé¡è‰²é¸æ“‡å™¨å…ƒç´ 
				if (switchEl && colorEl && !switchEl.checked) { // å¦‚æœé–‹é—œå­˜åœ¨ä¸”æœªè¢«é¸ä¸­
					colorEl.disabled = true; // ç¦ç”¨é¡è‰²é¸æ“‡å™¨
					const randomBtn = colorEl.nextElementSibling; // ç²å–éš¨æ©Ÿé¡è‰²æŒ‰éˆ•
					if (randomBtn && randomBtn.classList.contains('random-color-btn')) randomBtn.disabled = true; // ç¦ç”¨éš¨æ©Ÿé¡è‰²æŒ‰éˆ•
				}
			});
		}
		function updateWidgetVisibility() { // æ ¹æ“šè¨­å®šé¡¯ç¤ºæˆ–éš±è—å„å€‹å…ƒä»¶
			setStyle(qs('#digital-widget'), { display: settings.showDigitalTime ? 'inline-flex' : 'none' }); // æ•¸ä½æ™‚é–“
			setStyle(qs('#gregorian-date-widget'), { display: settings.showGregorianDate ? 'inline-flex' : 'none' }); // å…¬æ›†æ—¥æœŸ
			setStyle(qs('#lunar-date-widget'), { display: settings.showLunarDate ? 'inline-flex' : 'none' }); // è¾²æ›†æ—¥æœŸ
			setStyle(qs('#analog-clock-widget'), { display: settings.showAnalogClock ? 'inline-flex' : 'none' }); // é¡æ¯”æ™‚é˜
			setStyle(qs('#analog-calendar-widget'), { display: settings.showAnalogCalendar ? 'inline-flex' : 'none' }); // é¡æ¯”æ—¥æ›†
		}
		function s2t(input) { if (typeof input !== 'string' && !Array.isArray(input)) return input; const map = {'è§':'è¦‹','è´µ':'è²´','æ— ':'ç„¡','å¼€':'é–‹','çº³':'ç´','è´¢':'è²¡','æŒ‚':'æ›','æ¢':'æ¨‘','åŠ¨':'å‹•','ç§':'ç¨®','å¯':'å•Ÿ','é’»':'é‘½','è®¢':'è¨‚','ç«–':'è±','é—¨':'é–€','è¯':'è©','è®¼':'è¨Ÿ','å‘':'é«®','å…»':'é¤Š','é©¬':'é¦¬','ç»':'ç¶“','ç»œ':'çµ¡','ç›–':'è“‹','ä¼š':'æœƒ','å­¦':'å­¸','è‰º':'è—','åŒ»':'é†«','è£…':'è£','ç»“':'çµ','ç½‘':'ç¶²','æ¸”':'æ¼','çŒ':'çµ','äº²':'è¦ª','è¿›':'é€²','æ‰«':'æƒ','ç»˜':'ç¹ª','é½':'é½Š','æ–‹':'é½‹','åº™':'å»Ÿ','ç¶':'ç«ˆ','è°¢':'è¬','é—®':'å•','å©¿':'å£»','å½’':'æ­¸','å®':'å¯§','åŸ':'å¢³','å¯¿':'å£½','å':'å£','è¡¥':'è£œ','å•':'å»','ä»“':'å€‰','æ¶‚':'å¡—','æ¡¥':'æ©‹','ç­‘':'ç¯‰','é¥°':'é£¾','å¢™':'ç‰†','ä¹°':'è²·','è½¦':'è»Š','äº§':'ç”¢','é›‡':'åƒ±','ä½£':'å‚­','è´§':'è²¨','æœº':'æ©Ÿ','æ¢°':'æ¢°','é…':'é†','é…¿':'é‡€','é“¸':'é‘„','é’ˆ':'é‡','åº“':'åº«','ç–—':'ç™‚','è¯¸':'è«¸','é¦€':'é¤˜','ä¸§':'å–ª','æ–­':'æ–·','èš':'èŸ»','æˆ·':'æˆ¶','ç‚‰':'çˆ','æ –':'æ£²','å¨':'å»š','èƒœ':'å‹','è´Ÿ':'è² ','ç­':'æ»…','é¾™':'é¾','é¸¡':'é›','çŒª':'è±¬','ä¹Œ':'çƒ','åŒ':'é›™','å®«':'å®®','æƒŠ':'é©š','è›°':'èŸ„','æ»¡':'æ»¿','å¤„':'è™•','æ—¶':'æ™‚','æ°”':'æ°£','å':'å¾Œ','ç¾':'ç½','å¤':'å¾©','è™š':'è™›','è´¼':'è³Š','è´¥':'æ•—','ä»ª':'å„€','ç¥¸':'ç¦','ä¸´':'è‡¨','é˜´':'é™°','é˜³':'é™½','åœ£':'è–','å†²':'æ²–','ç»':'çµ•','å²':'æ­²','ä¼¤':'å‚·','æ€':'æ®º','é»„':'é»ƒ','èŠ‚':'ç¯€','æ ‘':'æ¨¹','å›½':'åœ‹','ä¸‡':'è¬','é•¿':'é•·','å':'è¯','ä¸º':'ç‚º','ç”µ':'é›»','å£°':'è²','å†»':'å‡','è™«':'èŸ²','é±¼':'é­š','é¹°':'é·¹','æ¥':'ä¾†','æ¶¦':'æ½¤','å‡‰':'æ¶¼','éº¦':'éº¥','æ¸©':'æº«','æ”¶':'æ”¶','é—­':'é–‰','é—°':'é–','è°·':'ç©€','æ®“':'æ®®'}; const convert = (str) => str.split('').map(char => map[char] || char).join(''); return Array.isArray(input) ? input.map(convert) : convert(input); } // ç°¡é«”ä¸­æ–‡è½‰ç¹é«”ä¸­æ–‡çš„å‡½å¼
		const moonPhaseData = { 1: { name: 'æœ”æœˆ', aka: 'æ–°æœˆ', desc: 'æœˆçƒä½æ–¼å¤ªé™½å’Œåœ°çƒä¹‹é–“ï¼Œæœˆçƒçš„é»‘æš—é¢æœå‘åœ°çƒï¼Œå› æ­¤æˆ‘å€‘çœ‹ä¸è¦‹æœˆäº®ã€‚é€™æ˜¯è¾²æ›†æœˆçš„é–‹å§‹ã€‚' }, 2: { name: 'æ—¢æœ”æœˆ', desc: 'æ–°æœˆä¹‹å¾Œï¼Œæœˆçƒè¢«å¤ªé™½ç…§äº®çš„ä¸€å°éƒ¨åˆ†é–‹å§‹å¯è¦‹ï¼Œå‘ˆç¾æ¥µç´°çš„å½æœˆã€‚' }, 3: { name: 'è›¾çœ‰æ–°æœˆ', desc: 'æœˆç‰™å…’é€æ¼¸è®Šå¯¬ï¼Œå½¢å¦‚ç¾å¥³çš„ç§€çœ‰ã€‚' }, 4: { name: 'è›¾çœ‰æœˆ', desc: 'æœˆç›¸æŒçºŒè®Šå¯¬ï¼Œæ›´æ˜“æ–¼è§€å¯Ÿã€‚' }, 5: { name: 'è›¾çœ‰æœˆ', desc: 'æœˆç›¸æŒçºŒè®Šå¯¬ï¼Œæ›´æ˜“æ–¼è§€å¯Ÿã€‚' }, 6: { name: 'å¤•æœˆ', desc: 'æ—¥è½å¾Œä¸ä¹…å³å¯åœ¨è¥¿æ–¹å¤©ç©ºçœ‹åˆ°ï¼Œæ•…åå¤•æœˆã€‚' }, 7: { name: 'ä¸Šå¼¦æœˆ', desc: 'æœˆçƒé‹è¡Œåˆ°å…¶è»Œé“çš„å››åˆ†ä¹‹ä¸€è™•ï¼Œæˆ‘å€‘èƒ½çœ‹åˆ°æœˆçƒè¢«å¤ªé™½ç…§äº®çš„ä¸€åŠï¼Œçœ‹èµ·ä¾†åƒä¸€å€‹å­—æ¯ "D"ã€‚' }, 8: { name: 'ä¸Šå¼¦æœˆ', desc: 'æœˆçƒé‹è¡Œåˆ°å…¶è»Œé“çš„å››åˆ†ä¹‹ä¸€è™•ï¼Œæˆ‘å€‘èƒ½çœ‹åˆ°æœˆçƒè¢«å¤ªé™½ç…§äº®çš„ä¸€åŠï¼Œçœ‹èµ·ä¾†åƒä¸€å€‹å­—æ¯ "D"ã€‚' }, 9: { name: 'ä¹å¤œæœˆ', desc: 'ä¸Šå¼¦æœˆä¹‹å¾Œï¼Œå¯è¦‹çš„è¢«ç…§äº®éƒ¨åˆ†ç¹¼çºŒå¢åŠ ã€‚' }, 10: { name: 'å®µæœˆ', desc: 'å¤œæ™šå¤§éƒ¨åˆ†æ™‚é–“éƒ½èƒ½çœ‹åˆ°æœˆäº®ã€‚' }, 11: { name: 'æ¼¸ç›ˆå‡¸æœˆ', desc: 'æœˆç›¸æ¥è¿‘åœ“æ»¿ï¼Œä½†å°šæœªå®Œå…¨è®Šåœ“ã€‚' }, 12: { name: 'æ¼¸ç›ˆå‡¸æœˆ', desc: 'æœˆç›¸æ¥è¿‘åœ“æ»¿ï¼Œä½†å°šæœªå®Œå…¨è®Šåœ“ã€‚' }, 13: { name: 'æ¼¸ç›ˆå‡¸æœˆ', desc: 'æœˆç›¸æ¥è¿‘åœ“æ»¿ï¼Œä½†å°šæœªå®Œå…¨è®Šåœ“ã€‚' }, 14: { name: 'å°æœ›æœˆ', desc: 'è·é›¢æ»¿æœˆåƒ…ä¸€æ­¥ä¹‹é™ï¼Œéå¸¸æ˜äº®ã€‚' }, 15: { name: 'æœ›æœˆ', aka: 'æ»¿æœˆ', desc: 'åœ°çƒä½æ–¼å¤ªé™½å’Œæœˆçƒä¹‹é–“ï¼Œæœˆçƒè¢«å¤ªé™½ç…§äº®çš„æ•´å€‹åŠçƒéƒ½æœå‘åœ°çƒï¼Œçœ‹èµ·ä¾†æ˜¯ä¸€å€‹å®Œæ•´çš„åœ“ç›¤ã€‚' }, 16: { name: 'æ—¢æœ›æœˆ', desc: 'æ»¿æœˆä¹‹å¾Œï¼Œæœˆäº®é–‹å§‹ç”±ç›ˆè½‰è™§ã€‚' }, 17: { name: 'ç«‹å¾…æœˆ', desc: 'æœˆå‡ºæ™‚é–“ç¨æ™šï¼Œéœ€è¦ç«™è‘—ç­‰å¾…ä¸€æœƒå…’ã€‚' }, 18: { name: 'å±…å¾…æœˆ', desc: 'æœˆå‡ºæ›´æ™šï¼Œå¯ä»¥åœ¨å®¶ä¸­åè‘—ç­‰å¾…ã€‚' }, 19: { name: 'å¯¢å¾…æœˆ', desc: 'æœˆäº®å‡èµ·æ™‚å·²è¿‘ç¡è¦ºæ™‚é–“ã€‚' }, 20: { name: 'æ›´å¾…æœˆ', desc: 'æœˆäº®åœ¨æ·±å¤œä¸€æ›´ä¹‹å¾Œæ‰å‡èµ·ã€‚' }, 21: { name: 'æ¼¸è™§å‡¸æœˆ', desc: 'å¯è¦‹çš„è¢«ç…§äº®éƒ¨åˆ†é–‹å§‹æ¸›å°‘ï¼Œä½†ä»ç„¶å¤§æ–¼ä¸€åŠã€‚' }, 22: { name: 'ä¸‹å¼¦æœˆ', desc: 'æˆ‘å€‘å†æ¬¡çœ‹åˆ°æœˆçƒè¢«ç…§äº®çš„ä¸€åŠï¼Œä½†é€™æ¬¡çœ‹èµ·ä¾†åƒä¸€å€‹åå‘çš„ "D"ã€‚' }, 23: { name: 'ä¸‹å¼¦æœˆ', desc: 'æˆ‘å€‘å†æ¬¡çœ‹åˆ°æœˆçƒè¢«ç…§äº®çš„ä¸€åŠï¼Œä½†é€™æ¬¡çœ‹èµ·ä¾†åƒä¸€å€‹åå‘çš„ "D"ã€‚' }, 24: { name: 'æœ‰æ˜æœˆ', desc: 'å¤©å°‡äº®æ™‚ï¼Œä»å¯åœ¨å¤©ç©ºä¸­çœ‹è¦‹æœˆäº®ã€‚' }, 25: { name: 'è›¾çœ‰æ®˜æœˆ', desc: 'æœˆç›¸è®Šå›å½æ›²çš„é®åˆ€å½¢ç‹€ã€‚' }, 26: { name: 'è›¾çœ‰æ®˜æœˆ', desc: 'æœˆç›¸è®Šå›å½æ›²çš„é®åˆ€å½¢ç‹€ã€‚' }, 27: { name: 'æ®˜æœˆ', desc: 'æœˆç‰™å…’è®Šå¾—æ›´ç´°ã€‚' }, 28: { name: 'æ®˜æœˆ', desc: 'æœˆç‰™å…’è®Šå¾—æ›´ç´°ã€‚' }, 29: { name: 'æ›‰æœˆ', desc: 'åƒ…åœ¨é»æ˜å‰çš„æ±æ–¹å¤©ç©ºçŸ­æš«å¯è¦‹ã€‚' }, 30: { name: 'æ™¦æœˆ', desc: 'æœˆäº®å®Œå…¨æ¶ˆå¤±åœ¨å¤ªé™½çš„å…‰èŠ’ä¸­ï¼Œç‚ºä¸€å€‹è¾²æ›†æœˆçš„çµæŸã€‚' } }; // æœˆç›¸è³‡æ–™ç‰©ä»¶
		function getMoonPhaseDetails(lunarDay) { return moonPhaseData[lunarDay] || { name: 'æœªçŸ¥æœˆç›¸', desc: 'ç„¡æ­¤æœˆç›¸çš„è©³ç´°è³‡è¨Šã€‚' }; } // æ ¹æ“šè¾²æ›†æ—¥æœŸç²å–æœˆç›¸è©³æƒ…
		function getMoonPhaseSVG(lunarDay, size = '1em') { const phase = (lunarDay - 1) / 29.0, r = 50, cx = 50, cy = 50, light = '#f0e68c', dark = '#222'; const cos_angle = Math.cos(phase * 2 * Math.PI + Math.PI); const base = phase > 0.5 ? `<rect x="0" y="0" width="${cx}" height="${r*2}" fill="${light}" /><rect x="${cx}" y="0" width="${cx}" height="${r*2}" fill="${dark}" />` : `<rect x="0" y="0" width="${cx}" height="${r*2}" fill="${dark}" /><rect x="${cx}" y="0" width="${cx}" height="${r*2}" fill="${light}" />`; const terminator = `<ellipse cx="${cx}" cy="${cy}" rx="${r * Math.abs(cos_angle)}" ry="${r}" fill="${cos_angle > 0 ? light : dark}" />`; const id = 'moon-clip-' + Math.random().toString(36).substr(2, 9); return `<svg width="${size}" height="${size}" viewBox="0 0 100 100" style="display: inline-block; vertical-align: middle; border-radius: 50%; box-shadow: 0 0 2px rgba(240, 230, 140, 0.5);"><defs><clipPath id="${id}"><circle cx="${cx}" cy="${cy}" r="${r}" /></clipPath></defs><g clip-path="url(#${id})">${base}${terminator}</g></svg>`; } // æ ¹æ“šè¾²æ›†æ—¥æœŸç”Ÿæˆæœˆç›¸çš„ SVG åœ–ç¤º
		function getJieqiDescription(name) { const d = { 'ç«‹æ˜¥': 'æ˜¥å­£é–‹å§‹ï¼Œè¬ç‰©å¾©ç”¦ã€‚', 'é›¨æ°´': 'é™é›¨å¢å¤šï¼Œæ˜¥è€•é–‹å§‹ã€‚', 'é©šèŸ„': 'æ˜¥é›·éŸ¿å‹•ï¼Œé©šé†’å†¬çœ å‹•ç‰©ã€‚', 'æ˜¥åˆ†': 'æ™å¤œç­‰é•·ï¼Œæ˜¥æ„ç›ç„¶ã€‚', 'æ¸…æ˜': 'æ°£å€™æ¸…çˆ½æ˜æœ—ï¼Œæƒå¢“ç¥­ç¥–ã€‚', 'ç©€é›¨': 'é›¨æ°´æ»‹æ½¤ï¼Œç©€ç‰©ç”Ÿé•·ã€‚', 'ç«‹å¤': 'å¤å­£é–‹å§‹ï¼Œè¬ç‰©ç¹èŒ‚ã€‚', 'å°æ»¿': 'å¤ç†Ÿä½œç‰©ç±½ç²’é–‹å§‹é£½æ»¿ã€‚', 'èŠ’ç¨®': 'æ”¶ç©«èˆ‡æ’­ç¨®çš„æ™‚ç¯€ã€‚', 'å¤è‡³': 'åŒ—åŠçƒç™½æ™æœ€é•·ï¼Œç››å¤é–‹å§‹ã€‚', 'å°æš‘': 'å¤©æ°£é–‹å§‹ç‚ç†±ã€‚', 'å¤§æš‘': 'ä¸€å¹´ä¸­æœ€ç‚ç†±çš„æ™‚æœŸã€‚', 'ç«‹ç§‹': 'ç§‹å­£é–‹å§‹ï¼Œæ°£æº«æ¼¸é™ã€‚', 'è™•æš‘': 'æš‘æ°£æ¼¸é€€ï¼Œå¤©æ°£è½‰æ¶¼ã€‚', 'ç™½éœ²': 'æ°´æ°£å‡çµæˆéœ²ï¼Œå¤©æ°£æ¼¸å¯’ã€‚', 'ç§‹åˆ†': 'æ™å¤œç­‰é•·ï¼Œç§‹é«˜æ°£çˆ½ã€‚', 'å¯’éœ²': 'æ°£æº«æ›´ä½ï¼Œå¤©æ°£è½‰å†·ã€‚', 'éœœé™': 'å¤©æ°£æ¼¸å†·ï¼Œéœ²æ°´å‡çµæˆéœœã€‚', 'ç«‹å†¬': 'å†¬å­£é–‹å§‹ï¼Œè¬ç‰©æ”¶è—ã€‚', 'å°é›ª': 'é–‹å§‹é™é›ªï¼Œä½†é›ªé‡ä¸å¤§ã€‚', 'å¤§é›ª': 'é™é›ªé‡å¢å¤šï¼Œå¤©æ°£æ›´å†·ã€‚', 'å†¬è‡³': 'åŒ—åŠçƒç™½æ™æœ€çŸ­ï¼Œæ•¸ä¹å¯’å¤©é–‹å§‹ã€‚', 'å°å¯’': 'å¤©æ°£å¯’å†·ï¼Œå°šæœªé”åˆ°æœ€å†·ã€‚', 'å¤§å¯’': 'ä¸€å¹´ä¸­æœ€å¯’å†·çš„æ™‚æœŸã€‚' }; return d[name] || 'æ­¤ç¯€æ°£ç„¡è©³ç´°èªªæ˜ã€‚'; } // ç²å–ç¯€æ°£çš„æè¿°æ–‡å­—
		function checkYearlyCache(year) { if (state.yearlyDataCache.year !== year) state.yearlyDataCache = { year: year, holidays: [], jieqi: [] }; } // æª¢æŸ¥ä¸¦åœ¨éœ€è¦æ™‚é‡è¨­å¹´åº¦è³‡æ–™å¿«å–
		function getHolidaysForYear(year) { checkYearlyCache(year); if (state.yearlyDataCache.holidays.length > 0) return state.yearlyDataCache.holidays; const holidays = []; [{ n: 'å…ƒæ—¦', m: 0, d: 1 }, { n: 'å’Œå¹³ç´€å¿µæ—¥', m: 1, d: 28 }, { n: 'å…’ç«¥ç¯€', m: 3, d: 4 }, { n: 'å‹å‹•ç¯€', m: 4, d: 1 }, { n: 'åœ‹æ…¶æ—¥', m: 9, d: 10 }, { n: 'è–èª•ç¯€', m: 11, d: 25 }].forEach(h => holidays.push({ name: h.n, date: new Date(year, h.m, h.d) })); [{m:1,d:1,n:'è¾²æ›†æ–°å¹´'}, {m:1,d:15,n:'å…ƒå®µç¯€'}, {m:5,d:5,n:'ç«¯åˆç¯€'}, {m:7,d:7,n:'ä¸ƒå¤•'}, {m:7,d:15,n:'ä¸­å…ƒç¯€'}, {m:8,d:15,n:'ä¸­ç§‹ç¯€'}, {m:9,d:9,n:'é‡é™½ç¯€'}, {m:12,d:8,n:'è‡˜å…«ç¯€'}].forEach(lh => { const sd = Lunar.fromYmd(year, lh.m, lh.d).getSolar(); holidays.push({ name: lh.n, date: new Date(sd.getYear(), sd.getMonth() - 1, sd.getDay()) }); }); const nySolar = Lunar.fromYmd(year, 1, 1).getSolar(); holidays.push({ name: 'é™¤å¤•', date: new Date(nySolar.getYear(), nySolar.getMonth() - 1, nySolar.getDay() - 1) }); const qmJieqi = getJieqiForYear(year).find(jq => jq.name === 'æ¸…æ˜'); if(qmJieqi) holidays.push({ name: 'æ¸…æ˜ç¯€', date: qmJieqi.date }); const may1 = new Date(year, 4, 1); holidays.push({ name: 'æ¯è¦ªç¯€', date: new Date(year, 4, 1 + (7 - may1.getDay() + 7) % 7 + 7) }); return state.yearlyDataCache.holidays = holidays.sort((a, b) => a.date - b.date); } // ç²å–æŒ‡å®šå¹´ä»½çš„æ‰€æœ‰ç¯€å‡æ—¥
		function getJieqiForYear(year) { checkYearlyCache(year); if (state.yearlyDataCache.jieqi.length > 0) return state.yearlyDataCache.jieqi; const pinyinMap = { 'LI_CHUN': 'ç«‹æ˜¥', 'YU_SHUI': 'é›¨æ°´', 'JING_ZHE': 'é©šèŸ„', 'CHUN_FEN': 'æ˜¥åˆ†', 'QING_MING': 'æ¸…æ˜', 'GU_YU': 'ç©€é›¨', 'LI_XIA': 'ç«‹å¤', 'XIAO_MAN': 'å°æ»¿', 'MANG_ZHONG': 'èŠ’ç¨®', 'XIA_ZHHI': 'å¤è‡³', 'XIAO_SHU': 'å°æš‘', 'DA_SHU': 'å¤§æš‘', 'LI_QIU': 'ç«‹ç§‹', 'CHU_SHU': 'è™•æš‘', 'BAI_LU': 'ç™½éœ²', 'QIU_FEN': 'ç§‹åˆ†', 'HAN_LU': 'å¯’éœ²', 'SHUANG_JIANG': 'éœœé™', 'LI_DONG': 'ç«‹å†¬', 'XIAO_XUE': 'å°é›ª', 'DA_XUE': 'å¤§é›ª', 'DONG_ZHI': 'å†¬è‡³', 'XIAO_HAN': 'å°å¯’', 'DA_HAN': 'å¤§å¯’' }; const sMap = { 'æƒŠè›°': 'é©šèŸ„', 'å°æ»¡': 'å°æ»¿', 'èŠ’ç§': 'èŠ’ç¨®', 'å¤„æš‘': 'è™•æš‘', 'è°·é›¨': 'ç©€é›¨' }; const table = Lunar.fromYmd(year, 1, 1).getJieQiTable(); return state.yearlyDataCache.jieqi = Object.entries(table).map(([name, dateStr]) => ({ name: pinyinMap[name] || sMap[name] || name, date: new Date(dateStr) })).sort((a, b) => a.date - b.date); } // ç²å–æŒ‡å®šå¹´ä»½çš„æ‰€æœ‰ç¯€æ°£
		const timeInfoByHour = { 0: { shichen: 'å­', period: 'å‡Œæ™¨' }, 1: { shichen: 'ä¸‘', period: 'å‡Œæ™¨' }, 2: { shichen: 'ä¸‘', period: 'å‡Œæ™¨' }, 3: { shichen: 'å¯…', period: 'å‡Œæ™¨' }, 4: { shichen: 'å¯…', period: 'å‡Œæ™¨' }, 5: { shichen: 'å¯', period: 'æ¸…æ™¨' }, 6: { shichen: 'å¯', period: 'æ¸…æ™¨' }, 7: { shichen: 'è¾°', period: 'æ¸…æ™¨' }, 8: { shichen: 'è¾°', period: 'æ¸…æ™¨' }, 9: { shichen: 'å·³', period: 'ä¸Šåˆ' }, 10: { shichen: 'å·³', period: 'ä¸Šåˆ' }, 11: { shichen: 'åˆ', period: 'ä¸Šåˆ' }, 12: { shichen: 'åˆ', period: 'ä¸­åˆ' }, 13: { shichen: 'æœª', period: 'ä¸‹åˆ' }, 14: { shichen: 'æœª', period: 'ä¸‹åˆ' }, 15: { shichen: 'ç”³', period: 'ä¸‹åˆ' }, 16: { shichen: 'ç”³', period: 'ä¸‹åˆ' }, 17: { shichen: 'é…‰', period: 'å‚æ™š' }, 18: { shichen: 'é…‰', period: 'å‚æ™š' }, 19: { shichen: 'æˆŒ', period: 'å¤œæ™š' }, 20: { shichen: 'æˆŒ', period: 'å¤œæ™š' }, 21: { shichen: 'äº¥', period: 'å¤œæ™š' }, 22: { shichen: 'äº¥', period: 'å¤œæ™š' }, 23: { shichen: 'å­', period: 'æ·±å¤œ' } }; // å°æ™‚å°æ‡‰çš„æ™‚è¾°å’Œæ™‚æ®µ
		const shichenTimeRanges = { 'å­': '23:00 - 00:59', 'ä¸‘': '01:00 - 02:59', 'å¯…': '03:00 - 04:59', 'å¯': '05:00 - 06:59', 'è¾°': '07:00 - 08:59', 'å·³': '09:00 - 10:59', 'åˆ': '11:00 - 12:59', 'æœª': '13:00 - 14:59', 'ç”³': '15:00 - 16:59', 'é…‰': '17:00 - 18:59', 'æˆŒ': '19:00 - 20:59', 'äº¥': '21:00 - 22:59' }; // å„æ™‚è¾°çš„æ™‚é–“ç¯„åœ
		const getShiChen = (h) => timeInfoByHour[h]?.shichen || ''; // æ ¹æ“šå°æ™‚ç²å–æ™‚è¾°
		const getShiChenTimeRange = (name) => shichenTimeRanges[name] || ''; // æ ¹æ“šæ™‚è¾°åç¨±ç²å–æ™‚é–“ç¯„åœ
		const getDetailedTimePeriod = (h) => timeInfoByHour[h]?.period || ''; // æ ¹æ“šå°æ™‚ç²å–è©³ç´°æ™‚æ®µ (å‡Œæ™¨ã€ä¸Šåˆç­‰)
		function getWeatherDescriptionAndEmoji(code) { const map = { 0: { desc: 'æ™´' }, 1: { desc: 'å¤šé›²æ™‚æ™´' }, 2: { desc: 'å±€éƒ¨å¤šé›²' }, 3: { desc: 'é™°' }, 45: { desc: 'éœ§' }, 48: { desc: 'å‡éœ§' }, 51: { desc: 'æ¯›æ¯›é›¨' }, 53: { desc: 'æ¯›æ¯›é›¨' }, 55: { desc: 'æ¯›æ¯›é›¨' }, 56: { desc: 'å‡æ¯›æ¯›é›¨' }, 57: { desc: 'å‡æ¯›æ¯›é›¨' }, 61: { desc: 'é›¨' }, 63: { desc: 'é›¨' }, 65: { desc: 'å¤§é›¨' }, 66: { desc: 'å‡é›¨' }, 67: { desc: 'å‡é›¨' }, 71: { desc: 'é›ª' }, 73: { desc: 'é›ª' }, 75: { desc: 'å¤§é›ª' }, 77: { desc: 'å†°é›¹' }, 80: { desc: 'é™£é›¨' }, 81: { desc: 'é™£é›¨' }, 82: { desc: 'å¤§é™£é›¨' }, 85: { desc: 'é™£é›ª' }, 86: { desc: 'å¤§é™£é›ª' }, 95: { desc: 'é›·é™£é›¨' }, 96: { desc: 'é›·é™£é›¨ä¼´å†°é›¹' }, 99: { desc: 'é›·é™£é›¨ä¼´å†°é›¹' } }; return map[code] || { desc: 'æœªçŸ¥' }; } // æ ¹æ“šå¤©æ°£ä»£ç¢¼ç²å–å¤©æ°£æè¿°
		function getWeatherSVGIcon(code, size = '1em') { const createSvg = (viewBox = "0 0 64 64") => `<svg width="${size}" height="${size}" viewBox="${viewBox}" class="weather-svg-icon">`; const sun = () => `${createSvg()}<g><circle cx="32" cy="32" r="14" fill="#FDB813" stroke="#FDB813" stroke-width="2"/><g stroke="#FDB813" stroke-width="3" stroke-linecap="round">${[0, 45, 90, 135, 180, 225, 270, 315].map(a => `<line x1="32" y1="15" x2="32" y2="5" transform="rotate(${a} 32 32)"/>`).join('')}</g></g></svg>`; const cloud = () => `${createSvg()}<g><path d="M 15,42 A 10,10 0 0 1 25,32 A 18,18 0 0 1 52,35 A 12,12 0 0 1 58,48 L 20,48 A 10,10 0 0 1 15,42 Z" fill="#B0C4DE" stroke="#90a4be" stroke-width="1.5"/></g></svg>`; const partlyCloudy = () => `${createSvg()}<g><circle cx="24" cy="24" r="12" fill="#FDB813"/><path d="M 15,42 A 10,10 0 0 1 25,32 A 18,18 0 0 1 52,35 A 12,12 0 0 1 58,48 L 20,48 A 10,10 0 0 1 15,42 Z" fill="#B0C4DE" stroke="#90a4be" stroke-width="1.5"/></g></svg>`; const rain = () => `${createSvg()}<g><path d="M 15,38 A 10,10 0 0 1 25,28 A 18,18 0 0 1 52,31 A 12,12 0 0 1 58,44 L 20,44 A 10,10 0 0 1 15,38 Z" fill="#90a4be" stroke="#70849e" stroke-width="1.5"/><g stroke="#4682B4" stroke-width="3" stroke-linecap="round">${[[25,48,25,58],[37,50,37,60],[49,48,49,58]].map(c => `<line x1="${c[0]}" y1="${c[1]}" x2="${c[2]}" y2="${c[3]}"/>`).join('')}</g></g></svg>`; const snow = () => `${createSvg()}<g><path d="M 15,38 A 10,10 0 0 1 25,28 A 18,18 0 0 1 52,31 A 12,12 0 0 1 58,44 L 20,44 A 10,10 0 0 1 15,38 Z" fill="#B0C4DE" stroke="#90a4be" stroke-width="1.5"/><g stroke="#FFFFFF" stroke-width="2" stroke-linecap="round">${[[25,55],[37,58],[49,55]].map(c => `<path d="M${c[0]-4},${c[1]} l8,0 M${c[0]},${c[1]-4} l0,8 M${c[0]-3},${c[1]-3} l6,6 M${c[0]-3},${c[1]+3} l6,-6"/>`).join('')}</g></g></svg>`; const storm = () => `${createSvg()}<g><path d="M 15,38 A 10,10 0 0 1 25,28 A 18,18 0 0 1 52,31 A 12,12 0 0 1 58,44 L 20,44 A 10,10 0 0 1 15,38 Z" fill="#6c757d" stroke="#5c656d" stroke-width="1.5"/><path d="M 38,45 L 32,55 L 42,55 L 36,65" fill="none" stroke="#FFC107" stroke-width="3" stroke-linejoin="round" stroke-linecap="round"/></g></svg>`; const fog = () => `${createSvg()}<g><path d="M 15,42 A 10,10 0 0 1 25,32 A 18,18 0 0 1 52,35 A 12,12 0 0 1 58,48 L 20,48 A 10,10 0 0 1 15,42 Z" fill="#E0E0E0" stroke="#C0C0C0" stroke-width="1.5"/><g stroke="#B0B0B0" stroke-width="3" stroke-linecap="round">${[[18,38,56,38],[22,44,52,44],[20,50,54,50]].map(c => `<line x1="${c[0]}" y1="${c[1]}" x2="${c[2]}" y2="${c[3]}"/>`).join('')}</g></g></svg>`; switch (code) { case 0: return sun(); case 1: return partlyCloudy(); case 2: case 3: return cloud(); case 45: case 48: return fog(); case 51: case 53: case 55: case 61: case 63: case 80: case 81: return rain(); case 65: case 82: return rain(); case 95: case 96: case 99: return storm(); case 56: case 57: case 66: case 67: case 71: case 73: case 75: case 77: case 85: case 86: return snow(); default: return `<span style="font-size:${size}; vertical-align: middle;">â“</span>`; } } // æ ¹æ“šå¤©æ°£ä»£ç¢¼ç²å–å¤©æ°£çš„ SVG åœ–ç¤º
		const zodiacSVGFunctions = { "é¼ ": (s) => `<svg class="zodiac-svg-icon" width="${s}" height="${s}" viewBox="0 0 100 100"><path d="M 50 90 C 20 90, 20 40, 50 30 C 80 40, 80 90, 50 90 Z" fill="#9E9E9E" stroke="#616161" stroke-width="2"></path><path d="M 25 45 A 15 15 0 1 1 35 30" fill="#757575" stroke="#616161" stroke-width="2"></path><path d="M 75 45 A 15 15 0 1 0 65 30" fill="#757575" stroke="#616161" stroke-width="2"></path><path d="M 40 60 a 3 3 0 1 1 0.1 0" fill="black"></path><path d="M 60 60 a 3 3 0 1 1 0.1 0" fill="black"></path><path d="M 50 75 a 4 4 0 1 1 0.1 0" fill="black"></path></svg>`, "ç‰›": (s) => `<svg class="zodiac-svg-icon" width="${s}" height="${s}" viewBox="0 0 100 100"><path d="M 30 30 Q 10 10 20 40" fill="#795548" stroke="#4E342E" stroke-width="2"></path><path d="M 70 30 Q 90 10 80 40" fill="#795548" stroke="#4E342E" stroke-width="2"></path><path d="M 50 95 C 20 95, 25 30, 50 25 C 75 30, 80 95, 50 95 Z" fill="#795548" stroke="#4E342E" stroke-width="2"></path><path d="M 25 50 L 15 60 L 30 60 Z" fill="#A1887F" stroke="#4E342E" stroke-width="2"></path><path d="M 75 50 L 85 60 L 70 60 Z" fill="#A1887F" stroke="#4E342E" stroke-width="2"></path><path d="M 40 60 a 3 3 0 1 1 0.1 0" fill="black"></path><path d="M 60 60 a 3 3 0 1 1 0.1 0" fill="black"></path><path d="M 40 80 A 10 8 0 1 1 60 80" fill="#A1887F" stroke="#4E342E" stroke-width="2"></path></svg>`, "è™": (s) => `<svg class="zodiac-svg-icon" width="${s}" height="${s}" viewBox="0 0 100 100"><path d="M 50 90 A 40 40 0 1 1 50.1 90 Z" fill="#FF9800" stroke="#E65100" stroke-width="2"></path><path d="M 25 30 A 10 10 0 1 1 35 20" fill="#F57C00" stroke="#E65100" stroke-width="2"></path><path d="M 75 30 A 10 10 0 1 0 65 20" fill="#F57C00" stroke="#E65100" stroke-width="2"></path><path d="M 20 50 L 30 55" stroke="black" stroke-width="3" fill="none"></path><path d="M 22 65 L 32 68" stroke="black" stroke-width="3" fill="none"></path><path d="M 80 50 L 70 55" stroke="black" stroke-width="3" fill="none"></path><path d="M 78 65 L 68 68" stroke="black" stroke-width="3" fill="none"></path><path d="M 50 30 L 50 40" stroke="black" stroke-width="3" fill="none"></path><path d="M 40 55 a 3 3 0 1 1 0.1 0" fill="black"></path><path d="M 60 55 a 3 3 0 1 1 0.1 0" fill="black"></path><path d="M 50 70 L 45 80 L 55 80 Z" fill="black"></path></svg>`, "å…”": (s) => `<svg class="zodiac-svg-icon" width="${s}" height="${s}" viewBox="0 0 100 100"><path d="M 35 40 C 30 10, 40 10, 40 40 Z" fill="#FAFAFA" stroke="#BDBDBD" stroke-width="2"></path><path d="M 65 40 C 70 10, 60 10, 60 40 Z" fill="#FAFAFA" stroke="#BDBDBD" stroke-width="2"></path><path d="M 50 90 A 25 30 0 1 1 50.1 90 Z" fill="#FAFAFA" stroke="#BDBDBD" stroke-width="2"></path><path d="M 42 65 a 3 3 0 1 1 0.1 0" fill="#F44336"></path><path d="M 58 65 a 3 3 0 1 1 0.1 0" fill="#F44336"></path><path d="M 50 75 L 50 80 M 45 80 Q 50 85 55 80" fill="none" stroke="#BDBDBD" stroke-width="2"></path></svg>`, "é¾": (s) => `<svg class="zodiac-svg-icon" width="${s}" height="${s}" viewBox="0 0 100 100"><path d="M 50 95 C 20 95, 15 40, 50 20 C 85 40, 80 95, 50 95 Z" fill="#00695C" stroke="#004D40" stroke-width="2"></path><path d="M 35 30 C 20 10, 40 15, 40 35" fill="#FFC107" stroke="#FF8F00" stroke-width="1"></path><path d="M 65 30 C 80 10, 60 15, 60 35" fill="#FFC107" stroke="#FF8F00" stroke-width="1"></path><path d="M 40 80 C 35 70, 65 70, 60 80 Q 50 90 40 80 Z" fill="#00695C" stroke="#004D40" stroke-width="2"></path><circle cx="40" cy="55" r="4" fill="#F44336"></circle><circle cx="60" cy="55" r="4" fill="#F44336"></circle><path d="M 35 80 Q 15 75 30 65" fill="none" stroke="#FF8F00" stroke-width="1"></path><path d="M 65 80 Q 85 75 70 65" fill="none" stroke="#FF8F00" stroke-width="1"></path></svg>`, "è›‡": (s) => `<svg class="zodiac-svg-icon" width="${s}" height="${s}" viewBox="0 0 100 100"><path d="M 50 20 C 80 20, 80 70, 50 90 C 20 70, 20 20, 50 20 Z" fill="#8BC34A" stroke="#558B2F" stroke-width="2"></path><path d="M 40 50 a 3 3 0 1 1 0.1 0" fill="black"></path><path d="M 60 50 a 3 3 0 1 1 0.1 0" fill="black"></path><path d="M 50 90 L 50 98 L 47 95 M 50 98 L 53 95" stroke="#F44336" stroke-width="2" fill="none"></path></svg>`, "é¦¬": (s) => `<svg class="zodiac-svg-icon" width="${s}" height="${s}" viewBox="0 0 100 100"><path d="M 60 10 L 55 40 L 65 40 L 60 60" fill="#6D4C41" stroke="#5D4037" stroke-width="2"></path><path d="M 50 95 C 25 95, 30 20, 50 20 C 70 20, 75 95, 50 95 Z" fill="#A1887F" stroke="#5D4037" stroke-width="2"></path><path d="M 35 30 L 30 15 L 45 30 Z" fill="#A1887F" stroke="#5D4037" stroke-width="2"></path><path d="M 65 30 L 70 15 L 55 30 Z" fill="#A1887F" stroke="#5D4037" stroke-width="2"></path><path d="M 40 55 a 3 3 0 1 1 0.1 0" fill="black"></path><path d="M 60 55 a 3 3 0 1 1 0.1 0" fill="black"></path></svg>`, "ç¾Š": (s) => `<svg class="zodiac-svg-icon" width="${s}" height="${s}" viewBox="0 0 100 100"><circle cx="50" cy="40" r="20" fill="#ECEFF1" stroke="#B0BEC5" stroke-width="1"></circle><circle cx="35" cy="55" r="18" fill="#ECEFF1" stroke="#B0BEC5" stroke-width="1"></circle><circle cx="65" cy="55" r="18" fill="#ECEFF1" stroke="#B0BEC5" stroke-width="1"></circle><circle cx="50" cy="65" r="20" fill="#ECEFF1" stroke="#B0BEC5" stroke-width="1"></circle><circle cx="50" cy="65" r="15" fill="#CFD8DC" stroke="#78909C" stroke-width="2"></circle><circle cx="44" cy="62" r="2.5" fill="black"></circle><circle cx="56" cy="62" r="2.5" fill="black"></circle><path d="M 30 50 C 15 45, 15 65, 30 65" fill="none" stroke="#78909C" stroke-width="2"></path><path d="M 70 50 C 85 45, 85 65, 70 65" fill="none" stroke="#78909C" stroke-width="2"></path></svg>`, "çŒ´": (s) => `<svg class="zodiac-svg-icon" width="${s}" height="${s}" viewBox="0 0 100 100"><path d="M 20 60 A 15 15 0 1 1 20.1 60 Z" fill="#BCAAA4" stroke="#795548" stroke-width="2"></path><path d="M 80 60 A 15 15 0 1 1 80.1 60 Z" fill="#BCAAA4" stroke="#795548" stroke-width="2"></path><path d="M 50 90 A 35 35 0 1 1 50.1 90 Z" fill="#BCAAA4" stroke="#795548" stroke-width="2"></path><path d="M 50 80 A 25 25 0 1 1 50.1 80 Z" fill="#D7CCC8" stroke="#795548" stroke-width="2"></path><path d="M 40 60 a 3 3 0 1 1 0.1 0" fill="black"></path><path d="M 60 60 a 3 3 0 1 1 0.1 0" fill="black"></path><path d="M 40 75 Q 50 85 60 75" fill="none" stroke="#795548" stroke-width="2"></path></svg>`, "é›": (s) => `<svg class="zodiac-svg-icon" width="${s}" height="${s}" viewBox="0 0 100 100"><circle cx="50" cy="60" r="25" fill="#FFFFFF" stroke="#9E9E9E" stroke-width="2"></circle><path d="M 40 35 Q 45 25, 50 35 T 60 35" fill="#F44336" stroke="#D32F2F" stroke-width="1"></path><path d="M 75 60 L 85 65 L 75 70 Z" fill="#FFC107" stroke="#FFA000"></path><path d="M 70 75 A 5 8 0 1 1 70.1 75 Z" fill="#F44336" stroke="#D32F2F" stroke-width="1"></path><circle cx="60" cy="55" r="3" fill="black"></circle></svg>`, "ç‹—": (s) => `<svg class="zodiac-svg-icon" width="${s}" height="${s}" viewBox="0 0 100 100"><path d="M 25 40 L 15 70 L 35 50 Z" fill="#FFE0B2" stroke="#FB8C00" stroke-width="2"></path><path d="M 75 40 L 85 70 L 65 50 Z" fill="#FFE0B2" stroke="#FB8C00" stroke-width="2"></path><path d="M 50 90 C 20 90, 20 40, 50 35 C 80 40, 80 90, 50 90 Z" fill="#FFE0B2" stroke="#FB8C00" stroke-width="2"></path><path d="M 40 60 a 4 4 0 1 1 0.1 0" fill="black"></path><path d="M 60 60 a 4 4 0 1 1 0.1 0" fill="black"></path><path d="M 50 75 L 45 85 L 55 85 Z" fill="black"></path></svg>`, "è±¬": (s) => `<svg class="zodiac-svg-icon" width="${s}" height="${s}" viewBox="0 0 100 100"><path d="M 25 40 L 20 20 L 40 40 Z" fill="#F8BBD0" stroke="#EC407A" stroke-width="2"></path><path d="M 75 40 L 80 20 L 60 40 Z" fill="#F8BBD0" stroke="#EC407A" stroke-width="2"></path><path d="M 50 90 A 35 35 0 1 1 50.1 90 Z" fill="#F8BBD0" stroke="#EC407A" stroke-width="2"></path><path d="M 50 75 A 15 10 0 1 1 50.1 75 Z" fill="#F48FB1" stroke="#EC407A" stroke-width="2"></path><path d="M 45 75 a 2 2 0 1 1 0.1 0" fill="black"></path><path d="M 55 75 a 2 2 0 1 1 0.1 0" fill="black"></path><path d="M 40 55 a 3 3 0 1 1 0.1 0" fill="black"></path><path d="M 60 55 a 3 3 0 1 1 0.1 0" fill="black"></path></svg>` }; // åäºŒç”Ÿè‚–çš„ SVG åœ–ç¤ºç”¢ç”Ÿå‡½å¼
		const getShengXiaoSVG = (name, size = '1.2em') => zodiacSVGFunctions[name] ? zodiacSVGFunctions[name](size) : ''; // æ ¹æ“šç”Ÿè‚–åç¨±ç²å–å°æ‡‰çš„ SVG åœ–ç¤º
		function addCalendarBgMonth(container, month) { // åœ¨æ—¥æ›†å®¹å™¨ä¸­åŠ å…¥èƒŒæ™¯æœˆä»½æ•¸å­—
			let bgMonthEl = container.querySelector('.calendar-bg-month'); // å°‹æ‰¾ç¾æœ‰çš„èƒŒæ™¯æœˆä»½å…ƒç´ 
			if (!bgMonthEl) { bgMonthEl = document.createElement('div'); bgMonthEl.className = 'calendar-bg-month'; container.insertBefore(bgMonthEl, container.firstChild); } // å¦‚æœä¸å­˜åœ¨ï¼Œå‰‡å‰µå»ºä¸€å€‹æ–°çš„ä¸¦æ’å…¥
			bgMonthEl.textContent = month; // è¨­å®šæœˆä»½æ–‡å­—
		}
		function updateDigitalClock() { // æ›´æ–°æ•¸ä½æ™‚é˜å’Œæ‰€æœ‰æ—¥æœŸè³‡è¨Šçš„é¡¯ç¤º
			const now = new Date(); // ç²å–ç›®å‰æ™‚é–“
			const bg = qs('#background-scanline-overlay'), txt = qs('#text-scanline-overlay'); // ç²å–æƒæç·šåœ–å±¤
			if (settings.enableBackgroundScanline) { bg.classList.toggle('pattern-a', state.scanlinePatternIsA); bg.classList.toggle('pattern-b', !state.scanlinePatternIsA); } // åˆ‡æ›èƒŒæ™¯æƒæç·šæ¨£å¼
			if (settings.enableTextScanline) { txt.classList.toggle('pattern-a', !state.scanlinePatternIsA); txt.classList.toggle('pattern-b', state.scanlinePatternIsA); } // åˆ‡æ›æ–‡å­—æƒæç·šæ¨£å¼
			if (settings.showDigitalTime) { // å¦‚æœè¨­å®šé¡¯ç¤ºæ•¸ä½æ™‚é–“
				const parts = new Intl.DateTimeFormat('en-US', { hour: 'numeric', minute: '2-digit', second: '2-digit', hour12: false }).formatToParts(now); // æ ¼å¼åŒ–æ™‚é–“
				const h = parts.find(p => p.type === 'hour')?.value.padStart(2, '0') || '00'; // ç²å–å°æ™‚
				const m = parts.find(p => p.type === 'minute')?.value || '00'; // ç²å–åˆ†é˜
				const s = parts.find(p => p.type === 'second')?.value || '00'; // ç²å–ç§’æ•¸
				let displayHour = h, amPmText = ''; // åˆå§‹åŒ–é¡¯ç¤ºçš„å°æ™‚å’Œä¸Šä¸‹åˆæ–‡å­—
				if (settings.showAmPm) { const h12 = parseInt(h, 10); amPmText = getDetailedTimePeriod(h12); let dH12 = h12 % 12; if (dH12 === 0) dH12 = 12; displayHour = dH12.toString().padStart(2, '0'); } // è™•ç† 12 å°æ™‚åˆ¶
				qs('#hoursDisplay').textContent = displayHour; qs('#minutesDisplay').textContent = m; qs('#secondsDisplay').textContent = s; qs('#amPmDisplay').textContent = amPmText; // æ›´æ–°æ™‚é–“é¡¯ç¤º
				setStyle(qs('#hoursDisplay'), { color: settings.hourColor }); setStyle(qs('#minutesDisplay'), { color: settings.minuteColor }); setStyle(qs('#colonDisplay'), { color: settings.colonColor }); setStyle(qs('#secondsDisplay'), { color: settings.secondColor }); setStyle(qs('#amPmDisplay'), { color: settings.amPmColor, display: amPmText ? 'block' : 'none' }); // æ›´æ–°æ™‚é–“é¡è‰²
			}
			if (settings.showGregorianDate) { // å¦‚æœè¨­å®šé¡¯ç¤ºå…¬æ›†æ—¥æœŸ
				let gregorianParts = []; // åˆå§‹åŒ–å…¬æ›†æ—¥æœŸéƒ¨åˆ†
				if (settings.showGregorianYear) gregorianParts.push(`<span class="gregorian-year-target" style="color: ${settings.gregorianYearColor};">${now.getFullYear()}å¹´</span>`); // åŠ å…¥å¹´ä»½
				if (settings.showGregorianMonth) gregorianParts.push(`<span class="gregorian-month-target" style="color: ${settings.gregorianMonthColor};">${(now.getMonth() + 1).toString().padStart(2, '0')}æœˆ</span>`); // åŠ å…¥æœˆä»½
				if (settings.showGregorianDay) gregorianParts.push(`<span class="gregorian-day-target" style="color: ${settings.gregorianDayColor};">${now.getDate().toString().padStart(2, '0')}æ—¥</span>`); // åŠ å…¥æ—¥æœŸ
				if (settings.showGregorianWeekday) gregorianParts.push(`<span class="weekday-target" style="color: ${settings.gregorianWeekdayColor};">å‘¨${['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][now.getDay()]}</span>`); // åŠ å…¥æ˜ŸæœŸ
				qs('#gregorianDateParts').innerHTML = gregorianParts.join(''); // æ›´æ–°å…¬æ›†æ—¥æœŸé¡¯ç¤º
			}
			if (settings.showLunarDate) { // å¦‚æœè¨­å®šé¡¯ç¤ºè¾²æ›†æ—¥æœŸ
				let lunarParts = [], combinedJieqiHolidayText = ''; // åˆå§‹åŒ–è¾²æ›†éƒ¨åˆ†å’Œç¯€æ°£ç¯€æ—¥æ–‡å­—
				const currentYear = now.getFullYear(); // ç²å–ç›®å‰å¹´ä»½
				if (state.yearlyDataCache.year !== currentYear) { getHolidaysForYear(currentYear); getJieqiForYear(currentYear); } // å¦‚æœå¹´ä»½è®Šæ›´ï¼Œå‰‡é‡æ–°è¼‰å…¥å¹´åº¦è³‡æ–™
				const solar = Solar.fromDate(now), lunar = solar.getLunar(); // ç²å–è¾²æ›†ç‰©ä»¶
				if (settings.showMinguoYear) { const shengxiao = s2t(lunar.getYearShengXiao()); lunarParts.push(`<span class="lunar-year-target" title="æŸ¥çœ‹åäºŒç”Ÿè‚–" style="color: ${settings.minguoYearColor};">${now.getFullYear() - 1911}å¹´${getShengXiaoSVG(shengxiao)}</span>`); } // åŠ å…¥æ°‘åœ‹å¹´å’Œç”Ÿè‚–
				if (settings.showLunarMonth) { const day = lunar.getDay(); const phase = getMoonPhaseDetails(day); const phaseName = phase.aka ? `${phase.name}(${phase.aka})` : phase.name; lunarParts.push(`<span class="lunar-month-target-group"><span class="lunar-month-text-target" title="æŸ¥çœ‹æœˆæ›†" style="color: ${settings.lunarMonthColor};">${s2t(lunar.getMonthInChinese())}</span><span class="moon-phase-icon-target" title="æŸ¥çœ‹æœˆç›¸è©³æƒ…: ${phaseName}" style="color: ${settings.lunarMonthColor};">${getMoonPhaseSVG(day, '1.1em')}</span></span>`); } // åŠ å…¥è¾²æ›†æœˆä»½å’Œæœˆç›¸
				if (settings.showLunarDay) lunarParts.push(`<span class="lunar-day-target" style="color: ${settings.lunarDayColor};">${s2t(lunar.getDayInChinese())}</span>`); // åŠ å…¥è¾²æ›†æ—¥æœŸ
				if (settings.showLunarShiChen) lunarParts.push(`<span class="lunar-shichen-target" style="color: ${settings.lunarShiChenColor};">${getShiChen(now.getHours())}æ™‚</span>`); // åŠ å…¥æ™‚è¾°
				let jieQiText = '', holidayText = ''; // åˆå§‹åŒ–ç¯€æ°£å’Œç¯€æ—¥æ–‡å­—
				if (settings.showJieqi) { const jq = state.yearlyDataCache.jieqi.find(j => j.date.toDateString() === now.toDateString()) || state.yearlyDataCache.jieqi.find(j => j.date > now); if (jq) { const days = Math.ceil((jq.date - now) / 864e5); jieQiText = (days === 0) ? `${jq.name}` : `${days}â¡${jq.name}`; } } // ç²å–ç¯€æ°£è³‡è¨Š
				if (settings.showHolidays) { const h = state.yearlyDataCache.holidays.find(h => h.date.toDateString() === now.toDateString()) || state.yearlyDataCache.holidays.find(h => h.date > now); if (h) { const days = Math.ceil((h.date - now) / 864e5); holidayText = (days === 0) ? `${h.name}` : `${days}â¡${h.name}`; } } // ç²å–ç¯€æ—¥è³‡è¨Š
				let marqueeParts = []; // åˆå§‹åŒ–è·‘é¦¬ç‡ˆå…§å®¹
				if(jieQiText) marqueeParts.push(`<span style="color: ${settings.jieqiColor};">${jieQiText}</span>`); // åŠ å…¥ç¯€æ°£åˆ°è·‘é¦¬ç‡ˆ
				if(holidayText) marqueeParts.push(`<span style="color: ${settings.holidayColor};">${holidayText}</span>`); // åŠ å…¥ç¯€æ—¥åˆ°è·‘é¦¬ç‡ˆ
				combinedJieqiHolidayText = marqueeParts.join(' '); // çµ„åˆè·‘é¦¬ç‡ˆæ–‡å­—
				qs('#lunarDateDisplay').innerHTML = lunarParts.join(''); // æ›´æ–°è¾²æ›†æ—¥æœŸé¡¯ç¤º
				setStyle(qs('#lunarDateDisplay'), { display: lunarParts.length > 0 ? 'inline-block' : 'none' }); // æ ¹æ“šå…§å®¹æ±ºå®šæ˜¯å¦é¡¯ç¤º
				const jieqiMarqueeVisible = settings.showJieqi || settings.showHolidays; // åˆ¤æ–·ç¯€æ°£è·‘é¦¬ç‡ˆæ˜¯å¦å¯è¦‹
				setStyle(qs('#jieqiHolidayMarqueeContainer'), { display: jieqiMarqueeVisible ? 'block' : 'none' }); // è¨­å®šç¯€æ°£è·‘é¦¬ç‡ˆå¯è¦‹æ€§
				if (jieqiMarqueeVisible && state.lastMarqueeContent !== combinedJieqiHolidayText) { updateMarquee(combinedJieqiHolidayText, 'jieqi'); state.lastMarqueeContent = combinedJieqiHolidayText; } // å¦‚æœå…§å®¹æ›´æ–°ï¼Œå‰‡æ›´æ–°è·‘é¦¬ç‡ˆ
			}
			const weatherMarqueeVisible = settings.showWeather && settings.showGregorianDate; // åˆ¤æ–·å¤©æ°£è·‘é¦¬ç‡ˆæ˜¯å¦å¯è¦‹
			setStyle(qs('#weatherMarqueeContainer'), { display: weatherMarqueeVisible ? 'block' : 'none' }); // è¨­å®šå¤©æ°£è·‘é¦¬ç‡ˆå¯è¦‹æ€§
			if (weatherMarqueeVisible && state.lastWeatherContent && qs('#weatherMarqueeInner .weather-marquee-content').innerHTML !== state.lastWeatherContent) { updateMarquee(state.lastWeatherContent, 'weather'); } // å¦‚æœå…§å®¹æ›´æ–°ï¼Œå‰‡æ›´æ–°è·‘é¦¬ç‡ˆ
		}
		function updateMarquee(text, type) { // æ›´æ–°è·‘é¦¬ç‡ˆå…§å®¹å’Œå‹•ç•«
			const isWeather = type === 'weather'; // åˆ¤æ–·è·‘é¦¬ç‡ˆé¡å‹
			const ids = { container: isWeather ? 'weatherMarqueeContainer' : 'jieqiHolidayMarqueeContainer', inner: isWeather ? 'weatherMarqueeInner' : 'jieqiHolidayMarqueeInner' }; // æ ¹æ“šé¡å‹ç²å– ID
			const classes = { content: isWeather ? 'weather-marquee-content' : 'jieqi-holiday-marquee-content', duplicate: isWeather ? 'weather-marquee-content-duplicate' : 'jieqi-holiday-marquee-content-duplicate' }; // æ ¹æ“šé¡å‹ç²å– class
			const container = qs(`#${ids.container}`), inner = qs(`#${ids.inner}`); // ç²å–å®¹å™¨å’Œå…§éƒ¨å…ƒç´ 
			if (!container || !inner) return; // å¦‚æœå…ƒç´ ä¸å­˜åœ¨å‰‡è¿”å›
			const contentSpan = inner.querySelector(`.${classes.content}`), duplicateSpan = inner.querySelector(`.${classes.duplicate}`); // ç²å–å…§å®¹å’Œè¤‡è£½å…§å®¹çš„ span
			if (!contentSpan || !duplicateSpan) return; // å¦‚æœ span ä¸å­˜åœ¨å‰‡è¿”å›
			contentSpan.innerHTML = text; // è¨­å®šå…§å®¹
			requestAnimationFrame(() => { const contentW = contentSpan.scrollWidth, containerW = container.offsetWidth; if (contentW > containerW) { duplicateSpan.innerHTML = text; container.classList.add('scrolling'); setStyle(inner, { animationDuration: `${contentW / 40}s` }); } else { duplicateSpan.innerHTML = ''; container.classList.remove('scrolling'); } }); // åˆ¤æ–·æ˜¯å¦éœ€è¦æ»¾å‹•ä¸¦è¨­å®šå‹•ç•«
		}
		function initializeAnalogClock() { // åˆå§‹åŒ–é¡æ¯”æ™‚é˜çš„åˆ»åº¦å’Œæ•¸å­—
			const container = qs('#ticks-container'); container.innerHTML = ''; // æ¸…ç©ºå®¹å™¨
			for (let i = 1; i <= 60; i++) { // è¿´åœˆ 60 æ¬¡ (åˆ†é˜)
				const isHour = i % 5 === 0, rotation = i * 6; // åˆ¤æ–·æ˜¯å¦ç‚ºå°æ™‚åˆ»åº¦ä¸¦è¨ˆç®—æ—‹è½‰è§’åº¦
				const wrapper = document.createElement('div'); wrapper.className = 'tick-wrapper'; setStyle(wrapper, { transform: `rotate(${rotation}deg)` }); // å‰µå»ºåˆ»åº¦åŒ…è£å…ƒç´ ä¸¦æ—‹è½‰
				const tick = document.createElement('div'); tick.className = isHour ? 'tick tick-hour' : 'tick tick-minute'; wrapper.appendChild(tick); // å‰µå»ºåˆ»åº¦å…ƒç´ ä¸¦åŠ å…¥
				if (isHour) { wrapper.style.setProperty('--rotation', `${rotation}deg`); const numDiv = document.createElement('div'); numDiv.className = 'number'; numDiv.innerHTML = `<div>${i / 5}</div>`; wrapper.appendChild(numDiv); } // å¦‚æœæ˜¯å°æ™‚ï¼Œå‰‡åŠ å…¥æ•¸å­—
				container.appendChild(wrapper); // å°‡åˆ»åº¦åŒ…è£å…ƒç´ åŠ å…¥å®¹å™¨
			}
		}
		function updateAnalogClock() { // æ›´æ–°é¡æ¯”æ™‚é˜çš„æŒ‡é‡ä½ç½®å’Œé¡æ¯”æ—¥æ›†
			if (!settings.showAnalogClock && !settings.showAnalogCalendar) return; // å¦‚æœéƒ½æ²’é¡¯ç¤ºï¼Œå‰‡ä¸åŸ·è¡Œ
			const now = new Date(), s = now.getSeconds() + now.getMilliseconds() / 1000, m = now.getMinutes() + s / 60, h = now.getHours() % 12 + m / 60; // è¨ˆç®—æ™‚åˆ†ç§’çš„ç²¾ç¢ºè§’åº¦
			if (settings.showAnalogClock) { setStyle(qs('.hour-hand'), { transform: `rotate(${(h / 12) * 360}deg)` }); setStyle(qs('.minute-hand'), { transform: `rotate(${(m / 60) * 360}deg)` }); setStyle(qs('.second-hand'), { transform: `rotate(${(s / 60) * 360}deg)` }); } // æ›´æ–°æŒ‡é‡æ—‹è½‰
			if (settings.showAnalogCalendar) { const todayCell = qs('#analog-calendar-grid .is-today .gregorian-day'); if (!todayCell || new Date().getDate() !== parseInt(todayCell.textContent)) createAnalogCalendar(); } // å¦‚æœæ—¥æœŸè®Šæ›´ï¼Œå‰‡é‡æ–°ç”Ÿæˆé¡æ¯”æ—¥æ›†
		}
		function createAnalogCalendar() { // ç”Ÿæˆé¡æ¯”æ—¥æ›†çš„å…§å®¹
			const now = new Date(), year = now.getFullYear(), month = now.getMonth(); // ç²å–ç•¶å¹´å’Œç•¶æœˆ
			qs('#analog-calendar-widget .analog-calendar-bg-month').textContent = month + 1; // è¨­å®šèƒŒæ™¯æœˆä»½
			const grid = qs('#analog-calendar-grid'); grid.innerHTML = ''; // æ¸…ç©ºæ—¥æ›†ç¶²æ ¼
			['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'].forEach(day => { const el = document.createElement('div'); el.textContent = day; el.className = 'weekday-header'; grid.appendChild(el); }); // åŠ å…¥æ˜ŸæœŸæ¨™é ­
			if (state.yearlyDataCache.year !== year) { getHolidaysForYear(year); getJieqiForYear(year); } // æª¢æŸ¥å¹´åº¦å¿«å–
			const { holidays, jieqi } = state.yearlyDataCache; // ç²å–ç¯€æ—¥å’Œç¯€æ°£è³‡æ–™
			const startDate = new Date(year, month, 1 - new Date(year, month, 1).getDay()); // è¨ˆç®—æ—¥æ›†çš„ç¬¬ä¸€å¤©
			for (let i = 0; i < 42; i++) { // è¿´åœˆç”Ÿæˆ 42 å€‹æ—¥æœŸæ ¼
				const date = new Date(startDate); date.setDate(startDate.getDate() + i); // è¨ˆç®—ç•¶å‰æ—¥æœŸ
				const cell = document.createElement('div'); cell.className = 'calendar-day'; // å‰µå»ºæ—¥æœŸæ ¼å…ƒç´ 
				if (date.getMonth() !== month) cell.classList.add('other-month'); // æ¨™è¨˜éæœ¬æœˆçš„æ—¥æœŸ
				cell.dataset.date = date.toISOString(); // å„²å­˜æ—¥æœŸè³‡æ–™
				cell.onclick = (e) => { e.stopPropagation(); showDateDetails(new Date(cell.dataset.date)); }; // ç¶å®šé»æ“Šäº‹ä»¶ä»¥é¡¯ç¤ºè©³æƒ…
				const lunar = Solar.fromDate(date).getLunar(); // ç²å–è¾²æ›†è³‡è¨Š
				const lunarText = lunar.getDay() === 1 ? s2t(lunar.getMonthInChinese()) + 'æœˆ' : s2t(lunar.getDayInChinese()); // æ ¼å¼åŒ–è¾²æ›†æ–‡å­—
				let eventHtml = ''; // åˆå§‹åŒ–äº‹ä»¶ HTML
				if (date.getMonth() === month) { // åªè™•ç†æœ¬æœˆçš„äº‹ä»¶
					const holiday = holidays.find(h => h.date.toDateString() === date.toDateString()); // å°‹æ‰¾ç¯€æ—¥
					if (holiday) eventHtml += `<span class="event-indicator holiday">${holiday.name}</span>`; // åŠ å…¥ç¯€æ—¥æ¨™è¨˜
					const jq = jieqi.find(j => j.date.toDateString() === date.toDateString()); // å°‹æ‰¾ç¯€æ°£
					if (jq) eventHtml += `<span class="event-indicator jieqi">${jq.name}</span>`; // åŠ å…¥ç¯€æ°£æ¨™è¨˜
				}
				cell.innerHTML = `<div class="analog-day-main"><div class="gregorian-day">${date.getDate()}</div><div class="lunar-day">${lunarText}</div></div><div class="analog-day-events">${eventHtml}</div>`; // å¡«å…¥æ—¥æœŸæ ¼å…§å®¹
				if (date.toDateString() === now.toDateString()) cell.classList.add('is-today'); // æ¨™è¨˜ä»Šå¤©
				grid.appendChild(cell); // å°‡æ—¥æœŸæ ¼åŠ å…¥ç¶²æ ¼
			}
		}
		function updateWeatherDisplay() { // æ›´æ–°å¤©æ°£è³‡è¨Šçš„é¡¯ç¤º
			if (!settings.showWeather) { state.lastWeatherContent = ''; updateDigitalClock(); return; } // å¦‚æœä¸é¡¯ç¤ºå¤©æ°£ï¼Œå‰‡æ¸…ç©ºä¸¦è¿”å›
			let weatherText = `<span style="color: ${settings.weatherColor};">ç„¡æ³•å–å¾—å¤©æ°£è³‡è¨Š</span>`; // é è¨­çš„éŒ¯èª¤è¨Šæ¯
			if (state.weatherDataCache) { // å¦‚æœæœ‰å¤©æ°£è³‡æ–™å¿«å–
				const { desc } = getWeatherDescriptionAndEmoji(state.weatherDataCache.current.weather_code); // ç²å–å¤©æ°£æè¿°
				const icon = getWeatherSVGIcon(state.weatherDataCache.current.weather_code, '1em'); // ç²å–å¤©æ°£åœ–ç¤º
				const temp = Math.round(state.weatherDataCache.current.temperature_2m); // ç²å–æº«åº¦
				const location = settings.showWeatherLocation ? `<span style="color: ${settings.weatherLocationColor};">${getChineseLocationName(settings.weatherLocation)}</span> ` : ''; // ç²å–åœ°é»åç¨±
				weatherText = `${location}<span style="color: ${settings.weatherColor};">${desc}${icon}${temp}Â°C</span>`; // çµ„åˆå¤©æ°£æ–‡å­—
			}
			state.lastWeatherContent = weatherText; updateMarquee(weatherText, 'weather'); // æ›´æ–°è·‘é¦¬ç‡ˆ
		}
		async function updateWeather() { // ç•°æ­¥ç²å–ä¸¦æ›´æ–°å¤©æ°£è³‡æ–™
			const locationName = settings.weatherLocation.trim(); // ç²å–åœ°é»åç¨±
			if (!locationName) { state.weatherDataCache = null; updateWeatherDisplay(); return; } // å¦‚æœåœ°é»ç‚ºç©ºï¼Œå‰‡æ¸…ç©ºè³‡æ–™ä¸¦è¿”å›
			const coords = await fetchCoordinates(locationName); // ç²å–åœ°é»çš„ç¶“ç·¯åº¦
			state.weatherDataCache = coords ? await fetchWeather(coords.latitude, coords.longitude) : null; // æ ¹æ“šç¶“ç·¯åº¦ç²å–å¤©æ°£è³‡æ–™
			updateWeatherDisplay(); // æ›´æ–°å¤©æ°£é¡¯ç¤º
		}
		async function fetchAPI(url) { try { const response = await fetch(url); if (!response.ok) throw new Error('APIè«‹æ±‚å¤±æ•—'); return await response.json(); } catch (error) { console.error(`ç²å–è³‡æ–™å¤±æ•—: ${url}`, error); return null; } } // ç•°æ­¥ API è«‹æ±‚çš„è¼”åŠ©å‡½å¼
		async function fetchCoordinates(name) { const data = await fetchAPI(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(name)}&count=1&language=en&format=json`); return data?.results?.[0] || null; } // æ ¹æ“šåœ°åç²å–ç¶“ç·¯åº¦
		async function fetchWeather(lat, lon) { return await fetchAPI(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code&hourly=temperature_2m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto&forecast_days=8`); } // æ ¹æ“šç¶“ç·¯åº¦ç²å–å¤©æ°£é å ±
		function getChineseLocationName(englishName) { for (const county in taiwanLocations) { for (const district in taiwanLocations[county].districts) { if (taiwanLocations[county].districts[district].toLowerCase() === englishName.toLowerCase()) return county === district ? county : district; } } return englishName; } // å°‡è‹±æ–‡åœ°åè½‰æ›ç‚ºä¸­æ–‡
		function updateMainMoonPhaseDisplay(date) { // æ›´æ–°æœˆç›¸è©³æƒ…å½ˆå‡ºè¦–çª—ä¸­çš„ä¸»è¦é¡¯ç¤ºå€åŸŸ
			const lunar = Solar.fromDate(date).getLunar(), day = lunar.getDay(), details = getMoonPhaseDetails(day); // ç²å–è¾²æ›†æ—¥æœŸå’Œæœˆç›¸è©³æƒ…
			const title = details.aka ? `${details.name} (${details.aka})` : details.name; // æ ¼å¼åŒ–æ¨™é¡Œ
			qs('#moonPhaseModalTitle').textContent = `æœˆç›¸è©³æƒ…ï¼š${title}`; // è¨­å®šæ¨™é¡Œ
			qs('#mainMoonIcon').innerHTML = getMoonPhaseSVG(day, '100px'); // è¨­å®šå¤§çš„æœˆç›¸åœ–ç¤º
			qs('#mainMoonDescription').textContent = details.desc; // è¨­å®šæœˆç›¸æè¿°
			qsa('#moonCalendarGrid .calendar-day').forEach(d => d.classList.remove('is-selected')); // ç§»é™¤æ‰€æœ‰æ—¥æœŸçš„é¸ä¸­ç‹€æ…‹
			const selectedDayEl = qs(`#moonCalendarGrid .calendar-day[data-date-string='${date.toDateString()}']`); // æ‰¾åˆ°å°æ‡‰çš„æ—¥æœŸå…ƒç´ 
			if (selectedDayEl) selectedDayEl.classList.add('is-selected'); // æ¨™è¨˜ç‚ºé¸ä¸­
		}
		function generateMoonPhaseCalendar(year, month, selectedDate) { // ç”Ÿæˆæœˆç›¸è©³æƒ…å½ˆå‡ºè¦–çª—ä¸­çš„å°æ—¥æ›†
			const grid = qs('#moonCalendarGrid'), monthYear = qs('#moonCalendarMonthYear'), weekdaysEl = qs('#moonCalendarWeekdays'); // ç²å–å…ƒç´ 
			grid.innerHTML = ''; weekdaysEl.innerHTML = ''; // æ¸…ç©ºå…§å®¹
			['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'].forEach(day => { const el = document.createElement('div'); el.textContent = day; weekdaysEl.appendChild(el); }); // åŠ å…¥æ˜ŸæœŸæ¨™é ­
			monthYear.textContent = `${year}å¹´ ${month + 1}æœˆ`; // è¨­å®šå¹´æœˆæ¨™é¡Œ
			const startDate = new Date(year, month, 1 - new Date(year, month, 1).getDay()), today = new Date(); // è¨ˆç®—æ—¥æ›†èµ·å§‹æ—¥æœŸ
			for (let i = 0; i < 42; i++) { // è¿´åœˆç”Ÿæˆ 42 å€‹æ—¥æœŸæ ¼
				const date = new Date(startDate); date.setDate(startDate.getDate() + i); date.setHours(12, 0, 0, 0); // è¨ˆç®—ç•¶å‰æ—¥æœŸ
				const cell = document.createElement('div'); cell.className = 'calendar-day'; // å‰µå»ºæ—¥æœŸæ ¼
				if (date.getMonth() !== month) cell.classList.add('other-month'); // æ¨™è¨˜éæœ¬æœˆæ—¥æœŸ
				cell.dataset.dateString = date.toDateString(); // å„²å­˜æ—¥æœŸå­—ä¸²
				cell.onclick = () => { state.moonCalendarDate = new Date(date); updateMainMoonPhaseDisplay(state.moonCalendarDate); }; // ç¶å®šé»æ“Šäº‹ä»¶
				const lunar = Solar.fromDate(date).getLunar(); // ç²å–è¾²æ›†è³‡è¨Š
				const lunarText = lunar.getDay() === 1 ? s2t(lunar.getMonthInChinese()) + 'æœˆ' : s2t(lunar.getDayInChinese()); // æ ¼å¼åŒ–è¾²æ›†æ–‡å­—
				cell.innerHTML = `<div class="gregorian-day">${date.getDate()}</div><div class="moon-phase-icon-small">${getMoonPhaseSVG(lunar.getDay(), '24px')}</div><div class="lunar-day">${lunarText}</div>`; // å¡«å…¥å…§å®¹
				if (today.toDateString() === date.toDateString()) cell.classList.add('is-today'); // æ¨™è¨˜ä»Šå¤©
				if (selectedDate.toDateString() === date.toDateString()) cell.classList.add('is-selected'); // æ¨™è¨˜é¸ä¸­çš„æ—¥æœŸ
				grid.appendChild(cell); // åŠ å…¥åˆ°ç¶²æ ¼
			}
		}
		function showMoonPhaseDetails(date) { // é¡¯ç¤ºæœˆç›¸è©³æƒ…å½ˆå‡ºè¦–çª—
			if (settings.editMode) return; // ç·¨è¼¯æ¨¡å¼ä¸‹ä¸åŸ·è¡Œ
			const d = new Date(date); d.setHours(12, 0, 0, 0); // å‰µå»ºæ—¥æœŸç‰©ä»¶ä¸¦æ¨™æº–åŒ–æ™‚é–“
			state.moonCalendarDate = d; updateMainMoonPhaseDisplay(d); generateMoonPhaseCalendar(d.getFullYear(), d.getMonth(), d); qs('#moonPhaseModal').classList.add('is-active'); // æ›´æ–°ç‹€æ…‹ã€UI ä¸¦é¡¯ç¤ºå½ˆçª—
		}
		function showDateDetails(date) { // é¡¯ç¤ºæŒ‡å®šæ—¥æœŸçš„è©³ç´°è³‡è¨Šå½ˆå‡ºè¦–çª—
			if (settings.editMode) return; // ç·¨è¼¯æ¨¡å¼ä¸‹ä¸åŸ·è¡Œ
			date.setHours(12, 0, 0, 0); const year = date.getFullYear(); // æ¨™æº–åŒ–æ™‚é–“ä¸¦ç²å–å¹´ä»½
			const holidays = getHolidaysForYear(year), jieqi = getJieqiForYear(year); // ç²å–å¹´åº¦è³‡æ–™
			const isToday = date.toDateString() === new Date().toDateString(); // åˆ¤æ–·æ˜¯å¦ç‚ºä»Šå¤©
			const lunar = Solar.fromDate(date).getLunar(); // ç²å–è¾²æ›†ç‰©ä»¶
			const shengxiao = s2t(lunar.getYearShengXiao()); // ç²å–ç”Ÿè‚–
			const lunarYearText = `${s2t(lunar.getYearInGanZhi())}${shengxiao}${getShengXiaoSVG(shengxiao)}å¹´`; // çµ„åˆè¾²æ›†å¹´ä»½æ–‡å­—
			const lunarDateText = `${s2t(lunar.getMonthInChinese())}æœˆ${s2t(lunar.getDayInChinese())}`; // çµ„åˆè¾²æ›†æœˆæ—¥æ–‡å­—
			let eventHtml = '', countdownHtml = ''; // åˆå§‹åŒ–äº‹ä»¶å’Œå€’æ•¸è¨ˆæ™‚çš„ HTML
			const currentJieqi = jieqi.find(j => j.date.toDateString() === date.toDateString()); // å°‹æ‰¾ç•¶å¤©çš„ç¯€æ°£
			if (currentJieqi) eventHtml += `<p>${isToday ? 'ä»Šå¤©æ˜¯' : 'é€™å¤©æ˜¯'} <strong>${currentJieqi.name}</strong>ï¼ ${getJieqiDescription(currentJieqi.name)}</p>`; // åŠ å…¥ç¯€æ°£è³‡è¨Š
			const currentHoliday = holidays.find(h => h.date.toDateString() === date.toDateString()); // å°‹æ‰¾ç•¶å¤©çš„ç¯€æ—¥
			if (currentHoliday) eventHtml += `<p>${isToday ? 'ä»Šå¤©æ˜¯' : 'é€™å¤©æ˜¯'} <strong>${currentHoliday.name}</strong>ï¼</p>`; // åŠ å…¥ç¯€æ—¥è³‡è¨Š
			const nextJieqi = jieqi.find(j => j.date > date); // å°‹æ‰¾ä¸‹ä¸€å€‹ç¯€æ°£
			if (nextJieqi) { const days = Math.ceil((nextJieqi.date - date) / 864e5); countdownHtml += `<p>è·é›¢ä¸‹å€‹ç¯€æ°£ <strong>${nextJieqi.name}</strong> é‚„æœ‰ ${days} å¤©ã€‚<br><span style="font-size:0.9em; color:#ccc;">${getJieqiDescription(nextJieqi.name)}</span></p>`; } // åŠ å…¥ä¸‹ä¸€å€‹ç¯€æ°£çš„å€’æ•¸
			const nextHoliday = holidays.find(h => h.date > date); // å°‹æ‰¾ä¸‹ä¸€å€‹ç¯€æ—¥
			if (nextHoliday) { const days = Math.ceil((nextHoliday.date - date) / 864e5); countdownHtml += `<p>è·é›¢ä¸‹å€‹ç¯€æ—¥ <strong>${nextHoliday.name}</strong> é‚„æœ‰ ${days} å¤©</p>`; } // åŠ å…¥ä¸‹ä¸€å€‹ç¯€æ—¥çš„å€’æ•¸
			if (countdownHtml) eventHtml += `<div class="countdown-section">${countdownHtml}</div>`; // çµ„åˆå€’æ•¸è¨ˆæ™‚ HTML
			const detailsHtml = `<p><strong>å…¬æ›†ï¼š</strong>${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥</p><p><strong>è¾²æ›†ï¼š</strong>${lunarYearText} ${lunarDateText} ${getMoonPhaseSVG(lunar.getDay(), '1.2em')}</p><div class="yi-ji-grid"><strong>å®œï¼š</strong><span>${s2t(lunar.getDayYi()).join('ã€') || 'ç„¡'}</span><strong>å¿Œï¼š</strong><span>${s2t(lunar.getDayJi()).join('ã€') || 'ç„¡'}</span></div>${eventHtml}<p style="margin-top: 15px; font-size: 0.9em; color: #aaa;">å®œå¿Œåƒ…ä¾›åƒè€ƒï¼Œè«‹é †å¿ƒè€Œç‚ºã€‚</p>`; // çµ„åˆæœ€çµ‚çš„è©³ç´°è³‡è¨Š HTML
			qs('#dateDetailsModalTitle').textContent = `${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`; // è¨­å®šå½ˆçª—æ¨™é¡Œ
			qs('#dateDetailsModalContent').innerHTML = detailsHtml; qs('#dateDetailsModal').classList.add('is-active'); // å¡«å…¥å…§å®¹ä¸¦é¡¯ç¤ºå½ˆçª—
		}
		function updateShiChenDetailsView(date) { // æ›´æ–°æ™‚è¾°è©³æƒ…å½ˆå‡ºè¦–çª—çš„å…§å®¹
			if (settings.editMode) return; // ç·¨è¼¯æ¨¡å¼ä¸‹ä¸åŸ·è¡Œ
			state.shichenDetailDate = new Date(date); const lunar = Solar.fromDate(state.shichenDetailDate).getLunar(); const hour = state.shichenDetailDate.getHours(); const name = getShiChen(hour); qs('#shichenDetailsModalTitle').textContent = `${state.shichenDetailDate.getMonth() + 1}æœˆ${state.shichenDetailDate.getDate()}æ—¥ ${name}æ™‚`; const lunarTime = lunar.getTimes().find(lt => lt.getZhi() === name); if (lunarTime) { qs('#shichenDetailsModalContent').innerHTML = `<p><strong>æ™‚è¾°ï¼š</strong>${name}æ™‚ (${s2t(lunarTime.getGan() + lunarTime.getZhi())}) <span style="font-size: 0.9em; color: #ccc;">${getShiChenTimeRange(name)}</span></p><div class="yi-ji-grid"><strong>å®œï¼š</strong><span>${s2t(lunarTime.getYi()).join('ã€') || 'ç„¡'}</span><strong>å¿Œï¼š</strong><span>${s2t(lunarTime.getJi()).join('ã€') || 'ç„¡'}</span></div><p style="margin-top: 15px; font-size: 0.9em; color: #aaa;">æ™‚è¾°å®œå¿Œåƒ…ä¾›åƒè€ƒã€‚</p>`; } else { qs('#shichenDetailsModalContent').innerHTML = `<p>æ‰¾ä¸åˆ° ${name}æ™‚ çš„è©³ç´°è³‡è¨Šã€‚</p>`; } qs('#shichenDetailsModal').classList.add('is-active'); // å¡«å…¥å…§å®¹ä¸¦é¡¯ç¤ºå½ˆçª—
		}
		function generateCalendarPopup(year, month) { // ç”Ÿæˆæœˆä»½æ—¥æ›†å½ˆå‡ºè¦–çª—
			const grid = qs('#calendarGrid'), monthYear = qs('#calendarMonthYear'), weekdaysEl = qs('#calendarWeekdays'); // ç²å–å…ƒç´ 
			grid.innerHTML = ''; weekdaysEl.innerHTML = ''; // æ¸…ç©ºå…§å®¹
			addCalendarBgMonth(qs('#calendarModal .modal-content'), month + 1); // åŠ å…¥èƒŒæ™¯æœˆä»½
			['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'].forEach(day => { const el = document.createElement('div'); el.textContent = day; weekdaysEl.appendChild(el); }); // åŠ å…¥æ˜ŸæœŸæ¨™é ­
			monthYear.textContent = `${year}å¹´`; monthYear.dataset.year = year; monthYear.dataset.month = month; // è¨­å®šå¹´æœˆæ¨™é¡Œå’Œè³‡æ–™
			if (state.yearlyDataCache.year !== year) { getHolidaysForYear(year); getJieqiForYear(year); } // æª¢æŸ¥å¹´åº¦å¿«å–
			const { holidays, jieqi } = state.yearlyDataCache; // ç²å–å¹´åº¦è³‡æ–™
			const startDate = new Date(year, month, 1 - new Date(year, month, 1).getDay()); // è¨ˆç®—èµ·å§‹æ—¥æœŸ
			for (let i = 0; i < 42; i++) { // è¿´åœˆç”Ÿæˆ 42 å€‹æ—¥æœŸæ ¼
				const date = new Date(startDate); date.setDate(startDate.getDate() + i); // è¨ˆç®—ç•¶å‰æ—¥æœŸ
				const cell = document.createElement('div'); cell.className = 'calendar-day'; // å‰µå»ºæ—¥æœŸæ ¼
				if (date.getMonth() !== month) cell.classList.add('other-month'); // æ¨™è¨˜éæœ¬æœˆæ—¥æœŸ
				cell.dataset.date = date.toISOString(); cell.onclick = () => showDateDetails(new Date(cell.dataset.date)); // ç¶å®šé»æ“Šäº‹ä»¶
				const lunar = Solar.fromDate(date).getLunar(); // ç²å–è¾²æ›†è³‡è¨Š
				cell.innerHTML = `<div class="gregorian-day">${date.getDate()}</div><div class="lunar-day">${lunar.getDay() === 1 ? s2t(lunar.getMonthInChinese()) + 'æœˆ' : s2t(lunar.getDayInChinese())}</div>`; // å¡«å…¥å…¬è¾²æ›†æ—¥æœŸ
				if (date.toDateString() === new Date().toDateString()) cell.classList.add('is-today'); // æ¨™è¨˜ä»Šå¤©
				if (date.getMonth() === month) { // åªè™•ç†æœ¬æœˆçš„äº‹ä»¶
					const holiday = holidays.find(h => h.date.toDateString() === date.toDateString()); // å°‹æ‰¾ç¯€æ—¥
					if (holiday) cell.innerHTML += `<span class="event-indicator holiday">${holiday.name}</span>`; // åŠ å…¥ç¯€æ—¥æ¨™è¨˜
					const jq = jieqi.find(j => j.date.toDateString() === date.toDateString()); // å°‹æ‰¾ç¯€æ°£
					if (jq) cell.innerHTML += `<span class="event-indicator jieqi">${jq.name}</span>`; // å¦‚æœæœ‰ç¯€æ°£ï¼Œå‰‡åœ¨å„²å­˜æ ¼ä¸­æ·»åŠ ç¯€æ°£æŒ‡ç¤ºç¬¦ã€‚
				}
				grid.appendChild(cell); // å°‡å„²å­˜æ ¼æ·»åŠ åˆ°æœˆæ›†ç¶²æ ¼ä¸­ã€‚
			}
		}
		function generateWeekCalendar(baseDate) { // ç”Ÿæˆé€±æ›†çš„å‡½å¼ï¼Œä»¥ baseDate ç‚ºåŸºæº–ã€‚
			const grid = qs('#weeklyCalendarGrid'), title = qs('#weeklyCalendarTitle'); // ç²å–é€±æ›†çš„ç¶²æ ¼å’Œæ¨™é¡Œå…ƒç´ ã€‚
			grid.innerHTML = ''; // æ¸…ç©ºé€±æ›†ç¶²æ ¼çš„ç¾æœ‰å…§å®¹ã€‚
			const today = new Date(), start = new Date(baseDate); // ç²å–ä»Šå¤©çš„æ—¥æœŸï¼Œä¸¦è¤‡è£½åŸºæº–æ—¥æœŸä»¥è¨ˆç®—é€±çš„é–‹å§‹ã€‚
			start.setDate(baseDate.getDate() - baseDate.getDay()); // è¨­å®šç‚ºæœ¬é€±çš„æ˜ŸæœŸæ—¥ï¼ˆä¸€é€±çš„é–‹å§‹ï¼‰ã€‚
			const end = new Date(start); // è¤‡è£½é–‹å§‹æ—¥æœŸä»¥è¨ˆç®—é€±çš„çµæŸã€‚
			end.setDate(start.getDate() + 6); // è¨­å®šç‚ºæœ¬é€±çš„æ˜ŸæœŸå…­ï¼ˆä¸€é€±çš„çµæŸï¼‰ã€‚
			title.textContent = `${start.getFullYear()}å¹´${start.getMonth() + 1}æœˆ${start.getDate()}æ—¥ - ${end.getFullYear()}å¹´${end.getMonth() + 1}æœˆ${end.getDate()}æ—¥`; // è¨­å®šé€±æ›†çš„æ¨™é¡Œï¼Œé¡¯ç¤ºæ—¥æœŸç¯„åœã€‚
			const weekdays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­']; // å®šç¾©ä¸€é€±ä¸­æ¯å¤©çš„ä¸­æ–‡åç¨±ã€‚
			const holidays = getHolidaysForYear(baseDate.getFullYear()), jieqi = getJieqiForYear(baseDate.getFullYear()); // ç²å–ç•¶å¹´åº¦çš„å‡æ—¥å’Œç¯€æ°£è³‡æ–™ã€‚
			for (let i = 0; i < 7; i++) { // è¿´åœˆéæ­·ä¸€é€±çš„ä¸ƒå¤©ã€‚
				const day = new Date(start); // å»ºç«‹ä¸€å€‹æ–°çš„æ—¥æœŸç‰©ä»¶ï¼Œä»¥é€±çš„é–‹å§‹æ—¥æœŸç‚ºåŸºç¤ã€‚
				day.setDate(start.getDate() + i); // è¨­å®šç‚ºç•¶å‰è¿´åœˆå°æ‡‰çš„æ—¥æœŸã€‚
				const cell = document.createElement('div'); // ç‚ºé€™ä¸€å¤©å»ºç«‹ä¸€å€‹ div å…ƒç´ ä½œç‚ºå„²å­˜æ ¼ã€‚
				cell.className = 'weekly-calendar-day'; // è¨­å®šå„²å­˜æ ¼çš„ CSS classã€‚
				cell.dataset.date = day.toISOString(); // åœ¨ data-* å±¬æ€§ä¸­å„²å­˜å®Œæ•´çš„æ—¥æœŸè³‡è¨Šã€‚
				cell.onclick = () => showDateDetails(new Date(cell.dataset.date)); // ç‚ºå„²å­˜æ ¼æ·»åŠ é»æ“Šäº‹ä»¶ï¼Œä»¥é¡¯ç¤ºæ—¥æœŸè©³æƒ…ã€‚
				if (day.toDateString() === today.toDateString()) cell.classList.add('is-today'); // å¦‚æœé€™ä¸€å¤©æ˜¯ä»Šå¤©ï¼Œå‰‡æ·»åŠ  'is-today' class ä»¥çªé¡¯ã€‚
				const lunar = Solar.fromDate(day).getLunar(); // ç²å–è©²æ—¥æœŸçš„è¾²æ›†è³‡è¨Šã€‚
				cell.innerHTML = `<div class="weekly-day-header">${weekdays[i]}</div><div class="weekly-gregorian-day">${day.getDate()}</div><div class="weekly-lunar-day">${lunar.getDay() === 1 ? s2t(lunar.getMonthInChinese()) + 'æœˆ' : s2t(lunar.getDayInChinese())}</div>`; // è¨­å®šå„²å­˜æ ¼çš„ HTML å…§å®¹ï¼ŒåŒ…æ‹¬æ˜ŸæœŸã€å…¬æ›†æ—¥æœŸå’Œè¾²æ›†æ—¥æœŸã€‚
				const holiday = holidays.find(h => h.date.toDateString() === day.toDateString()); // æŸ¥æ‰¾é€™ä¸€å¤©æ˜¯å¦æœ‰å°æ‡‰çš„å‡æ—¥ã€‚
				if (holiday) cell.innerHTML += `<span class="event-indicator holiday">${holiday.name}</span>`; // å¦‚æœæœ‰å‡æ—¥ï¼Œå‰‡æ·»åŠ å‡æ—¥æŒ‡ç¤ºç¬¦ã€‚
				const jq = jieqi.find(j => j.date.toDateString() === day.toDateString()); // æŸ¥æ‰¾é€™ä¸€å¤©æ˜¯å¦æœ‰å°æ‡‰çš„ç¯€æ°£ã€‚
				if (jq) cell.innerHTML += `<span class="event-indicator jieqi">${jq.name}</span>`; // å¦‚æœæœ‰ç¯€æ°£ï¼Œå‰‡æ·»åŠ ç¯€æ°£æŒ‡ç¤ºç¬¦ã€‚
				grid.appendChild(cell); // å°‡å®Œæˆçš„å„²å­˜æ ¼æ·»åŠ åˆ°é€±æ›†ç¶²æ ¼ä¸­ã€‚
			}
		}
		function generateYearCalendar(year) { // ç”Ÿæˆå¹´æ›†çš„å‡½å¼ï¼Œåƒæ•¸ç‚ºå¹´ä»½ã€‚
			const grid = qs('#yearlyCalendarGrid'), title = qs('#yearlyCalendarTitle'); // ç²å–å¹´æ›†çš„ç¶²æ ¼å’Œæ¨™é¡Œå…ƒç´ ã€‚
			grid.innerHTML = ''; // æ¸…ç©ºå¹´æ›†ç¶²æ ¼çš„ç¾æœ‰å…§å®¹ã€‚
			title.textContent = `${year}å¹´`; // è¨­å®šå¹´æ›†çš„æ¨™é¡Œç‚ºæŒ‡å®šçš„å¹´ä»½ã€‚
			const today = new Date(), weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­']; // ç²å–ä»Šå¤©çš„æ—¥æœŸï¼Œä¸¦å®šç¾©æ˜ŸæœŸçš„ç¸®å¯«ã€‚
			const holidays = getHolidaysForYear(year), jieqi = getJieqiForYear(year); // ç²å–æŒ‡å®šå¹´ä»½çš„å‡æ—¥å’Œç¯€æ°£è³‡æ–™ã€‚
			for (let month = 0; month < 12; month++) { // è¿´åœˆéæ­·ä¸€å¹´çš„åäºŒå€‹æœˆã€‚
				const monthContainer = document.createElement('div'); // ç‚ºæ¯å€‹æœˆå»ºç«‹ä¸€å€‹å®¹å™¨ã€‚
				monthContainer.className = 'yearly-month-container'; // è¨­å®šæœˆä»½å®¹å™¨çš„ CSS classã€‚
				monthContainer.style.cursor = 'pointer'; // è¨­å®šæ»‘é¼ æŒ‡æ¨™ç‚ºæ‰‹å½¢ï¼Œæç¤ºå¯é»æ“Šã€‚
				monthContainer.title = `æŸ¥çœ‹ ${month + 1}æœˆ æœˆæ›†`; // è¨­å®šå·¥å…·æç¤ºæ–‡å­—ã€‚
				monthContainer.onclick = () => { // ç‚ºæœˆä»½å®¹å™¨æ·»åŠ é»æ“Šäº‹ä»¶ã€‚
					if (settings.editMode) return; // å¦‚æœåœ¨ç·¨è¼¯æ¨¡å¼ä¸‹ï¼Œå‰‡ä¸åŸ·è¡Œä»»ä½•æ“ä½œã€‚
					qs('#yearlyCalendarModal').classList.remove('is-active'); // é—œé–‰å¹´æ›†å½ˆçª—ã€‚
					state.calendarDate.setFullYear(year, month, 1); // è¨­å®šå…¨åŸŸç‹€æ…‹çš„æ—¥æ›†æ—¥æœŸç‚ºé»æ“Šçš„æœˆä»½ã€‚
					generateCalendarPopup(year, month); // ç”Ÿæˆè©²æœˆä»½çš„æœˆæ›†å½ˆçª—å…§å®¹ã€‚
					qs('#calendarModal').classList.add('is-active'); // é¡¯ç¤ºæœˆæ›†å½ˆçª—ã€‚
				};
				addCalendarBgMonth(monthContainer, month + 1); // ç‚ºæœˆä»½å®¹å™¨æ·»åŠ èƒŒæ™¯æœˆä»½æ•¸å­—ã€‚
				const weekdaysDiv = document.createElement('div'); // å»ºç«‹ä¸€å€‹ç”¨æ–¼é¡¯ç¤ºæ˜ŸæœŸçš„å®¹å™¨ã€‚
				weekdaysDiv.className = 'yearly-weekdays'; // è¨­å®šæ˜ŸæœŸå®¹å™¨çš„ CSS classã€‚
				weekdays.forEach(day => { // éæ­·æ˜ŸæœŸç¸®å¯«é™£åˆ—ã€‚
					const el = document.createElement('div'); // ç‚ºæ¯å€‹æ˜ŸæœŸç¸®å¯«å»ºç«‹ä¸€å€‹ div å…ƒç´ ã€‚
					el.textContent = day; // è¨­å®šå…ƒç´ çš„æ–‡å­—å…§å®¹ã€‚
					weekdaysDiv.appendChild(el); // å°‡å…ƒç´ æ·»åŠ åˆ°æ˜ŸæœŸå®¹å™¨ä¸­ã€‚
				});
				monthContainer.appendChild(weekdaysDiv); // å°‡æ˜ŸæœŸå®¹å™¨æ·»åŠ åˆ°æœˆä»½å®¹å™¨ä¸­ã€‚
				const dayGrid = document.createElement('div'); // å»ºç«‹ä¸€å€‹ç”¨æ–¼é¡¯ç¤ºæ—¥æœŸçš„ç¶²æ ¼ã€‚
				dayGrid.className = 'yearly-day-grid'; // è¨­å®šæ—¥æœŸç¶²æ ¼çš„ CSS classã€‚
				const firstDay = new Date(year, month, 1).getDay(), daysInMonth = new Date(year, month + 1, 0).getDate(); // ç²å–è©²æœˆçš„ç¬¬ä¸€å¤©æ˜¯æ˜ŸæœŸå¹¾ï¼Œä»¥åŠè©²æœˆç¸½å…±æœ‰å¹¾å¤©ã€‚
				for (let i = 0; i < firstDay; i++) dayGrid.appendChild(document.createElement('div')); // åœ¨ç¬¬ä¸€å¤©ä¹‹å‰æ·»åŠ ç©ºç™½çš„ div å…ƒç´ ä»¥å°é½Šã€‚
				for (let dayNum = 1; dayNum <= daysInMonth; dayNum++) { // è¿´åœˆéæ­·è©²æœˆçš„æ¯ä¸€å¤©ã€‚
					const cell = document.createElement('div'); // ç‚ºæ¯ä¸€å¤©å»ºç«‹ä¸€å€‹å„²å­˜æ ¼ã€‚
					cell.className = 'yearly-day'; // è¨­å®šå„²å­˜æ ¼çš„ CSS classã€‚
					const date = new Date(year, month, dayNum); // å»ºç«‹è©²å¤©çš„ Date ç‰©ä»¶ã€‚
					cell.dataset.date = date.toISOString(); // åœ¨ data-* å±¬æ€§ä¸­å„²å­˜å®Œæ•´çš„æ—¥æœŸè³‡è¨Šã€‚
					cell.onclick = (e) => { // ç‚ºå„²å­˜æ ¼æ·»åŠ é»æ“Šäº‹ä»¶ã€‚
						e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡åˆ°çˆ¶å±¤çš„æœˆä»½å®¹å™¨ã€‚
						showDateDetails(new Date(cell.dataset.date)); // é¡¯ç¤ºè©²æ—¥æœŸçš„è©³ç´°è³‡è¨Šã€‚
					};
					cell.textContent = dayNum; // è¨­å®šå„²å­˜æ ¼çš„æ–‡å­—å…§å®¹ç‚ºæ—¥æœŸæ•¸å­—ã€‚
					if (today.getFullYear() === year && today.getMonth() === month && dayNum === today.getDate()) cell.classList.add('is-today'); // å¦‚æœæ˜¯ä»Šå¤©ï¼Œå‰‡æ·»åŠ  'is-today' class ä»¥çªé¡¯ã€‚
					const holiday = holidays.find(h => h.date.toDateString() === date.toDateString()); // æŸ¥æ‰¾é€™ä¸€å¤©æ˜¯å¦æœ‰å°æ‡‰çš„å‡æ—¥ã€‚
					const jq = jieqi.find(j => j.date.toDateString() === date.toDateString()); // æŸ¥æ‰¾é€™ä¸€å¤©æ˜¯å¦æœ‰å°æ‡‰çš„ç¯€æ°£ã€‚
					if(holiday || jq) { // å¦‚æœæœ‰å‡æ—¥æˆ–ç¯€æ°£ã€‚
						const indicators = document.createElement('div'); // å»ºç«‹ä¸€å€‹æŒ‡ç¤ºç¬¦å®¹å™¨ã€‚
						indicators.className = 'yearly-indicators'; // è¨­å®šæŒ‡ç¤ºç¬¦å®¹å™¨çš„ CSS classã€‚
						if(holiday) indicators.innerHTML += '<span class="dot holiday"></span>'; // å¦‚æœæœ‰å‡æ—¥ï¼Œæ·»åŠ å‡æ—¥åœ“é»æŒ‡ç¤ºç¬¦ã€‚
						if(jq) indicators.innerHTML += '<span class="dot jieqi"></span>'; // å¦‚æœæœ‰ç¯€æ°£ï¼Œæ·»åŠ ç¯€æ°£åœ“é»æŒ‡ç¤ºç¬¦ã€‚
						cell.appendChild(indicators); // å°‡æŒ‡ç¤ºç¬¦å®¹å™¨æ·»åŠ åˆ°å„²å­˜æ ¼ä¸­ã€‚
					}
					dayGrid.appendChild(cell); // å°‡å„²å­˜æ ¼æ·»åŠ åˆ°æ—¥æœŸç¶²æ ¼ä¸­ã€‚
				}
				monthContainer.appendChild(dayGrid); // å°‡æ—¥æœŸç¶²æ ¼æ·»åŠ åˆ°æœˆä»½å®¹å™¨ä¸­ã€‚
				grid.appendChild(monthContainer); // å°‡æœˆä»½å®¹å™¨æ·»åŠ åˆ°å¹´æ›†ç¶²æ ¼ä¸­ã€‚
			}
		}
		function showWeatherForecast() { // é¡¯ç¤ºä¸€é€±å¤©æ°£é å ±çš„å‡½å¼ã€‚
			if (settings.editMode) return; // å¦‚æœåœ¨ç·¨è¼¯æ¨¡å¼ä¸‹ï¼Œå‰‡ä¸åŸ·è¡Œã€‚
			if (!state.weatherDataCache) { // å¦‚æœæ²’æœ‰å¿«å–çš„å¤©æ°£è³‡æ–™ã€‚
				const el = qs('#weatherMarqueeContainer'); // ç²å–å¤©æ°£è·‘é¦¬ç‡ˆå®¹å™¨ã€‚
				if(el) { // å¦‚æœå®¹å™¨å­˜åœ¨ã€‚
					setStyle(el, { backgroundColor: '#552222' }); // è¨­å®šèƒŒæ™¯è‰²ç‚ºç´…è‰²ä»¥æç¤ºéŒ¯èª¤ã€‚
					setTimeout(() => setStyle(el, { backgroundColor: '' }), 500); // 500æ¯«ç§’å¾Œæ¢å¾©åŸä¾†çš„èƒŒæ™¯è‰²ã€‚
				}
				return; // çµæŸå‡½å¼åŸ·è¡Œã€‚
			}
			const grid = qs('#weatherForecastGrid'), title = qs('#weatherForecastModalTitle'); // ç²å–é å ±ç¶²æ ¼å’Œæ¨™é¡Œå…ƒç´ ã€‚
			grid.innerHTML = ''; // æ¸…ç©ºç¶²æ ¼å…§å®¹ã€‚
			title.textContent = `${getChineseLocationName(settings.weatherLocation)} ä¸€é€±é å ±`; // è¨­å®šæ¨™é¡Œï¼ŒåŒ…å«åœ°é»åç¨±ã€‚
			for (let i = 0; i < 7; i++) { // è¿´åœˆé¡¯ç¤ºä¸ƒå¤©çš„é å ±ã€‚
				const date = new Date(state.weatherDataCache.daily.time[i]); // ç²å–ç¬¬ i å¤©çš„æ—¥æœŸã€‚
				const dayName = i === 0 ? 'ä»Šå¤©' : `å‘¨${['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][date.getDay()]}`; // æ±ºå®šé¡¯ç¤ºçš„æ˜ŸæœŸåç¨±ï¼ˆç¬¬ä¸€å¤©é¡¯ç¤º"ä»Šå¤©"ï¼‰ã€‚
				const { desc } = getWeatherDescriptionAndEmoji(state.weatherDataCache.daily.weather_code[i]); // æ ¹æ“šå¤©æ°£ä»£ç¢¼ç²å–å¤©æ°£æè¿°ã€‚
				const dayCell = document.createElement('div'); // å»ºç«‹ä¸€å¤©çš„é å ±å„²å­˜æ ¼ã€‚
				dayCell.className = 'forecast-day'; // è¨­å®šå„²å­˜æ ¼çš„ CSS classã€‚
				dayCell.innerHTML = `<p class="day-name">${dayName}</p><p>${date.getMonth() + 1}/${date.getDate()}</p><div class="weather-icon">${getWeatherSVGIcon(state.weatherDataCache.daily.weather_code[i], '2.5em')}</div><p>${desc}</p><p><span class="temp-high">${Math.round(state.weatherDataCache.daily.temperature_2m_max[i])}Â°</span> / <span class="temp-low">${Math.round(state.weatherDataCache.daily.temperature_2m_min[i])}Â°</span></p>`; // å¡«å……å„²å­˜æ ¼å…§å®¹ï¼ŒåŒ…æ‹¬æ—¥æœŸã€å¤©æ°£åœ–ç¤ºã€æè¿°ã€æœ€é«˜/æœ€ä½æº«ã€‚
				dayCell.onclick = () => showHourlyWeather(i); // ç‚ºå„²å­˜æ ¼æ·»åŠ é»æ“Šäº‹ä»¶ï¼Œä»¥é¡¯ç¤ºè©²å¤©çš„æ¯å°æ™‚å¤©æ°£ã€‚
				grid.appendChild(dayCell); // å°‡å„²å­˜æ ¼æ·»åŠ åˆ°é å ±ç¶²æ ¼ä¸­ã€‚
			}
			qs('#weatherForecastModal').classList.add('is-active'); // é¡¯ç¤ºå¤©æ°£é å ±å½ˆçª—ã€‚
		}
		function showHourlyWeather(dayIndex) { // é¡¯ç¤ºæŒ‡å®šæ—¥æœŸçš„æ¯å°æ™‚å¤©æ°£é å ±ã€‚
			if (!state.weatherDataCache?.hourly) return; // å¦‚æœæ²’æœ‰æ¯å°æ™‚å¤©æ°£è³‡æ–™ï¼Œå‰‡ä¸åŸ·è¡Œã€‚
			const grid = qs('#hourlyWeatherGrid'), title = qs('#hourlyWeatherModalTitle'); // ç²å–æ¯å°æ™‚å¤©æ°£çš„ç¶²æ ¼å’Œæ¨™é¡Œå…ƒç´ ã€‚
			grid.innerHTML = ''; // æ¸…ç©ºç¶²æ ¼å…§å®¹ã€‚
			const date = new Date(state.weatherDataCache.daily.time[dayIndex]); // ç²å–æŒ‡å®šæ—¥æœŸçš„ Date ç‰©ä»¶ã€‚
			const max = Math.round(state.weatherDataCache.daily.temperature_2m_max[dayIndex]), min = Math.round(state.weatherDataCache.daily.temperature_2m_min[dayIndex]); // ç²å–ä¸¦å››æ¨äº”å…¥ç•¶å¤©çš„æœ€é«˜å’Œæœ€ä½æº«åº¦ã€‚
			title.innerHTML = `${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥ é å ± <span style="font-size: 0.7em; color: #ccc;">(é«˜ <span class="temp-high">${max}Â°</span> / ä½ <span class="temp-low">${min}Â°</span>)</span>`; // è¨­å®šæ¨™é¡Œï¼ŒåŒ…å«æ—¥æœŸå’Œæœ€é«˜/æœ€ä½æº«ã€‚
			const now = new Date(); // ç²å–ç•¶å‰æ™‚é–“ã€‚
			const start = dayIndex * 24, end = start + 24; // è¨ˆç®—åœ¨æ¯å°æ™‚è³‡æ–™é™£åˆ—ä¸­çš„èµ·å§‹å’ŒçµæŸç´¢å¼•ã€‚
			for (let i = start; i < end; i += 3) { // ä»¥3å°æ™‚ç‚ºé–“éš”éæ­·ç•¶å¤©çš„è³‡æ–™ã€‚
				const hourDate = new Date(state.weatherDataCache.hourly.time[i]); // ç²å–è©²æ™‚æ®µçš„æ—¥æœŸæ™‚é–“ã€‚
				const { desc } = getWeatherDescriptionAndEmoji(state.weatherDataCache.hourly.weather_code[i]); // æ ¹æ“šå¤©æ°£ä»£ç¢¼ç²å–å¤©æ°£æè¿°ã€‚
				const hourCell = document.createElement('div'); // å»ºç«‹ä¸€å€‹æ¯å°æ™‚å¤©æ°£é …ç›®çš„å…ƒç´ ã€‚
				hourCell.className = 'hourly-item'; // è¨­å®šå…¶ CSS classã€‚
				if (dayIndex === 0) { // å¦‚æœæ˜¯ä»Šå¤©ã€‚
					const currentHour = now.getHours(), blockStartHour = hourDate.getHours(); // ç²å–ç•¶å‰å°æ™‚å’Œè©²æ™‚æ®µçš„é–‹å§‹å°æ™‚ã€‚
					if (currentHour >= blockStartHour && currentHour < blockStartHour + 3) hourCell.classList.add('is-now'); // å¦‚æœç•¶å‰æ™‚é–“è½åœ¨è©²æ™‚æ®µå…§ï¼Œå‰‡æ·»åŠ  'is-now' class ä»¥çªé¡¯ã€‚
				}
				hourCell.innerHTML = `<p class="hour-time">${hourDate.getHours().toString().padStart(2, '0')}:00</p><div class="weather-icon">${getWeatherSVGIcon(state.weatherDataCache.hourly.weather_code[i], '2em')}</div><p>${desc}</p><p>${Math.round(state.weatherDataCache.hourly.temperature_2m[i])}Â°C</p>`; // å¡«å……å…§å®¹ï¼ŒåŒ…æ‹¬æ™‚é–“ã€å¤©æ°£åœ–ç¤ºã€æè¿°å’Œæº«åº¦ã€‚
				grid.appendChild(hourCell); // å°‡é …ç›®æ·»åŠ åˆ°ç¶²æ ¼ä¸­ã€‚
			}
			qs('#weatherForecastModal').classList.remove('is-active'); // éš±è—ä¸€é€±é å ±å½ˆçª—ã€‚
			qs('#hourlyWeatherModal').classList.add('is-active'); // é¡¯ç¤ºæ¯å°æ™‚å¤©æ°£å½ˆçª—ã€‚
		}
		function showZodiacDetails() { // é¡¯ç¤ºåäºŒç”Ÿè‚–è©³æƒ…å½ˆçª—çš„å‡½å¼ã€‚
			if (settings.editMode) return; // å¦‚æœåœ¨ç·¨è¼¯æ¨¡å¼ä¸‹ï¼Œå‰‡ä¸åŸ·è¡Œã€‚
			const grid = qs('#zodiacGrid'); // ç²å–ç”Ÿè‚–ç¶²æ ¼å…ƒç´ ã€‚
			grid.innerHTML = ''; // æ¸…ç©ºç¶²æ ¼å…§å®¹ã€‚
			['é¼ ', 'ç‰›', 'è™', 'å…”', 'é¾', 'è›‡', 'é¦¬', 'ç¾Š', 'çŒ´', 'é›', 'ç‹—', 'è±¬'].forEach(name => { // éæ­·åäºŒç”Ÿè‚–åç¨±ã€‚
				const item = document.createElement('div'); // ç‚ºæ¯å€‹ç”Ÿè‚–å»ºç«‹ä¸€å€‹ div å…ƒç´ ã€‚
				item.className = 'zodiac-item'; // è¨­å®šå…¶ CSS classã€‚
				item.innerHTML = `<div class="zodiac-icon">${getShengXiaoSVG(name, '100%')}</div><p>${name}</p>`; // å¡«å……å…§å®¹ï¼ŒåŒ…æ‹¬ç”Ÿè‚–çš„ SVG åœ–ç¤ºå’Œåç¨±ã€‚
				grid.appendChild(item); // å°‡ç”Ÿè‚–é …ç›®æ·»åŠ åˆ°ç¶²æ ¼ä¸­ã€‚
			});
			qs('#zodiacModal').classList.add('is-active'); // é¡¯ç¤ºç”Ÿè‚–å½ˆçª—ã€‚
		}
		function updateDistrictSelector(county) { // æ ¹æ“šé¸æ“‡çš„ç¸£å¸‚æ›´æ–°é„‰é®å¸‚å€ä¸‹æ‹‰é¸å–®çš„å‡½å¼ã€‚
			const sel = qs('#districtSelect'); // ç²å–é„‰é®å¸‚å€çš„ select å…ƒç´ ã€‚
			sel.innerHTML = ''; // æ¸…ç©ºç¾æœ‰é¸é …ã€‚
			const districts = taiwanLocations[county]?.districts || {}; // æ ¹æ“šç¸£å¸‚åç¨±ç²å–å°æ‡‰çš„é„‰é®å¸‚å€åˆ—è¡¨ã€‚
			for (const name in districts) { // éæ­·é„‰é®å¸‚å€åˆ—è¡¨ã€‚
				const opt = document.createElement('option'); // å»ºç«‹ä¸€å€‹æ–°çš„ option å…ƒç´ ã€‚
				opt.value = name; // è¨­å®š option çš„å€¼ã€‚
				opt.textContent = name; // è¨­å®š option é¡¯ç¤ºçš„æ–‡å­—ã€‚
				sel.appendChild(opt); // å°‡ option æ·»åŠ åˆ° select å…ƒç´ ä¸­ã€‚
			}
		}
		function syncLocationControls() { // åŒæ­¥åœ°é»æ§åˆ¶é …ç‹€æ…‹çš„å‡½å¼ã€‚
			const county = qs('#countySelect').value, district = qs('#districtSelect').value; // ç²å–ç•¶å‰é¸æ“‡çš„ç¸£å¸‚å’Œé„‰é®å¸‚å€ã€‚
			const english = taiwanLocations[county]?.districts[district] || 'taiwan'; // æ ¹æ“šé¸æ“‡ç²å–å°æ‡‰çš„è‹±æ–‡åœ°é»åç¨±ï¼Œè‹¥æ‰¾ä¸åˆ°å‰‡é è¨­ç‚º 'taiwan'ã€‚
			qs('#weatherLocation').value = english; // æ›´æ–°éš±è—çš„è‹±æ–‡åœ°é»è¼¸å…¥æ¡†çš„å€¼ã€‚
			settings.weatherLocation = english; // æ›´æ–°è¨­å®šä¸­çš„å¤©æ°£åœ°é»ã€‚
			saveState(); // ä¿å­˜ç‹€æ…‹ã€‚
			updateWeather(); // æ›´æ–°å¤©æ°£è³‡è¨Šã€‚
		}
		function setLocationSelectorsFromEnglish(english) { // æ ¹æ“šè‹±æ–‡åœ°é»åç¨±è¨­å®šç¸£å¸‚å’Œé„‰é®å¸‚å€ä¸‹æ‹‰é¸å–®çš„å‡½å¼ã€‚
			const countySel = qs('#countySelect'), districtSel = qs('#districtSelect'); // ç²å–ç¸£å¸‚å’Œé„‰é®å¸‚å€çš„ select å…ƒç´ ã€‚
			qs('#weatherLocation').value = english; // æ›´æ–°éš±è—çš„è‹±æ–‡åœ°é»è¼¸å…¥æ¡†çš„å€¼ã€‚
			let found = false; // æ¨™è¨˜æ˜¯å¦å·²æ‰¾åˆ°å°æ‡‰çš„åœ°é»ã€‚
			for (const county in taiwanLocations) { // éæ­·æ‰€æœ‰ç¸£å¸‚ã€‚
				for (const district in taiwanLocations[county].districts) { // éæ­·è©²ç¸£å¸‚ä¸‹çš„æ‰€æœ‰é„‰é®å¸‚å€ã€‚
					if (taiwanLocations[county].districts[district].toLowerCase() === english.toLowerCase()) { // å¦‚æœæ‰¾åˆ°åŒ¹é…çš„è‹±æ–‡åç¨±ï¼ˆä¸å€åˆ†å¤§å°å¯«ï¼‰ã€‚
						countySel.value = county; // è¨­å®šç¸£å¸‚ä¸‹æ‹‰é¸å–®çš„å€¼ã€‚
						updateDistrictSelector(county); // æ›´æ–°é„‰é®å¸‚å€ä¸‹æ‹‰é¸å–®çš„é¸é …ã€‚
						districtSel.value = district; // è¨­å®šé„‰é®å¸‚å€ä¸‹æ‹‰é¸å–®çš„å€¼ã€‚
						found = true; // æ¨™è¨˜ç‚ºå·²æ‰¾åˆ°ã€‚
						break; // ä¸­æ–·å…§å±¤è¿´åœˆã€‚
					}
				}
				if (found) break; // å¦‚æœå·²æ‰¾åˆ°ï¼Œå‰‡ä¸­æ–·å¤–å±¤è¿´åœˆã€‚
			}
			if (!found) { // å¦‚æœéæ­·å®Œç•¢ä»æœªæ‰¾åˆ°ã€‚
				countySel.value = 'å°ç£'; // å°‡ç¸£å¸‚è¨­ç‚º 'å°ç£'ã€‚
				updateDistrictSelector('å°ç£'); // æ›´æ–°é„‰é®å¸‚å€é¸é …ã€‚
				districtSel.value = 'å°ç£'; // å°‡é„‰é®å¸‚å€è¨­ç‚º 'å°ç£'ã€‚
			}
		}
		function constrainPositions() { // é™åˆ¶å°å·¥å…·ä½ç½®åœ¨è¦–çª—å…§çš„å‡½å¼ã€‚
			const handleSize = 40, margin = 10; // å®šç¾©æ§åˆ¶é»å¤§å°å’Œé‚Šç•Œã€‚
			const minX = -window.innerWidth / 2 + handleSize / 2 + margin, maxX = window.innerWidth / 2 - handleSize / 2 - margin; // è¨ˆç®— X è»¸çš„æœ€å°å’Œæœ€å¤§å…è¨±ä½ç½®ã€‚
			const minY = -window.innerHeight / 2 + handleSize / 2 + margin, maxY = window.innerHeight / 2 - handleSize / 2 - margin; // è¨ˆç®— Y è»¸çš„æœ€å°å’Œæœ€å¤§å…è¨±ä½ç½®ã€‚
			let needsUpdate = false; // æ¨™è¨˜æ˜¯å¦éœ€è¦æ›´æ–°ç•«é¢ã€‚
			for (const id in transformState) { // éæ­·æ‰€æœ‰å°å·¥å…·çš„è®Šæ›ç‹€æ…‹ã€‚
				if (id === 'master') continue; // å¿½ç•¥ 'master' ç‹€æ…‹ã€‚
				const T = transformState[id]; // ç²å–ç•¶å‰å°å·¥å…·çš„è®Šæ›ç‹€æ…‹ã€‚
				if (T && typeof T.x === 'number' && typeof T.y === 'number') { // ç¢ºä¿ç‹€æ…‹ç‰©ä»¶å’Œåº§æ¨™å­˜åœ¨ã€‚
					const originalX = T.x, originalY = T.y; // ä¿å­˜åŸå§‹åº§æ¨™ã€‚
					T.x = Math.max(minX, Math.min(maxX, T.x)); // å°‡ X åº§æ¨™é™åˆ¶åœ¨å…è¨±ç¯„åœå…§ã€‚
					T.y = Math.max(minY, Math.min(maxY, T.y)); // å°‡ Y åº§æ¨™é™åˆ¶åœ¨å…è¨±ç¯„åœå…§ã€‚
					if (T.x !== originalX || T.y !== originalY) needsUpdate = true; // å¦‚æœåº§æ¨™è¢«ä¿®æ”¹ï¼Œå‰‡æ¨™è¨˜éœ€è¦æ›´æ–°ã€‚
				}
			}
			return needsUpdate; // è¿”å›æ˜¯å¦éœ€è¦æ›´æ–°çš„æ¨™è¨˜ã€‚
		}
		function initializeEventListeners() { // åˆå§‹åŒ–æ‰€æœ‰äº‹ä»¶ç›£è½å™¨çš„å‡½å¼ã€‚
			qs('#settingsModal').addEventListener('change', e => { // ç›£è½è¨­å®šå½ˆçª—å…§çš„è®Šæ›´äº‹ä»¶ã€‚
				const { id, type, checked, value } = e.target; // è§£æ§‹ç²å–äº‹ä»¶ç›®æ¨™çš„å±¬æ€§ã€‚
				if (['countySelect', 'districtSelect', 'weatherLocation'].includes(id)) return; // å¦‚æœæ˜¯åœ°é»é¸æ“‡å™¨ï¼Œå‰‡å¿½ç•¥ï¼ˆç”±å…¶ä»–ç›£è½å™¨è™•ç†ï¼‰ã€‚
				settings[id] = type === 'checkbox' ? checked : value; // æ ¹æ“šå…ƒç´ é¡å‹ï¼ˆæ ¸å–æ–¹å¡Šæˆ–å…¶å®ƒï¼‰æ›´æ–°è¨­å®šå€¼ã€‚
				if (id.startsWith('enableMovement') || id.includes('movementInterval')) applyMovement(); // å¦‚æœæ˜¯ç§»å‹•ç›¸é—œçš„è¨­å®šï¼Œå‰‡æ‡‰ç”¨ç§»å‹•æ•ˆæœã€‚
				else if (id.startsWith('enableBackgroundScanline') || id.startsWith('enableTextScanline') || id.includes('scanlineInterval')) { applyScanlineEffect(); updateDigitalClock(); } // å¦‚æœæ˜¯æƒæç·šç›¸é—œçš„è¨­å®šï¼Œå‰‡æ‡‰ç”¨æƒæç·šæ•ˆæœä¸¦æ›´æ–°æ•¸ä½æ™‚é˜ã€‚
				else if (id.startsWith('show')) { updateWidgetVisibility(); applyAllSettings(); } // å¦‚æœæ˜¯é¡¯ç¤º/éš±è—å°å·¥å…·çš„è¨­å®šï¼Œå‰‡æ›´æ–°å¯è¦‹æ€§ä¸¦æ‡‰ç”¨æ‰€æœ‰è¨­å®šã€‚
				else applyAllSettings(); // å°æ–¼å…¶ä»–è¨­å®šï¼Œç›´æ¥æ‡‰ç”¨æ‰€æœ‰è¨­å®šã€‚
				updateSettingDependencies(); // æ›´æ–°è¨­å®šä¹‹é–“çš„ä¾è³´é—œä¿‚ï¼ˆä¾‹å¦‚ï¼Œç¦ç”¨æŸäº›é¸é …ï¼‰ã€‚
				saveState(); // ä¿å­˜ç‹€æ…‹ã€‚
			});
			qsa('#settingsModal input[type="color"]').forEach(el => el.addEventListener('input', e => { settings[e.target.id] = e.target.value; applyAllSettings(); saveState(); })); // ç‚ºæ‰€æœ‰é¡è‰²é¸æ“‡å™¨æ·»åŠ  'input' äº‹ä»¶ç›£è½ï¼Œå³æ™‚æ›´æ–°é¡è‰²ã€‚
			qsa('.random-color-btn').forEach(btn => { btn.addEventListener('click', () => { // ç‚ºæ‰€æœ‰éš¨æ©Ÿé¡è‰²æŒ‰éˆ•æ·»åŠ é»æ“Šäº‹ä»¶ã€‚
				const targetId = btn.dataset.target; // ç²å–æŒ‰éˆ•è¦ä½œç”¨çš„ç›®æ¨™å…ƒç´  IDã€‚
				if (targetId && settings.hasOwnProperty(targetId)) { // ç¢ºä¿ç›®æ¨™ ID å­˜åœ¨ä¸”æ˜¯æœ‰æ•ˆçš„è¨­å®šé …ã€‚
					const randomColor = '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0'); // ç”Ÿæˆä¸€å€‹éš¨æ©Ÿçš„åå…­é€²ä½é¡è‰²ç¢¼ã€‚
					settings[targetId] = randomColor; // æ›´æ–°è¨­å®šä¸­çš„é¡è‰²å€¼ã€‚
					document.getElementById(targetId).value = randomColor; // æ›´æ–°é¡è‰²é¸æ“‡å™¨è¼¸å…¥æ¡†çš„é¡¯ç¤ºå€¼ã€‚
					saveState(); // ä¿å­˜ç‹€æ…‹ã€‚
					applyAllSettings(); // æ‡‰ç”¨æ‰€æœ‰è¨­å®šä»¥ç«‹å³çœ‹åˆ°æ•ˆæœã€‚
				}
			}); });
			qs('#countySelect').addEventListener('change', () => { updateDistrictSelector(qs('#countySelect').value); syncLocationControls(); }); // ç›£è½ç¸£å¸‚ä¸‹æ‹‰é¸å–®çš„è®Šæ›´ï¼Œæ›´æ–°é„‰é®å¸‚å€é¸å–®ä¸¦åŒæ­¥åœ°é»ã€‚
			qs('#districtSelect').addEventListener('change', syncLocationControls); // ç›£è½é„‰é®å¸‚å€ä¸‹æ‹‰é¸å–®çš„è®Šæ›´ï¼ŒåŒæ­¥åœ°é»ã€‚
			qs('#weatherLocation').addEventListener('change', e => { const loc = e.target.value.trim(); if(loc) { settings.weatherLocation = loc; setLocationSelectorsFromEnglish(loc); saveState(); updateWeather(); } }); // ç›£è½éš±è—çš„è‹±æ–‡åœ°é»è¼¸å…¥æ¡†çš„è®Šæ›´ï¼Œæ›´æ–°è¨­å®šä¸¦åå‘è¨­å®šä¸‹æ‹‰é¸å–®ã€‚
			qs('#useCurrentLocationBtn').addEventListener('click', () => { // ç‚º "ä½¿ç”¨ç›®å‰ä½ç½®" æŒ‰éˆ•æ·»åŠ é»æ“Šäº‹ä»¶ã€‚
				if (navigator.geolocation) { // æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦æ”¯æ´åœ°ç†å®šä½ã€‚
					updateMarquee('æ­£åœ¨å®šä½...', 'weather'); // åœ¨è·‘é¦¬ç‡ˆé¡¯ç¤ºå®šä½ä¸­è¨Šæ¯ã€‚
					navigator.geolocation.getCurrentPosition( pos => { // æˆåŠŸç²å–ä½ç½®ã€‚
						fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&localityLanguage=en`).then(r => r.json()).then(geo => { // ä½¿ç”¨åå‘åœ°ç†ç·¨ç¢¼ API ç²å–åœ°é»åç¨±ã€‚
							const city = geo.locality || geo.city; // ç²å–åŸå¸‚/åœ°å€åç¨±ã€‚
							if (city) { // å¦‚æœæˆåŠŸç²å–ã€‚
								settings.weatherLocation = city; // æ›´æ–°è¨­å®šä¸­çš„åœ°é»ã€‚
								setLocationSelectorsFromEnglish(city); // è¨­å®šä¸‹æ‹‰é¸å–®ã€‚
								saveState(); // ä¿å­˜ç‹€æ…‹ã€‚
								updateWeather(); // æ›´æ–°å¤©æ°£ã€‚
							} else updateMarquee(`<span style="color: ${settings.weatherColor};">å®šä½å¤±æ•—</span>`, 'weather'); // å¦‚æœ API å›å‚³è³‡æ–™ä¸­æ²’æœ‰åŸå¸‚ï¼Œé¡¯ç¤ºå®šä½å¤±æ•—ã€‚
						}).catch(() => updateMarquee(`<span style="color: ${settings.weatherColor};">å®šä½å¤±æ•—</span>`, 'weather')); // å¦‚æœ fetch å¤±æ•—ï¼Œé¡¯ç¤ºå®šä½å¤±æ•—ã€‚
					}, () => updateMarquee(`<span style="color: ${settings.weatherColor};">å®šä½å¤±æ•—ï¼Œè«‹æª¢æŸ¥æ¬Šé™</span>`, 'weather'), { timeout: 10000 } ); // å¦‚æœç”¨æˆ¶æ‹’çµ•æˆ–éŒ¯èª¤ï¼Œé¡¯ç¤ºæ¬Šé™æˆ–å¤±æ•—è¨Šæ¯ï¼Œè¨­å®š10ç§’è¶…æ™‚ã€‚
				}
			});
			qs('#restoreDefaultsBtn').onclick = restoreDefaults; // ç‚º "æ¢å¾©é è¨­å€¼" æŒ‰éˆ•è¨­å®šé»æ“Šäº‹ä»¶ã€‚
			qs('#randomColorsBtn').onclick = setRandomColors; // ç‚º "éš¨æ©Ÿé…è‰²" æŒ‰éˆ•è¨­å®šé»æ“Šäº‹ä»¶ã€‚
			document.body.addEventListener('click', e => { // ç‚ºæ•´å€‹é é¢ body æ·»åŠ é»æ“Šäº‹ä»¶ï¼ˆäº‹ä»¶å§”æ´¾ï¼‰ã€‚
				if (settings.editMode || state.isDragging) return; // å¦‚æœåœ¨ç·¨è¼¯æ¨¡å¼æˆ–æ­£åœ¨æ‹–æ›³ï¼Œå‰‡ä¸è§¸ç™¼ã€‚
				const target = e.target; // ç²å–é»æ“Šçš„ç›®æ¨™å…ƒç´ ã€‚
				if (target.closest('#weatherMarqueeContainer')) showWeatherForecast(); // å¦‚æœé»æ“Šçš„æ˜¯å¤©æ°£è·‘é¦¬ç‡ˆï¼Œé¡¯ç¤ºå¤©æ°£é å ±ã€‚
				else if (target.closest('.jieqi-holiday-marquee-container')) showDateDetails(new Date()); // å¦‚æœé»æ“Šçš„æ˜¯ç¯€æ°£å‡æ—¥è·‘é¦¬ç‡ˆï¼Œé¡¯ç¤ºä»Šå¤©è©³æƒ…ã€‚
				else if (target.closest('.lunar-shichen-target')) updateShiChenDetailsView(new Date()); // å¦‚æœé»æ“Šçš„æ˜¯æ™‚è¾°å€åŸŸï¼Œé¡¯ç¤ºæ™‚è¾°è©³æƒ…ã€‚
				else if (target.closest('.lunar-day-target')) showDateDetails(new Date()); // å¦‚æœé»æ“Šçš„æ˜¯è¾²æ›†æ—¥å€åŸŸï¼Œé¡¯ç¤ºä»Šå¤©è©³æƒ…ã€‚
				else if (target.closest('.lunar-month-text-target') || target.closest('.gregorian-month-target')) { state.calendarDate = new Date(); generateCalendarPopup(state.calendarDate.getFullYear(), state.calendarDate.getMonth()); qs('#calendarModal').classList.add('is-active'); } // å¦‚æœé»æ“Šçš„æ˜¯æœˆä»½å€åŸŸï¼Œé¡¯ç¤ºæœˆæ›†å½ˆçª—ã€‚
				else if (target.closest('.moon-phase-icon-target')) showMoonPhaseDetails(new Date()); // å¦‚æœé»æ“Šçš„æ˜¯æœˆç›¸åœ–ç¤ºï¼Œé¡¯ç¤ºæœˆç›¸è©³æƒ…ã€‚
				else if (target.closest('.lunar-year-target')) showZodiacDetails(); // å¦‚æœé»æ“Šçš„æ˜¯è¾²æ›†å¹´å€åŸŸï¼Œé¡¯ç¤ºç”Ÿè‚–è©³æƒ…ã€‚
				else if (target.closest('.gregorian-year-target')) { state.yearlyCalendarDate = new Date(); generateYearCalendar(state.yearlyCalendarDate.getFullYear()); qs('#yearlyCalendarModal').classList.add('is-active'); } // å¦‚æœé»æ“Šçš„æ˜¯å…¬æ›†å¹´å€åŸŸï¼Œé¡¯ç¤ºå¹´æ›†å½ˆçª—ã€‚
				else if (target.closest('.weekday-target')) { state.weeklyCalendarDate = new Date(); generateWeekCalendar(state.weeklyCalendarDate); qs('#weeklyCalendarModal').classList.add('is-active'); } // å¦‚æœé»æ“Šçš„æ˜¯æ˜ŸæœŸå€åŸŸï¼Œé¡¯ç¤ºé€±æ›†å½ˆçª—ã€‚
				else if (target.closest('.gregorian-day-target')) showDateDetails(new Date()); // å¦‚æœé»æ“Šçš„æ˜¯å…¬æ›†æ—¥å€åŸŸï¼Œé¡¯ç¤ºä»Šå¤©è©³æƒ…ã€‚
				else if (target.closest('#analog-calendar-widget .calendar-container')) { state.calendarDate = new Date(); generateCalendarPopup(state.calendarDate.getFullYear(), state.calendarDate.getMonth()); qs('#calendarModal').classList.add('is-active'); } // å¦‚æœé»æ“Šçš„æ˜¯æŒ‡é‡æ—¥æ›†ï¼Œé¡¯ç¤ºæœˆæ›†å½ˆçª—ã€‚
				else if (target.closest('#clockCenterDot')) updateShiChenDetailsView(new Date()); // å¦‚æœé»æ“Šçš„æ˜¯æ™‚é˜ä¸­å¿ƒé»ï¼Œé¡¯ç¤ºæ™‚è¾°è©³æƒ…ã€‚
			});
			qsa('.close-icon').forEach(btn => btn.onclick = () => btn.closest('.modal').classList.remove('is-active')); // ç‚ºæ‰€æœ‰é—œé–‰åœ–ç¤ºæ·»åŠ é»æ“Šäº‹ä»¶ï¼Œé—œé–‰å…¶æ‰€åœ¨çš„å½ˆçª—ã€‚
			qsa('.modal').forEach(modal => modal.addEventListener('click', e => { if (e.target === modal) modal.classList.remove('is-active'); })); // ç‚ºæ‰€æœ‰å½ˆçª—æ·»åŠ é»æ“Šäº‹ä»¶ï¼Œå¦‚æœé»æ“Šçš„æ˜¯å½ˆçª—èƒŒæ™¯ï¼ˆè€Œéå…§å®¹ï¼‰ï¼Œå‰‡é—œé–‰å½ˆçª—ã€‚
			qs('#backToWeeklyForecastBtn').onclick = () => { qs('#hourlyWeatherModal').classList.remove('is-active'); qs('#weatherForecastModal').classList.add('is-active'); }; // "è¿”å›ä¸€é€±é å ±" æŒ‰éˆ•çš„é»æ“Šäº‹ä»¶ã€‚
			qs('#todayCalendarBtn').onclick = () => { state.calendarDate = new Date(); generateCalendarPopup(state.calendarDate.getFullYear(), state.calendarDate.getMonth()); }; // æœˆæ›†ä¸­çš„ "ä»Šå¤©" æŒ‰éˆ•ã€‚
			qs('#todayWeeklyBtn').onclick = () => { state.weeklyCalendarDate = new Date(); generateWeekCalendar(state.weeklyCalendarDate); }; // é€±æ›†ä¸­çš„ "æœ¬é€±" æŒ‰éˆ•ã€‚
			qs('#todayYearlyBtn').onclick = () => { state.yearlyCalendarDate = new Date(); generateYearCalendar(state.yearlyCalendarDate.getFullYear()); }; // å¹´æ›†ä¸­çš„ "ä»Šå¹´" æŒ‰éˆ•ã€‚
			qs('#prevMonthBtn').onclick = () => { state.calendarDate.setMonth(state.calendarDate.getMonth() - 1); generateCalendarPopup(state.calendarDate.getFullYear(), state.calendarDate.getMonth()); }; // "ä¸Šå€‹æœˆ" æŒ‰éˆ•ã€‚
			qs('#nextMonthBtn').onclick = () => { state.calendarDate.setMonth(state.calendarDate.getMonth() + 1); generateCalendarPopup(state.calendarDate.getFullYear(), state.calendarDate.getMonth()); }; // "ä¸‹å€‹æœˆ" æŒ‰éˆ•ã€‚
			qs('#prevWeekBtn').onclick = () => { state.weeklyCalendarDate.setDate(state.weeklyCalendarDate.getDate() - 7); generateWeekCalendar(state.weeklyCalendarDate); }; // "ä¸Šä¸€é€±" æŒ‰éˆ•ã€‚
			qs('#nextWeekBtn').onclick = () => { state.weeklyCalendarDate.setDate(state.weeklyCalendarDate.getDate() + 7); generateWeekCalendar(state.weeklyCalendarDate); }; // "ä¸‹ä¸€é€±" æŒ‰éˆ•ã€‚
			qs('#prevYearBtn').onclick = () => { state.yearlyCalendarDate.setFullYear(state.yearlyCalendarDate.getFullYear() - 1); generateYearCalendar(state.yearlyCalendarDate.getFullYear()); }; // "ä¸Šä¸€å¹´" æŒ‰éˆ•ã€‚
			qs('#nextYearBtn').onclick = () => { state.yearlyCalendarDate.setFullYear(state.yearlyCalendarDate.getFullYear() + 1); generateYearCalendar(state.yearlyCalendarDate.getFullYear()); }; // "ä¸‹ä¸€å¹´" æŒ‰éˆ•ã€‚
			qs('#calendarMonthYear').onclick = () => { const year = parseInt(qs('#calendarMonthYear').dataset.year); qs('#calendarModal').classList.remove('is-active'); state.yearlyCalendarDate.setFullYear(year); generateYearCalendar(year); qs('#yearlyCalendarModal').classList.add('is-active'); }; // æœˆæ›†æ¨™é¡Œçš„é»æ“Šäº‹ä»¶ï¼Œç”¨æ–¼è·³è½‰åˆ°å¹´æ›†ã€‚
			qs('#prevShichenBtn').onclick = () => { state.shichenDetailDate.setHours(state.shichenDetailDate.getHours() - 2); updateShiChenDetailsView(state.shichenDetailDate); }; // "ä¸Šä¸€å€‹æ™‚è¾°" æŒ‰éˆ•ã€‚
			qs('#nextShichenBtn').onclick = () => { state.shichenDetailDate.setHours(state.shichenDetailDate.getHours() + 2); updateShiChenDetailsView(state.shichenDetailDate); }; // "ä¸‹ä¸€å€‹æ™‚è¾°" æŒ‰éˆ•ã€‚
			qs('#nowShichenBtn').onclick = () => updateShiChenDetailsView(new Date()); // æ™‚è¾°è©³æƒ…ä¸­çš„ "ç¾åœ¨" æŒ‰éˆ•ã€‚
			qs('#prevMoonMonthBtn').onclick = () => { state.moonCalendarDate.setMonth(state.moonCalendarDate.getMonth() - 1); generateMoonPhaseCalendar(state.moonCalendarDate.getFullYear(), state.moonCalendarDate.getMonth(), state.moonCalendarDate); }; // æœˆç›¸æ—¥æ›†çš„ "ä¸Šå€‹æœˆ" æŒ‰éˆ•ã€‚
			qs('#nextMoonMonthBtn').onclick = () => { state.moonCalendarDate.setMonth(state.moonCalendarDate.getMonth() + 1); generateMoonPhaseCalendar(state.moonCalendarDate.getFullYear(), state.moonCalendarDate.getMonth(), state.moonCalendarDate); }; // æœˆç›¸æ—¥æ›†çš„ "ä¸‹å€‹æœˆ" æŒ‰éˆ•ã€‚
			qs('#todayMoonCalendarBtn').onclick = () => { const today = new Date(); today.setHours(12,0,0,0); state.moonCalendarDate = today; updateMainMoonPhaseDisplay(today); generateMoonPhaseCalendar(today.getFullYear(), today.getMonth(), today); }; // æœˆç›¸æ—¥æ›†çš„ "ä»Šå¤©" æŒ‰éˆ•ã€‚
			qs('#settings-icon').addEventListener('click', () => { qs('#settingsModal').classList.add('is-active'); updateSettingsModalUI(); updateSettingDependencies(); }); // è¨­å®šåœ–ç¤ºçš„é»æ“Šäº‹ä»¶ï¼Œæ‰“é–‹è¨­å®šå½ˆçª—ã€‚
			qs('#edit-mode-icon').addEventListener('click', () => { settings.editMode = !settings.editMode; toggleEditModeState(); saveState(); }); // ç·¨è¼¯æ¨¡å¼åœ–ç¤ºçš„é»æ“Šäº‹ä»¶ï¼Œåˆ‡æ›ç·¨è¼¯æ¨¡å¼ã€‚
			qs('#fullscreen-icon').addEventListener('click', () => { if (!document.fullscreenElement) document.documentElement.requestFullscreen().catch(err => console.warn(`ç„¡æ³•é€²å…¥å…¨è¢å¹•æ¨¡å¼: ${err.message}`)); else if (document.exitFullscreen) document.exitFullscreen(); }); // å…¨è¢å¹•åœ–ç¤ºçš„é»æ“Šäº‹ä»¶ï¼Œé€²å…¥æˆ–é€€å‡ºå…¨è¢å¹•ã€‚
			const handleFullscreen = () => { // è™•ç†å…¨è¢å¹•ç‹€æ…‹è®Šæ›´çš„å‡½å¼ã€‚
				const isFullscreen = !!document.fullscreenElement; // æª¢æŸ¥ç•¶å‰æ˜¯å¦è™•æ–¼å…¨è¢å¹•ç‹€æ…‹ã€‚
				const enterIcon = qs('#fullscreen-icon .enter-fullscreen-svg'), exitIcon = qs('#fullscreen-icon .exit-fullscreen-svg'), button = qs('#fullscreen-icon'); // ç²å–å…¨è¢å¹•æŒ‰éˆ•å’Œå…¶å…§éƒ¨çš„åœ–ç¤ºã€‚
				if (enterIcon && exitIcon && button) { // ç¢ºä¿å…ƒç´ éƒ½å­˜åœ¨ã€‚
					enterIcon.style.display = isFullscreen ? 'none' : 'block'; // æ ¹æ“šå…¨è¢å¹•ç‹€æ…‹é¡¯ç¤º/éš±è— "é€²å…¥" åœ–ç¤ºã€‚
					exitIcon.style.display = isFullscreen ? 'block' : 'none'; // æ ¹æ“šå…¨è¢å¹•ç‹€æ…‹é¡¯ç¤º/éš±è— "é€€å‡º" åœ–ç¤ºã€‚
					button.title = isFullscreen ? 'é€€å‡ºå…¨è¢å¹•' : 'å…¨è¢å¹•'; // æ›´æ–°æŒ‰éˆ•çš„å·¥å…·æç¤ºã€‚
				}
				window.dispatchEvent(new Event('resize')); // è§¸ç™¼ resize äº‹ä»¶ä»¥é‡æ–°è¨ˆç®—ä½ˆå±€ã€‚
			};
			const handleResize = () => { if (constrainPositions()) { applyTransforms(); } }; // è™•ç†è¦–çª—å¤§å°è®Šæ›´çš„å‡½å¼ï¼Œé‡æ–°é™åˆ¶å°å·¥å…·ä½ç½®ã€‚
			document.addEventListener('fullscreenchange', handleFullscreen); document.addEventListener('webkitfullscreenchange', handleFullscreen); // ç›£è½æ¨™æº–å’Œ Webkit çš„å…¨è¢å¹•è®Šæ›´äº‹ä»¶ã€‚
			window.addEventListener('resize', handleResize); // ç›£è½è¦–çª—å¤§å°è®Šæ›´äº‹ä»¶ã€‚
			let inactivityTimer; const icons = qsa('.control-icon'); // å®šç¾©é–’ç½®è¨ˆæ™‚å™¨å’Œç²å–æ‰€æœ‰æ§åˆ¶åœ–ç¤ºã€‚
			const resetIdle = () => { // é‡ç½®é–’ç½®è¨ˆæ™‚å™¨çš„å‡½å¼ã€‚
				icons.forEach(icon => { if (window.getComputedStyle(icon).display !== 'none') setStyle(icon, { opacity: '0.5' }); }); // å°‡æ‰€æœ‰å¯è¦‹çš„åœ–ç¤ºé€æ˜åº¦è¨­ç‚º 0.5ã€‚
				clearTimeout(inactivityTimer); // æ¸…é™¤ä¹‹å‰çš„è¨ˆæ™‚å™¨ã€‚
				inactivityTimer = setTimeout(() => icons.forEach(icon => setStyle(icon, { opacity: '0' })), 5000); // è¨­å®šä¸€å€‹æ–°çš„ 5 ç§’è¨ˆæ™‚å™¨ï¼Œæ™‚é–“åˆ°å¾Œå°‡åœ–ç¤ºé€æ˜åº¦è¨­ç‚º 0ï¼ˆéš±è—ï¼‰ã€‚
			};
			['mousemove', 'keydown', 'touchstart'].forEach(evt => document.addEventListener(evt, resetIdle)); // ç›£è½æ»‘é¼ ç§»å‹•ã€éµç›¤æŒ‰ä¸‹ã€è§¸æ§é–‹å§‹äº‹ä»¶ä¾†é‡ç½®é–’ç½®è¨ˆæ™‚å™¨ã€‚
			resetIdle(); // åˆå§‹å‘¼å«ä¸€æ¬¡ä»¥å•Ÿå‹•è¨ˆæ™‚å™¨ã€‚
			const dragStart = (e) => { // æ‹–æ›³é–‹å§‹çš„å‡½å¼ã€‚
				if (!settings.editMode) return; // åƒ…åœ¨ç·¨è¼¯æ¨¡å¼ä¸‹ç”Ÿæ•ˆã€‚
				const wrapper = e.target.closest('.widget-wrapper'); // æ‰¾åˆ°è¢«é»æ“Šçš„ widget åŒ…è£å…ƒç´ ã€‚
				if (!wrapper) return; // å¦‚æœæ²’æ‰¾åˆ°ï¼Œå‰‡è¿”å›ã€‚
				e.preventDefault(); // é˜²æ­¢é è¨­è¡Œç‚ºï¼ˆå¦‚æ–‡å­—é¸å–ï¼‰ã€‚
				state.isDragging = true; state.dragTarget = wrapper.id.replace('-widget', ''); // è¨­å®šæ‹–æ›³ç‹€æ…‹å’Œç›®æ¨™ã€‚
				const T = transformState[state.dragTarget]; if (!T) return; // ç²å–ç›®æ¨™çš„è®Šæ›ç‹€æ…‹ã€‚
				const event = e.touches ? e.touches[0] : e; // è™•ç†è§¸æ§å’Œæ»‘é¼ äº‹ä»¶çš„å·®ç•°ã€‚
				state.startX = event.clientX; state.startY = event.clientY; // è¨˜éŒ„èµ·å§‹é»åº§æ¨™ã€‚
				if (e.target.classList.contains('resize-handle-x')) { state.dragType = 'resize-x'; document.body.style.cursor = 'ew-resize'; state.initialWidth = T.width || 92; } // å¦‚æœé»æ“Šçš„æ˜¯æ°´å¹³èª¿æ•´å¤§å°çš„æ§åˆ¶é»ã€‚
				else if (e.target.classList.contains('move-handle')) { state.dragType = 'move'; document.body.style.cursor = 'move'; state.initialX = T.x; state.initialY = T.y; } // å¦‚æœé»æ“Šçš„æ˜¯ç§»å‹•æ§åˆ¶é»ã€‚
				else { state.dragType = 'scale'; document.body.style.cursor = 'nwse-resize'; const rect = wrapper.getBoundingClientRect(); const centerX = rect.left + rect.width / 2; const centerY = rect.top + rect.height / 2; state.initialDist = Math.hypot(state.startX - centerX, state.startY - centerY); state.initialScale = T.scale; } // å¦å‰‡è¦–ç‚ºç¸®æ”¾æ“ä½œã€‚
				window.addEventListener('mousemove', dragMove); window.addEventListener('touchmove', dragMove, { passive: false }); // æ·»åŠ ç§»å‹•äº‹ä»¶ç›£è½å™¨ã€‚
				window.addEventListener('mouseup', dragEnd); window.addEventListener('touchend', dragEnd); // æ·»åŠ çµæŸäº‹ä»¶ç›£è½å™¨ã€‚
			};
			const dragMove = (e) => { // æ‹–æ›³éç¨‹ä¸­çš„å‡½å¼ã€‚
				if (!state.isDragging || !state.dragTarget) return; // å¦‚æœä¸åœ¨æ‹–æ›³ç‹€æ…‹ï¼Œå‰‡è¿”å›ã€‚
				e.preventDefault(); // é˜²æ­¢é è¨­è¡Œç‚ºï¼ˆå¦‚é é¢æ»¾å‹•ï¼‰ã€‚
				const T = transformState[state.dragTarget]; const el = qs(`#${state.dragTarget}-widget`); // ç²å–ç›®æ¨™çš„è®Šæ›ç‹€æ…‹å’Œå…ƒç´ ã€‚
				if (!el || !T) return; // å¦‚æœä¸å­˜åœ¨ï¼Œå‰‡è¿”å›ã€‚
				const event = e.touches ? e.touches[0] : e; // è™•ç†è§¸æ§å’Œæ»‘é¼ äº‹ä»¶çš„å·®ç•°ã€‚
				const dx = event.clientX - state.startX; const dy = event.clientY - state.startY; // è¨ˆç®—ç›¸å°æ–¼èµ·å§‹é»çš„ä½ç§»ã€‚
				requestAnimationFrame(() => { // ä½¿ç”¨ requestAnimationFrame å„ªåŒ–æ¸²æŸ“ã€‚
					if (!state.isDragging) return; // å†æ¬¡æª¢æŸ¥æ˜¯å¦ä»åœ¨æ‹–æ›³ã€‚
					if (state.dragType === 'move') { // å¦‚æœæ˜¯ç§»å‹•æ“ä½œã€‚
						const handleSize = 40, margin = 10; // å®šç¾©æ§åˆ¶é»å¤§å°å’Œé‚Šç•Œã€‚
						const minX = -window.innerWidth / 2 + handleSize / 2 + margin, maxX = window.innerWidth / 2 - handleSize / 2 - margin; // è¨ˆç®— X è»¸é‚Šç•Œã€‚
						const minY = -window.innerHeight / 2 + handleSize / 2 + margin, maxY = window.innerHeight / 2 - handleSize / 2 - margin; // è¨ˆç®— Y è»¸é‚Šç•Œã€‚
						T.x = Math.max(minX, Math.min(maxX, state.initialX + dx)); // æ›´æ–° X åº§æ¨™ä¸¦é™åˆ¶åœ¨é‚Šç•Œå…§ã€‚
						T.y = Math.max(minY, Math.min(maxY, state.initialY + dy)); // æ›´æ–° Y åº§æ¨™ä¸¦é™åˆ¶åœ¨é‚Šç•Œå…§ã€‚
					}
					else if (state.dragType === 'scale') { const rect = el.getBoundingClientRect(); const centerX = rect.left + rect.width / 2; const centerY = rect.top + rect.height / 2; const currentDist = Math.hypot(event.clientX - centerX, event.clientY - centerY); if (state.initialDist > 0) { const scaleFactor = currentDist / state.initialDist; T.scale = Math.max(0.2, state.initialScale * scaleFactor); } } // å¦‚æœæ˜¯ç¸®æ”¾æ“ä½œï¼Œæ ¹æ“šèˆ‡ä¸­å¿ƒé»çš„è·é›¢è®ŠåŒ–è¨ˆç®—æ–°çš„ç¸®æ”¾æ¯”ä¾‹ã€‚
					else if (state.dragType === 'resize-x') { const widthInVw = (dx / window.innerWidth) * 100; T.width = Math.max(20, state.initialWidth + widthInVw); } // å¦‚æœæ˜¯æ°´å¹³èª¿æ•´å¤§å°ï¼Œæ ¹æ“š X è»¸ä½ç§»è¨ˆç®—æ–°çš„å¯¬åº¦ï¼ˆvw å–®ä½ï¼‰ã€‚
					applyTransforms(); // æ‡‰ç”¨æ›´æ–°å¾Œçš„è®Šæ›ã€‚
				});
			};
			const dragEnd = () => { // æ‹–æ›³çµæŸçš„å‡½å¼ã€‚
				if (!state.isDragging) return; // å¦‚æœä¸åœ¨æ‹–æ›³ç‹€æ…‹ï¼Œå‰‡è¿”å›ã€‚
				state.isDragging = false; state.dragTarget = null; state.dragType = null; // é‡ç½®æ‹–æ›³ç›¸é—œçš„ç‹€æ…‹ã€‚
				document.body.style.cursor = 'default'; // æ¢å¾©é è¨­çš„æ»‘é¼ æŒ‡æ¨™ã€‚
				if (constrainPositions()) applyTransforms(); // å†æ¬¡æª¢æŸ¥ä¸¦é™åˆ¶ä½ç½®ï¼Œç¢ºä¿åœ¨é‚Šç•Œå…§ã€‚
				saveState(); // ä¿å­˜ç‹€æ…‹ã€‚
				window.removeEventListener('mousemove', dragMove); window.removeEventListener('touchmove', dragMove); // ç§»é™¤ç§»å‹•äº‹ä»¶ç›£è½å™¨ã€‚
				window.removeEventListener('mouseup', dragEnd); window.removeEventListener('touchend', dragEnd); // ç§»é™¤çµæŸäº‹ä»¶ç›£è½å™¨ã€‚
			};
			document.addEventListener('mousedown', dragStart); document.addEventListener('touchstart', dragStart, { passive: false }); // ç‚ºæ•´å€‹æ–‡ä»¶æ·»åŠ æ‹–æ›³é–‹å§‹äº‹ä»¶ç›£è½å™¨ã€‚
		}
		function initializeApp() { // åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼çš„ä¸»å‡½å¼ã€‚
			['movementIntervalMinutes', 'movementIntervalSeconds', 'scanlineIntervalMinutes', 'scanlineIntervalSeconds'].forEach(id => { const sel = document.getElementById(id); if (sel) for (let i = 0; i <= 59; i++) { const opt = document.createElement('option'); opt.value = i; opt.textContent = i; sel.appendChild(opt); } }); // ç‚ºè¨­å®šä¸­çš„æ™‚é–“é–“éš”ä¸‹æ‹‰é¸å–®ï¼ˆåˆ†å’Œç§’ï¼‰ç”Ÿæˆ 0-59 çš„é¸é …ã€‚
			const countySelect = qs('#countySelect'); // ç²å–ç¸£å¸‚ä¸‹æ‹‰é¸å–®å…ƒç´ ã€‚
			for (const county in taiwanLocations) { const opt = document.createElement('option'); opt.value = county; opt.textContent = county; countySelect.appendChild(opt); } // éæ­·å°ç£åœ°é»è³‡æ–™ï¼Œç”Ÿæˆç¸£å¸‚é¸é …ã€‚
			loadState(); // è¼‰å…¥ä¹‹å‰ä¿å­˜çš„ç‹€æ…‹å’Œè¨­å®šã€‚
			constrainPositions(); // é™åˆ¶å°å·¥å…·ä½ç½®ï¼Œé˜²æ­¢è¼‰å…¥æ™‚è¶…å‡ºé‚Šç•Œã€‚
			updateSettingsModalUI(); updateSettingDependencies(); initializeTimers(); initializeAnalogClock(); createAnalogCalendar(); // æ›´æ–°è¨­å®šä»‹é¢ã€åˆå§‹åŒ–è¨ˆæ™‚å™¨å’Œå„ç¨®æ™‚é˜æ—¥æ›†å…ƒä»¶ã€‚
			applyAllSettings(); applyTransforms(); updateWidgetVisibility(); clearInterval(timers.weather); updateWeather(); // æ‡‰ç”¨æ‰€æœ‰è¨­å®šã€è®Šæ›ã€æ›´æ–°å¯è¦‹æ€§ï¼Œä¸¦ç«‹å³æ›´æ–°ä¸€æ¬¡å¤©æ°£ã€‚
			timers.weather = setInterval(updateWeather, 10 * 60 * 1000); // è¨­å®šæ¯ 10 åˆ†é˜è‡ªå‹•æ›´æ–°ä¸€æ¬¡å¤©æ°£ã€‚
			initializeEventListeners(); // åˆå§‹åŒ–æ‰€æœ‰çš„äº‹ä»¶ç›£è½å™¨ã€‚
		}
		window.onload = initializeApp; // ç•¶é é¢å®Œå…¨è¼‰å…¥å¾Œï¼ŒåŸ·è¡Œæ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–å‡½å¼ã€‚
	</script>
</body>
</html>
