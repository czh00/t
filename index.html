<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™‚é–“</title>
    <style>
        /* å…¨å±€æ¨£å¼ï¼šè¨­å®šæ‰€æœ‰å…ƒç´ çš„ç›’æ¨¡å‹ç‚º border-box */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        /* body æ¨£å¼ï¼šè¨­å®šé é¢ç‚ºå…¨å±é¡¯ç¤ºï¼Œå…§å®¹å±…ä¸­ï¼ŒèƒŒæ™¯ç‚ºé»‘è‰² */
        body {
            margin: 0;
            overflow: hidden; /* éš±è—è¶…å‡ºè¦–çª—çš„å…§å®¹ */
            display: flex; /* ä½¿ç”¨ Flexbox ä½ˆå±€ */
            flex-direction: column; /* å‚ç›´æ’åˆ—å­å…ƒç´  */
            justify-content: center; /* å‚ç›´å±…ä¸­å°é½Š */
            align-items: center; /* æ°´å¹³å±…ä¸­å°é½Š */
            min-height: 100vh; /* æœ€å°é«˜åº¦ç‚ºè¦–çª—é«˜åº¦ */
            width: 100vw; /* å¯¬åº¦ç‚ºè¦–çª—å¯¬åº¦ */
            position: relative; /* ç›¸å°å®šä½ */
            font-family: 'Inter', sans-serif; /* ä½¿ç”¨ Inter å­—é«” */
        }

        /* dateTimeDisplay æ¨£å¼ï¼šæ™‚é–“é¡¯ç¤ºå®¹å™¨çš„æ¨£å¼ï¼ŒåŒ…æ‹¬å­—é«”ã€é¡è‰²ã€é™°å½±å’Œå®šä½ */
        #dateTimeDisplay {
            font-family: 'Segoe UI', Arial, sans-serif; /* å­—é«”è¨­å®š */
            font-weight: bold; /* å­—é«”åŠ ç²— */
            text-align: center; /* æ–‡å­—å±…ä¸­å°é½Š */
            padding: 10px; /* å…§é‚Šè· */
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5); /* æ–‡å­—é™°å½± */
            position: absolute; /* çµ•å°å®šä½ */
            transition: transform 1s ease-in-out; /* è®Šæ›éæ¸¡æ•ˆæœ */
            transform: translate(-50%, -50%); /* å±…ä¸­å®šä½ */
            left: 50%; /* å·¦é‚Šè· 50% */
            top: 50%; /* ä¸Šé‚Šè· 50% */
        }

        /* time-text æ¨£å¼ï¼šé¡¯ç¤ºæ™‚åˆ†çš„ä¸»æ™‚é–“æ–‡å­—æ¨£å¼ */
        .time-text {
            font-size: 32vw; /* å­—é«”å¤§å°æ ¹æ“šè¦–çª—å¯¬åº¦èª¿æ•´ */
            margin-bottom: -10vw; /* åº•éƒ¨å¤–é‚Šè· */
            position: relative; /* ç›¸å°å®šä½ï¼Œç‚ºç§’æ•¸å’ŒAM/PMæä¾›å®šä½ä¸Šä¸‹æ–‡ */
            display: inline-block; /* è¡Œå…§å¡Šç´šå…ƒç´  */
            white-space: nowrap; /* ä¸æ›è¡Œ */
            padding-right: 8vw; /* ç‚ºç§’æ•¸å’ŒAM/PMé¨°å‡ºç©ºé–“ */
        }

        /* time-seconds æ¨£å¼ï¼šé¡¯ç¤ºç§’æ•¸çš„æ–‡å­—æ¨£å¼ */
        .time-seconds {
            font-size: 6vw; /* å­—é«”å¤§å°æ ¹æ“šè¦–çª—å¯¬åº¦èª¿æ•´ */
            cursor: pointer; /* é¼ æ¨™æ‡¸åœæ™‚é¡¯ç¤ºæ‰‹å‹ */
            position: absolute; /* çµ•å°å®šä½ */
            top: 12vw; /* èª¿æ•´å‚ç›´ä½ç½® */
            right: ; /* å°é½Šåˆ° time-text çš„å³é‚Šç·£ */
            text-align: right; /* ç¢ºä¿æ–‡å­—é å³å°é½Š */
            width: 6vw; /* çµ¦å®šå¯¬åº¦ä»¥å°é½Š */
        }

        /* time-ampm æ¨£å¼ï¼šé¡¯ç¤ºä¸Šåˆ/ä¸‹åˆçš„æ–‡å­—æ¨£å¼ */
        .time-ampm {
            font-size: 5vw; /* å­—é«”å¤§å°èˆ‡ç§’æ•¸ç›¸åŒ */
            position: absolute; /* çµ•å°å®šä½ */
            bottom: 10vw; /* èª¿æ•´å‚ç›´ä½ç½® */
            right: 0; /* å°é½Šåˆ° time-text çš„å³é‚Šç·£ */
            text-align: right; /* ç¢ºä¿æ–‡å­—é å³å°é½Š */
            width: 8vw; /* çµ¦å®šå¯¬åº¦ä»¥å°é½Š */
        }

        /* gregorian-date-text æ¨£å¼ï¼šé¡¯ç¤ºå…¬æ›†æ—¥æœŸçš„æ–‡å­—æ¨£å¼ */
        .gregorian-date-text {
            font-size: 10vw; /* å­—é«”å¤§å°æ ¹æ“šè¦–çª—å¯¬åº¦èª¿æ•´ */
            margin-top: -2vw; /* æ–°å¢ï¼šå°å…¬æ›†æ—¥æœŸå…ƒç´ è¨­å®šè² ä¸Šå¤–é‚Šè· */
            margin-bottom: -3vw; /* åº•éƒ¨å¤–é‚Šè· */
            display: block; /* å¡Šç´šå…ƒç´  */
            white-space: nowrap; /* ä¸æ›è¡Œ */
        }

        /* lunar-jieqi-combined-text æ¨£å¼ï¼šé¡¯ç¤ºè¾²æ›†å’Œç¯€æ°£çš„æ–‡å­—æ¨£å¼ */
        .lunar-jieqi-combined-text {
            font-size: 6.4vw; /* å­—é«”å¤§å°æ ¹æ“šè¦–çª—å¯¬åº¦èª¿æ•´ */
            display: block; /* å¡Šç´šå…ƒç´  */
            white-space: nowrap; /* ä¸æ›è¡Œ */
        }

        /* noscript-message æ¨£å¼ï¼šç•¶ JavaScript è¢«ç¦ç”¨æ™‚é¡¯ç¤ºçš„æç¤ºè¨Šæ¯æ¨£å¼ */
        .noscript-message {
            font-size: 0.5em; /* å­—é«”å¤§å° */
            color: #FFB3BA; /* æ·ºç´…è‰² */
            margin-top: 10px; /* é ‚éƒ¨å¤–é‚Šè· */
        }

        /* è¨­å®šå½ˆå‡ºè¦–çª—çš„æ¨£å¼ - é è¨­éš±è— */
        .settings-modal, .jieqi-modal, .yiji-modal {
            display: none; /* é è¨­éš±è— */
            position: fixed; /* å›ºå®šå®šä½ */
            z-index: 100; /* ç¢ºä¿åœ¨æœ€ä¸Šå±¤ */
            left: 0;
            top: 0;
            width: 100%; /* å…¨å¯¬ */
            height: 100%; /* å…¨é«˜ */
            overflow: auto; /* å…è¨±æ»¾å‹• */
            background-color: rgba(0, 0, 0, 0.7); /* åŠé€æ˜é»‘è‰²èƒŒæ™¯ */
        }

        /* å½ˆå‡ºè¦–çª—é¡¯ç¤ºæ™‚çš„æ¨£å¼ */
        .settings-modal.is-active, .jieqi-modal.is-active, .yiji-modal.is-active {
            display: flex; /* åƒ…åœ¨ .is-active æ™‚é¡¯ç¤ºç‚º flex */
            justify-content: center;
            align-items: center;
        }

        /* è¨­å®šå½ˆå‡ºè¦–çª—å…§å®¹çš„æ¨£å¼ */
        .settings-content, .jieqi-content, .yiji-content {
            background-color: #333; /* æ·±ç°è‰²èƒŒæ™¯ */
            margin: auto; /* è‡ªå‹•å¤–é‚Šè·ï¼Œç”¨æ–¼å±…ä¸­ */
            padding: 20px;
            border: 1px solid #888;
            width: 90%; /* å¯¬åº¦ä½” 90% */
            max-width: 600px; /* æœ€å¤§å¯¬åº¦ */
            border-radius: 10px; /* åœ“è§’ */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5); /* é™°å½± */
            color: #00FF00; /* æ–‡å­—é¡è‰² */
            text-align: center; /* æ–‡å­—å±…ä¸­ */
            display: flex; /* ä½¿ç”¨ Flexbox é€²è¡Œæ•´é«”å…§å®¹ä½ˆå±€ */
            flex-direction: column; /* å‚ç›´å †ç–Šå…¶å­å…ƒç´  */
            gap: 15px; /* å­å…ƒç´ ä¹‹é–“çš„é–“è· */
            max-height: 90vh; /* é™åˆ¶æœ€å¤§é«˜åº¦ç‚ºè¦–çª—çš„ 90% */
            overflow-y: auto; /* å¦‚æœå…§å®¹è¶…å‡ºé«˜åº¦ï¼Œå‰‡å…è¨±å‚ç›´æ»¾å‹• */
        }

        /* è¨­å®šé …ç›®æ¨£å¼ */
        .setting-item {
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between; /* å°‡å…§å®¹åˆ†é–‹å°é½Š */
            align-items: center;
            flex-wrap: nowrap; /* é˜²æ­¢å–®å€‹è¨­å®šé …ç›®å…§å®¹æ›è¡Œ */
        }

        .setting-item label {
            font-size: 1.2em;
            flex-shrink: 0; /* é˜²æ­¢æ¨™ç±¤ç¸®å° */
            margin-right: 10px; /* æ¨™ç±¤èˆ‡é–‹é—œä¹‹é–“çš„é–“è· */
        }

        /* é–‹é—œæŒ‰éˆ•æ¨£å¼ */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
            margin-left: auto; /* å°‡é–‹é—œæ¨åˆ°å³é‚Š */
            margin-right: 10px; /* åœ¨é–‹é—œå’Œé¡è‰²é¸æ“‡å™¨ä¹‹é–“å¢åŠ é–“è· */
            flex-shrink: 0; /* é˜²æ­¢é–‹é—œç¸®å° */
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #00FF00;
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #00FF00;
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* é¡è‰²é¸æ“‡å™¨æ¨£å¼ */
        .setting-item input[type="color"] {
            width: 40px; /* èª¿æ•´é¡è‰²é¸æ“‡å™¨å¯¬åº¦ */
            height: 34px; /* èª¿æ•´é¡è‰²é¸æ“‡å™¨é«˜åº¦ */
            border: none;
            padding: 0;
            background: none;
            cursor: pointer;
            flex-shrink: 0; /* é˜²æ­¢é¡è‰²é¸æ“‡å™¨ç¸®å° */
        }

        /* æ¢å¾©é è¨­å’Œéš¨æ©ŸæŒ‰éˆ•æ¨£å¼ */
        .action-button {
            background-color: #555;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            margin-top: 20px;
        }

        .action-button:hover {
            background-color: #777;
        }

        /* æŒ‰éˆ•ç¾¤çµ„æ¨£å¼ï¼Œç”¨æ–¼æ’åˆ—ã€Œæ¢å¾©é è¨­ã€ã€ã€Œéš¨æ©Ÿã€å’Œã€Œå®Œæˆã€æŒ‰éˆ• */
        .button-group {
            display: flex;
            justify-content: center;
            gap: 10px; /* æŒ‰éˆ•ä¹‹é–“çš„é–“è· */
            margin-top: 20px;
            white-space: nowrap; /* ä¸æ›è¡Œ */
        }

        /* æ–°å¢ï¼šæ—¥æ›†è¨­å®šå®¹å™¨ï¼Œç”¨æ–¼ä¸¦æ’é¡¯ç¤ºå…¬æ›†å’Œè¾²æ›†è¨­å®š */
        .calendar-settings-container {
            display: flex;
            flex-wrap: wrap; /* å…è¨±åœ¨å°è¢å¹•ä¸Šæ›è¡Œ */
            gap: 20px; /* åˆ—ä¹‹é–“çš„é–“è· */
            justify-content: space-around; /* åˆ†æ•£ç©ºé–“ */
            width: 100%; /* ä½”ç”¨å¯ç”¨å¯¬åº¦ */
        }

        /* æ–°å¢ï¼šå…¬æ›†å’Œè¾²æ›†è¨­å®šçš„åˆ—æ¨£å¼ */
        .gregorian-settings-column,
        .lunar-settings-column {
            flex: 1; /* æ¯åˆ—ä½”ç”¨ç›¸ç­‰ç©ºé–“ */
            min-width: 80px; /* æ¯åˆ—çš„æœ€å°å¯¬åº¦ï¼Œé˜²æ­¢åœ¨å°è¢å¹•ä¸Šéåº¦å£“ç¸® */
            padding: 10px;
            border: 1px solid #555; /* å¯é¸ï¼šç‚ºè¦–è¦ºåˆ†é›¢æ·»åŠ é‚Šæ¡† */
            border-radius: 8px;
            background-color: #444; /* åˆ—çš„èƒŒæ™¯é¡è‰² */
            text-align: left; /* å°‡åˆ—å…§çš„æ–‡å­—å·¦å°é½Š */
        }

        .gregorian-settings-column h3,
        .lunar-settings-column h3 {
            text-align: center; /* åˆ—æ¨™é¡Œå±…ä¸­ */
            margin-top: 0;
        }

        /* ç¯€æ°£æ–‡å­—å¯é»æ“Šæ¨£å¼ */
        .jieqi-clickable {
            cursor: pointer;
        }

        /* è¾²æ›†æ—¥æœŸæ–‡å­—å¯é»æ“Šæ¨£å¼ */
        .lunar-date-clickable {
            cursor: pointer;
        }

        /* æ™‚è¾°æ–‡å­—å¯é»æ“Šæ¨£å¼ */
        .lunar-shichen-clickable {
            cursor: pointer;
        }

        /* å®œå¿Œå½ˆçª—å…§å®¹ç‰¹å®šæ¨£å¼ */
        .yiji-content p {
            margin-bottom: 5px;
        }
        .yiji-content strong {
            color: #FFD700; /* é‡‘è‰²ï¼Œè®“å®œå¿Œæ¨™é¡Œæ›´é¡¯çœ¼ */
        }

        /* ç¯€æ°£/ç¯€æ—¥å½ˆçª—å…§å®¹ç‰¹å®šæ¨£å¼ */
        .jieqi-content p {
            margin-bottom: 5px;
        }
        .jieqi-content strong {
            color: #FFD700; /* é‡‘è‰²ï¼Œè®“æ¨™é¡Œæ›´é¡¯çœ¼ */
        }
    </style>
    <!-- åŠ å…¥å°å¤–éƒ¨ lunar-javascript å‡½å¼åº«çš„å¼•ç”¨ï¼Œç”¨æ–¼è¾²æ›†å’Œç¯€æ°£è¨ˆç®— -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lunar-javascript/1.7.0/lunar.min.js"></script>
</head>
<body>
    <!-- æ™‚é–“ã€æ—¥æœŸã€è¾²æ›†å’Œç¯€æ°£çš„é¡¯ç¤ºå®¹å™¨ -->
    <div id="dateTimeDisplay"></div>

    <!-- å¦‚æœç€è¦½å™¨ä¸æ”¯æ´ JavaScriptï¼Œé¡¯ç¤ºæ­¤è¨Šæ¯ -->
    <noscript>
            <div class="noscript-message">
                æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´æˆ–å·²ç¦ç”¨ JavaScriptã€‚
            </div>
    </noscript>

    <!-- è¨­å®šå½ˆå‡ºè¦–çª— -->
    <div id="settingsModal" class="settings-modal">
        <div class="settings-content">
            <h2>é¡¯ç¤ºè¨­å®š</h2>
            <div class="calendar-settings-container"> <!-- æ–°å¢ï¼šç”¨æ–¼ä¸¦æ’é¡¯ç¤ºå…¬æ›†å’Œè¾²æ›†è¨­å®šçš„å®¹å™¨ -->
                <div class="gregorian-settings-column"> <!-- å…¬æ›†è¨­å®šåˆ— -->
                    <h3>å…¬æ›†</h3>
                    <div class="setting-item">
                        <label for="textColor">æ™‚é–“</label>
                        <label class="switch" title="åˆ‡æ›ä¸Šåˆ/ä¸‹åˆæ ¼å¼">
                            <input type="checkbox" id="showAmPm">
                            <span class="slider"></span>
                        </label>
                        <input type="color" id="textColor" value="#00FF00">
                    </div>
                    <div class="setting-item">
                        <label for="showGregorianYear">å¹´</label>
                        <label class="switch">
                            <input type="checkbox" id="showGregorianYear">
                            <span class="slider"></span>
                        </label>
                        <input type="color" id="gregorianYearColor" value="#00FF00">
                    </div>
                    <div class="setting-item">
                        <label for="showGregorianMonth">æœˆ</label>
                        <label class="switch">
                            <input type="checkbox" id="showGregorianMonth">
                            <span class="slider"></span>
                        </label>
                        <input type="color" id="gregorianMonthColor" value="#00FF00">
                    </div>
                    <div class="setting-item">
                        <label for="showGregorianDay">æ—¥</label>
                        <label class="switch">
                            <input type="checkbox" id="showGregorianDay">
                            <span class="slider"></span>
                        </label>
                        <input type="color" id="gregorianDayColor" value="#00FF00">
                    </div>
                    <div class="setting-item">
                        <label for="showGregorianWeekday">å‘¨</label>
                        <label class="switch">
                            <input type="checkbox" id="showGregorianWeekday">
                            <span class="slider"></span>
                        </label>
                        <input type="color" id="gregorianWeekdayColor" value="#00FF00">
                    </div>
                </div>

                <div class="lunar-settings-column"> <!-- è¾²æ›†è¨­å®šåˆ— -->
                    <h3>è¾²æ›†</h3>
                    <div class="setting-item">
                        <label for="showMinguoYear">å¹´</label>
                        <label class="switch">
                            <input type="checkbox" id="showMinguoYear">
                            <span class="slider"></span>
                        </label>
                        <input type="color" id="minguoYearColor" value="#00FF00">
                    </div>
                    <div class="setting-item">
                        <label for="showLunarMonth">æœˆ</label>
                        <label class="switch">
                            <input type="checkbox" id="showLunarMonth">
                            <span class="slider"></span>
                        </label>
                        <input type="color" id="lunarMonthColor" value="#00FF00">
                    </div>
                    <div class="setting-item">
                        <label for="showLunarDay">æ—¥</label>
                        <label class="switch">
                            <input type="checkbox" id="showLunarDay">
                            <span class="slider"></span>
                        </label>
                        <input type="color" id="lunarDayColor" value="#00FF00">
                    </div>
                    <div class="setting-item">
                        <label for="showLunarShiChen">æ™‚</label>
                        <label class="switch">
                            <input type="checkbox" id="showLunarShiChen">
                            <span class="slider"></span>
                        </label>
                        <input type="color" id="lunarShiChenColor" value="#00FF00">
                    </div>
                    <div class="setting-item">
                        <label for="showJieqi">ç¯€æ°£</label>
                        <label class="switch">
                            <input type="checkbox" id="showJieqi">
                            <span class="slider"></span>
                        </label>
                        <input type="color" id="jieqiColor" value="#00FF00">
                    </div>
                    <div class="setting-item">
                        <label for="showHolidays">ç¯€æ—¥</label>
                        <label class="switch">
                            <input type="checkbox" id="showHolidays">
                            <span class="slider"></span>
                        </label>
                        <input type="color" id="holidayColor" value="#00FF00">
                    </div>
                </div>
            </div>

            <div class="setting-item">
                <label for="backgroundColor">èƒŒæ™¯é¡è‰²</label>
                <input type="color" id="backgroundColor" value="#000000">
            </div>

            <div class="button-group">
                <button id="restoreDefaultsBtn" class="action-button">æ¢å¾©é è¨­</button>
                <button id="randomColorsBtn" class="action-button">éš¨æ©Ÿé¡è‰²</button>
                <button id="doneBtn" class="action-button">å®Œæˆ</button>
            </div>
        </div>
    </div>

    <!-- ç¯€æ°£è©³ç´°è³‡æ–™å½ˆå‡ºè¦–çª— -->
    <div id="jieqiDetailsModal" class="jieqi-modal">
        <div class="jieqi-content">
            <h2>ç¯€æ°£èˆ‡ç¯€æ—¥è³‡è¨Š</h2>
            <div id="jieqiDetailsContent" style="text-align: left;">
                <!-- ç¯€æ°£å’Œç¯€æ—¥è©³ç´°è³‡æ–™å°‡åœ¨æ­¤è™•å‹•æ…‹è¼‰å…¥ -->
            </div>
            <button id="closeJieqiDetailsBtn" class="action-button">é—œé–‰</button>
        </div>
    </div>

    <!-- æ¯æ—¥å®œå¿Œå½ˆå‡ºè¦–çª— -->
    <div id="yijiDetailsModal" class="yiji-modal">
        <div class="yiji-content">
            <h2>å®œå¿Œè³‡è¨Š</h2> <!-- æ¨™é¡Œå·²å¾ã€Œæ¯æ—¥å®œå¿Œã€ä¿®æ”¹ç‚ºã€Œå®œå¿Œè³‡è¨Šã€ -->
            <div id="yijiDetailsContent" style="text-align: left;">
                <!-- å®œå¿Œè©³ç´°è³‡æ–™å°‡åœ¨æ­¤è™•å‹•æ…‹è¼‰å…¥ -->
            </div>
            <button id="closeYijiDetailsBtn" class="action-button">é—œé–‰</button>
        </div>
    </div>

    <script>
        let lastSecondTensDigit = -1; // ç”¨æ–¼è¿½è¹¤ç§’æ•¸çš„åä½æ•¸ï¼Œä»¥è§¸ç™¼æ¯åç§’çš„éš¨æ©Ÿç§»å‹•
        let currentPosition = { x: 0, y: 0 }; // è¿½è¹¤æ™‚é–“é¡¯ç¤ºå…ƒç´ çš„ç•¶å‰ä½ç½®

        // é è¨­é¡¯ç¤ºè¨­å®šçš„åˆå§‹å€¼
        const defaultDisplaySettings = {
            showAmPm: false, // æ–°å¢ï¼šä¸Šåˆ/ä¸‹åˆ (AM/PM) é¡¯ç¤ºè¨­å®š
            showGregorianYear: true,
            showGregorianMonth: true,
            showGregorianDay: true,
            showGregorianWeekday: true,
            showMinguoYear: true,
            showLunarMonth: true,
            showLunarDay: true,
            showLunarShiChen: true,
            showJieqi: true, // é è¨­ç¯€æ°£é–‹å•Ÿ
            showHolidays: false, // é è¨­ç¯€æ—¥é—œé–‰
            textColor: '#00FF00', // ä¸»æ™‚é–“æ–‡å­—é¡è‰²è¨­å®š
            backgroundColor: '#000000', // èƒŒæ™¯é¡è‰²è¨­å®š
            // å€‹åˆ¥é¡¯ç¤ºé …ç›®çš„é è¨­é¡è‰²è¨­å®š
            gregorianYearColor: '#00FF00',
            gregorianMonthColor: '#00FF00',
            gregorianDayColor: '#00FF00',
            gregorianWeekdayColor: '#00FF00',
            minguoYearColor: '#00FF00',
            lunarMonthColor: '#00FF00',
            lunarDayColor: '#00FF00',
            lunarShiChenColor: '#00FF00',
            jieqiColor: '#00FF00',
            holidayColor: '#00FF00' // ç¯€æ—¥æ–‡å­—é¡è‰²è¨­å®š
        };

        // displaySettings å„²å­˜ç•¶å‰æ‡‰ç”¨æ–¼é¡¯ç¤ºçš„è¨­å®šã€‚
        // ä½¿ç”¨å±•é–‹é‹ç®—ç¬¦ (...) è¤‡è£½ defaultDisplaySettingsï¼Œç¢ºä¿ displaySettings ç¨ç«‹æ–¼é è¨­å€¼ï¼Œ
        // å…è¨±ç”¨æˆ¶ä¿®æ”¹ä¸¦å„²å­˜é€™äº›è¨­å®šè€Œä¸æœƒå½±éŸ¿åŸå§‹é è¨­å€¼ã€‚
        let displaySettings = { ...defaultDisplaySettings }; 

        /**
         * å°‡é¡¯ç¤ºè¨­å®šå„²å­˜åˆ° Cookie ä¸­ã€‚
         * å°‡ displaySettings ç‰©ä»¶è½‰æ›ç‚º JSON å­—ä¸²ä¸¦å„²å­˜åˆ°åç‚º 'displaySettings' çš„ Cookie ä¸­ã€‚
         * Cookie æœ‰æ•ˆæœŸè¨­å®šç‚º 365 å¤©ï¼Œä¸¦åœ¨æ•´å€‹ç¶²ç«™è·¯å¾‘ä¸‹å¯ç”¨ã€‚
         */
        function saveSettings() {
            const settingsJson = JSON.stringify(displaySettings);
            document.cookie = `displaySettings=${settingsJson}; expires=${new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toUTCString()}; path=/`;
        }

        /**
         * å¾ Cookie ä¸­è¼‰å…¥é¡¯ç¤ºè¨­å®šã€‚
         * è®€å– 'displaySettings' Cookieï¼Œè§£æ JSON å­—ä¸²ï¼Œä¸¦æ›´æ–° displaySettings ç‰©ä»¶ã€‚
         * å¦‚æœ Cookie ä¸å­˜åœ¨æˆ–è§£æå¤±æ•—ï¼Œå°‡ä¿ç•™ç•¶å‰çš„ displaySettingsï¼ˆé è¨­å€¼æˆ–ä¹‹å‰è¼‰å…¥çš„å€¼ï¼‰ã€‚
         * é€™ç¨®éæ­·ç¢ºä¿äº†å³ä½¿åœ¨ Cookie ä¸­ç¼ºå°‘æŸäº›è¨­å®šæ™‚ï¼Œæ–°çš„é è¨­å€¼ä¹Ÿèƒ½è¢«æ‡‰ç”¨ã€‚
         */
        function loadSettings() {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                let cookie = cookies[i].trim();
                if (cookie.startsWith('displaySettings=')) {
                    try {
                        const settingsJson = cookie.substring('displaySettings='.length);
                        const loadedSettings = JSON.parse(settingsJson);
                        // ä½¿ç”¨ Object.assign ä¾†åˆä½µè¼‰å…¥çš„è¨­å®šå’Œé è¨­è¨­å®šï¼Œç¢ºä¿æ–°å¢åŠ çš„è¨­å®šé …èƒ½è¢«æ­£ç¢ºåˆå§‹åŒ–
                        displaySettings = Object.assign({ ...defaultDisplaySettings }, loadedSettings);
                    } catch (e) {
                        console.error("Failed to parse display settings from cookie:", e);
                    }
                    return; // æ‰¾åˆ°ä¸¦è™•ç†å®Œ cookie å¾Œå°±è¿”å›
                }
            }
        }

        /**
         * æ›´æ–°è¨­å®šå½ˆå‡ºè¦–çª—ä¸­çš„æ‰€æœ‰ UI å…ƒç´ ï¼ˆé–‹é—œå’Œé¡è‰²é¸æ“‡å™¨ï¼‰ä»¥åŒ¹é…ç•¶å‰ displaySettingsã€‚
         */
        function updateSettingsModalCheckboxes() {
            document.getElementById('showAmPm').checked = displaySettings.showAmPm;
            document.getElementById('showGregorianYear').checked = displaySettings.showGregorianYear;
            document.getElementById('showGregorianMonth').checked = displaySettings.showGregorianMonth;
            document.getElementById('showGregorianDay').checked = displaySettings.showGregorianDay;
            document.getElementById('showGregorianWeekday').checked = displaySettings.showGregorianWeekday;
            document.getElementById('showMinguoYear').checked = displaySettings.showMinguoYear;
            document.getElementById('showLunarMonth').checked = displaySettings.showLunarMonth;
            document.getElementById('showLunarDay').checked = displaySettings.showLunarDay;
            document.getElementById('showLunarShiChen').checked = displaySettings.showLunarShiChen;
            document.getElementById('showJieqi').checked = displaySettings.showJieqi;
            document.getElementById('showHolidays').checked = displaySettings.showHolidays; // æ–°å¢

            document.getElementById('textColor').value = displaySettings.textColor;
            document.getElementById('backgroundColor').value = displaySettings.backgroundColor;

            document.getElementById('gregorianYearColor').value = displaySettings.gregorianYearColor;
            document.getElementById('gregorianMonthColor').value = displaySettings.gregorianMonthColor;
            document.getElementById('gregorianDayColor').value = displaySettings.gregorianDayColor;
            document.getElementById('gregorianWeekdayColor').value = displaySettings.gregorianWeekdayColor;
            document.getElementById('minguoYearColor').value = displaySettings.minguoYearColor;
            document.getElementById('lunarMonthColor').value = displaySettings.lunarMonthColor;
            document.getElementById('lunarDayColor').value = displaySettings.lunarDayColor;
            document.getElementById('lunarShiChenColor').value = displaySettings.lunarShiChenColor;
            document.getElementById('jieqiColor').value = displaySettings.jieqiColor;
            document.getElementById('holidayColor').value = displaySettings.holidayColor; // æ–°å¢
        }

        /**
         * å°‡ç”Ÿè‚–åç¨±è½‰æ›ç‚ºå°æ‡‰çš„ emojiã€‚
         * @param {string} shengXiaoName - ç”Ÿè‚–çš„ä¸­æ–‡åç¨±ã€‚
         * @returns {string} å°æ‡‰çš„ç”Ÿè‚– emojiã€‚
         */
        function getShengXiaoEmoji(shengXiaoName) {
            const emojiMap = {
                'é¼ ': 'ğŸ­',
                'ç‰›': 'ï¿½',
                'è™': 'ğŸ…',
                'å…”': 'ğŸ‡',
                'é¾': 'ğŸ‰',
                'è›‡': 'ğŸ',
                'é¦¬': 'ğŸ',
                'ç¾Š': 'ğŸ‘',
                'çŒ´': 'ğŸ’',
                'é›': 'ğŸ“',
                'ç‹—': 'ğŸ•',
                'è±¬': 'ğŸ–'
            };
            return emojiMap[shengXiaoName] || shengXiaoName; // å¦‚æœæ‰¾ä¸åˆ°å°æ‡‰çš„ emojiï¼Œå‰‡è¿”å›åŸå§‹åç¨±
        }

        /**
         * ç²å–ç¯€æ°£çš„è©³ç´°èªªæ˜ã€‚
         * @param {string} jieqiName - ç¯€æ°£çš„åç¨±ã€‚
         * @returns {string} ç¯€æ°£çš„è©³ç´°èªªæ˜ã€‚
         */
        function getJieqiDescription(jieqiName) {
            const descriptions = {
                'ç«‹æ˜¥': 'æ˜¥å­£é–‹å§‹ï¼Œè¬ç‰©å¾©ç”¦ï¼Œæ°£æº«å›å‡ã€‚',
                'é›¨æ°´': 'é™é›¨å¢å¤šï¼Œè‰æœ¨èŒå‹•ï¼Œæ˜¥è€•é–‹å§‹ã€‚',
                'é©šèŸ„': 'æ˜¥é›·éŸ¿å‹•ï¼Œé©šé†’å†¬çœ å‹•ç‰©ï¼Œæ°£æº«æ¼¸å‡ã€‚',
                'æ˜¥åˆ†': 'æ™å¤œç­‰é•·ï¼Œæ˜¥æ„ç›ç„¶ï¼Œå—åŒ—åŠçƒæ°£æº«è¶¨æ–¼å¹³è¡¡ã€‚',
                'æ¸…æ˜': 'æ°£å€™æ¸…çˆ½æ˜æœ—ï¼Œè¬ç‰©æ½”æ·¨ï¼Œæ˜¯æƒå¢“ç¥­ç¥–çš„æ—¥å­ã€‚',
                'ç©€é›¨': 'é›¨æ°´æ»‹æ½¤ï¼Œç©€ç‰©ç”Ÿé•·ï¼Œæ˜¯æ’­ç¨®ç§»è‹—çš„å¥½æ™‚ç¯€ã€‚',
                'ç«‹å¤': 'å¤å­£é–‹å§‹ï¼Œè¬ç‰©ç¹èŒ‚ï¼Œæ°£æº«æ˜é¡¯å‡é«˜ã€‚',
                'å°æ»¿': 'éº¥é¡ç­‰å¤ç†Ÿä½œç‰©ç±½ç²’é–‹å§‹é£½æ»¿ï¼Œä½†å°šæœªæˆç†Ÿã€‚',
                'èŠ’ç¨®': 'æœ‰èŠ’ä½œç‰©ï¼ˆå¦‚éº¥ã€ç¨»ï¼‰æˆç†Ÿï¼Œå¯ä»¥æ”¶ç©«å’Œæ’­ç¨®ã€‚',
                'å¤è‡³': 'åŒ—åŠçƒç™½æ™æœ€é•·ï¼Œé™½æ°£æœ€ç››ï¼Œæ˜¯ç››å¤çš„é–‹å§‹ã€‚',
                'å°æš‘': 'å¤©æ°£é–‹å§‹ç‚ç†±ï¼Œä½†é‚„æœªåˆ°æœ€ç†±çš„æ™‚å€™ã€‚',
                'å¤§æš‘': 'ä¸€å¹´ä¸­æœ€ç‚ç†±çš„æ™‚æœŸï¼Œæ¿•ç†±äº¤è’¸ã€‚',
                'ç«‹ç§‹': 'ç§‹å­£é–‹å§‹ï¼Œæ°£æº«é€æ¼¸ä¸‹é™ï¼Œä½†ä»æœ‰æš‘ç†±ã€‚',
                'è™•æš‘': 'æš‘æ°£æ¼¸é€€ï¼Œå¤©æ°£è½‰æ¶¼ï¼Œä½†ä»æœ‰ã€Œç§‹è€è™ã€ã€‚',
                'ç™½éœ²': 'å¤©æ°£è½‰æ¶¼ï¼Œæ°´æ°£å‡çµæˆéœ²ç ï¼Œå¤©æ°£æ¼¸å¯’ã€‚',
                'ç§‹åˆ†': 'æ™å¤œç­‰é•·ï¼Œç§‹é«˜æ°£çˆ½ï¼Œæ˜¯æ”¶ç©«çš„å­£ç¯€ã€‚',
                'å¯’éœ²': 'æ°£æº«æ›´ä½ï¼Œéœ²æ°´æ›´å¤šï¼Œå¤©æ°£è½‰å†·ã€‚',
                'éœœé™': 'å¤©æ°£æ¼¸å†·ï¼Œéœ²æ°´å‡çµæˆéœœï¼Œæ˜¯ç§‹å­£çš„æœ€å¾Œä¸€å€‹ç¯€æ°£ã€‚',
                'ç«‹å†¬': 'å†¬å­£é–‹å§‹ï¼Œè¬ç‰©æ”¶è—ï¼Œæ°£æº«é¡¯è‘—ä¸‹é™ã€‚',
                'å°é›ª': 'é–‹å§‹é™é›ªï¼Œä½†é›ªé‡ä¸å¤§ï¼Œæ°£æº«æŒçºŒèµ°ä½ã€‚',
                'å¤§é›ª': 'é™é›ªé‡å¢å¤šï¼Œå¤©æ°£æ›´å†·ï¼Œå†°å‡ç¾è±¡å¸¸è¦‹ã€‚',
                'å†¬è‡³': 'åŒ—åŠçƒç™½æ™æœ€çŸ­ï¼Œå¤œæ™šæœ€é•·ï¼Œæ˜¯æ•¸ä¹å¯’å¤©çš„é–‹å§‹ã€‚',
                'å°å¯’': 'å¤©æ°£å¯’å†·ï¼Œå°šæœªé”åˆ°æœ€å†·ã€‚',
                'å¤§å¯’': 'ä¸€å¹´ä¸­æœ€å¯’å†·çš„æ™‚æœŸï¼Œåš´å¯’å†°å‡ã€‚'
            };
            return descriptions[jieqiName] || 'æ­¤ç¯€æ°£ç„¡è©³ç´°èªªæ˜ã€‚';
        }

        /**
         * ç²å–æŒ‡å®šå¹´ä»½çš„ç¯€æ—¥åˆ—è¡¨ã€‚
         * åŒ…æ‹¬å…¬æ›†ç¯€æ—¥å’Œè¾²æ›†ç¯€æ—¥ï¼ˆè½‰æ›ç‚ºå…¬æ›†æ—¥æœŸï¼‰ã€‚
         * @param {number} year - è¦ç²å–ç¯€æ—¥çš„å¹´ä»½ã€‚
         * @returns {Array<Object>} ç¯€æ—¥åˆ—è¡¨ï¼Œæ¯å€‹ç‰©ä»¶åŒ…å« { name: string, date: Date }ã€‚
         */
        function getHolidays(year) {
            const holidays = [
                { name: 'å…ƒæ—¦', date: new Date(year, 0, 1) }, // Jan 1
                { name: 'å’Œå¹³', date: new Date(year, 1, 28) }, // Feb 28
                { name: 'å…’ç«¥', date: new Date(year, 3, 4) }, // Apr 4
                // æ¸…æ˜ç¯€é€šå¸¸åœ¨ 4/4 æˆ– 4/5ï¼Œé€™è£¡æš«æ™‚å¯«æ­» 4/4ï¼Œå¯¦éš›æ‡‰èˆ‡ç¯€æ°£è¨ˆç®—åŒæ­¥
                { name: 'æ¸…æ˜', date: new Date(year, 3, 4) }, // Apr 4
                { name: 'å‹å‹•', date: new Date(year, 4, 1) }, // May 1
                { name: 'åœ‹æ…¶', date: new Date(year, 9, 10) }, // Oct 10
                { name: 'è–èª•', date: new Date(year, 11, 25) } // Dec 25
            ];

            // è¾²æ›†æ–°å¹´ (æ ¹æ“š Lunar åº«ç²å–)
            const lunarNewYear = Lunar.fromYmd(year, 1, 1).getSolar();
            holidays.push({ name: 'éå¹´', date: new Date(lunarNewYear.getYear(), lunarNewYear.getMonth() - 1, lunarNewYear.getDay()) });

            // ç«¯åˆç¯€ (è¾²æ›†äº”æœˆåˆäº”)
            const dragonBoatFestival = Lunar.fromYmd(year, 5, 5).getSolar();
            holidays.push({ name: 'ç«¯åˆ', date: new Date(dragonBoatFestival.getYear(), dragonBoatFestival.getMonth() - 1, dragonBoatFestival.getDay()) });

            // ä¸­å…ƒç¯€ (è¾²æ›†ä¸ƒæœˆåäº”)
            const ghostFestival = Lunar.fromYmd(year, 7, 15).getSolar();
            holidays.push({ name: 'ä¸­å…ƒ', date: new Date(ghostFestival.getYear(), ghostFestival.getMonth() - 1, ghostFestival.getDay()) });

            // ä¸­ç§‹ç¯€ (è¾²æ›†å…«æœˆåäº”)
            const midAutumnFestival = Lunar.fromYmd(year, 8, 15).getSolar();
            holidays.push({ name: 'ä¸­ç§‹', date: new Date(midAutumnFestival.getYear(), midAutumnFestival.getMonth() - 1, midAutumnFestival.getDay()) });

            // é‡é™½ç¯€ (è¾²æ›†ä¹æœˆåˆä¹)
            const doubleNinthFestival = Lunar.fromYmd(year, 9, 9).getSolar();
            holidays.push({ name: 'é‡é™½', date: new Date(doubleNinthFestival.getYear(), doubleNinthFestival.getMonth() - 1, doubleNinthFestival.getDay()) });

            // é™¤å¤• (è¾²æ›†åäºŒæœˆæœ€å¾Œä¸€å¤©)
            // ç²å–ä¸‹ä¸€å€‹è¾²æ›†å¹´çš„ç¬¬ä¸€å¤©ï¼Œç„¶å¾Œå›æº¯ä¸€å¤©å¾—åˆ°ç•¶å¹´çš„é™¤å¤•
            const nextLunarNewYearSolar = Lunar.fromYmd(year + 1, 1, 1).getSolar();
            const chineseNewYearsEveDate = new Date(nextLunarNewYearSolar.getYear(), nextLunarNewYearSolar.getMonth() - 1, nextLunarNewYearSolar.getDay() - 1);
            holidays.push({ name: 'é™¤å¤•', date: chineseNewYearsEveDate });


            // æ’åºç¯€æ—¥ï¼Œç¢ºä¿æŒ‰æ—¥æœŸå‡åºæ’åˆ—
            holidays.sort((a, b) => a.date.getTime() - b.date.getTime());

            return holidays;
        }


        /**
         * æ ¹æ“šå°æ™‚ç²å–æ™‚è¾°ã€‚
         * @param {number} h - ç•¶å‰å°æ™‚ (0-23)ã€‚
         * @returns {string} å°æ‡‰çš„æ™‚è¾°å­—ä¸²ã€‚
         */
        function getShiChen(h) {
            if (h >= 23 || h < 1) return 'å­';
            if (h >= 1 && h < 3) return 'ä¸‘';
            if (h >= 3 && h < 5) return 'å¯…';
            if (h >= 5 && h < 7) return 'å¯';
            if (h >= 7 && h < 9) return 'è¾°';
            if (h >= 9 && h < 11) return 'å·³';
            if (h >= 11 && h < 13) return 'åˆ';
            if (h >= 13 && h < 15) return 'æœª';
            if (h >= 15 && h < 17) return 'ç”³';
            if (h >= 17 && h < 19) return 'é…‰';
            if (h >= 19 && h < 21) return 'æˆŒ';
            if (h >= 21 && h < 23) return 'äº¥';
            return '';
        }

        /**
         * æ ¹æ“šå°æ™‚ç²å–æ›´è©³ç´°çš„æ™‚é–“æ®µåç¨±ã€‚
         * @param {number} hour - ç•¶å‰å°æ™‚ (0-23)ã€‚
         * @returns {string} è©³ç´°çš„æ™‚é–“æ®µåç¨±ã€‚
         */
        function getDetailedTimePeriod(hour) {
            if (hour >= 0 && hour < 5) return 'å‡Œæ™¨';
            if (hour >= 5 && hour < 9) return 'æ¸…æ™¨';
            if (hour >= 9 && hour < 12) return 'ä¸Šåˆ';
            if (hour === 12) return 'ä¸­åˆ';
            if (hour > 12 && hour < 17) return 'ä¸‹åˆ';
            if (hour >= 17 && hour < 19) return 'å‚æ™š';
            if (hour >= 19 && hour < 23) return 'å¤œæ™š';
            if (hour === 23) return 'æ·±å¤œ';
            return '';
        }

        /**
         * æ›´æ–°æ™‚é–“ã€æ—¥æœŸã€è¾²æ›†å’Œç¯€æ°£çš„é¡¯ç¤ºã€‚
         * æ¯ç§’å‘¼å«ä¸€æ¬¡ï¼Œä¸¦åœ¨æ¯åç§’è§¸ç™¼ä¸€æ¬¡éš¨æ©Ÿç§»å‹•æ•ˆæœã€‚
         * æ ¹æ“š displaySettings ä¸­çš„å€¼å‹•æ…‹ç”Ÿæˆ HTML ä¸¦æ‡‰ç”¨é¡è‰²ã€‚
         */
        function updateDateTime() {
            const now = new Date(); // ç²å–ç•¶å‰æ—¥æœŸå’Œæ™‚é–“
            const currentSeconds = now.getSeconds(); // ç²å–ç•¶å‰ç§’æ•¸
            const secondTensDigit = Math.floor(currentSeconds / 10); // è¨ˆç®—ç§’æ•¸çš„åä½æ•¸

            // æ¯åç§’éš¨æ©Ÿç§»å‹•ä¸€æ¬¡
            if (secondTensDigit !== lastSecondTensDigit) {
                moveRandomly(); // å‘¼å«éš¨æ©Ÿç§»å‹•å‡½æ•¸
                lastSecondTensDigit = secondTensDigit; // æ›´æ–°ç§’æ•¸çš„åä½æ•¸
            }

            // æ ¼å¼åŒ–æ™‚é–“
            const timeOptions = {
                hour: 'numeric',
                minute: '2-digit',
                second: '2-digit',
                hour12: true // å§‹çµ‚ä½¿ç”¨ 12 å°æ™‚åˆ¶ä¾†ç²å–å°æ™‚å’Œ AM/PMï¼Œä»¥ä¾¿å¾ŒçºŒåˆ¤æ–·è©³ç´°æ™‚é–“æ®µ
            };
            
            const formatter = new Intl.DateTimeFormat('zh-Hant', timeOptions);
            const parts = formatter.formatToParts(now);

            let hoursMinutes = '';
            let seconds = '';
            let amPmText = ''; // ç”¨æ–¼å„²å­˜ä¸Šåˆ/ä¸‹åˆ/è©³ç´°æ™‚é–“æ®µæ–‡å­—

            const hourPart = parts.find(p => p.type === 'hour')?.value.padStart(2, '0') || '00';
            const minutePart = parts.find(p => p.type === 'minute')?.value || '00';
            const secondPart = parts.find(p => p.type === 'second')?.value || '00';
            
            hoursMinutes = `${hourPart}:${minutePart}`;
            seconds = secondPart;
            
            // æ ¹æ“šè¨­å®šæ±ºå®šé¡¯ç¤ºä¸Šåˆ/ä¸‹åˆæˆ–æ›´è©³ç´°çš„æ™‚é–“æ®µ
            if (displaySettings.showAmPm) {
                const currentHour24 = now.getHours(); // ç²å– 24 å°æ™‚åˆ¶çš„å°æ™‚
                amPmText = getDetailedTimePeriod(currentHour24);
            }


            // å…¬æ›†æ—¥æœŸé‚è¼¯
            let gregorianDateHtml = '';
            if (displaySettings.showGregorianYear || displaySettings.showGregorianMonth || displaySettings.showGregorianDay || displaySettings.showGregorianWeekday) {
                const year = now.getFullYear();
                // å°‡æœˆä»½å’Œæ—¥æœŸè£œè¶³å…©ä½æ•¸
                const month = (now.getMonth() + 1).toString().padStart(2, '0');
                const day = now.getDate().toString().padStart(2, '0');
                const weekday = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][now.getDay()];

                let gregorianParts = [];
                if (displaySettings.showGregorianYear) gregorianParts.push(`<span style="color: ${displaySettings.gregorianYearColor};">${year}å¹´</span>`);
                if (displaySettings.showGregorianMonth) gregorianParts.push(`<span style="color: ${displaySettings.gregorianMonthColor};">${month}æœˆ</span>`);
                if (displaySettings.showGregorianDay) gregorianParts.push(`<span style="color: ${displaySettings.gregorianDayColor};">${day}æ—¥</span>`);
                if (displaySettings.showGregorianWeekday) gregorianParts.push(`<span style="color: ${displaySettings.gregorianWeekdayColor};">å‘¨${weekday}</span>`);

                if (gregorianParts.length > 0) {
                    gregorianDateHtml = `<div class="gregorian-date-text">${gregorianParts.join('')}</div>`;
                }
            }

            // è¾²æ›†å’Œç¯€æ°£é‚è¼¯ (åƒ…åœ¨ lunar-javascript å‡½å¼åº«è¼‰å…¥æˆåŠŸæ™‚åŸ·è¡Œ)
            let lunarAndJieQiHtml = '';
            let currentJieqiInfo = null; // ç”¨æ–¼å„²å­˜ç•¶å‰æˆ–ä¸‹ä¸€å€‹ç¯€æ°£çš„å®Œæ•´è³‡è¨Š
            let nextHolidayInfo = null; // ç”¨æ–¼å„²å­˜ä¸‹ä¸€å€‹å³å°‡åˆ°ä¾†çš„ç¯€æ—¥è³‡è¨Š (for modal)
            let currentHolidayName = ''; // ç”¨æ–¼å„²å­˜ç•¶å¤©çš„ç¯€æ—¥åç¨± (for modal)

            if ((displaySettings.showMinguoYear || displaySettings.showLunarMonth || displaySettings.showLunarDay || displaySettings.showLunarShiChen || displaySettings.showJieqi || displaySettings.showHolidays) && typeof Lunar !== 'undefined' && typeof Solar !== 'undefined') {
                const year = now.getFullYear();
                const hour = now.getHours();
                const minguoYear = year - 1911;

                const solar = Solar.fromDate(now); // ä½¿ç”¨ Solar.fromDate(now) ç²å–ç•¶å‰æ—¥æœŸçš„é™½æ›†ç‰©ä»¶
                const lunar = solar.getLunar(); // æ ¹æ“šé™½æ›†ç‰©ä»¶ç²å–è¾²æ›†ç‰©ä»¶

                let lunarParts = [];
                if (displaySettings.showMinguoYear) {
                    const shengXiaoEmoji = getShengXiaoEmoji(lunar.getYearShengXiao());
                    lunarParts.push(`<span style="color: ${displaySettings.minguoYearColor};">${minguoYear}å¹´${shengXiaoEmoji}</span>`);
                }
                if (displaySettings.showLunarMonth) lunarParts.push(`<span style="color: ${displaySettings.lunarMonthColor};">${lunar.getMonthInChinese().replace('é—°', 'é–')}æœˆ</span>`);
                if (displaySettings.showLunarDay) lunarParts.push(`<span id="lunarDayDisplay" class="lunar-date-clickable" style="color: ${displaySettings.lunarDayColor};">${lunar.getDayInChinese()}</span>`); // æ·»åŠ  ID å’Œ class
                if (displaySettings.showLunarShiChen) lunarParts.push(`<span id="lunarShiChenDisplay" class="lunar-shichen-clickable" style="color: ${displaySettings.lunarShiChenColor};">${getShiChen(hour)}æ™‚</span>`); // æ·»åŠ  ID å’Œ class
                
                let lunarDateString = lunarParts.join('');

                // ç¯€æ°£è¨ˆç®— (ç„¡è«–é–‹é—œæ˜¯å¦é–‹å•Ÿï¼Œéƒ½è¨ˆç®— currentJieqiInfo)
                const solarToday = Solar.fromDate(now);
                const jieQisForYear = solarToday.getLunar().getJieQiTable();

                let tempJieqiName = ''; // ç”¨æ–¼æš«å­˜è¨ˆç®—å‡ºçš„ç¯€æ°£åç¨±
                let tempJieqiDate = null; // ç”¨æ–¼æš«å­˜è¨ˆç®—å‡ºçš„ç¯€æ°£æ—¥æœŸ
                let tempDaysUntilNextJieqi = -1; // ç”¨æ–¼æš«å­˜è·é›¢ä¸‹å€‹ç¯€æ°£çš„å¤©æ•¸

                // å°‡ç¯€æ°£è¡¨è½‰æ›ç‚ºç‰©ä»¶é™£åˆ—ï¼Œä»¥ä¾¿æ–¼è™•ç†å’Œæ’åº
                const allJieqis = Object.entries(jieQisForYear).map(([name, dateStr]) => {
                    return { name: name, date: new Date(dateStr) };
                }).sort((a, b) => a.date.getTime() - b.date.getTime()); // æ ¹æ“šæ—¥æœŸæ’åº

                let foundTodayJieqi = false;
                for (const jq of allJieqis) {
                    // æª¢æŸ¥ä»Šå¤©æ˜¯å¦ç‚ºæ­¤ç¯€æ°£çš„æ—¥æœŸï¼ˆå¿½ç•¥æ™‚é–“ï¼‰
                    if (jq.date.getFullYear() === now.getFullYear() &&
                        jq.date.getMonth() === now.getMonth() &&
                        jq.date.getDate() === now.getDate()) {
                        tempJieqiName = jq.name;
                        tempJieqiDate = jq.date;
                        foundTodayJieqi = true;
                        break; // æ‰¾åˆ°ä»Šå¤©çš„ç¯€æ°£
                    }
                }

                if (!foundTodayJieqi) {
                    // å¦‚æœä»Šå¤©ä¸æ˜¯ç¯€æ°£æ—¥ï¼Œå‰‡å°‹æ‰¾ä¸‹ä¸€å€‹å³å°‡åˆ°ä¾†çš„ç¯€æ°£
                    for (const jq of allJieqis) {
                        // è¨­ç½® jq.date çš„æ™‚é–“ç‚ºç•¶å¤©çµæŸï¼Œä»¥ä¾¿æ­£ç¢ºè¨ˆç®—å¤©æ•¸
                        const jqDateAtEndOfDay = new Date(jq.date.getFullYear(), jq.date.getMonth(), jq.date.getDate(), 23, 59, 59, 999);
                        if (jqDateAtEndOfDay > now) { 
                            const diffTime = jqDateAtEndOfDay.getTime() - now.getTime();
                            tempDaysUntilNextJieqi = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                            tempJieqiName = jq.name;
                            tempJieqiDate = jq.date;
                            break; // æ‰¾åˆ°ç¬¬ä¸€å€‹æœªä¾†çš„ç¯€æ°£
                        }
                    }
                }
                // å°‡è¨ˆç®—å‡ºçš„ç¯€æ°£è³‡è¨Šå„²å­˜åˆ° currentJieqiInfo
                if (tempJieqiName && tempJieqiDate) {
                    currentJieqiInfo = { name: tempJieqiName, date: tempJieqiDate };
                }

                let jieQiText = '';
                if (displaySettings.showJieqi) { // åªæœ‰ç•¶ç¯€æ°£é–‹é—œé–‹å•Ÿæ™‚æ‰é¡¯ç¤º
                    if (foundTodayJieqi) {
                        jieQiText = `${tempJieqiName}`;
                    } else if (tempJieqiName && tempDaysUntilNextJieqi !== -1) {
                        jieQiText = `${tempDaysUntilNextJieqi}â¡${tempJieqiName}`;
                    }
                }

                // --- START: Unconditional Holiday Data Calculation for Modal ---
                const holidays = getHolidays(now.getFullYear());
                let foundTodayHoliday = false;

                for (const holiday of holidays) {
                    if (holiday.date.getFullYear() === now.getFullYear() &&
                        holiday.date.getMonth() === now.getMonth() &&
                        holiday.date.getDate() === now.getDate()) {
                        currentHolidayName = holiday.name; // Always store current holiday name
                        foundTodayHoliday = true;
                        break;
                    }
                }

                if (!foundTodayHoliday) { // Only search for next upcoming holiday if today is NOT a holiday
                    const tomorrow = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
                    for (const holiday of holidays) {
                        const holidayDateAtEndOfDay = new Date(holiday.date.getFullYear(), holiday.date.getMonth(), holiday.date.getDate(), 23, 59, 59, 999);
                        if (holidayDateAtEndOfDay >= tomorrow) {
                            const diffTime = holidayDateAtEndOfDay.getTime() - now.getTime();
                            nextHolidayInfo = { // Always populate nextHolidayInfo if applicable
                                name: holiday.name,
                                date: holiday.date,
                                daysUntil: Math.ceil(diffTime / (1000 * 60 * 60 * 24))
                            };
                            break;
                        }
                    }
                }
                // --- END: Unconditional Holiday Data Calculation for Modal ---


                let holidayCountdownText = ''; // This is for the main display
                if (displaySettings.showHolidays) { // Only display on main screen if setting is ON
                    if (foundTodayHoliday) {
                        holidayCountdownText = `${currentHolidayName}`; // Only name, no countdown
                    } else if (nextHolidayInfo) { // If no current holiday, and nextHolidayInfo exists
                        holidayCountdownText = `${nextHolidayInfo.daysUntil}â¡${nextHolidayInfo.name}`;
                    }
                }


                let combinedJieqiHolidayText = '';
                // ç§»é™¤ç¯€æ°£å’Œç¯€æ—¥ä¹‹é–“çš„ç©ºæ ¼
                if (jieQiText && holidayCountdownText) { // å…©è€…éƒ½æœ‰é¡¯ç¤ºæ™‚æ‰çµ„åˆ
                    combinedJieqiHolidayText = `<span style="color: ${displaySettings.jieqiColor};">${jieQiText}</span><span style="color: ${displaySettings.holidayColor};">${holidayCountdownText}</span>`;
                } else if (jieQiText) { // åªæœ‰ç¯€æ°£
                    combinedJieqiHolidayText = `<span style="color: ${displaySettings.jieqiColor};">${jieQiText}</span>`;
                } else if (holidayCountdownText) { // åªæœ‰ç¯€æ—¥ï¼ˆç•¶å¤©ç¯€æ—¥æˆ–å€’æ•¸ï¼‰
                    combinedJieqiHolidayText = `<span style="color: ${displaySettings.holidayColor};">${holidayCountdownText}</span>`;
                }


                if (lunarDateString || combinedJieqiHolidayText) {
                    lunarAndJieQiHtml = `
                        <div class="lunar-jieqi-combined-text">
                            ${lunarDateString}<span id="jieqiDisplay" class="jieqi-clickable"
                                data-jieqi-name="${currentJieqiInfo ? currentJieqiInfo.name : ''}" 
                                data-jieqi-date="${currentJieqiInfo ? currentJieqiInfo.date.toISOString() : ''}"
                                data-next-holiday-name="${nextHolidayInfo ? nextHolidayInfo.name : ''}"
                                data-next-holiday-date="${nextHolidayInfo ? nextHolidayInfo.date.toISOString() : ''}"
                                data-next-holiday-days-until="${nextHolidayInfo ? nextHolidayInfo.daysUntil : ''}"
                                data-current-holiday-name="${currentHolidayName}"
                            >${combinedJieqiHolidayText}</span>
                        </div>
                    `;
                }
            }

            // æ›´æ–°ç•«é¢
            const dateTimeDisplay = document.getElementById('dateTimeDisplay');
            dateTimeDisplay.innerHTML = `
                <div class="time-text" style="color: ${displaySettings.textColor};">
                    <span>${hoursMinutes}</span>
                    <span class="time-seconds" id="secondsDisplay">${seconds}</span>
                    ${amPmText ? `<span class="time-ampm">${amPmText}</span>` : ''}
                </div>
                ${gregorianDateHtml}
                ${lunarAndJieQiHtml}
            `;
            document.body.style.backgroundColor = displaySettings.backgroundColor; // æ‡‰ç”¨èƒŒæ™¯é¡è‰²
        }

        /**
         * ä½¿æ™‚é–“é¡¯ç¤ºå…ƒç´ åœ¨è¢å¹•ä¸Šéš¨æ©Ÿç§»å‹•ã€‚
         * ç§»å‹•ç¯„åœå—é™æ–¼å®‰å…¨é‚Šç•Œï¼Œä»¥ç¢ºä¿å…ƒç´ ä¸æœƒç§»å‡ºè¦–çª—ã€‚
         */
        function moveRandomly() {
            const displayElement = document.getElementById('dateTimeDisplay'); // ç²å–æ™‚é–“é¡¯ç¤ºå…ƒç´ 
            const viewportWidth = window.innerWidth; // ç²å–è¦–çª—å¯¬åº¦
            const viewportHeight = window.innerHeight; // ç²å–è¦–çª—é«˜åº¦
            const elementRect = displayElement.getBoundingClientRect(); // ç²å–å…ƒç´ çš„å¤§å°å’Œä½ç½®
            const elementWidth = elementRect.width; // å…ƒç´ å¯¬åº¦
            const elementHeight = elementRect.height; // å…ƒç´ é«˜åº¦
            const safeMargin = 20; // å…ƒç´ è·é›¢è¦–çª—é‚Šç·£çš„å®‰å…¨é‚Šè·
            const smallOffsetRange = 40; // æ¯æ¬¡éš¨æ©Ÿç§»å‹•çš„ç¯„åœ

            let currentX = currentPosition.x; // ç•¶å‰ X åº§æ¨™
            let currentY = currentPosition.y; // ç•¶å‰ Y åº§æ¨™

            // è¨ˆç®—éš¨æ©Ÿåç§»é‡
            const offsetX = (Math.random() * 2 - 1) * smallOffsetRange; // X è»¸éš¨æ©Ÿåç§»é‡
            const offsetY = (Math.random() * 2 - 1) * smallOffsetRange; // Y è»¸éš¨æ©Ÿåç§»é‡

            let newTargetX = currentX + offsetX; // æ–°çš„ç›®æ¨™ X åº§æ¨™
            let newTargetY = currentY + offsetY; // æ–°çš„ç›®æ¨™ Y åº§æ¨™

            // è¨ˆç®—å…è¨±çš„ç§»å‹•ç¯„åœï¼Œç¢ºä¿å…ƒç´ ä¸æœƒç§»å‡ºè¦–çª—
            const minAllowedX = - (viewportWidth / 2) + (elementWidth / 2) + safeMargin;
            const minAllowedY = - (viewportHeight / 2) + (elementHeight / 2) + safeMargin;
            const maxAllowedX = (viewportWidth / 2) - (elementWidth / 2) - safeMargin;
            const maxAllowedY = (viewportHeight / 2) - (elementHeight / 2) - safeMargin;

            // å°‡æ–°çš„ç›®æ¨™ä½ç½®é™åˆ¶åœ¨å…è¨±çš„ç¯„åœå…§
            newTargetX = Math.max(minAllowedX, Math.min(newTargetX, maxAllowedX));
            newTargetY = Math.max(minAllowedY, Math.min(newTargetY, maxAllowedY));

            // æ›´æ–°ç•¶å‰ä½ç½®ä¸¦æ‡‰ç”¨ CSS è®Šæ›
            currentPosition.x = newTargetX;
            currentPosition.y = newTargetY;
            // èª¿æ•´ transform ç¢ºä¿å±…ä¸­ï¼Œå› ç‚ºå…§å®¹é«˜åº¦å¯èƒ½æœƒå› é¡¯ç¤ºè¨­å®šè€Œè®ŠåŒ–
            displayElement.style.transform = `translate(calc(-50% + ${newTargetX}px), calc(-72% + ${newTargetY}px))`;
        }

        /**
         * å°‡æ‰€æœ‰è¨­å®šæ¢å¾©ç‚ºé è¨­å€¼ã€‚
         * å°‡ displaySettings é‡ç½®ç‚º defaultDisplaySettings çš„å‰¯æœ¬ï¼Œç„¶å¾Œå„²å­˜ä¸¦æ›´æ–° UIã€‚
         */
        function restoreDefaults() {
            displaySettings = { ...defaultDisplaySettings }; // å°‡ç•¶å‰è¨­å®šé‡ç½®ç‚ºé è¨­å€¼
            saveSettings(); // å„²å­˜é è¨­è¨­å®š
            updateSettingsModalCheckboxes(); // æ›´æ–°è¨­å®šè¦–çª—ä¸­çš„é¡¯ç¤º
            updateDateTime(); // æ›´æ–°ä¸»ç•«é¢é¡¯ç¤º
        }

        /**
         * ç”Ÿæˆä¸€å€‹éš¨æ©Ÿçš„åå…­é€²åˆ¶é¡è‰²ç¢¼ã€‚
         * @returns {string} éš¨æ©Ÿçš„åå…­é€²åˆ¶é¡è‰²ç¢¼ï¼Œä¾‹å¦‚ '#RRGGBB'ã€‚
         */
        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        /**
         * éš¨æ©Ÿè¨­å®šæ‰€æœ‰é¡è‰²é¸é …çš„é¡è‰²ã€‚
         * æ›´æ–° displaySettings ä¸­çš„æ‰€æœ‰é¡è‰²å±¬æ€§ç‚ºéš¨æ©Ÿé¡è‰²ï¼Œç„¶å¾Œå„²å­˜ä¸¦æ›´æ–° UIã€‚
         */
        function setRandomColors() {
            displaySettings.textColor = getRandomColor();
            displaySettings.backgroundColor = getRandomColor();
            displaySettings.gregorianYearColor = getRandomColor();
            displaySettings.gregorianMonthColor = getRandomColor();
            displaySettings.gregorianDayColor = getRandomColor();
            displaySettings.gregorianWeekdayColor = getRandomColor();
            displaySettings.minguoYearColor = getRandomColor();
            displaySettings.lunarMonthColor = getRandomColor();
            displaySettings.lunarDayColor = getRandomColor();
            displaySettings.lunarShiChenColor = getRandomColor();
            displaySettings.jieqiColor = getRandomColor();
            displaySettings.holidayColor = getRandomColor(); // æ–°å¢

            saveSettings(); // å„²å­˜æ–°çš„éš¨æ©Ÿé¡è‰²è¨­å®š
            updateSettingsModalCheckboxes(); // æ›´æ–°è¨­å®šè¦–çª—ä¸­çš„é¡¯ç¤º
            updateDateTime(); // æ›´æ–°ä¸»ç•«é¢é¡¯ç¤º
        }


        // é é¢è¼‰å…¥å¾Œé–‹å§‹æ›´æ–°æ™‚é–“
        window.onload = function () {
            loadSettings(); // è¼‰å…¥ä¹‹å‰å„²å­˜çš„è¨­å®š
            updateSettingsModalCheckboxes(); // åœ¨è¼‰å…¥è¨­å®šå¾Œç«‹å³æ›´æ–°è¨­å®šè¦–çª—ä¸­çš„é–‹é—œç‹€æ…‹
            currentPosition = { x: 0, y: 0 }; // åˆå§‹åŒ–å…ƒç´ ä½ç½®
            setInterval(updateDateTime, 1000); // æ¯ç§’æ›´æ–°ä¸€æ¬¡
            updateDateTime(); // ç«‹å³æ›´æ–°ä¸€æ¬¡ä»¥é¿å…å»¶é²

            // è¨­å®šå½ˆå‡ºè¦–çª—çš„ã€Œå®Œæˆã€æŒ‰éˆ•äº‹ä»¶ï¼Œé»æ“Šå¾Œé—œé–‰å½ˆå‡ºè¦–çª—
            document.getElementById('doneBtn').onclick = function() {
                document.getElementById('settingsModal').classList.remove('is-active'); // ä½¿ç”¨ classList.remove
            };

            // ç¯€æ°£è©³ç´°è³‡æ–™å½ˆå‡ºè¦–çª—çš„ã€Œé—œé–‰ã€æŒ‰éˆ•äº‹ä»¶
            document.getElementById('closeJieqiDetailsBtn').onclick = function() {
                document.getElementById('jieqiDetailsModal').classList.remove('is-active'); // ä½¿ç”¨ classList.remove
            };

            // æ¯æ—¥å®œå¿Œå½ˆå‡ºè¦–çª—çš„ã€Œé—œé–‰ã€æŒ‰éˆ•äº‹ä»¶
            document.getElementById('closeYijiDetailsBtn').onclick = function() {
                document.getElementById('yijiDetailsModal').classList.remove('is-active'); // ä½¿ç”¨ classList.remove
            };

            // è¨­å®šé¸é …çš„è®Šæ›´äº‹ä»¶
            // æ¯ç•¶ä»»ä½•é–‹é—œæˆ–é¡è‰²é¸æ“‡å™¨æ”¹è®Šæ™‚ï¼Œéƒ½æœƒæ›´æ–° displaySettingsï¼Œå„²å­˜è¨­å®šä¸¦æ›´æ–°é¡¯ç¤ºã€‚
            document.getElementById('showAmPm').onchange = function(event) {
                displaySettings.showAmPm = event.target.checked;
                saveSettings();
                updateDateTime();
            };
            document.getElementById('showGregorianYear').onchange = function(event) {
                displaySettings.showGregorianYear = event.target.checked;
                saveSettings();
                updateDateTime();
            };
            document.getElementById('showGregorianMonth').onchange = function(event) {
                displaySettings.showGregorianMonth = event.target.checked;
                saveSettings();
                updateDateTime();
            };
            document.getElementById('showGregorianDay').onchange = function(event) {
                displaySettings.showGregorianDay = event.target.checked;
                saveSettings();
                updateDateTime();
            };
            document.getElementById('showGregorianWeekday').onchange = function(event) {
                displaySettings.showGregorianWeekday = event.target.checked;
                saveSettings();
                updateDateTime();
            };
            document.getElementById('showMinguoYear').onchange = function(event) {
                displaySettings.showMinguoYear = event.target.checked;
                saveSettings();
                updateDateTime();
            };
            document.getElementById('showLunarMonth').onchange = function(event) {
                displaySettings.showLunarMonth = event.target.checked; // ä¿®æ­£ï¼šæ‡‰ç‚º checked
                saveSettings();
                updateDateTime();
            };
            document.getElementById('showLunarDay').onchange = function(event) {
                displaySettings.showLunarDay = event.target.checked;
                saveSettings();
                updateDateTime();
            };
            document.getElementById('showLunarShiChen').onchange = function(event) {
                displaySettings.showLunarShiChen = event.target.checked;
                saveSettings();
                updateDateTime();
            };
            
            // ç¯€æ°£å’Œç¯€æ—¥äº’æ–¥é‚è¼¯
            document.getElementById('showJieqi').onchange = function(event) {
                displaySettings.showJieqi = event.target.checked;
                if (event.target.checked) {
                    displaySettings.showHolidays = false;
                    document.getElementById('showHolidays').checked = false; // æ›´æ–° UI
                }
                saveSettings();
                updateDateTime();
            };
            document.getElementById('showHolidays').onchange = function(event) { // æ–°å¢
                displaySettings.showHolidays = event.target.checked;
                if (event.target.checked) {
                    displaySettings.showJieqi = false;
                    document.getElementById('showJieqi').checked = false; // æ›´æ–° UI
                }
                saveSettings();
                updateDateTime();
            };

            document.getElementById('textColor').onchange = function(event) {
                displaySettings.textColor = event.target.value;
                saveSettings();
                updateDateTime();
            };
            document.getElementById('backgroundColor').onchange = function(event) {
                displaySettings.backgroundColor = event.target.value;
                saveSettings();
                updateDateTime();
            };

            document.getElementById('gregorianYearColor').onchange = function(event) {
                displaySettings.gregorianYearColor = event.target.value;
                saveSettings();
                updateDateTime();
            };
            document.getElementById('gregorianMonthColor').onchange = function(event) {
                displaySettings.gregorianMonthColor = event.target.value;
                saveSettings();
                updateDateTime();
            };
            document.getElementById('gregorianDayColor').onchange = function(event) {
                displaySettings.gregorianDayColor = event.target.value;
                saveSettings();
                updateDateTime();
            };
            document.getElementById('gregorianWeekdayColor').onchange = function(event) {
                displaySettings.gregorianWeekdayColor = event.target.value;
                saveSettings();
                updateDateTime();
            };
            document.getElementById('minguoYearColor').onchange = function(event) {
                displaySettings.minguoYearColor = event.target.value;
                saveSettings();
                updateDateTime();
            };
            document.getElementById('lunarMonthColor').onchange = function(event) {
                displaySettings.lunarMonthColor = event.target.value;
                saveSettings();
                updateDateTime();
            };
            document.getElementById('lunarDayColor').onchange = function(event) {
                displaySettings.lunarDayColor = event.target.value;
                saveSettings();
                updateDateTime();
            };
            document.getElementById('lunarShiChenColor').onchange = function(event) {
                displaySettings.lunarShiChenColor = event.target.value;
                saveSettings();
                updateDateTime();
            };
            document.getElementById('jieqiColor').onchange = function(event) {
                displaySettings.jieqiColor = event.target.value;
                saveSettings();
                updateDateTime();
            };
            document.getElementById('holidayColor').onchange = function(event) { // æ–°å¢
                displaySettings.holidayColor = event.target.value;
                saveSettings();
                updateDateTime();
            };

            // æ¢å¾©é è¨­æŒ‰éˆ•äº‹ä»¶
            document.getElementById('restoreDefaultsBtn').onclick = restoreDefaults;
            // æ–°å¢éš¨æ©Ÿé¡è‰²æŒ‰éˆ•äº‹ä»¶
            document.getElementById('randomColorsBtn').onclick = setRandomColors;

            // ä½¿ç”¨äº‹ä»¶å§”æ´¾è™•ç†æ‰€æœ‰å‹•æ…‹ç”Ÿæˆçš„å¯é»æ“Šå…ƒç´ 
            document.getElementById('dateTimeDisplay').addEventListener('click', function(event) {
                const now = new Date();
                const solar = Solar.fromDate(now);
                const lunar = solar.getLunar();

                const secondsElement = event.target.closest('#secondsDisplay');
                const jieqiElement = event.target.closest('#jieqiDisplay');
                const lunarDayElement = event.target.closest('#lunarDayDisplay');
                const lunarShiChenElement = event.target.closest('#lunarShiChenDisplay');

                if (secondsElement) {
                    document.getElementById('settingsModal').classList.add('is-active');
                    updateSettingsModalCheckboxes();
                } else if (jieqiElement) {
                    // å¾ data å±¬æ€§ä¸­ç²å–è³‡è¨Š
                    const jieqiName = jieqiElement.getAttribute('data-jieqi-name');
                    const jieqiDateStr = jieqiElement.getAttribute('data-jieqi-date');
                    
                    const nextHolidayName = jieqiElement.getAttribute('data-next-holiday-name');
                    const nextHolidayDateStr = jieqiElement.getAttribute('data-next-holiday-date');
                    const nextHolidayDaysUntil = jieqiElement.getAttribute('data-next-holiday-days-until');
                    const currentHolidayNameFromData = jieqiElement.getAttribute('data-current-holiday-name'); // å¾ data å±¬æ€§ç²å–ç•¶å‰ç¯€æ—¥åç¨±

                    let detailsHtml = '';

                    // ç¯€æ°£è³‡è¨Š (ç„¡è«– showJieqi è¨­å®šå¦‚ä½•ï¼Œéƒ½é¡¯ç¤º)
                    if (jieqiName && jieqiDateStr) {
                        const jieqiDate = new Date(jieqiDateStr);
                        const formattedDate = `${jieqiDate.getFullYear()}å¹´${(jieqiDate.getMonth() + 1).toString().padStart(2, '0')}æœˆ${jieqiDate.getDate().toString().padStart(2, '0')}æ—¥`;
                        const description = getJieqiDescription(jieqiName);
                        detailsHtml += `
                            <h3>ç¯€æ°£è³‡è¨Š</h3>
                            <p><strong>ç¯€æ°£åç¨±ï¼š</strong> ${jieqiName}</p>
                            <p><strong>å…¬æ›†æ—¥æœŸï¼š</strong> ${formattedDate}</p>
                            <p style="margin-top: 15px;"><strong>èªªæ˜ï¼š</strong> ${description}</p>
                            <p style="margin-top: 15px; font-size: 0.9em; color: #aaa;">
                                ç¯€æ°£æ˜¯ä¸­åœ‹å‚³çµ±æ›†æ³•ä¸­ç”¨æ–¼æŒ‡å°è¾²äº‹çš„è£œå……æ›†æ³•ï¼Œåæ˜ äº†åœ°çƒåœ¨å…¬è½‰è»Œé“ä¸Šçš„ä½ç½®è®ŠåŒ–ã€‚
                                â€»å›ºå®šåœ¨æ—©ä¸Šå…«é»è¾°æ™‚æ›´æ–°
                            </p>
                            <hr style="margin: 20px 0; border-color: #555;">
                        `;
                    } else {
                        detailsHtml += `<p>ç›®å‰æ²’æœ‰ç¯€æ°£è³‡è¨Šå¯é¡¯ç¤ºã€‚</p><hr style="margin: 20px 0; border-color: #555;">`;
                    }

                    // ç¯€æ—¥è³‡è¨Š (ç„¡è«– showHolidays è¨­å®šå¦‚ä½•ï¼Œéƒ½é¡¯ç¤º)
                    // å¦‚æœç•¶å¤©æœ‰ç¯€æ—¥ï¼Œå‰‡åªé¡¯ç¤ºç•¶å¤©ç¯€æ—¥è³‡è¨Šï¼Œä¸é¡¯ç¤ºå³å°‡åˆ°ä¾†çš„ç¯€æ—¥
                    if (currentHolidayNameFromData) {
                        detailsHtml += `
                            <h3>ä»Šæ—¥ç¯€æ—¥</h3>
                            <p><strong>ç¯€æ—¥åç¨±ï¼š</strong> ${currentHolidayNameFromData}</p>
                        `;
                    } else if (nextHolidayName && nextHolidayDateStr && nextHolidayDaysUntil) {
                        const nextHolidayDate = new Date(nextHolidayDateStr);
                        const formattedHolidayDate = `${nextHolidayDate.getFullYear()}å¹´${(nextHolidayDate.getMonth() + 1).toString().padStart(2, '0')}æœˆ${nextHolidayDate.getDate().toString().padStart(2, '0')}æ—¥`;
                        detailsHtml += `
                            <h3>å³å°‡åˆ°ä¾†çš„ç¯€æ—¥</h3>
                            <p><strong>ç¯€æ—¥åç¨±ï¼š</strong> ${nextHolidayName}</p>
                            <p><strong>å…¬æ›†æ—¥æœŸï¼š</strong> ${formattedHolidayDate}</p>
                            <p><strong>å€’æ•¸ï¼š</strong> é‚„æœ‰ ${nextHolidayDaysUntil} å¤©</p>
                        `;
                    } else {
                        detailsHtml += `<p>ç›®å‰æ²’æœ‰å³å°‡åˆ°ä¾†çš„ç¯€æ—¥è³‡è¨Šã€‚</p>`;
                    }

                    document.getElementById('jieqiDetailsContent').innerHTML = detailsHtml;
                    document.getElementById('jieqiDetailsModal').classList.add('is-active');
                } else if (lunarDayElement) {
                    const yiList = lunar.getDayYi() || [];
                    const jiList = lunar.getDayJi() || [];

                    let yijiHtml = `
                        <p><strong>è¾²æ›†æ—¥æœŸï¼š</strong> ${lunar.getMonthInChinese().replace('é—°', 'é–')}æœˆ${lunar.getDayInChinese()}</p>
                        <p style="margin-top: 15px;"><strong>å®œï¼š</strong> ${yiList.join('ã€')}</p>
                        <p style="margin-top: 15px;"><strong>å¿Œï¼šï¼š</strong> ${jiList.join('ã€')}</p>
                        <p style="margin-top: 15px; font-size: 0.9em; color: #aaa;">
                            æ¯æ—¥å®œå¿Œåƒ…ä¾›åƒè€ƒï¼Œè«‹å‹¿éåº¦è¿·ä¿¡ã€‚
                        </p>
                    `;
                    document.getElementById('yijiDetailsContent').innerHTML = yijiHtml;
                    document.getElementById('yijiDetailsModal').classList.add('is-active');
                } else if (lunarShiChenElement) {
                    const currentHour = now.getHours();
                    const shiChenName = getShiChen(currentHour);

                    const hourYiList = lunar.getTimeYi() || ['ç„¡'];
                    const hourJiList = lunar.getTimeJi() || ['ç„¡'];

                    let yijiHtml = `
                        <p><strong>æ™‚è¾°ï¼šï¼š</strong> ${shiChenName}æ™‚</p>
                        <p style="margin-top: 15px;"><strong>å®œï¼š</strong> ${hourYiList.join('ã€')}</p>
                        <p style="margin-top: 15px;"><strong>å¿Œï¼šï¼š</strong> ${hourJiList.join('ã€')}</p>
                        <p style="margin-top: 15px; font-size: 0.9em; color: #aaa;">
                            æ™‚è¾°å®œå¿Œåƒ…ä¾›åƒè€ƒï¼Œè«‹å‹¿éåº¦è¿·ä¿¡ã€‚
                        </p>
                    `;
                    document.getElementById('yijiDetailsContent').innerHTML = yijiHtml;
                    document.getElementById('yijiDetailsModal').classList.add('is-active');
                }
            });
        };
    </script>
</body>
</html>
ï¿½
