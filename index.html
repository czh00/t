<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊôÇÈñì</title>
    <style>
        :root {
            --page-background-color: #000; /* [Êñ∞Â¢û] Áî®ÊñºÂêåÊ≠•ËÉåÊôØËâ≤ÁöÑ CSS ËÆäÊï∏ */
        }

        *, *::before, *::after {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            width: 100vw;
            position: relative;
            font-family: 'Inter', sans-serif;
            background-color: var(--page-background-color);
        }

        #dateTimeDisplay {
            font-family: 'Segoe UI', Arial, sans-serif;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
            position: absolute;
            transition: transform 1s ease-in-out;
            transform: translate(-50%, -50%);
            left: 50%;
            top: 50%;
            cursor: default;
            z-index: 10;
        }

        .time-text {
            font-size: 32vw;
            margin-bottom: -10vw;
            position: relative;
            display: inline-block;
            white-space: nowrap;
            padding-right: 8vw;
        }

        .time-seconds {
            font-size: 6vw;
            cursor: pointer;
            position: absolute;
            right: 0;
            bottom: 6vw;
            text-align: right;
            width: 6vw;
        }

        .time-ampm {
            font-size: 5vw;
            position: absolute;
            top: 11vw;
            right: 0;
            text-align: right;
            width: 8vw;
        }

        .gregorian-date-text {
            font-size: 10vw;
            margin-top: -2vw;
            margin-bottom: -3vw;
            display: block;
            white-space: nowrap;
            cursor: pointer;
            position: relative;
            z-index: 1;
        }

        .lunar-and-jieqi-line {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 6.4vw;
            white-space: nowrap;
            width: 92vw;
            margin: 0 auto;
            overflow: hidden;
            position: relative;
            z-index: 1;
        }

        .lunar-date-static-text {
            flex-shrink: 0;
            text-align: right;
            cursor: pointer;
        }

        .jieqi-holiday-marquee-container {
            flex-grow: 1;
            overflow: hidden;
            position: relative;
            text-align: left;
            min-width: 0;
            cursor: pointer;
        }

        .jieqi-holiday-marquee-inner {
            display: flex;
            flex-wrap: nowrap;
            width: fit-content;
            will-change: transform;
        }

        .jieqi-holiday-marquee-content,
        .jieqi-holiday-marquee-content-duplicate {
            display: inline-block;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .jieqi-holiday-marquee-container.scrolling .jieqi-holiday-marquee-inner {
            animation-name: marquee;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
        }

        @keyframes marquee {
            from {
                transform: translateX(0);
            }
            to {
                transform: translateX(-50%);
            }
        }

        .noscript-message {
            font-size: 0.5em;
            color: #FFB3BA;
            margin-top: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7);
        }

        .modal.is-active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #333;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 90%;
            max-width: 600px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            color: #00FF00;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .setting-item {
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: nowrap;
        }

        .setting-item label {
            font-size: 1.2em;
            flex-shrink: 0;
            margin-right: 10px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
            margin-left: auto;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #00FF00;
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #00FF00;
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        .setting-item input[type="color"] {
            width: 40px;
            height: 34px;
            border: none;
            padding: 0;
            background: none;
            cursor: pointer;
            flex-shrink: 0;
        }

        .action-button {
            background-color: #555;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            margin-top: 20px;
        }

        .action-button:hover {
            background-color: #777;
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            white-space: nowrap;
        }

        .calendar-settings-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: space-around;
            width: 100%;
        }

        .gregorian-settings-column,
        .lunar-settings-column {
            flex: 1;
            min-width: 80px;
            padding: 10px;
            border: 1px solid #555;
            border-radius: 8px;
            background-color: #444;
            text-align: left;
        }

        .gregorian-settings-column h3,
        .lunar-settings-column h3 {
            text-align: center;
            margin-top: 0;
        }

        .lunar-date-clickable,
        .lunar-shichen-clickable {
            cursor: pointer;
        }

        .yiji-content p, .jieqi-content p {
            margin-bottom: 10px;
            font-size: 1.5em;
            line-height: 1.6;
        }
        .yiji-content strong, .jieqi-content strong {
            color: #FFD700;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
        }

        .calendar-header h2 {
            margin: 0;
            font-size: 1.5em;
            color: #00FF00;
        }

        .calendar-header button {
            background: none;
            border: none;
            color: #00FF00;
            font-size: 2em;
            cursor: pointer;
        }

        .calendar-content {
            background-color: #2c2c2c;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 95%;
            max-width: 800px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.6);
            color: #e0e0e0;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 90vh;
        }

        .calendar-weekdays, .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendar-weekdays div {
            font-weight: bold;
            color: #aaa;
            padding-bottom: 5px;
        }

        .calendar-day {
            background-color: #444;
            border-radius: 5px;
            padding: 5px;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            border: 1px solid #555;
        }

        .calendar-day.other-month {
            color: #777;
            background-color: #3a3a3a;
        }

        .calendar-day.is-today {
            border-color: #00FF00;
            box-shadow: 0 0 5px #00FF00;
        }

        .calendar-day .gregorian-day {
            font-size: 1.2em;
            font-weight: bold;
        }

        .calendar-day .lunar-day {
            font-size: 0.8em;
            color: #ccc;
        }

        .weekly-calendar-content {
             background-color: #2c2c2c;
            margin: auto;
            padding: 15px;
            border: 1px solid #888;
            width: 98%;
            max-width: 1200px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.6);
            color: #e0e0e0;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 90vh;
        }

        .weekly-calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .weekly-calendar-day {
            background-color: #444;
            border-radius: 8px;
            padding: 10px;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid #555;
        }

        .weekly-calendar-day.is-today {
            border-color: #00FF00;
            box-shadow: 0 0 8px #00FF00;
        }

        .weekly-day-header {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .weekly-gregorian-day {
            font-size: 1.5em;
            font-weight: bold;
        }
        
        .weekly-lunar-day {
            font-size: 0.9em;
            color: #ccc;
            margin-top: 5px;
        }
        
        .yearly-calendar-content {
            background-color: #2c2c2c;
            margin: auto;
            padding: 15px;
            border: 1px solid #888;
            width: 98%;
            max-width: 1400px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.6);
            color: #e0e0e0;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 95vh;
        }

        .yearly-calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            overflow-y: auto;
            padding: 10px;
        }

        .yearly-month-container {
            background-color: #3a3a3a;
            border-radius: 8px;
            padding: 10px;
            border: 1px solid #555;
        }

        .yearly-month-header {
            font-size: 1.2em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
            color: #00FF00;
        }

        .yearly-weekdays, .yearly-day-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px;
            text-align: center;
        }

        .yearly-weekdays div {
            font-size: 0.8em;
            color: #aaa;
        }

        .yearly-day {
            font-size: 0.9em;
            padding: 2px;
            border-radius: 3px;
        }

        .yearly-day.is-today {
            background-color: #00FF00;
            color: #000;
            font-weight: bold;
        }

        /* [‰øÆÊîπ] ËÉåÊôØÊéÉÊèèÁ∑öÁâπÊïà */
        #background-scanline-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            background-color: transparent;
            display: none; /* È†êË®≠Èö±Ëóè */
        }

        #background-scanline-overlay.active.pattern-a {
            display: block;
            background-image: repeating-linear-gradient(
                to bottom,
                transparent,
                transparent 2px,
                rgba(0,0,0,0.3) 2px,
                rgba(0,0,0,0.3) 4px
            );
        }

        #background-scanline-overlay.active.pattern-b {
            display: block;
            background-image: repeating-linear-gradient(
                to bottom,
                rgba(0,0,0,0.3) 0,
                rgba(0,0,0,0.3) 2px,
                transparent 2px,
                transparent 4px
            );
        }

        /* [‰øÆÊîπ] ÊñáÂ≠óÊéÉÊèèÁ∑öÁâπÊïà (ÊÅ¢Âæ©ÂéüÁâàÈÇèËºØ) */
        #text-scanline-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50; /* Âú®ÊñáÂ≠ó‰πã‰∏äÔºåÂΩàÂá∫Ë¶ñÁ™ó‰πã‰∏ã */
            background-color: transparent;
            display: none; /* È†êË®≠Èö±Ëóè */
        }

        #text-scanline-overlay.active.pattern-a {
            display: block;
            background-image: repeating-linear-gradient(
                to bottom,
                transparent,
                transparent 2px,
                var(--page-background-color) 2px,
                var(--page-background-color) 4px
            );
        }

        #text-scanline-overlay.active.pattern-b {
            display: block;
            background-image: repeating-linear-gradient(
                to bottom,
                var(--page-background-color) 0,
                var(--page-background-color) 2px,
                transparent 2px,
                transparent 4px
            );
        }

    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/lunar-javascript/1.7.0/lunar.min.js"></script>
</head>
<body>
    <div id="background-scanline-overlay"></div>
    <div id="text-scanline-overlay"></div>
    
    <div id="dateTimeDisplay">
        <div class="time-text" id="timeTextContainer">
            <span id="hoursMinutesDisplay"></span>
            <span class="time-seconds" id="secondsDisplay"></span>
            <span class="time-ampm" id="amPmDisplay"></span>
        </div>
        <div class="gregorian-date-text" id="gregorianDateDisplay"></div>
        <div class="lunar-and-jieqi-line" id="lunarAndJieqiLine">
            <span class="lunar-date-static-text" id="lunarDateDisplay"></span>
            <div id="jieqiHolidayMarqueeContainer" class="jieqi-holiday-marquee-container">
                <div id="jieqiHolidayMarqueeInner" class="jieqi-holiday-marquee-inner">
                    <span class="jieqi-holiday-marquee-content"></span>
                    <span class="jieqi-holiday-marquee-content-duplicate"></span>
                </div>
            </div>
        </div>
    </div>

    <noscript>
        <div class="noscript-message">
            ÊÇ®ÁöÑÁÄèË¶ΩÂô®‰∏çÊîØÊè¥ÊàñÂ∑≤Á¶ÅÁî® JavaScript„ÄÇ
        </div>
    </noscript>

    <!-- Ë®≠ÂÆö Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <h2>È°ØÁ§∫Ë®≠ÂÆö</h2>
            <div class="calendar-settings-container">
                <div class="gregorian-settings-column">
                    <h3>ÂÖ¨ÊõÜ</h3>
                    <div class="setting-item">
                        <label for="textColor">ÊôÇÈñì</label>
                        <label class="switch" title="ÂàáÊèõ‰∏äÂçà/‰∏ãÂçàÊ†ºÂºè">
                            <input type="checkbox" id="showAmPm">
                            <span class="slider"></span>
                        </label>
                        <input type="color" id="textColor" value="#00FF00">
                    </div>
                    <div class="setting-item">
                        <label for="showGregorianYear">Âπ¥</label>
                        <label class="switch">
                            <input type="checkbox" id="showGregorianYear">
                            <span class="slider"></span>
                        </label>
                        <input type="color" id="gregorianYearColor" value="#00FF00">
                    </div>
                    <div class="setting-item">
                        <label for="showGregorianMonth">Êúà</label>
                        <label class="switch">
                            <input type="checkbox" id="showGregorianMonth">
                            <span class="slider"></span>
                        </label>
                        <input type="color" id="gregorianMonthColor" value="#00FF00">
                    </div>
                    <div class="setting-item">
                        <label for="showGregorianDay">Êó•</label>
                        <label class="switch">
                            <input type="checkbox" id="showGregorianDay">
                            <span class="slider"></span>
                        </label>
                        <input type="color" id="gregorianDayColor" value="#00FF00">
                    </div>
                    <div class="setting-item">
                        <label for="showGregorianWeekday">Âë®</label>
                        <label class="switch">
                            <input type="checkbox" id="showGregorianWeekday">
                            <span class="slider"></span>
                        </label>
                        <input type="color" id="gregorianWeekdayColor" value="#00FF00">
                    </div>
                </div>

                <div class="lunar-settings-column">
                    <h3>Ëæ≤ÊõÜ</h3>
                    <div class="setting-item">
                        <label for="showMinguoYear">Âπ¥</label>
                        <label class="switch">
                            <input type="checkbox" id="showMinguoYear">
                            <span class="slider"></span>
                        </label>
                        <input type="color" id="minguoYearColor" value="#00FF00">
                    </div>
                    <div class="setting-item">
                        <label for="showLunarMonth">Êúà</label>
                        <label class="switch">
                            <input type="checkbox" id="showLunarMonth">
                            <span class="slider"></span>
                        </label>
                        <input type="color" id="lunarMonthColor" value="#00FF00">
                    </div>
                    <div class="setting-item">
                        <label for="showLunarDay">Êó•</label>
                        <label class="switch">
                            <input type="checkbox" id="showLunarDay">
                            <span class="slider"></span>
                        </label>
                        <input type="color" id="lunarDayColor" value="#00FF00">
                    </div>
                    <div class="setting-item">
                        <label for="showLunarShiChen">ÊôÇ</label>
                        <label class="switch">
                            <input type="checkbox" id="showLunarShiChen">
                            <span class="slider"></span>
                        </label>
                        <input type="color" id="lunarShiChenColor" value="#00FF00">
                    </div>
                    <div class="setting-item">
                        <label for="showJieqi">ÁØÄÊ∞£</label>
                        <label class="switch">
                            <input type="checkbox" id="showJieqi">
                            <span class="slider"></span>
                        </label>
                        <input type="color" id="jieqiColor" value="#00FF00">
                    </div>
                    <div class="setting-item">
                        <label for="showHolidays">ÁØÄÊó•</label>
                        <label class="switch">
                            <input type="checkbox" id="showHolidays">
                            <span class="slider"></span>
                        </label>
                        <input type="color" id="holidayColor" value="#0000FF">
                    </div>
                </div>
            </div>

            <div class="setting-item">
                <label for="backgroundColor">ËÉåÊôØ</label>
                <label class="switch" title="ÂàáÊèõËÉåÊôØÊéÉÊèèÁ∑öÁâπÊïà">
                    <input type="checkbox" id="enableBackgroundScanline">
                    <span class="slider"></span>
                </label>
                <input type="color" id="backgroundColor" value="#000000">
            </div>
            
            <div class="setting-item">
                <label for="enableTextScanline">ÊñáÂ≠óÊéÉÊèèÁ∑öÁâπÊïà</label>
                <label class="switch">
                    <input type="checkbox" id="enableTextScanline">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <label for="enableMovement">Èö®Ê©üÁßªÂãïÁâπÊïà</label>
                <label class="switch">
                    <input type="checkbox" id="enableMovement">
                    <span class="slider"></span>
                </label>
            </div>


            <div class="button-group">
                <button id="restoreDefaultsBtn" class="action-button">ÊÅ¢Âæ©È†êË®≠</button>
                <button id="randomColorsBtn" class="action-button">Èö®Ê©üÈ°èËâ≤</button>
                <button id="doneBtn" class="action-button">ÂÆåÊàê</button>
            </div>
        </div>
    </div>

    <!-- ÁØÄÊ∞£/ÁØÄÊó• Modal -->
    <div id="jieqiDetailsModal" class="modal">
        <div class="modal-content jieqi-content">
            <h2>ÁØÄÊ∞£ËàáÁØÄÊó•Ë≥áË®ä</h2>
            <div id="jieqiDetailsContent" style="text-align: left;"></div>
            <button id="closeJieqiDetailsBtn" class="action-button">ÈóúÈñâ</button>
        </div>
    </div>

    <!-- ÂÆúÂøå Modal -->
    <div id="yijiDetailsModal" class="modal">
        <div class="modal-content yiji-content">
            <h2>ÂÆúÂøåË≥áË®ä</h2>
            <div id="yijiDetailsContent" style="text-align: left;"></div>
            <button id="closeYijiDetailsBtn" class="action-button">ÈóúÈñâ</button>
        </div>
    </div>

    <!-- ÊúàÊõÜ Modal -->
    <div id="calendarModal" class="modal">
        <div class="calendar-content">
            <div class="calendar-header">
                <button id="prevMonthBtn">&lt;</button>
                <h2 id="calendarMonthYear"></h2>
                <button id="nextMonthBtn">&gt;</button>
            </div>
            <div id="calendarWeekdays" class="calendar-weekdays"></div>
            <div id="calendarGrid" class="calendar-grid"></div>
            <button id="closeCalendarBtn" class="action-button">ÈóúÈñâ</button>
        </div>
    </div>

    <!-- Âë®ÊõÜ Modal -->
    <div id="weeklyCalendarModal" class="modal">
        <div class="weekly-calendar-content">
            <div class="calendar-header">
                <button id="prevWeekBtn">&lt;</button>
                <h2 id="weeklyCalendarTitle"></h2>
                <button id="nextWeekBtn">&gt;</button>
            </div>
            <div id="weeklyCalendarGrid" class="weekly-calendar-grid"></div>
            <button id="closeWeeklyCalendarBtn" class="action-button">ÈóúÈñâ</button>
        </div>
    </div>
    
    <!-- Âπ¥ÊõÜ Modal -->
    <div id="yearlyCalendarModal" class="modal">
        <div class="yearly-calendar-content">
            <div class="calendar-header">
                <button id="prevYearBtn">&lt;</button>
                <h2 id="yearlyCalendarTitle"></h2>
                <button id="nextYearBtn">&gt;</button>
            </div>
            <div id="yearlyCalendarGrid" class="yearly-calendar-grid"></div>
            <button id="closeYearlyCalendarBtn" class="action-button">ÈóúÈñâ</button>
        </div>
    </div>

    <script>
        // ÂÖ®ÂüüËÆäÊï∏
        let lastSecondTensDigit = -1;
        let lastMarqueeContent = ''; 
        let calendarDate = new Date();
        let weeklyCalendarDate = new Date();
        let yearlyCalendarDate = new Date();

        const defaultDisplaySettings = {
            showAmPm: true,
            showGregorianYear: true,
            showGregorianMonth: true,
            showGregorianDay: true,
            showGregorianWeekday: true,
            showMinguoYear: true,
            showLunarMonth: true,
            showLunarDay: true,
            showLunarShiChen: true,
            showJieqi: true,
            showHolidays: true,
            textColor: '#00FF00',
            backgroundColor: '#000000',
            gregorianYearColor: '#00FF00',
            gregorianMonthColor: '#00FF00',
            gregorianDayColor: '#00FF00',
            gregorianWeekdayColor: '#00FF00',
            minguoYearColor: '#00FF00',
            lunarMonthColor: '#00FF00',
            lunarDayColor: '#00FF00',
            lunarShiChenColor: '#00FF00',
            jieqiColor: '#00FF00',
            holidayColor: '#00FFFF',
            enableTextScanline: true,
            enableBackgroundScanline: true,
            enableMovement: true
        };

        let displaySettings = { ...defaultDisplaySettings }; 

        function saveSettings() {
            try {
                localStorage.setItem('displaySettings', JSON.stringify(displaySettings));
            } catch (e) {
                console.error("ÂÑ≤Â≠òË®≠ÂÆöËá≥ localStorage Â§±Êïó:", e);
            }
        }

        function loadSettings() {
            try {
                const settingsJson = localStorage.getItem('displaySettings');
                if (settingsJson) {
                    const loadedSettings = JSON.parse(settingsJson);
                    displaySettings = Object.assign({ ...defaultDisplaySettings }, loadedSettings);
                }
            } catch (e) {
                console.error("Âæû localStorage Ëß£ÊûêË®≠ÂÆöÂ§±Êïó:", e);
                displaySettings = { ...defaultDisplaySettings };
            }
        }

        function updateSettingsModalUI() {
            document.getElementById('showAmPm').checked = displaySettings.showAmPm;
            document.getElementById('showGregorianYear').checked = displaySettings.showGregorianYear;
            document.getElementById('showGregorianMonth').checked = displaySettings.showGregorianMonth;
            document.getElementById('showGregorianDay').checked = displaySettings.showGregorianDay;
            document.getElementById('showGregorianWeekday').checked = displaySettings.showGregorianWeekday;
            document.getElementById('showMinguoYear').checked = displaySettings.showMinguoYear;
            document.getElementById('showLunarMonth').checked = displaySettings.showLunarMonth;
            document.getElementById('showLunarDay').checked = displaySettings.showLunarDay;
            document.getElementById('showLunarShiChen').checked = displaySettings.showLunarShiChen;
            document.getElementById('showJieqi').checked = displaySettings.showJieqi;
            document.getElementById('showHolidays').checked = displaySettings.showHolidays;
            document.getElementById('textColor').value = displaySettings.textColor;
            document.getElementById('backgroundColor').value = displaySettings.backgroundColor;
            document.getElementById('gregorianYearColor').value = displaySettings.gregorianYearColor;
            document.getElementById('gregorianMonthColor').value = displaySettings.gregorianMonthColor;
            document.getElementById('gregorianDayColor').value = displaySettings.gregorianDayColor;
            document.getElementById('gregorianWeekdayColor').value = displaySettings.gregorianWeekdayColor;
            document.getElementById('minguoYearColor').value = displaySettings.minguoYearColor;
            document.getElementById('lunarMonthColor').value = displaySettings.lunarMonthColor;
            document.getElementById('lunarDayColor').value = displaySettings.lunarDayColor;
            document.getElementById('lunarShiChenColor').value = displaySettings.lunarShiChenColor;
            document.getElementById('jieqiColor').value = displaySettings.jieqiColor;
            document.getElementById('holidayColor').value = displaySettings.holidayColor;
            document.getElementById('enableTextScanline').checked = displaySettings.enableTextScanline;
            document.getElementById('enableBackgroundScanline').checked = displaySettings.enableBackgroundScanline;
            document.getElementById('enableMovement').checked = displaySettings.enableMovement;
        }

        function getShengXiaoEmoji(shengXiaoName) {
            const emojiMap = { 'Èº†': 'üê≠', 'Áâõ': 'üêÆ', 'Ëôé': 'üêÖ', 'ÂÖî': 'üê∞', 'Èæç': 'üêâ', 'Ëõá': 'üêç', 'È¶¨': 'üêé', 'Áæä': 'üêë', 'Áå¥': 'üêí', 'Èõû': 'üêî', 'Áãó': 'ÔøΩ', 'Ë±¨': 'üêñ' };
            return emojiMap[shengXiaoName] || shengXiaoName;
        }

        function getJieqiDescription(jieqiName) {
            const descriptions = { 'Á´ãÊò•': 'Êò•Â≠£ÈñãÂßãÔºåËê¨Áâ©Âæ©Áî¶ÔºåÊ∞£Ê∫´ÂõûÂçá„ÄÇ', 'Èõ®Ê∞¥': 'ÈôçÈõ®Â¢ûÂ§öÔºåËçâÊú®ËêåÂãïÔºåÊò•ËÄïÈñãÂßã„ÄÇ', 'È©öËüÑ': 'Êò•Èõ∑ÈüøÂãïÔºåÈ©öÈÜíÂÜ¨Áú†ÂãïÁâ©ÔºåÊ∞£Ê∫´Êº∏Âçá„ÄÇ', 'Êò•ÂàÜ': 'ÊôùÂ§úÁ≠âÈï∑ÔºåÊò•ÊÑèÁõéÁÑ∂ÔºåÂçóÂåóÂçäÁêÉÊ∞£Ê∫´Ë∂®ÊñºÂπ≥Ë°°„ÄÇ', 'Ê∏ÖÊòé': 'Ê∞£ÂÄôÊ∏ÖÁàΩÊòéÊúóÔºåËê¨Áâ©ÊΩîÊ∑®ÔºåÊòØÊéÉÂ¢ìÁ•≠Á•ñÁöÑÊó•Â≠ê„ÄÇ', 'Á©ÄÈõ®': 'Èõ®Ê∞¥ÊªãÊΩ§ÔºåÁ©ÄÁâ©ÁîüÈï∑ÔºåÊòØÊí≠Á®ÆÁßªËãóÁöÑÂ•ΩÊôÇÁØÄ„ÄÇ', 'Á´ãÂ§è': 'Â§èÂ≠£ÈñãÂßãÔºåËê¨Áâ©ÁπÅËåÇÔºåÊ∞£Ê∫´ÊòéÈ°ØÂçáÈ´ò„ÄÇ', 'Â∞èÊªø': 'È∫•È°ûÁ≠âÂ§èÁÜü‰ΩúÁâ©Á±ΩÁ≤íÈñãÂßãÈ£ΩÊªøÔºå‰ΩÜÂ∞öÊú™ÊàêÁÜü„ÄÇ', 'ËäíÁ®Æ': 'ÊúâËäí‰ΩúÁâ©ÔºàÂ¶ÇÈ∫•„ÄÅÁ®ªÔºâÊàêÁÜüÔºåÂèØ‰ª•Êî∂Á©´ÂíåÊí≠Á®Æ„ÄÇ', 'Â§èËá≥': 'ÂåóÂçäÁêÉÁôΩÊôùÊúÄÈï∑ÔºåÈôΩÊ∞£ÊúÄÁõõÔºåÊòØÁõõÂ§èÁöÑÈñãÂßã„ÄÇ', 'Â∞èÊöë': 'Â§©Ê∞£ÈñãÂßãÁÇéÁÜ±Ôºå‰ΩÜÈÇÑÊú™Âà∞ÊúÄÁÜ±ÁöÑÊôÇÂÄô„ÄÇ', 'Â§ßÊöë': '‰∏ÄÂπ¥‰∏≠ÊúÄÁÇéÁÜ±ÁöÑÊôÇÊúüÔºåÊøïÁÜ±‰∫§Ëí∏„ÄÇ', 'Á´ãÁßã': 'ÁßãÂ≠£ÈñãÂßãÔºåÊ∞£Ê∫´ÈÄêÊº∏‰∏ãÈôçÔºå‰ΩÜ‰ªçÊúâÊöëÁÜ±„ÄÇ', 'ËôïÊöë': 'ÊöëÊ∞£Êº∏ÈÄÄÔºåÂ§©Ê∞£ËΩâÊ∂ºÔºå‰ΩÜ‰ªçÊúâ„ÄåÁßãËÄÅËôé„Äç„ÄÇ', 'ÁôΩÈú≤': 'Â§©Ê∞£ËΩâÊ∂ºÔºåÊ∞¥Ê∞£ÂáùÁµêÊàêÈú≤Áè†ÔºåÂ§©Ê∞£Êº∏ÂØí„ÄÇ', 'ÁßãÂàÜ': 'ÊôùÂ§úÁ≠âÈï∑ÔºåÁßãÈ´òÊ∞£ÁàΩÔºåÊòØÊî∂Á©´ÁöÑÂ≠£ÁØÄ„ÄÇ', 'ÂØíÈú≤': 'Ê∞£Ê∫´Êõ¥‰ΩéÔºåÈú≤Ê∞¥Êõ¥Â§öÔºåÂ§©Ê∞£ËΩâÂÜ∑„ÄÇ', 'ÈúúÈôç': 'Â§©Ê∞£Êº∏ÂÜ∑ÔºåÈú≤Ê∞¥ÂáùÁµêÊàêÈúúÔºåÊòØÁßãÂ≠£ÁöÑÊúÄÂæå‰∏ÄÂÄãÁØÄÊ∞£„ÄÇ', 'Á´ãÂÜ¨': 'ÂÜ¨Â≠£ÈñãÂßãÔºåËê¨Áâ©Êî∂ËóèÔºåÊ∞£Ê∫´È°ØËëó‰∏ãÈôç„ÄÇ', 'Â∞èÈõ™': 'ÈñãÂßãÈôçÈõ™Ôºå‰ΩÜÈõ™Èáè‰∏çÂ§ßÔºåÊ∞£Ê∫´ÊåÅÁ∫åËµ∞‰Ωé„ÄÇ', 'Â§ßÈõ™': 'ÈôçÈõ™ÈáèÂ¢ûÂ§öÔºåÂ§©Ê∞£Êõ¥ÂÜ∑ÔºåÂÜ∞ÂáçÁèæË±°Â∏∏Ë¶ã„ÄÇ', 'ÂÜ¨Ëá≥': 'ÂåóÂçäÁêÉÁôΩÊôùÊúÄÁü≠ÔºåÂ§úÊôöÊúÄÈï∑ÔºåÊòØÊï∏‰πùÂØíÂ§©ÁöÑÈñãÂßã„ÄÇ', 'Â∞èÂØí': 'Â§©Ê∞£ÂØíÂÜ∑ÔºåÂ∞öÊú™ÈÅîÂà∞ÊúÄÂÜ∑„ÄÇ', 'Â§ßÂØí': '‰∏ÄÂπ¥‰∏≠ÊúÄÂØíÂÜ∑ÁöÑÊôÇÊúüÔºåÂö¥ÂØíÂÜ∞Âáç„ÄÇ' };
            return descriptions[jieqiName] || 'Ê≠§ÁØÄÊ∞£ÁÑ°Ë©≥Á¥∞Ë™™Êòé„ÄÇ';
        }

        function getHolidays(year) {
            const holidays = [
                { name: 'ÂÖÉÊó¶', date: new Date(year, 0, 1) }, { name: 'ÂíåÂπ≥Á¥ÄÂøµÊó•', date: new Date(year, 1, 28) }, { name: 'ÂÖíÁ´•ÁØÄ', date: new Date(year, 3, 4) }, { name: 'Ê∏ÖÊòéÁØÄ', date: new Date(year, 3, 4) }, { name: 'ÂãûÂãïÁØÄ', date: new Date(year, 4, 1) }, { name: 'ÂúãÊÖ∂Êó•', date: new Date(year, 9, 10) }, { name: 'ËÅñË™ïÁØÄ', date: new Date(year, 11, 25) }
            ];
            const lunarNewYear = Lunar.fromYmd(year, 1, 1).getSolar();
            holidays.push({ name: 'Ëæ≤ÊõÜÊñ∞Âπ¥', date: new Date(lunarNewYear.getYear(), lunarNewYear.getMonth() - 1, lunarNewYear.getDay()) });
            const dragonBoatFestival = Lunar.fromYmd(year, 5, 5).getSolar();
            holidays.push({ name: 'Á´ØÂçàÁØÄ', date: new Date(dragonBoatFestival.getYear(), dragonBoatFestival.getMonth() - 1, dragonBoatFestival.getDay()) });
            const ghostFestival = Lunar.fromYmd(year, 7, 15).getSolar();
            holidays.push({ name: '‰∏≠ÂÖÉÁØÄ', date: new Date(ghostFestival.getYear(), ghostFestival.getMonth() - 1, ghostFestival.getDay()) });
            const midAutumnFestival = Lunar.fromYmd(year, 8, 15).getSolar();
            holidays.push({ name: '‰∏≠ÁßãÁØÄ', date: new Date(midAutumnFestival.getYear(), midAutumnFestival.getMonth() - 1, midAutumnFestival.getDay()) });
            const doubleNinthFestival = Lunar.fromYmd(year, 9, 9).getSolar();
            holidays.push({ name: 'ÈáçÈôΩÁØÄ', date: new Date(doubleNinthFestival.getYear(), doubleNinthFestival.getMonth() - 1, doubleNinthFestival.getDay()) });
            const nextLunarNewYearSolar = Lunar.fromYmd(year + 1, 1, 1).getSolar();
            const chineseNewYearsEveDate = new Date(nextLunarNewYearSolar.getYear(), nextLunarNewYearSolar.getMonth() - 1, nextLunarNewYearSolar.getDay() - 1);
            holidays.push({ name: 'Èô§Â§ï', date: chineseNewYearsEveDate });
            holidays.sort((a, b) => a.date.getTime() - b.date.getTime());
            return holidays;
        }

        function getShiChen(h) {
            if (h >= 23 || h < 1) return 'Â≠ê'; if (h >= 1 && h < 3) return '‰∏ë'; if (h >= 3 && h < 5) return 'ÂØÖ'; if (h >= 5 && h < 7) return 'ÂçØ'; if (h >= 7 && h < 9) return 'Ëæ∞'; if (h >= 9 && h < 11) return 'Â∑≥'; if (h >= 11 && h < 13) return 'Âçà'; if (h >= 13 && h < 15) return 'Êú™'; if (h >= 15 && h < 17) return 'Áî≥'; if (h >= 17 && h < 19) return 'ÈÖâ'; if (h >= 19 && h < 21) return 'Êàå'; if (h >= 21 && h < 23) return '‰∫•';
            return '';
        }

        function getDetailedTimePeriod(hour) {
            if (hour >= 0 && hour < 5) return 'ÂáåÊô®'; if (hour >= 5 && hour < 9) return 'Ê∏ÖÊô®'; if (hour >= 9 && hour < 12) return '‰∏äÂçà'; if (hour === 12) return '‰∏≠Âçà'; if (hour > 12 && hour < 17) return '‰∏ãÂçà'; if (hour >= 17 && hour < 19) return 'ÂÇçÊôö'; if (hour >= 19 && hour < 23) return 'Â§úÊôö'; if (hour === 23) return 'Ê∑±Â§ú';
            return '';
        }

        function updateMarquee(combinedJieqiHolidayText) {
            const marqueeContainer = document.getElementById('jieqiHolidayMarqueeContainer');
            const marqueeInner = document.getElementById('jieqiHolidayMarqueeInner');
            if (!marqueeContainer || !marqueeInner) return;

            const contentSpan = marqueeInner.querySelector('.jieqi-holiday-marquee-content');
            const duplicateSpan = marqueeInner.querySelector('.jieqi-holiday-marquee-content-duplicate');
            if (!contentSpan || !duplicateSpan) return;

            contentSpan.innerHTML = combinedJieqiHolidayText;
            
            requestAnimationFrame(() => {
                const contentWidth = contentSpan.scrollWidth;
                const containerWidth = marqueeContainer.offsetWidth;

                if (contentWidth > containerWidth) {
                    duplicateSpan.innerHTML = combinedJieqiHolidayText;
                    marqueeContainer.classList.add('scrolling');
                    const speed = 50;
                    const duration = contentWidth / speed;
                    marqueeInner.style.animationDuration = `${duration}s`;
                    marqueeInner.style.animationPlayState = 'running';
                } else {
                    duplicateSpan.innerHTML = '';
                    marqueeContainer.classList.remove('scrolling');
                    marqueeInner.style.animationPlayState = 'paused';
                }
            });
        }

        // [‰øÆÊîπ] Êõ¥Êñ∞‰∏ªÁï´Èù¢È°ØÁ§∫ÔºåÂàÜÈõ¢ÊéÉÊèèÁ∑öÈÇèËºØ
        function updateDateTime() {
            const now = new Date();
            const currentSeconds = now.getSeconds();
            const backgroundOverlay = document.getElementById('background-scanline-overlay');
            const textOverlay = document.getElementById('text-scanline-overlay');
            
            const secondTensDigit = Math.floor(currentSeconds / 10);
            if (secondTensDigit !== lastSecondTensDigit) {
                if(displaySettings.enableMovement) {
                    moveRandomly();
                }
                
                // ÂàáÊèõÂÖ©ÂÄãÊéÉÊèèÁ∑öÁöÑ pattern
                if (displaySettings.enableBackgroundScanline) {
                    backgroundOverlay.classList.toggle('pattern-a');
                    backgroundOverlay.classList.toggle('pattern-b');
                }
                if (displaySettings.enableTextScanline) {
                    textOverlay.classList.toggle('pattern-a');
                    textOverlay.classList.toggle('pattern-b');
                }
                
                lastSecondTensDigit = secondTensDigit;
            }

            // Ê†πÊìöË®≠ÂÆöÊ±∫ÂÆöÊòØÂê¶È°ØÁ§∫ÊéÉÊèèÁ∑ö
            backgroundOverlay.classList.toggle('active', displaySettings.enableBackgroundScanline);
            textOverlay.classList.toggle('active', displaySettings.enableTextScanline);

            // Êõ¥Êñ∞ËÉåÊôØËâ≤
            document.documentElement.style.setProperty('--page-background-color', displaySettings.backgroundColor);

            const timeOptions = { hour: 'numeric', minute: '2-digit', second: '2-digit', hour12: displaySettings.showAmPm };
            const formatter = new Intl.DateTimeFormat('zh-Hant', timeOptions);
            const parts = formatter.formatToParts(now);
            const hourPart = parts.find(p => p.type === 'hour')?.value.padStart(2, '0') || '00';
            const minutePart = parts.find(p => p.type === 'minute')?.value || '00';
            const secondPart = parts.find(p => p.type === 'second')?.value || '00';
            const hoursMinutes = `${hourPart}:${minutePart}`;
            const seconds = secondPart;
            const amPmText = displaySettings.showAmPm ? getDetailedTimePeriod(now.getHours()) : '';

            let gregorianParts = [];
            if (displaySettings.showGregorianYear || displaySettings.showGregorianMonth || displaySettings.showGregorianDay || displaySettings.showGregorianWeekday) {
                const year = now.getFullYear();
                const month = (now.getMonth() + 1).toString().padStart(2, '0');
                const day = now.getDate().toString().padStart(2, '0');
                const weekday = ['Êó•', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠'][now.getDay()];
                if (displaySettings.showGregorianYear) gregorianParts.push(`<span class="gregorian-year-target" style="color: ${displaySettings.gregorianYearColor}; cursor: pointer;">${year}Âπ¥</span>`);
                if (displaySettings.showGregorianMonth) gregorianParts.push(`<span style="color: ${displaySettings.gregorianMonthColor};">${month}Êúà</span>`);
                if (displaySettings.showGregorianDay) gregorianParts.push(`<span style="color: ${displaySettings.gregorianDayColor};">${day}Êó•</span>`);
                if (displaySettings.showGregorianWeekday) gregorianParts.push(`<span class="weekday-target" style="color: ${displaySettings.gregorianWeekdayColor}; cursor: pointer;">Âë®${weekday}</span>`);
            }
            
            let lunarParts = [];
            let combinedJieqiHolidayText = '';
            let currentJieqiInfo = null;
            let nextHolidayInfo = null;
            let currentHolidayName = '';
            let tempJieqiName = '';
            let tempDaysUntilNextJieqi = -1;

            if (typeof Lunar !== 'undefined') {
                const solar = Solar.fromDate(now);
                const lunar = solar.getLunar();
                const minguoYear = now.getFullYear() - 1911;

                if (displaySettings.showMinguoYear || displaySettings.showLunarMonth || displaySettings.showLunarDay || displaySettings.showLunarShiChen) {
                    if (displaySettings.showMinguoYear) lunarParts.push(`<span class="lunar-year-target" style="color: ${displaySettings.minguoYearColor}; cursor: pointer;">${minguoYear}Âπ¥${getShengXiaoEmoji(lunar.getYearShengXiao())}</span>`);
                    if (displaySettings.showLunarMonth) lunarParts.push(`<span style="color: ${displaySettings.lunarMonthColor};">${lunar.getMonthInChinese().replace('Èó∞', 'Èñè')}Êúà</span>`);
                    if (displaySettings.showLunarDay) lunarParts.push(`<span class="lunar-day-target lunar-date-clickable" style="color: ${displaySettings.lunarDayColor};">${lunar.getDayInChinese()}</span>`);
                    if (displaySettings.showLunarShiChen) lunarParts.push(`<span class="lunar-shichen-target lunar-shichen-clickable" style="color: ${displaySettings.lunarShiChenColor};">${getShiChen(now.getHours())}ÊôÇ</span>`);
                }

                const jieQisForYear = lunar.getJieQiTable();
                const allJieqis = Object.entries(jieQisForYear).map(([name, dateStr]) => ({ name, date: new Date(dateStr) })).sort((a, b) => a.date.getTime() - b.date.getTime());
                let foundTodayJieqi = allJieqis.find(jq => jq.date.toDateString() === now.toDateString());
                if (foundTodayJieqi) {
                    tempJieqiName = foundTodayJieqi.name;
                    tempDaysUntilNextJieqi = 0;
                    currentJieqiInfo = foundTodayJieqi;
                } else {
                    let nextJieqi = allJieqis.find(jq => jq.date > now);
                    if (nextJieqi) {
                        const diffTime = nextJieqi.date.getTime() - now.getTime();
                        tempDaysUntilNextJieqi = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        tempJieqiName = nextJieqi.name;
                        currentJieqiInfo = nextJieqi;
                    }
                }
                
                let jieQiText = '';
                if (displaySettings.showJieqi && tempJieqiName) {
                    jieQiText = (tempDaysUntilNextJieqi === 0) ? `${tempJieqiName}` : `${tempDaysUntilNextJieqi}‚û°${tempJieqiName}`;
                }

                const holidays = getHolidays(now.getFullYear());
                let foundTodayHoliday = holidays.find(h => h.date.toDateString() === now.toDateString());
                if (foundTodayHoliday) {
                    currentHolidayName = foundTodayHoliday.name;
                } else {
                    nextHolidayInfo = holidays.find(h => h.date > now);
                    if (nextHolidayInfo) {
                       const diffTime = nextHolidayInfo.date.getTime() - now.getTime();
                       nextHolidayInfo.daysUntil = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    }
                }

                let holidayCountdownText = '';
                if (displaySettings.showHolidays) {
                    if (currentHolidayName) {
                        holidayCountdownText = `${currentHolidayName}`;
                    } else if (nextHolidayInfo) {
                        holidayCountdownText = `${nextHolidayInfo.daysUntil}‚û°${nextHolidayInfo.name}`;
                    }
                }

                let marqueeParts = [];
                if(jieQiText) marqueeParts.push(`<span style="color: ${displaySettings.jieqiColor};">${jieQiText}</span>`);
                if(holidayCountdownText) marqueeParts.push(`<span style="color: ${displaySettings.holidayColor};">${holidayCountdownText}</span>`);
                combinedJieqiHolidayText = marqueeParts.join('');
            }

            const timeTextContainer = document.getElementById('timeTextContainer');
            const hoursMinutesDisplay = document.getElementById('hoursMinutesDisplay');
            const secondsDisplay = document.getElementById('secondsDisplay');
            const amPmDisplay = document.getElementById('amPmDisplay');
            const gregorianDateDisplay = document.getElementById('gregorianDateDisplay');
            const lunarDateDisplay = document.getElementById('lunarDateDisplay');
            const marqueeContainer = document.getElementById('jieqiHolidayMarqueeContainer');

            timeTextContainer.style.color = displaySettings.textColor;
            hoursMinutesDisplay.textContent = hoursMinutes;
            secondsDisplay.textContent = seconds;
            amPmDisplay.textContent = amPmText;
            amPmDisplay.style.display = amPmText ? 'block' : 'none';

            gregorianDateDisplay.innerHTML = gregorianParts.join('');
            gregorianDateDisplay.style.display = gregorianParts.length > 0 ? 'block' : 'none';

            lunarDateDisplay.innerHTML = lunarParts.join('');
            lunarDateDisplay.style.display = lunarParts.length > 0 ? 'inline-block' : 'none';
            
            const marqueeIsVisible = displaySettings.showJieqi || displaySettings.showHolidays;
            marqueeContainer.style.display = marqueeIsVisible ? 'block' : 'none';
            if(marqueeIsVisible) {
                marqueeContainer.dataset.jieqiName = currentJieqiInfo ? currentJieqiInfo.name : '';
                marqueeContainer.dataset.jieqiDate = currentJieqiInfo ? currentJieqiInfo.date.toISOString() : '';
                marqueeContainer.dataset.daysUntilNextJieqi = tempDaysUntilNextJieqi !== -1 ? tempDaysUntilNextJieqi : '';
                marqueeContainer.dataset.nextHolidayName = nextHolidayInfo ? nextHolidayInfo.name : '';
                marqueeContainer.dataset.nextHolidayDate = nextHolidayInfo ? nextHolidayInfo.date.toISOString() : '';
                marqueeContainer.dataset.nextHolidayDaysUntil = nextHolidayInfo ? nextHolidayInfo.daysUntil : '';
                marqueeContainer.dataset.currentHolidayName = currentHolidayName;

                if (lastMarqueeContent !== combinedJieqiHolidayText) {
                    updateMarquee(combinedJieqiHolidayText);
                    lastMarqueeContent = combinedJieqiHolidayText;
                }
            } else {
                 if (lastMarqueeContent !== '') {
                    updateMarquee('');
                    lastMarqueeContent = '';
                 }
            }
        }

        function moveRandomly() {
            const displayElement = document.getElementById('dateTimeDisplay');
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            const elementRect = displayElement.getBoundingClientRect();
            const safeMargin = 20;

            const maxX = (viewportWidth - elementRect.width) / 2 - safeMargin;
            const maxY = (viewportHeight - elementRect.height) / 2 - safeMargin;

            const newTargetX = Math.random() * (maxX * 2) - maxX;
            const newTargetY = Math.random() * (maxY * 2) - maxY;

            displayElement.style.transform = `translate(calc(-50% + ${newTargetX}px), calc(-60% + ${newTargetY}px))`;
        }

        function resetPosition() {
            const displayElement = document.getElementById('dateTimeDisplay');
            displayElement.style.transform = `translate(-50%, -60%)`;
        }

        function restoreDefaults() {
            displaySettings = { ...defaultDisplaySettings };
            saveSettings();
            updateSettingsModalUI();
            
            const textOverlay = document.getElementById('text-scanline-overlay');
            textOverlay.classList.add('active', 'pattern-a');
            textOverlay.classList.remove('pattern-b');

            const backgroundOverlay = document.getElementById('background-scanline-overlay');
            backgroundOverlay.classList.add('active', 'pattern-a');
            backgroundOverlay.classList.remove('pattern-b');
            
            if (displaySettings.enableMovement) {
                moveRandomly();
            } else {
                resetPosition();
            }

            lastMarqueeContent = '';
            updateDateTime();
        }

        function getRandomColor() {
            return '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0');
        }

        function setRandomColors() {
            for (const key in displaySettings) {
                if (key.toLowerCase().includes('color')) {
                    displaySettings[key] = getRandomColor();
                }
            }
            saveSettings();
            updateSettingsModalUI();
            updateDateTime();
        }

        function generateCalendar(year, month) {
            const calendarGrid = document.getElementById('calendarGrid');
            const calendarMonthYear = document.getElementById('calendarMonthYear');
            const weekdaysContainer = document.getElementById('calendarWeekdays');
            if(!calendarGrid || !calendarMonthYear || !weekdaysContainer) return;

            calendarGrid.innerHTML = '';
            weekdaysContainer.innerHTML = '';

            ['Êó•', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠'].forEach(day => {
                const weekdayEl = document.createElement('div');
                weekdayEl.textContent = day;
                weekdaysContainer.appendChild(weekdayEl);
            });

            calendarMonthYear.textContent = `${year}Âπ¥ ${month + 1}Êúà`;

            const firstDayOfMonth = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();

            for (let i = 0; i < 42; i++) {
                const dayCell = document.createElement('div');
                dayCell.classList.add('calendar-day');
                const dayNumber = i - firstDayOfMonth + 1;

                if (dayNumber > 0 && dayNumber <= daysInMonth) {
                    const currentDate = new Date(year, month, dayNumber);
                    const lunar = Solar.fromDate(currentDate).getLunar();
                    dayCell.innerHTML = `
                        <div class="gregorian-day">${dayNumber}</div>
                        <div class="lunar-day">${lunar.getDay() === 1 ? lunar.getMonthInChinese().replace('Èó∞', 'Èñè') + 'Êúà' : lunar.getDayInChinese()}</div>
                    `;
                    if (today.getFullYear() === year && today.getMonth() === month && dayNumber === today.getDate()) {
                        dayCell.classList.add('is-today');
                    }
                } else {
                    dayCell.classList.add('other-month');
                }
                calendarGrid.appendChild(dayCell);
            }
        }

        function generateWeekCalendar(baseDate) {
            const grid = document.getElementById('weeklyCalendarGrid');
            const title = document.getElementById('weeklyCalendarTitle');
            if (!grid || !title) return;

            grid.innerHTML = '';
            const today = new Date();
            const startOfWeek = new Date(baseDate);
            startOfWeek.setDate(baseDate.getDate() - baseDate.getDay());

            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);

            title.textContent = `${startOfWeek.getFullYear()}Âπ¥${startOfWeek.getMonth() + 1}Êúà${startOfWeek.getDate()}Êó• - ${endOfWeek.getFullYear()}Âπ¥${endOfWeek.getMonth() + 1}Êúà${endOfWeek.getDate()}Êó•`;

            const weekdays = ['Âë®Êó•', 'Âë®‰∏Ä', 'Âë®‰∫å', 'Âë®‰∏â', 'Âë®Âõõ', 'Âë®‰∫î', 'Âë®ÂÖ≠'];

            for (let i = 0; i < 7; i++) {
                const day = new Date(startOfWeek);
                day.setDate(startOfWeek.getDate() + i);
                
                const dayCell = document.createElement('div');
                dayCell.classList.add('weekly-calendar-day');

                if (day.toDateString() === today.toDateString()) {
                    dayCell.classList.add('is-today');
                }

                const lunar = Solar.fromDate(day).getLunar();
                
                dayCell.innerHTML = `
                    <div class="weekly-day-header">${weekdays[i]}</div>
                    <div class="weekly-gregorian-day">${day.getDate()}</div>
                    <div class="weekly-lunar-day">${lunar.getDay() === 1 ? lunar.getMonthInChinese().replace('Èó∞', 'Èñè') + 'Êúà' : lunar.getDayInChinese()}</div>
                `;
                grid.appendChild(dayCell);
            }
        }

        function generateYearCalendar(year) {
            const grid = document.getElementById('yearlyCalendarGrid');
            const title = document.getElementById('yearlyCalendarTitle');
            if (!grid || !title) return;

            grid.innerHTML = '';
            title.textContent = `${year}Âπ¥`;
            const today = new Date();
            const weekdays = ['Êó•', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠'];

            for (let month = 0; month < 12; month++) {
                const monthContainer = document.createElement('div');
                monthContainer.classList.add('yearly-month-container');

                const monthHeader = document.createElement('div');
                monthHeader.classList.add('yearly-month-header');
                monthHeader.textContent = `${month + 1}Êúà`;
                monthContainer.appendChild(monthHeader);

                const weekdaysDiv = document.createElement('div');
                weekdaysDiv.classList.add('yearly-weekdays');
                weekdays.forEach(day => {
                    const weekdayEl = document.createElement('div');
                    weekdayEl.textContent = day;
                    weekdaysDiv.appendChild(weekdayEl);
                });
                monthContainer.appendChild(weekdaysDiv);

                const dayGrid = document.createElement('div');
                dayGrid.classList.add('yearly-day-grid');

                const firstDayOfMonth = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                for (let i = 0; i < firstDayOfMonth; i++) {
                    const emptyCell = document.createElement('div');
                    dayGrid.appendChild(emptyCell);
                }

                for (let day = 1; day <= daysInMonth; day++) {
                    const dayCell = document.createElement('div');
                    dayCell.classList.add('yearly-day');
                    dayCell.textContent = day;
                    if (today.getFullYear() === year && today.getMonth() === month && day === today.getDate()) {
                        dayCell.classList.add('is-today');
                    }
                    dayGrid.appendChild(dayCell);
                }
                monthContainer.appendChild(dayGrid);
                grid.appendChild(monthContainer);
            }
        }

        window.onload = function () {
            loadSettings();
            
            if (displaySettings.enableTextScanline) {
                document.getElementById('text-scanline-overlay').classList.add('active', 'pattern-a');
            }
            if (displaySettings.enableBackgroundScanline) {
                document.getElementById('background-scanline-overlay').classList.add('active', 'pattern-a');
            }
            if (!displaySettings.enableMovement) {
                resetPosition();
            }

            updateSettingsModalUI();
            updateDateTime();
            setInterval(updateDateTime, 1000);

            document.querySelectorAll('.modal').forEach(modal => {
                const closeButton = modal.querySelector('.action-button[id^="close"], .action-button[id^="done"]');
                if (closeButton) {
                    closeButton.onclick = () => modal.classList.remove('is-active');
                }
                modal.addEventListener('click', (event) => {
                    if (event.target === modal) {
                        modal.classList.remove('is-active');
                    }
                });
            });

            document.getElementById('prevMonthBtn').onclick = () => {
                calendarDate.setMonth(calendarDate.getMonth() - 1);
                generateCalendar(calendarDate.getFullYear(), calendarDate.getMonth());
            };
            document.getElementById('nextMonthBtn').onclick = () => {
                calendarDate.setMonth(calendarDate.getMonth() + 1);
                generateCalendar(calendarDate.getFullYear(), calendarDate.getMonth());
            };
            
            document.getElementById('prevWeekBtn').onclick = () => {
                weeklyCalendarDate.setDate(weeklyCalendarDate.getDate() - 7);
                generateWeekCalendar(weeklyCalendarDate);
            };
            document.getElementById('nextWeekBtn').onclick = () => {
                weeklyCalendarDate.setDate(weeklyCalendarDate.getDate() + 7);
                generateWeekCalendar(weeklyCalendarDate);
            };
            
            document.getElementById('prevYearBtn').onclick = () => {
                yearlyCalendarDate.setFullYear(yearlyCalendarDate.getFullYear() - 1);
                generateYearCalendar(yearlyCalendarDate.getFullYear());
            };
            document.getElementById('nextYearBtn').onclick = () => {
                yearlyCalendarDate.setFullYear(yearlyCalendarDate.getFullYear() + 1);
                generateYearCalendar(yearlyCalendarDate.getFullYear());
            };

            document.querySelectorAll('.switch input[type="checkbox"]').forEach(toggle => {
                toggle.onchange = (event) => {
                    displaySettings[event.target.id] = event.target.checked;
                    
                    if (event.target.id === 'enableMovement' && !event.target.checked) {
                        resetPosition();
                    }
                    
                    saveSettings();
                    lastMarqueeContent = '';
                    updateDateTime(); // Á´ãÂç≥Êõ¥Êñ∞‰∏ÄÊ¨°‰ª•ÂèçÊò†ÈñãÈóúËÆäÂåñ
                };
            });

            document.querySelectorAll('input[type="color"]').forEach(colorInput => {
                colorInput.oninput = (event) => {
                    displaySettings[event.target.id] = event.target.value;
                    saveSettings();
                    updateDateTime();
                };
            });

            document.getElementById('restoreDefaultsBtn').onclick = restoreDefaults;
            document.getElementById('randomColorsBtn').onclick = setRandomColors;

            document.getElementById('dateTimeDisplay').addEventListener('click', function(event) {
                const now = new Date();
                const solar = Solar.fromDate(now);
                const lunar = solar.getLunar();

                const secondsElement = event.target.closest('#secondsDisplay');
                const lunarDayElement = event.target.closest('.lunar-day-target');
                const lunarShiChenElement = event.target.closest('.lunar-shichen-target');
                const jieqiMarqueeElement = event.target.closest('#jieqiHolidayMarqueeContainer');
                const weekdayElement = event.target.closest('.weekday-target');
                const gregorianDateElement = event.target.closest('.gregorian-date-text:not(.gregorian-year-target)');
                const lunarDateElement = event.target.closest('.lunar-date-static-text:not(.lunar-year-target)');
                const gregorianYearElement = event.target.closest('.gregorian-year-target');
                const lunarYearElement = event.target.closest('.lunar-year-target');

                if (secondsElement) {
                    document.getElementById('settingsModal').classList.add('is-active');
                    updateSettingsModalUI();
                } else if (lunarDayElement) {
                    const yijiHtml = `
                        <p><strong>Ëæ≤ÊõÜÊó•ÊúüÔºö</strong> ${lunar.getMonthInChinese().replace('Èó∞', 'Èñè')}Êúà${lunar.getDayInChinese()}</p>
                        <p style="margin-top: 15px;"><strong>ÂÆúÔºö</strong> ${lunar.getDayYi().join('„ÄÅ') || 'ÁÑ°'}</p>
                        <p style="margin-top: 15px;"><strong>ÂøåÔºö</strong> ${lunar.getDayJi().join('„ÄÅ') || 'ÁÑ°'}</p>
                        <p style="margin-top: 15px; font-size: 0.9em; color: #aaa;">ÊØèÊó•ÂÆúÂøåÂÉÖ‰æõÂèÉËÄÉÔºåË´ãÂãøÈÅéÂ∫¶Ëø∑‰ø°„ÄÇ</p>`;
                    document.getElementById('yijiDetailsContent').innerHTML = yijiHtml;
                    document.getElementById('yijiDetailsModal').classList.add('is-active');
                } else if (lunarShiChenElement) {
                    const yijiHtml = `
                        <p><strong>ÊôÇËæ∞Ôºö</strong> ${getShiChen(now.getHours())}ÊôÇ</p>
                        <p style="margin-top: 15px;"><strong>ÂÆúÔºö</strong> ${lunar.getTimeYi().join('„ÄÅ') || 'ÁÑ°'}</p>
                        <p style="margin-top: 15px;"><strong>ÂøåÔºö</strong> ${lunar.getTimeJi().join('„ÄÅ') || 'ÁÑ°'}</p>
                        <p style="margin-top: 15px; font-size: 0.9em; color: #aaa;">ÊôÇËæ∞ÂÆúÂøåÂÉÖ‰æõÂèÉËÄÉÔºåË´ãÂãøÈÅéÂ∫¶Ëø∑‰ø°„ÄÇ</p>`;
                    document.getElementById('yijiDetailsContent').innerHTML = yijiHtml;
                    document.getElementById('yijiDetailsModal').classList.add('is-active');
                } else if (jieqiMarqueeElement) {
                    const jieqiName = jieqiMarqueeElement.dataset.jieqiName;
                    const jieqiDateStr = jieqiMarqueeElement.dataset.jieqiDate;
                    const daysUntilJieqi = jieqiMarqueeElement.dataset.daysUntilNextJieqi;
                    const holidayName = jieqiMarqueeElement.dataset.nextHolidayName;
                    const holidayDateStr = jieqiMarqueeElement.dataset.nextHolidayDate;
                    const daysUntilHoliday = jieqiMarqueeElement.dataset.nextHolidayDaysUntil;
                    const currentHoliday = jieqiMarqueeElement.dataset.currentHolidayName;
                    
                    let detailsHtml = '';
                    if (jieqiName && jieqiDateStr) {
                        const date = new Date(jieqiDateStr);
                        const formattedDate = `${date.getFullYear()}Âπ¥${(date.getMonth() + 1)}Êúà${date.getDate()}Êó•`;
                        detailsHtml += (parseInt(daysUntilJieqi) === 0)
                            ? `<p>‰ªäÂ§© <strong>${jieqiName}</strong></p>`
                            : `<p>${formattedDate} <strong>${jieqiName}</strong> ÈÇÑÊúâ${daysUntilJieqi}Â§©</p>`;
                        detailsHtml += `<p style="margin-top: 10px; font-size: 1.2em;">${getJieqiDescription(jieqiName)}</p>`;
                    } else {
                        detailsHtml += `<p>ÁõÆÂâçÊ≤íÊúâÁØÄÊ∞£Ë≥áË®ä„ÄÇ</p>`;
                    }

                    detailsHtml += `<hr style="margin: 20px 0; border-color: #555;">`;

                    if (currentHoliday) {
                        detailsHtml += `<p>‰ªäÂ§© <strong>${currentHoliday}</strong></p>`;
                    } else if (holidayName && holidayDateStr) {
                        const date = new Date(holidayDateStr);
                        const formattedDate = `${date.getFullYear()}Âπ¥${(date.getMonth() + 1)}Êúà${date.getDate()}Êó•`;
                        detailsHtml += `<p>${formattedDate} <strong>${holidayName}</strong> ÈÇÑÊúâ${daysUntilHoliday}Â§©</p>`;
                    } else {
                        detailsHtml += `<p>ÁõÆÂâçÊ≤íÊúâÁØÄÊó•Ë≥áË®ä„ÄÇ</p>`;
                    }

                    document.getElementById('jieqiDetailsContent').innerHTML = detailsHtml;
                    document.getElementById('jieqiDetailsModal').classList.add('is-active');
                } else if (gregorianYearElement || lunarYearElement) {
                    yearlyCalendarDate = new Date();
                    generateYearCalendar(yearlyCalendarDate.getFullYear());
                    document.getElementById('yearlyCalendarModal').classList.add('is-active');
                } else if (weekdayElement) {
                    weeklyCalendarDate = new Date();
                    generateWeekCalendar(weeklyCalendarDate);
                    document.getElementById('weeklyCalendarModal').classList.add('is-active');
                } else if (gregorianDateElement || lunarDateElement) {
                    calendarDate = new Date();
                    generateCalendar(calendarDate.getFullYear(), calendarDate.getMonth());
                    document.getElementById('calendarModal').classList.add('is-active');
                }
            });
        };
    </script>
</body>
</html>
ÔøΩ
