<!DOCTYPE html>
<html lang="zh-Hant">
<head>
	<meta charset="UTF-8"> <!-- è¨­å®šç¶²é å­—å…ƒç·¨ç¢¼ç‚ºUTF-8 -->
	<meta content="width=device-width, initial-scale=1.0" name="viewport"> <!-- è¨­å®šè¦–å£ï¼Œè®“ç¶²é åœ¨ä¸åŒè£ç½®ä¸Šæ­£ç¢ºé¡¯ç¤º -->
	<title>æ™‚é–“</title> <!-- ç¶²é æ¨™é¡Œ -->
	<script src="https://unpkg.com/lunar-javascript@1.7.3/lunar.js"></script> <!-- å¼•å…¥è¾²æ›†è½‰æ›çš„å¤–éƒ¨JavaScriptå‡½å¼åº« -->
	<link href="https://fonts.cdnfonts.com/css/digital-dismay" rel="stylesheet"> <!-- å¼•å…¥æ•¸ä½æ™‚é˜å­—å‹ -->
	<style>
		:root { --page-background-color: #000; } /* å®šç¾©CSSè®Šæ•¸ï¼Œç”¨æ–¼å…¨åŸŸèƒŒæ™¯é¡è‰² */
		*, *::before, *::after { box-sizing: border-box; } /* è¨­å®šæ‰€æœ‰å…ƒç´ çš„ç›’æ¨¡å‹ç‚ºborder-box */
		body {
			margin: 0; overflow: hidden; display: flex; /* ç§»é™¤å¤–é‚Šè·ã€éš±è—æ»¾å‹•æ¢ã€ä½¿ç”¨Flexä½ˆå±€ */
			justify-content: center; align-items: center; /* æ°´å¹³å‚ç›´å±…ä¸­ */
			min-height: 100vh; width: 100vw; /* æœ€å°é«˜å¯¬ç‚ºæ•´å€‹è¦–å£ */
			position: relative; /* ç›¸å°å®šä½ */
			font-family: 'Inter', sans-serif; /* è¨­å®šé è¨­å­—é«” */
			background-color: var(--page-background-color); /* è¨­å®šèƒŒæ™¯é¡è‰² */
		}
		#dateTimeDisplay {
			font-family: 'Digital Dismay', 'Segoe UI'; sans-serif; /* æ•¸ä½æ™‚é˜å­—å‹ */
			font-weight: bold; text-align: center; padding: 10px; /* å­—é«”åŠ ç²—ã€æ–‡å­—å±…ä¸­ã€å…§é‚Šè· */
			text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5); /* æ–‡å­—é™°å½± */
			position: absolute; left: 50%; top: 50%; /* çµ•å°å®šä½ä¸¦ç½®ä¸­ */
			transform: translate(-50%, -50%); /* é€éä½ç§»å°‡å…ƒç´ ä¸­å¿ƒé»å°æº– */
			transition: transform 1s ease-in-out; /* ä½ç§»éæ¸¡å‹•ç•« */
			cursor: default; z-index: 10; /* é è¨­é¼ æ¨™ã€å †ç–Šé †åº */
		}
		.time-text { font-size: 36vw; font-weight: normal; margin-bottom: -10vw; position: relative; display: inline-block; white-space: nowrap; padding-right: 8vw; } /* ä¸»è¦æ™‚é–“(æ™‚:åˆ†)æ¨£å¼ */
		.time-seconds { font-size: 8vw; font-weight: normal; position: absolute; right: 0; bottom: 8vw; text-align: right; width: 6vw; } /* ç§’æ•¸æ¨£å¼ */
		.time-ampm { font-size: 5vw; font-weight: bold; position: absolute; top: 8vw; right: 0; text-align: right; width: 8vw; } /* ä¸Šåˆ/ä¸‹åˆ/æ™‚æ®µæ¨£å¼ */
		.gregorian-date-text { font-family: 'Inter', sans-serif; font-size: 7.4vw; display: flex; justify-content: center; align-items: center; width: 92vw; margin: -2vw auto -3vw; white-space: nowrap; cursor: pointer; position: relative; z-index: 1; } /* å…¬æ›†æ—¥æœŸèˆ‡å¤©æ°£å®¹å™¨æ¨£å¼ */
        .gregorian-date-parts { flex-shrink: 0; } /* é˜²æ­¢å…¬æ›†æ—¥æœŸè¢«å£“ç¸® */
		.lunar-and-jieqi-line { font-family: 'Inter', sans-serif; display: flex; justify-content: center; align-items: center; font-size: 6.4vw; white-space: nowrap; width: 92vw; margin: 0 auto; overflow: hidden; position: relative; z-index: 1; } /* è¾²æ›†èˆ‡ç¯€æ°£è¡Œå®¹å™¨æ¨£å¼ */
		.lunar-date-static-text { flex-shrink: 0; text-align: right; cursor: pointer; } /* è¾²æ›†æ—¥æœŸéœæ…‹æ–‡å­—æ¨£å¼ */
		.weather-marquee-container, .jieqi-holiday-marquee-container { flex-grow: 1; overflow: hidden; position: relative; text-align: left; min-width: 0; cursor: pointer; } /* å¤©æ°£èˆ‡ç¯€æ°£è·‘é¦¬ç‡ˆå®¹å™¨ */
		.weather-marquee-inner, .jieqi-holiday-marquee-inner { display: flex; flex-wrap: nowrap; width: fit-content; will-change: transform; } /* è·‘é¦¬ç‡ˆå…§éƒ¨å®¹å™¨ */
		.weather-marquee-content, .weather-marquee-content-duplicate, .jieqi-holiday-marquee-content, .jieqi-holiday-marquee-content-duplicate { display: inline-block; white-space: nowrap; flex-shrink: 0; } /* è·‘é¦¬ç‡ˆå…§å®¹ */
		.weather-marquee-container.scrolling .weather-marquee-inner, .jieqi-holiday-marquee-container.scrolling .jieqi-holiday-marquee-inner { animation-name: marquee; animation-timing-function: linear; animation-iteration-count: infinite; } /* è·‘é¦¬ç‡ˆæ»¾å‹•å‹•ç•« */
		@keyframes marquee { from { transform: translateX(0); } to { transform: translateX(-50%); } } /* è·‘é¦¬ç‡ˆé—œéµå½±æ ¼ */
		.noscript-message { font-size: 0.5em; color: #FFB3BA; margin-top: 10px; } /* JavaScriptç¦ç”¨æ™‚è¨Šæ¯æ¨£å¼ */
		/* --- å½ˆå‡ºè¦–çª— (Modal) --- */
		.modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7); } /* å½ˆçª—èƒŒæ™¯é®ç½© */
		.modal.is-active { display: flex; justify-content: center; align-items: center; } /* å•Ÿç”¨æ™‚æ¨£å¼ */
        #dateDetailsModal, #shichenDetailsModal, #weatherForecastModal, #hourlyWeatherModal { z-index: 110; } /* [ä¿®æ”¹] æé«˜ç‰¹å®šå½ˆçª—çš„ z-index */
        #settingsModal { z-index: 120; } /* --- è¨­å®šå½ˆçª— --- */
		.modal-content { background-color: #333; margin: auto; padding: 20px; border: 1px solid #888; width: 90%; max-width: 600px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); color: #00FF00; text-align: center; display: flex; flex-direction: column; gap: 15px; max-height: 90vh; overflow-y: auto; } /* å½ˆçª—å…§å®¹å€é€šç”¨æ¨£å¼ */
		#dateDetailsModal .modal-content, #shichenDetailsModal .modal-content { max-width: 800px; }
		.details-content p { margin-bottom: 10px; font-size: 1.2em; line-height: 1.6; } /* è©³æƒ…å½ˆçª—æ®µè½æ¨£å¼ */
		.details-content strong { color: #FFD700; } /* è©³æƒ…å½ˆçª—å¼·èª¿æ–‡å­—é¡è‰² */
        .details-content .yi-ji-grid { display: grid; grid-template-columns: 40px 1fr; gap: 5px 10px; text-align: left;} /* å®œå¿Œç¶²æ ¼ä½ˆå±€ */
        .details-content .yi-ji-grid strong { grid-column: 1; color: #FFD700; } /* "å®œ"ã€"å¿Œ"æ¨™é¡Œ */
        .details-content .yi-ji-grid span { grid-column: 2; } /* å®œå¿Œå…§å®¹ */
        .details-content .countdown-section { border-top: 1px solid #555; margin-top: 15px; padding-top: 15px; font-size: 1em; } /* å€’æ•¸è¨ˆæ™‚å€å¡Šæ¨£å¼ */
		/* --- è¨­å®šå½ˆçª— --- */
		.setting-item { margin-bottom: 15px; display: flex; align-items: center; flex-wrap: wrap; gap: 10px;} /* è¨­å®šé …ç›®å®¹å™¨ */
		.setting-item label:first-child { margin-right: 10px; flex-shrink: 0;} /* æ¨™é¡Œæ–‡å­—é å·¦ä¸å£“ç¸® */
		.switch { position: relative; display: inline-block; width: 60px; height: 34px; flex-shrink: 0; } /* æ»‘å‹•é–‹é—œå®¹å™¨ */
		.switch input { opacity: 0; width: 0; height: 0; } /* éš±è—åŸå§‹checkbox */
		.slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; } /* æ»‘å‹•é–‹é—œèƒŒæ™¯æ¢ */
		.slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; } /* æ»‘å‹•é–‹é—œåœ“å½¢æ»‘å¡Š */
		input:checked + .slider { background-color: #00FF00; } /* å•Ÿç”¨æ™‚èƒŒæ™¯è‰² */
		input:focus + .slider { box-shadow: 0 0 1px #00FF00; } /* èšç„¦æ™‚å¤–æ¡†é™°å½± */
		input:checked + .slider:before { transform: translateX(26px); } /* å•Ÿç”¨æ™‚æ»‘å¡Šä½ç§» */
		.setting-item input[type="color"] { width: 40px; height: 34px; border: none; padding: 0; background: none; cursor: pointer; flex-shrink: 0; } /* é¡è‰²é¸æ“‡å™¨ */
        .setting-item input[type="text"] { background-color: #555; color: white; border: 1px solid #888; border-radius: 4px; padding: 5px; font-size: 0.9em; max-width: 100px; } /* æ–‡å­—è¼¸å…¥æ¡† */
        .setting-item button { background: none; border: none; cursor: pointer; padding: 0 5px; display: inline-flex; align-items: center; } /* è¨­å®šé …ç›®ä¸­çš„æŒ‰éˆ• */
        .setting-item button svg { width: 24px; height: 24px; stroke: white; } /* æŒ‰éˆ•çš„SVGåœ–ç¤º */
		.action-button { background-color: #555; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 1.1em; margin-top: 0px; } /* é€šç”¨æŒ‰éˆ• */
		.action-button:hover { background-color: #777; } /* æŒ‰éˆ•æ‡¸åœæ¨£å¼ */
		.button-group { display: flex; justify-content: center; gap: 10px; margin-top: 0px; white-space: nowrap; } /* æŒ‰éˆ•ç¾¤çµ„å®¹å™¨ */
		.calendar-settings-container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: space-around; width: 100%; } /* æ—¥æ›†è¨­å®šå®¹å™¨ */
		.gregorian-settings-column, .lunar-settings-column { flex: 1; min-width: 80px; padding: 10px; border: 1px solid #555; border-radius: 8px; background-color: #444; text-align: left; } /* å…¬æ›†èˆ‡è¾²æ›†è¨­å®šåˆ†æ¬„ */
		.gregorian-settings-column h3, .lunar-settings-column h3 { text-align: center; margin-top: 0; } /* åˆ†æ¬„æ¨™é¡Œ */
        .interval-selector-group { display: flex; align-items: center; gap: 5px; } /* ç‰¹æ•ˆæ™‚é–“é–“éš”é¸æ“‡å™¨å®¹å™¨ */
        .interval-select { background-color: #555; color: white; border: 1px solid #888; border-radius: 4px; padding: 5px; font-size: 0.9em; } /* ä¸‹æ‹‰é¸æ“‡å™¨ */
        .interval-select-label { color: #ccc; font-size: 0.9em; margin-left: 2px; margin-right: 5px; } /* "åˆ†"ã€"ç§’"å–®ä½æ¨™ç±¤ */
		.location-input-group { display: flex; align-items: center; gap: 5px; flex-grow: 1; } /* åœ°é»è¼¸å…¥ç¾¤çµ„ */
        .location-controls-group { display: flex; align-items: center; gap: 5px; margin-left: auto; } /* åœ°é»æ§åˆ¶æŒ‰éˆ•ç¾¤çµ„ */
        .setting-controls { margin-left: auto; display: flex; align-items: center; gap: 10px; } /* [æ–°å¢] ç”¨æ–¼å°‡æ§åˆ¶é …ç¾¤çµ„ä¸¦æ¨åˆ°å³å´çš„å®¹å™¨ */
		/* --- æ—¥æ›† --- */
		.calendar-header { display: flex; justify-content: space-between; align-items: center; padding: 0 10px; } /* æ—¥æ›†é ­éƒ¨å®¹å™¨ */
		.calendar-header h2 { margin: 0; font-size: 1.5em; color: #00FF00; } /* æ—¥æ›†æ¨™é¡Œ */
		.calendar-header button { background: none; border: none; color: #00FF00; font-size: 2em; cursor: pointer; } /* æ—¥æ›†åˆ‡æ›æŒ‰éˆ• */
        .calendar-footer { display: flex; justify-content: center; gap: 10px; width: 100%; margin-top: 10px; } /* æ—¥æ›†åº•éƒ¨æŒ‰éˆ•å€ */
		.calendar-content, .weekly-calendar-content { background-color: #2c2c2c; margin: auto; padding: 20px; border: 1px solid #888; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.6); color: #e0e0e0; display: flex; flex-direction: column; gap: 15px; max-height: 90vh; width: 95%; max-width: 900px; } /* æœˆ/é€±æ›†å…§å®¹å€é€šç”¨æ¨£å¼ */
        .yearly-calendar-content { background-color: #2c2c2c; margin: auto; padding: 20px; border: 1px solid #888; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.6); color: #e0e0e0; display: flex; flex-direction: column; gap: 15px; max-height: 90vh; width: 95%; max-width: 1400px; } /* å¹´æ›†å…§å®¹å€æ¨£å¼ */
		.calendar-weekdays, .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; } /* æœˆæ›†æ˜ŸæœŸèˆ‡æ—¥æœŸç¶²æ ¼ */
		.calendar-weekdays div { font-weight: bold; color: #aaa; padding-bottom: 5px; } /* æ˜ŸæœŸæ¨™é ­ */
		.calendar-day { background-color: #444; border-radius: 5px; padding: 5px; min-height: 80px; display: flex; flex-direction: column; justify-content: flex-start; align-items: center; font-size: 0.9em; border: 1px solid #555; cursor: pointer; transition: background-color 0.3s; } /* æœˆæ›†æ¯æ—¥æ ¼å­ */
        .calendar-day:hover { background-color: #5e5e5e; } /* æ¯æ—¥æ ¼å­æ‡¸åœ */
		.calendar-day.other-month { color: #777; background-color: #3a3a3a; cursor: default; } /* éç•¶æœˆæ—¥æœŸ */
		.calendar-day.is-today { border-color: #00FF00; box-shadow: 0 0 5px #00FF00; } /* ç•¶å¤©æ—¥æœŸ */
		.calendar-day .gregorian-day { font-size: 1.2em; font-weight: bold; } /* æœˆæ›†å…¬æ›†æ•¸å­— */
		.calendar-day .lunar-day { font-size: 0.8em; color: #ccc; } /* æœˆæ›†è¾²æ›†æ–‡å­— */
        .calendar-day .event-indicator { font-size: 0.75em; padding: 1px 4px; border-radius: 3px; margin-top: 3px; display: block; text-align: center; width: 90%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; } /* äº‹ä»¶æ¨™è¨˜ */
        .event-indicator.holiday { background-color: #007bff; color: white; } /* ç¯€æ—¥æ¨™è¨˜é¡è‰² */
        .event-indicator.jieqi { background-color: #28a745; color: white; } /* ç¯€æ°£æ¨™è¨˜é¡è‰² */
		.weekly-calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; } /* é€±æ›†æ—¥æœŸç¶²æ ¼ */
		.weekly-calendar-day { background-color: #444; border-radius: 8px; padding: 10px; min-height: 100px; display: flex; flex-direction: column; align-items: center; border: 1px solid #555; cursor: pointer; transition: background-color 0.3s; } /* é€±æ›†æ¯æ—¥æ ¼å­ */
        .weekly-calendar-day:hover { background-color: #5e5e5e; } /* é€±æ›†æ¯æ—¥æ ¼å­æ‡¸åœ */
		.weekly-calendar-day.is-today { border-color: #00FF00; box-shadow: 0 0 5px #00FF00; } /* é€±æ›†ç•¶å¤© */
		.weekly-day-header { font-weight: bold; font-size: 1.1em; margin-bottom: 5px; } /* é€±æ›†æ˜ŸæœŸæ¨™é ­ */
		.weekly-gregorian-day { font-size: 1.5em; font-weight: bold; } /* é€±æ›†å…¬æ›†æ•¸å­— */
		.weekly-lunar-day { font-size: 0.9em; color: #ccc; margin-top: 5px; } /* é€±æ›†è¾²æ›†æ–‡å­— */
        .weekly-calendar-day .event-indicator { font-size: 0.8em; padding: 2px 5px; border-radius: 4px; margin-top: 5px; display: block; text-align: center; width: 90%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;} /* é€±æ›†äº‹ä»¶æ¨™è¨˜ */
		.yearly-calendar-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; overflow-y: auto; padding: 10px; } /* å¹´æ›†æœˆä»½ç¶²æ ¼ */
		.yearly-month-container { background-color: #3a3a3a; border-radius: 8px; padding: 10px; border: 1px solid #555; } /* å¹´æ›†æœˆä»½å®¹å™¨ */
		.yearly-month-header { font-size: 1.2em; font-weight: bold; text-align: center; margin-bottom: 10px; color: #00FF00; } /* å¹´æ›†æœˆä»½æ¨™é ­ */
		.yearly-weekdays, .yearly-day-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px; text-align: center; } /* å¹´æ›†æ˜ŸæœŸèˆ‡æ—¥æœŸç¶²æ ¼ */
		.yearly-weekdays div { font-size: 0.8em; color: #aaa; } /* å¹´æ›†æ˜ŸæœŸæ¨™é ­ */
		.yearly-day { font-size: 0.9em; padding: 2px; border-radius: 3px; position: relative; cursor: pointer; transition: background-color 0.3s; min-height: 24px; } /* å¹´æ›†æ¯æ—¥æ ¼å­ */
        .yearly-day:hover { background-color: #555; } /* å¹´æ›†æ¯æ—¥æ ¼å­æ‡¸åœ */
		.yearly-day.is-today { background-color: #00FF00; color: #000; font-weight: bold; } /* å¹´æ›†ç•¶å¤© */
        .yearly-indicators { position: absolute; bottom: 1px; left: 50%; transform: translateX(-50%); display: flex; gap: 2px; } /* å¹´æ›†äº‹ä»¶æ¨™è¨˜é»å®¹å™¨ */
        .yearly-indicators .dot { width: 4px; height: 4px; border-radius: 50%; } /* äº‹ä»¶æ¨™è¨˜é» */
        .yearly-indicators .holiday { background-color: #007bff; } /* ç¯€æ—¥æ¨™è¨˜é»é¡è‰² */
        .yearly-indicators .jieqi { background-color: #28a745; } /* ç¯€æ°£æ¨™è¨˜é»é¡è‰² */
		/* --- å¤©æ°£é å ± --- */
        #weatherForecastModal .modal-content, #hourlyWeatherModal .modal-content { max-width: 1000px; } /* [ä¿®æ”¹] é å ±å½ˆçª—æœ€å¤§å¯¬åº¦ */
        .weather-forecast-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(90px, 1fr)); gap: 10px; width: 100%; text-align: center; } /* é å ±ç¶²æ ¼ */
        .forecast-day { background-color: #444; padding: 10px; border-radius: 8px; border: 1px solid #555; cursor: pointer; transition: background-color 0.3s; } /* [ä¿®æ”¹] é å ±æ¯æ—¥æ ¼å­ */
        .forecast-day:hover { background-color: #5e5e5e; } /* [æ–°å¢] æ¯æ—¥æ ¼å­æ‡¸åœæ•ˆæœ */
        .forecast-day p { margin: 2px 0; font-size: 1em; line-height: 1.4; } /* é å ±æ–‡å­— */
        .forecast-day .day-name { font-weight: bold; color: #FFD700; } /* æ˜ŸæœŸåç¨± */
        .forecast-day .weather-icon { font-size: 2em; margin: 5px 0; } /* å¤©æ°£åœ–ç¤º */
        .forecast-day .temp-high { color: #FFA07A; } /* æœ€é«˜æº« */
        .forecast-day .temp-low { color: #87CEFA; } /* æœ€ä½æº« */
        /* [ä¿®æ”¹] æ¯å°æ™‚å¤©æ°£é å ±æ¨£å¼ */
        .hourly-weather-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 10px; width: 100%; text-align: center; }
        .hourly-item { background-color: #444; padding: 10px; border-radius: 8px; border: 1px solid #555; }
        .hourly-item p { margin: 2px 0; font-size: 0.9em; line-height: 1.3; }
        .hourly-item .hour-time { font-weight: bold; color: #FFD700; }
        .hourly-item .weather-icon { font-size: 1.8em; margin: 4px 0; }
        /* [æ–°å¢] ç•¶å‰æ™‚æ®µé«˜äº®æ¨£å¼ */
        .hourly-item.is-now { border-color: #00FF00; box-shadow: 0 0 8px #00FF00; }
		/* --- ç‰¹æ•ˆ --- */
		#background-scanline-overlay, #text-scanline-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; background-color: transparent; display: none; } /* æƒæç·šè¦†è“‹å±¤ */
		#background-scanline-overlay { z-index: 1; } /* èƒŒæ™¯æƒæç·šå †ç–Šé †åº */
		#text-scanline-overlay { z-index: 50; } /* æ–‡å­—æƒæç·šå †ç–Šé †åº */
		#background-scanline-overlay.active.pattern-a { display: block; background-image: repeating-linear-gradient(to bottom, transparent, transparent 2px, rgba(0,0,0,0.3) 2px, rgba(0,0,0,0.3) 4px); } /* èƒŒæ™¯æƒæç·šæ¨£å¼A */
		#background-scanline-overlay.active.pattern-b { display: block; background-image: repeating-linear-gradient(to bottom, rgba(0,0,0,0.3) 0, rgba(0,0,0,0.3) 2px, transparent 2px, transparent 4px); } /* èƒŒæ™¯æƒæç·šæ¨£å¼B */
		#text-scanline-overlay.active.pattern-a { display: block; background-image: repeating-linear-gradient(to bottom, transparent, transparent 2px, var(--page-background-color) 2px, var(--page-background-color) 4px); } /* æ–‡å­—æƒæç·šæ¨£å¼A */
		#text-scanline-overlay.active.pattern-b { display: block; background-image: repeating-linear-gradient(to bottom, var(--page-background-color) 0, var(--page-background-color) 2px, transparent 2px, transparent 4px); } /* æ–‡å­—æƒæç·šæ¨£å¼B */
		/* --- æ§åˆ¶åœ–ç¤º --- */
		.control-icon { position: fixed; bottom: 20px; width: 32px; height: 32px; cursor: pointer; z-index: 200; opacity: 0.5; transition: opacity 0.3s ease; } /* é€šç”¨æ¨£å¼ */
		.control-icon svg { width: 100%; height: 100%; fill: #fff; } /* SVGæ¨£å¼ */
		.control-icon:hover { opacity: 1; } /* æ‡¸åœæ™‚ä¸é€æ˜ */
		#settings-icon { right: 62px; } /* è¨­å®šåœ–ç¤ºä½ç½® */
		#fullscreen-icon { right: 20px; } /* å…¨è¢å¹•åœ–ç¤ºä½ç½® */
	</style>
</head>
<body>
    <div id="content-wrapper"> <!-- ä¸»è¦å…§å®¹å®¹å™¨ -->
        <div id="background-scanline-overlay"></div> <!-- æƒæç·šç‰¹æ•ˆçš„è¦†è“‹å±¤ -->
        <div id="text-scanline-overlay"></div> <!-- æƒæç·šç‰¹æ•ˆçš„è¦†è“‹å±¤ -->
        <div id="dateTimeDisplay"> <!-- æ—¥æœŸèˆ‡æ™‚é–“é¡¯ç¤ºçš„ä¸»è¦å€å¡Š -->
            <div class="time-text" id="timeTextContainer">
                <span id="hoursMinutesDisplay"></span><span class="time-seconds" id="secondsDisplay"></span><span class="time-ampm" id="amPmDisplay"></span>
            </div>
            <div class="gregorian-date-text" id="gregorianDateDisplay">
                <span class="gregorian-date-parts" id="gregorianDateParts"></span>
                <div class="weather-marquee-container" id="weatherMarqueeContainer">
                    <div class="weather-marquee-inner" id="weatherMarqueeInner">
                        <span class="weather-marquee-content"></span><span class="weather-marquee-content-duplicate"></span>
                    </div>
                </div>
            </div>
            <div class="lunar-and-jieqi-line" id="lunarAndJieqiLine">
                <span class="lunar-date-static-text" id="lunarDateDisplay"></span>
                <div class="jieqi-holiday-marquee-container" id="jieqiHolidayMarqueeContainer">
                    <div class="jieqi-holiday-marquee-inner" id="jieqiHolidayMarqueeInner">
                        <span class="jieqi-holiday-marquee-content"></span><span class="jieqi-holiday-marquee-content-duplicate"></span>
                    </div>
                </div>
            </div>
        </div>
        <noscript><div class="noscript-message">æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´æˆ–å·²ç¦ç”¨ JavaScriptã€‚</div></noscript> <!-- JSç¦ç”¨æç¤º -->
        <div class="modal" id="settingsModal"> <!-- è¨­å®šå½ˆå‡ºè¦–çª— -->
            <div class="modal-content">
                <h2>é¡¯ç¤ºè¨­å®š</h2>
                <div class="calendar-settings-container">
                    <div class="gregorian-settings-column">
                        <h3>å…¬æ›†</h3>
                        <div class="setting-item">
                            <label for="textColor">æ™‚é–“</label>
                            <div class="setting-controls">
                                <label class="switch" title="åˆ‡æ›12/24å°æ™‚æ ¼å¼"><input id="showAmPm" type="checkbox"> <span class="slider"></span></label>
                                <input id="textColor" type="color">
                            </div>
                        </div>
                        <div class="setting-item">
                            <label for="showGregorianYear">å¹´</label>
                            <div class="setting-controls">
                                <label class="switch"><input id="showGregorianYear" type="checkbox"> <span class="slider"></span></label>
                                <input id="gregorianYearColor" type="color">
                            </div>
                        </div>
                        <div class="setting-item">
                            <label for="showGregorianMonth">æœˆ</label>
                            <div class="setting-controls">
                                <label class="switch"><input id="showGregorianMonth" type="checkbox"> <span class="slider"></span></label>
                                <input id="gregorianMonthColor" type="color">
                            </div>
                        </div>
                        <div class="setting-item">
                            <label for="showGregorianDay">æ—¥</label>
                            <div class="setting-controls">
                                <label class="switch"><input id="showGregorianDay" type="checkbox"> <span class="slider"></span></label>
                                <input id="gregorianDayColor" type="color">
                            </div>
                        </div>
                        <div class="setting-item">
                            <label for="showGregorianWeekday">å‘¨</label>
                            <div class="setting-controls">
                                <label class="switch"><input id="showGregorianWeekday" type="checkbox"> <span class="slider"></span></label>
                                <input id="gregorianWeekdayColor" type="color">
                            </div>
                        </div>
                    </div>
                    <div class="lunar-settings-column">
                        <h3>è¾²æ›†</h3>
                        <div class="setting-item">
                            <label for="showMinguoYear">å¹´</label>
                            <div class="setting-controls">
                                <label class="switch"><input id="showMinguoYear" type="checkbox"> <span class="slider"></span></label>
                                <input id="minguoYearColor" type="color">
                            </div>
                        </div>
                        <div class="setting-item">
                            <label for="showLunarMonth">æœˆ</label>
                            <div class="setting-controls">
                                <label class="switch"><input id="showLunarMonth" type="checkbox"> <span class="slider"></span></label>
                                <input id="lunarMonthColor" type="color">
                            </div>
                        </div>
                        <div class="setting-item">
                            <label for="showLunarDay">æ—¥</label>
                            <div class="setting-controls">
                                <label class="switch"><input id="showLunarDay" type="checkbox"> <span class="slider"></span></label>
                                <input id="lunarDayColor" type="color">
                            </div>
                        </div>
                        <div class="setting-item">
                            <label for="showLunarShiChen">æ™‚</label>
                            <div class="setting-controls">
                                <label class="switch"><input id="showLunarShiChen" type="checkbox"> <span class="slider"></span></label>
                                <input id="lunarShiChenColor" type="color">
                            </div>
                        </div>
                        <div class="setting-item">
                            <label for="showJieqi">ç¯€æ°£</label>
                            <div class="setting-controls">
                                <label class="switch"><input id="showJieqi" type="checkbox"> <span class="slider"></span></label>
                                <input id="jieqiColor" type="color">
                            </div>
                        </div>
                        <div class="setting-item">
                            <label for="showHolidays">ç¯€æ—¥</label>
                            <div class="setting-controls">
                                <label class="switch"><input id="showHolidays" type="checkbox"> <span class="slider"></span></label>
                                <input id="holidayColor" type="color">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="setting-item">
                    <label for="showWeather">å¤©æ°£è³‡è¨Š</label>
                    <div class="setting-controls">
                        <label class="switch"><input id="showWeather" type="checkbox"><span class="slider"></span></label>
                        <input id="weatherColor" type="color">
                    </div>
                </div>
                <div class="setting-item">
                    <label for="showWeatherLocation">å¤©æ°£åœ°å€</label>
                    <div class="location-input-group">
                        <select id="countySelect" class="interval-select" style="max-width: 85px;"></select>
                        <select id="districtSelect" class="interval-select" style="max-width: 85px;"></select>
                        <input id="weatherLocation" type="text" class="interval-select" title="å¯æ‰‹å‹•è¼¸å…¥è‹±æ–‡åœ°å" placeholder="æ‰‹å‹•è¼¸å…¥(è‹±æ–‡)" style="width: 120px; margin-left: 5px;">
                    </div>
                    <div class="location-controls-group">
                        <button id="useCurrentLocationBtn" title="ä½¿ç”¨ç›®å‰ä½ç½®"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L12 6"/><path d="M12 18L12 22"/><path d="M20 12L22 12"/><path d="M2 12L4 12"/><circle cx="12" cy="12" r="2"/><path d="M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16z"/></svg></button>
                        <label class="switch"><input id="showWeatherLocation" type="checkbox"><span class="slider"></span></label>
                        <input id="weatherLocationColor" type="color">
                    </div>
                </div>
                <div class="setting-item">
                    <label for="enableBackgroundScanline">èƒŒæ™¯æƒæç·š</label>
                    <div class="setting-controls">
                        <label class="switch"><input id="enableBackgroundScanline" type="checkbox"><span class="slider"></span></label>
                    </div>
                </div>
                <div class="setting-item">
                    <label for="enableTextScanline">æ–‡å­—æƒæç·š</label>
                    <div class="setting-controls">
                        <div class="interval-selector-group">
                            <select id="scanlineIntervalMinutes" class="interval-select"></select><span class="interval-select-label">åˆ†</span>
                            <select id="scanlineIntervalSeconds" class="interval-select"></select><span class="interval-select-label">ç§’</span>
                        </div>
                        <label class="switch"><input id="enableTextScanline" type="checkbox"><span class="slider"></span></label>
                    </div>
                </div>
                <div class="setting-item">
                    <label for="enableMovement">éš¨æ©Ÿç§»å‹•</label>
                    <div class="setting-controls">
                        <div class="interval-selector-group">
                            <select id="movementIntervalMinutes" class="interval-select"></select><span class="interval-select-label">åˆ†</span>
                            <select id="movementIntervalSeconds" class="interval-select"></select><span class="interval-select-label">ç§’</span>
                        </div>
                        <label class="switch"><input id="enableMovement" type="checkbox"><span class="slider"></span></label>
                    </div>
                </div>
                <div class="setting-item">
                    <label for="backgroundColor">èƒŒæ™¯é¡è‰²</label>
                    <div class="setting-controls">
                        <input id="backgroundColor" type="color">
                    </div>
                </div>
                <div class="button-group"><button class="action-button" id="restoreDefaultsBtn">æ¢å¾©é è¨­</button><button class="action-button" id="randomColorsBtn">éš¨æ©Ÿé¡è‰²</button><button class="action-button" id="doneBtn">å®Œæˆ</button></div>
            </div>
        </div>
        <div class="modal" id="dateDetailsModal"> <!-- ç•¶æ—¥è©³æƒ…å½ˆå‡ºè¦–çª— -->
            <div class="modal-content details-content"><h2 id="dateDetailsModalTitle">ç•¶æ—¥è©³æƒ…</h2><div id="dateDetailsModalContent" style="text-align: left;"></div><button class="action-button" id="closeDateDetailsModalBtn">é—œé–‰</button></div>
        </div>
        <div class="modal" id="shichenDetailsModal"> <!-- æ™‚è¾°è©³æƒ…å½ˆå‡ºè¦–çª— -->
            <div class="modal-content details-content"><div class="calendar-header"><button id="prevShichenBtn">&lt;</button><h2 id="shichenDetailsModalTitle">æ™‚è¾°è©³æƒ…</h2><button id="nextShichenBtn">&gt;</button></div><div id="shichenDetailsModalContent" style="text-align: left;"></div><div class="button-group"><button class="action-button" id="nowShichenBtn">ç¾åœ¨</button><button class="action-button" id="closeShichenDetailsModalBtn">é—œé–‰</button></div></div>
        </div>
        <div class="modal" id="calendarModal"> <!-- æœˆæ›†å½ˆå‡ºè¦–çª— -->
            <div class="calendar-content"><div class="calendar-header"><button id="prevMonthBtn">&lt;</button><h2 id="calendarMonthYear"></h2><button id="nextMonthBtn">&gt;</button></div><div class="calendar-weekdays" id="calendarWeekdays"></div><div class="calendar-grid" id="calendarGrid"></div><div class="calendar-footer"><button class="action-button" id="todayCalendarBtn">ä»Šå¤©</button><button class="action-button" id="closeCalendarBtn">é—œé–‰</button></div></div>
        </div>
        <div class="modal" id="weeklyCalendarModal"> <!-- é€±æ›†å½ˆå‡ºè¦–çª— -->
            <div class="weekly-calendar-content"><div class="calendar-header"><button id="prevWeekBtn">&lt;</button><h2 id="weeklyCalendarTitle"></h2><button id="nextWeekBtn">&gt;</button></div><div class="weekly-calendar-grid" id="weeklyCalendarGrid"></div><div class="calendar-footer"><button class="action-button" id="todayWeeklyBtn">ä»Šå¤©</button><button class="action-button" id="closeWeeklyCalendarBtn">é—œé–‰</button></div></div>
        </div>
        <div class="modal" id="yearlyCalendarModal"> <!-- å¹´æ›†å½ˆå‡ºè¦–çª— -->
            <div class="yearly-calendar-content"><div class="calendar-header"><button id="prevYearBtn">&lt;</button><h2 id="yearlyCalendarTitle"></h2><button id="nextYearBtn">&gt;</button></div><div class="yearly-calendar-grid" id="yearlyCalendarGrid"></div><div class="calendar-footer"><button class="action-button" id="todayYearlyBtn">ä»Šå¹´</button><button class="action-button" id="closeYearlyCalendarBtn">é—œé–‰</button></div></div>
        </div>
        <div class="modal" id="weatherForecastModal"> <!-- å¤©æ°£é å ±å½ˆå‡ºè¦–çª— -->
            <div class="modal-content"><h2 id="weatherForecastModalTitle">æœªä¾†ä¸€é€±å¤©æ°£é å ±</h2><div class="weather-forecast-grid" id="weatherForecastGrid"></div><button class="action-button" id="closeWeatherForecastModalBtn">é—œé–‰</button></div>
        </div>
        <!-- [æ–°å¢] æ¯å°æ™‚å¤©æ°£é å ±å½ˆå‡ºè¦–çª— -->
        <div class="modal" id="hourlyWeatherModal">
            <div class="modal-content">
                <h2 id="hourlyWeatherModalTitle">æ¯å°æ™‚å¤©æ°£é å ±</h2>
                <div class="hourly-weather-grid" id="hourlyWeatherGrid"></div>
                <div class="button-group">
                    <button class="action-button" id="backToWeeklyForecastBtn">è¿”å›é€±é å ±</button>
                    <button class="action-button" id="closeHourlyWeatherModalBtn">é—œé–‰</button>
                </div>
            </div>
        </div>
    </div>
    <div id="settings-icon" class="control-icon" title="è¨­å®š"> <!-- è¨­å®šåœ–ç¤º -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61-.25-1.17-.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>
    </div>
    <div id="fullscreen-icon" class="control-icon" title="å…¨è¢å¹•/é€€å‡ºå…¨è¢å¹•"> <!-- å…¨è¢å¹•åœ–ç¤º -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"></path></svg>
    </div>
	<script>
		let scanlinePatternIsA = true, lastMarqueeContent = '', lastWeatherContent = ''; // å‹•æ…‹æ•ˆæœè®Šæ•¸
		let calendarDate = new Date(), weeklyCalendarDate = new Date(), yearlyCalendarDate = new Date(), shichenDetailDate = new Date(); // æ—¥æ›†æ—¥æœŸè®Šæ•¸
		let yearlyDataCache = { year: -1, holidays: [], jieqi: [] }; // å¹´åº¦è³‡æ–™å¿«å–
        let weatherDataCache = null, weatherUpdateTimer = null, movementTimer = null, scanlineTimer = null; // å¤©æ°£èˆ‡ç‰¹æ•ˆè¨ˆæ™‚å™¨
        
        const taiwanLocations = {
            "å°ç£": { "english": "taiwan", "districts": { "å°ç£": "taiwan" } },
            "åŸºéš†å¸‚": { "english": "keelung", "districts": { "åŸºéš†å¸‚": "keelung", "ä»æ„›å€": "renai", "ä¿¡ç¾©å€": "xinyi", "ä¸­æ­£å€": "zhongzheng", "ä¸­å±±å€": "zhongshan", "å®‰æ¨‚å€": "anle", "æš–æš–å€": "nuannuan", "ä¸ƒå µå€": "qidu" } },
            "è‡ºåŒ—å¸‚": { "english": "taipei", "districts": { "è‡ºåŒ—å¸‚": "taipei", "ä¸­æ­£å€": "zhongzheng", "å¤§åŒå€": "datong", "ä¸­å±±å€": "zhongshan", "æ¾å±±å€": "songshan", "å¤§å®‰å€": "da'an", "è¬è¯å€": "wanhua", "ä¿¡ç¾©å€": "xinyi", "å£«æ—å€": "shilin", "åŒ—æŠ•å€": "beitou", "å…§æ¹–å€": "neihu", "å—æ¸¯å€": "nangang", "æ–‡å±±å€": "wenshan" } },
            "æ–°åŒ—å¸‚": { "english": "new taipei", "districts": { "æ–°åŒ—å¸‚": "new taipei", "æ¿æ©‹å€": "banqiao", "ä¸‰é‡å€": "sanchong", "ä¸­å’Œå€": "zhonghe", "æ°¸å’Œå€": "yonghe", "æ–°èŠå€": "xinzhuang", "æ–°åº—å€": "xindian", "åœŸåŸå€": "tucheng", "è˜†æ´²å€": "luzhou", "æ¨¹æ—å€": "shulin", "æ±æ­¢å€": "xizhi", "é¶¯æ­Œå€": "yingge", "ä¸‰å³½å€": "sanxia", "æ·¡æ°´å€": "danshui", "ç‘èŠ³å€": "ruifang", "äº”è‚¡å€": "wugu", "æ³°å±±å€": "taishan", "æ—å£å€": "linkou", "æ·±å‘å€": "shengkeng", "çŸ³ç¢‡å€": "shiding", "åªæ—å€": "pinglin", "ä¸‰èŠå€": "sanzhi", "çŸ³é–€å€": "shimen", "å…«é‡Œå€": "bali", "å¹³æºªå€": "pingxi", "é›™æºªå€": "shuangxi", "è²¢å¯®å€": "gongliao", "é‡‘å±±å€": "jinshan", "è¬é‡Œå€": "wanli", "çƒä¾†å€": "wulai" } },
            "æ¡ƒåœ’å¸‚": { "english": "taoyuan", "districts": { "æ¡ƒåœ’å¸‚": "taoyuan", "æ¡ƒåœ’å€": "taoyuan", "ä¸­å£¢å€": "zhongli", "å¹³é®å€": "pingzhen", "å…«å¾·å€": "bade", "æ¥Šæ¢…å€": "yangmei", "è˜†ç«¹å€": "luzhu", "å¤§æºªå€": "daxi", "é¾æ½­å€": "longtan", "é¾œå±±å€": "guishan", "å¤§åœ’å€": "dayuan", "è§€éŸ³å€": "guanyin", "æ–°å±‹å€": "xinwu", "å¾©èˆˆå€": "fuxing" } },
            "è‡ºä¸­å¸‚": { "english": "taichung", "districts": { "è‡ºä¸­å¸‚": "taichung", "ä¸­å€": "central", "æ±å€": "east", "å—å€": "south", "è¥¿å€": "west", "åŒ—å€": "north", "åŒ—å±¯å€": "beitun", "è¥¿å±¯å€": "xitun", "å—å±¯å€": "nantun", "å¤ªå¹³å€": "taiping", "å¤§é‡Œå€": "dali", "éœ§å³°å€": "wufeng", "çƒæ—¥å€": "wuri", "è±åŸå€": "fengyuan", "åé‡Œå€": "houli", "çŸ³å²¡å€": "shigang", "æ±å‹¢å€": "dongshi", "å’Œå¹³å€": "heping", "æ–°ç¤¾å€": "xinshe", "æ½­å­å€": "tanzi", "å¤§é›…å€": "daya", "ç¥å²¡å€": "shengang", "å¤§è‚šå€": "dadu", "æ²™é¹¿å€": "shalu", "é¾äº•å€": "longjing", "æ¢§æ£²å€": "wuqi", "æ¸…æ°´å€": "qingshui", "å¤§ç”²å€": "dajia", "å¤–åŸ”å€": "waipu", "å¤§å®‰å€": "daan" } },
            "è‡ºå—å¸‚": { "english": "tainan", "districts": { "è‡ºå—å¸‚": "tainan", "ä¸­è¥¿å€": "west central", "æ±å€": "east", "å—å€": "south", "åŒ—å€": "north", "å®‰å¹³å€": "anping", "å®‰å—å€": "annan", "æ°¸åº·å€": "yongkang", "æ­¸ä»å€": "guiren", "æ–°åŒ–å€": "xinhua", "å·¦é®å€": "zuozhen", "ç‰äº•å€": "yujing", "æ¥ è¥¿å€": "nanxi", "å—åŒ–å€": "nanhua", "ä»å¾·å€": "rende", "é—œå»Ÿå€": "guanmiao", "é¾å´å€": "longqi", "å®˜ç”°å€": "guantian", "éº»è±†å€": "madou", "ä½³é‡Œå€": "jiali", "è¥¿æ¸¯å€": "xigang", "ä¸ƒè‚¡å€": "qigu", "å°‡è»å€": "jiangjun", "å­¸ç”²å€": "xuejia", "åŒ—é–€å€": "beimen", "æ–°ç‡Ÿå€": "xinying", "å¾Œå£å€": "houbi", "ç™½æ²³å€": "baihe", "æ±å±±å€": "dongshan", "å…­ç”²å€": "liujia", "ä¸‹ç‡Ÿå€": "xiaying", "æŸ³ç‡Ÿå€": "liuying", "é¹½æ°´å€": "yanshui", "å–„åŒ–å€": "shanhua", "å¤§å…§å€": "danei", "å±±ä¸Šå€": "shanshang", "æ–°å¸‚å€": "xingshi", "å®‰å®šå€": "anding" } },
            "é«˜é›„å¸‚": { "english": "kaohsiung", "districts": { "é«˜é›„å¸‚": "kaohsiung", "æ¥ æ¢“å€": "nanzi", "å·¦ç‡Ÿå€": "zuoying", "é¼“å±±å€": "gushan", "ä¸‰æ°‘å€": "sanmin", "é¹½åŸ•å€": "yancheng", "å‰é‡‘å€": "qianjin", "æ–°èˆˆå€": "xinxing", "è‹“é›…å€": "lingya", "å‰é®å€": "qianzhen", "æ——æ´¥å€": "qijin", "å°æ¸¯å€": "xiaogang", "é³³å±±å€": "fengshan", "æ—åœ’å€": "linyuan", "å¤§å¯®å€": "daliao", "å¤§æ¨¹å€": "dashu", "å¤§ç¤¾å€": "dashe", "ä»æ­¦å€": "renwu", "é³¥æ¾å€": "niaosong", "å²¡å±±å€": "gangshan", "æ©‹é ­å€": "qiaotou", "ç‡•å·¢å€": "yanchao", "ç”°å¯®å€": "tianliao", "é˜¿è“®å€": "alian", "è·¯ç«¹å€": "luzhu", "æ¹–å…§å€": "hunei", "èŒ„è£å€": "qieding", "æ°¸å®‰å€": "yong'an", "å½Œé™€å€": "mizuo", "æ¢“å®˜å€": "ziguan", "æ——å±±å€": "qishan", "ç¾æ¿ƒå€": "meinong", "å…­é¾œå€": "liugui", "ç”²ä»™å€": "jiaxian", "æ‰æ—å€": "shanlin", "å…§é–€å€": "neimen", "èŒ‚æ—å€": "maolin", "æ¡ƒæºå€": "taoyuan", "é‚£ç‘ªå¤å€": "namasia" } },
            "æ–°ç«¹ç¸£": { "english": "hsinchu county", "districts": { "æ–°ç«¹ç¸£": "hsinchu county", "ç«¹åŒ—å¸‚": "zhubei", "ç«¹æ±é®": "zhudong", "æ–°åŸ”é®": "xinpu", "é—œè¥¿é®": "guanxi", "æ¹–å£é„‰": "hukou", "æ–°è±é„‰": "xinfeng", "èŠæ—é„‰": "qionglin", "æ©«å±±é„‰": "hengshan", "åŒ—åŸ”é„‰": "beipu", "å¯¶å±±é„‰": "baoshan", "å³¨çœ‰é„‰": "emei", "å°–çŸ³é„‰": "jianshi", "äº”å³°é„‰": "wufeng" } },
            "è‹—æ —ç¸£": { "english": "miaoli", "districts": { "è‹—æ —ç¸£": "miaoli", "è‹—æ —å¸‚": "miaoli city", "é ­ä»½å¸‚": "toufen", "è‹‘è£¡é®": "yuanli", "é€šéœ„é®": "tongxiao", "ç«¹å—é®": "zhunan", "å¾Œé¾é®": "houlong", "å“è˜­é®": "zhuolan", "å¤§æ¹–é„‰": "dahu", "å…¬é¤¨é„‰": "gongguan", "éŠ…é‘¼é„‰": "tongluo", "å—åº„é„‰": "nanzhuang", "é ­å±‹é„‰": "touwu", "ä¸‰ç£é„‰": "sanwan", "ä¸‰ç¾©é„‰": "sanyi", "è¥¿æ¹–é„‰": "xihu", "é€ æ©‹é„‰": "zaoqiao", "ç…æ½­é„‰": "shitan", "æ³°å®‰é„‰": "taian" } },
            "å½°åŒ–ç¸£": { "english": "changhua", "districts": { "å½°åŒ–ç¸£": "changhua", "å½°åŒ–å¸‚": "changhua city", "å“¡æ—å¸‚": "yuanlin", "å’Œç¾é®": "hemei", "é¹¿æ¸¯é®": "lukang", "æºªæ¹–é®": "xihu", "ç”°ä¸­é®": "tianzhong", "åŒ—æ–—é®": "beidou", "äºŒæ—é®": "erlin", "ç·šè¥¿é„‰": "xianxi", "ä¼¸æ¸¯é„‰": "shengang", "ç¦èˆˆé„‰": "fuxing", "ç§€æ°´é„‰": "xiushui", "èŠ±å£‡é„‰": "huatan", "èŠ¬åœ’é„‰": "fenyuan", "å¤§æ‘é„‰": "dacun", "åŸ”é¹½é„‰": "puyan", "åŸ”å¿ƒé„‰": "puxin", "æ°¸é–é„‰": "yongjing", "ç¤¾é ­é„‰": "shetou", "äºŒæ°´é„‰": "ershui", "ç”°å°¾é„‰": "tianwei", "åŸ¤é ­é„‰": "pitou", "èŠ³è‹‘é„‰": "fangyuan", "å¤§åŸé„‰": "dacheng", "ç«¹å¡˜é„‰": "zhutang", "æºªå·é„‰": "xizhou" } },
            "å—æŠ•ç¸£": { "english": "nantou", "districts": { "å—æŠ•ç¸£": "nantou", "å—æŠ•å¸‚": "nantou city", "åŸ”é‡Œé®": "puli", "è‰å±¯é®": "caotun", "ç«¹å±±é®": "zhushan", "é›†é›†é®": "jiji", "åé–“é„‰": "mingjian", "é¹¿è°·é„‰": "lugu", "ä¸­å¯®é„‰": "zhongliao", "é­šæ± é„‰": "yuchi", "åœ‹å§“é„‰": "guoxing", "æ°´é‡Œé„‰": "shuili", "ä¿¡ç¾©é„‰": "xinyi", "ä»æ„›é„‰": "ren'ai" } },
            "é›²æ—ç¸£": { "english": "yunlin", "districts": { "é›²æ—ç¸£": "yunlin", "æ–—å…­å¸‚": "douliu", "æ–—å—é®": "dounan", "è™å°¾é®": "huwei", "è¥¿èºé®": "xiluo", "åœŸåº«é®": "tuku", "åŒ—æ¸¯é®": "beigang", "å¤å‘é„‰": "gukeng", "å¤§åŸ¤é„‰": "dapi", "è¿æ¡é„‰": "citong", "æ—å…§é„‰": "linnei", "äºŒå´™é„‰": "erlun", "å´™èƒŒé„‰": "lunbei", "éº¥å¯®é„‰": "mailiao", "æ±å‹¢é„‰": "dongshi", "è¤’å¿ é„‰": "baozhong", "è‡ºè¥¿é„‰": "taixi", "å…ƒé•·é„‰": "yuanchang", "å››æ¹–é„‰": "sihu", "å£æ¹–é„‰": "kouhu", "æ°´æ—é„‰": "shuilin" } },
            "å˜‰ç¾©ç¸£": { "english": "chiayi county", "districts": { "å˜‰ç¾©ç¸£": "chiayi county", "å¤ªä¿å¸‚": "taibao", "æœ´å­å¸‚": "puzi", "å¸ƒè¢‹é®": "budai", "å¤§æ—é®": "dalin", "æ°‘é›„é„‰": "minxiong", "æºªå£é„‰": "xikou", "æ–°æ¸¯é„‰": "xingang", "å…­è…³é„‰": "liujiao", "æ±çŸ³é„‰": "dongshi", "ç¾©ç«¹é„‰": "yizu", "é¹¿è‰é„‰": "lucao", "æ°´ä¸Šé„‰": "shuishang", "ä¸­åŸ”é„‰": "zhongpu", "ç«¹å´é„‰": "zhuqi", "æ¢…å±±é„‰": "meishan", "ç•ªè·¯é„‰": "fanlu", "å¤§åŸ”é„‰": "dapu", "é˜¿é‡Œå±±é„‰": "alishan" } },
            "å±æ±ç¸£": { "english": "pingtung", "districts": { "å±æ±ç¸£": "pingtung", "å±æ±å¸‚": "pingtung city", "æ½®å·é®": "chaozhou", "æ±æ¸¯é®": "donggang", "æ†æ˜¥é®": "hengchun", "è¬ä¸¹é„‰": "wandan", "é•·æ²»é„‰": "changzhi", "éºŸæ´›é„‰": "linluo", "ä¹å¦‚é„‰": "jiuru", "é‡Œæ¸¯é„‰": "ligang", "é¹½åŸ”é„‰": "yanpu", "é«˜æ¨¹é„‰": "gaoshu", "è¬å·’é„‰": "wanluan", "å…§åŸ”é„‰": "neipu", "ç«¹ç”°é„‰": "zhutian", "æ–°åŸ¤é„‰": "xinpi", "æ‹å¯®é„‰": "fangliao", "æ–°åœ’é„‰": "xinyuan", "å´é ‚é„‰": "kanding", "æ—é‚Šé„‰": "linbian", "å—å·é„‰": "nanzhou", "ä½³å†¬é„‰": "jiadong", "ç‰çƒé„‰": "liuqiu", "è»ŠåŸé„‰": "checheng", "æ»¿å·é„‰": "manzhou", "æ‹å±±é„‰": "fangshan", "ä¸‰åœ°é–€é„‰": "sandimen", "éœ§è‡ºé„‰": "wutai", "ç‘ªå®¶é„‰": "majia", "æ³°æ­¦é„‰": "taiwu", "ä¾†ç¾©é„‰": "laiyi", "æ˜¥æ—¥é„‰": "chunri", "ç…å­é„‰": "shizi", "ç‰¡ä¸¹é„‰": "mudan" } },
            "å®œè˜­ç¸£": { "english": "yilan", "districts": { "å®œè˜­ç¸£": "yilan", "å®œè˜­å¸‚": "yilan city", "ç¾…æ±é®": "luodong", "è˜‡æ¾³é®": "su'ao", "é ­åŸé®": "toucheng", "ç¤æºªé„‰": "jiaoxi", "å£¯åœé„‰": "zhuangwei", "å“¡å±±é„‰": "yuanshan", "å†¬å±±é„‰": "dongshan", "äº”çµé„‰": "wujie", "ä¸‰æ˜Ÿé„‰": "sanxing", "å¤§åŒé„‰": "datong", "å—æ¾³é„‰": "nan'ao" } },
            "èŠ±è“®ç¸£": { "english": "hualien", "districts": { "èŠ±è“®ç¸£": "hualien", "èŠ±è“®å¸‚": "hualien city", "é³³æ—é®": "fenglin", "ç‰é‡Œé®": "yuli", "æ–°åŸé„‰": "xincheng", "å‰å®‰é„‰": "ji'an", "å£½è±é„‰": "shoufeng", "å…‰å¾©é„‰": "guangfu", "è±æ¿±é„‰": "fengbin", "ç‘ç©—é„‰": "ruisui", "å¯Œé‡Œé„‰": "fuli", "ç§€æ—é„‰": "xiulin", "è¬æ¦®é„‰": "wanrong", "å“æºªé„‰": "zhuoxi" } },
            "è‡ºæ±ç¸£": { "english": "taitung", "districts": { "è‡ºæ±ç¸£": "taitung", "è‡ºæ±å¸‚": "taitung city", "æˆåŠŸé®": "chenggong", "é—œå±±é®": "guanshan", "å‘å—é„‰": "beinan", "é¹¿é‡é„‰": "luye", "æ± ä¸Šé„‰": "chishang", "æ±æ²³é„‰": "donghe", "é•·æ¿±é„‰": "changbin", "å¤ªéº»é‡Œé„‰": "taimali", "å¤§æ­¦é„‰": "dawu", "é”ä»é„‰": "daren", "é‡‘å³°é„‰": "jinfeng", "æµ·ç«¯é„‰": "haiduan", "å»¶å¹³é„‰": "yanping", "ç¶ å³¶é„‰": "ludao", "è˜­å¶¼é„‰": "lanyu" } },
            "æ¾æ¹–ç¸£": { "english": "penghu", "districts": { "æ¾æ¹–ç¸£": "penghu", "é¦¬å…¬å¸‚": "magong", "æ¹–è¥¿é„‰": "huxi", "ç™½æ²™é„‰": "baisha", "è¥¿å¶¼é„‰": "xiyu", "æœ›å®‰é„‰": "wang'an", "ä¸ƒç¾é„‰": "qimei" } },
            "é‡‘é–€ç¸£": { "english": "kinmen", "districts": { "é‡‘é–€ç¸£": "kinmen", "é‡‘åŸé®": "jincheng", "é‡‘æ¹–é®": "jinhu", "é‡‘æ²™é®": "jinsha", "é‡‘å¯§é„‰": "jinning", "çƒˆå¶¼é„‰": "lieyu", "çƒåµé„‰": "wuqiu" } },
            "é€£æ±Ÿç¸£": { "english": "lienchiang", "districts": { "é€£æ±Ÿç¸£": "lienchiang", "å—ç«¿é„‰": "nangan", "åŒ—ç«¿é„‰": "beigan", "è’å…‰é„‰": "juguang", "æ±å¼•é„‰": "dongyin" } },
            "æ–°ç«¹å¸‚": { "english": "hsinchu", "districts": { "æ–°ç«¹å¸‚": "hsinchu", "æ±å€": "east", "åŒ—å€": "north", "é¦™å±±å€": "xiangshan" } },
            "å˜‰ç¾©å¸‚": { "english": "chiayi", "districts": { "å˜‰ç¾©å¸‚": "chiayi", "æ±å€": "east", "è¥¿å€": "west" } }
        };

		const defaultDisplaySettings = { // é è¨­é¡¯ç¤ºè¨­å®š
			showAmPm: true, showGregorianYear: true, showGregorianMonth: true, showGregorianDay: true, showGregorianWeekday: true,
			showMinguoYear: true, showLunarMonth: true, showLunarDay: true, showLunarShiChen: true, showJieqi: true, showHolidays: true,
			textColor: '#00FF00', backgroundColor: '#000000', gregorianYearColor: '#00FF00', gregorianMonthColor: '#00FF00',
			gregorianDayColor: '#00FF00', gregorianWeekdayColor: '#00FF00', minguoYearColor: '#00FF00', lunarMonthColor: '#00FF00',
			lunarDayColor: '#00FF00', lunarShiChenColor: '#00FF00', jieqiColor: '#00FF00', holidayColor: '#00FFFF',
			enableTextScanline: false, enableBackgroundScanline: false, enableMovement: true,
            movementIntervalMinutes: 0, movementIntervalSeconds: 10, scanlineIntervalMinutes: 0, scanlineIntervalSeconds: 10,
            showWeather: true, weatherLocation: 'taiwan', weatherColor: '#87CEFA',
            showWeatherLocation: true, weatherLocationColor: '#00FFFF',
		};
		let displaySettings = { ...defaultDisplaySettings }; // ç•¶å‰é¡¯ç¤ºè¨­å®š

		function saveSettings() { try { localStorage.setItem('displaySettings', JSON.stringify(displaySettings)); } catch (e) { console.error("å„²å­˜è¨­å®šå¤±æ•—:", e); } } // å„²å­˜è¨­å®šåˆ°LocalStorage
		function loadSettings() { try { const settingsJson = localStorage.getItem('displaySettings'); if (settingsJson) { displaySettings = { ...defaultDisplaySettings, ...JSON.parse(settingsJson) }; } } catch (e) { console.error("è§£æè¨­å®šå¤±æ•—:", e); displaySettings = { ...defaultDisplaySettings }; } } // è¼‰å…¥è¨­å®š
		function updateSettingsModalUI() { for (const key in displaySettings) { const element = document.getElementById(key); if (element) { if (element.type === 'checkbox') { element.checked = displaySettings[key]; } else if (element.tagName !== 'SELECT') { element.value = displaySettings[key]; } } } setLocationSelectorsFromEnglish(displaySettings.weatherLocation); } // æ›´æ–°è¨­å®šè¦–çª—UI
		function getShengXiaoEmoji(shengXiaoName) { const emojiMap = { 'é¼ ': 'ğŸ­', 'ç‰›': 'ğŸ®', 'è™': 'ğŸ…', 'å…”': 'ğŸ‡', 'é¾': 'ğŸ‰', 'è›‡': 'ğŸ', 'é¦¬': 'ğŸ', 'ç¾Š': 'ğŸ‘', 'çŒ´': 'ğŸ’', 'é›': 'ï¿½', 'ç‹—': 'ğŸ¶', 'è±¬': 'ğŸ–' }; return emojiMap[shengXiaoName] || ''; } // æ ¹æ“šç”Ÿè‚–åè¿”å›Emoji
		function getJieqiDescription(jieqiName) { const descriptions = { 'ç«‹æ˜¥': 'æ˜¥å­£é–‹å§‹ï¼Œè¬ç‰©å¾©ç”¦ã€‚', 'é›¨æ°´': 'é™é›¨å¢å¤šï¼Œæ˜¥è€•é–‹å§‹ã€‚', 'é©šèŸ„': 'æ˜¥é›·éŸ¿å‹•ï¼Œé©šé†’å†¬çœ å‹•ç‰©ã€‚', 'æ˜¥åˆ†': 'æ™å¤œç­‰é•·ï¼Œæ˜¥æ„ç›ç„¶ã€‚', 'æ¸…æ˜': 'æ°£å€™æ¸…çˆ½æ˜æœ—ï¼Œæƒå¢“ç¥­ç¥–ã€‚', 'ç©€é›¨': 'é›¨æ°´æ»‹æ½¤ï¼Œç©€ç‰©ç”Ÿé•·ã€‚', 'ç«‹å¤': 'å¤å­£é–‹å§‹ï¼Œè¬ç‰©ç¹èŒ‚ã€‚', 'å°æ»¿': 'å¤ç†Ÿä½œç‰©ç±½ç²’é–‹å§‹é£½æ»¿ã€‚', 'èŠ’ç¨®': 'æ”¶ç©«èˆ‡æ’­ç¨®çš„æ™‚ç¯€ã€‚', 'å¤è‡³': 'åŒ—åŠçƒç™½æ™æœ€é•·ï¼Œç››å¤é–‹å§‹ã€‚', 'å°æš‘': 'å¤©æ°£é–‹å§‹ç‚ç†±ã€‚', 'å¤§æš‘': 'ä¸€å¹´ä¸­æœ€ç‚ç†±çš„æ™‚æœŸã€‚', 'ç«‹ç§‹': 'ç§‹å­£é–‹å§‹ï¼Œæ°£æº«æ¼¸é™ã€‚', 'è™•æš‘': 'æš‘æ°£æ¼¸é€€ï¼Œå¤©æ°£è½‰æ¶¼ã€‚', 'ç™½éœ²': 'æ°´æ°£å‡çµæˆéœ²ï¼Œå¤©æ°£æ¼¸å¯’ã€‚', 'ç§‹åˆ†': 'æ™å¤œç­‰é•·ï¼Œç§‹é«˜æ°£çˆ½ã€‚', 'å¯’éœ²': 'æ°£æº«æ›´ä½ï¼Œå¤©æ°£è½‰å†·ã€‚', 'éœœé™': 'å¤©æ°£æ¼¸å†·ï¼Œéœ²æ°´å‡çµæˆéœœã€‚', 'ç«‹å†¬': 'å†¬å­£é–‹å§‹ï¼Œè¬ç‰©æ”¶è—ã€‚', 'å°é›ª': 'é–‹å§‹é™é›ªï¼Œä½†é›ªé‡ä¸å¤§ã€‚', 'å¤§é›ª': 'é™é›ªé‡å¢å¤šï¼Œå¤©æ°£æ›´å†·ã€‚', 'å†¬è‡³': 'åŒ—åŠçƒç™½æ™æœ€çŸ­ï¼Œæ•¸ä¹å¯’å¤©é–‹å§‹ã€‚', 'å°å¯’': 'å¤©æ°£å¯’å†·ï¼Œå°šæœªé”åˆ°æœ€å†·ã€‚', 'å¤§å¯’': 'ä¸€å¹´ä¸­æœ€å¯’å†·çš„æ™‚æœŸã€‚' }; return descriptions[jieqiName] || 'æ­¤ç¯€æ°£ç„¡è©³ç´°èªªæ˜ã€‚'; } // æ ¹æ“šç¯€æ°£åè¿”å›æè¿°
		function getHolidaysForYear(year) { const holidays = []; const fixedHolidays = [ { name: 'å…ƒæ—¦', m: 0, d: 1 }, { name: 'å’Œå¹³ç´€å¿µæ—¥', m: 1, d: 28 }, { name: 'å…’ç«¥ç¯€', m: 3, d: 4 }, { name: 'å‹å‹•ç¯€', m: 4, d: 1 }, { name: 'åœ‹æ…¶æ—¥', m: 9, d: 10 }, { name: 'è–èª•ç¯€', m: 11, d: 25 } ]; fixedHolidays.forEach(h => holidays.push({ name: h.name, date: new Date(year, h.m, h.d) })); const lunarHolidays = [{m:1,d:1,n:'è¾²æ›†æ–°å¹´'}, {m:1,d:15,n:'å…ƒå®µç¯€'}, {m:5,d:5,n:'ç«¯åˆç¯€'}, {m:7,d:7,n:'ä¸ƒå¤•'}, {m:7,d:15,n:'ä¸­å…ƒç¯€'}, {m:8,d:15,n:'ä¸­ç§‹ç¯€'}, {m:9,d:9,n:'é‡é™½ç¯€'}, {m:12,d:8,n:'è‡˜å…«ç¯€'}]; lunarHolidays.forEach(lh => { const solarDate = Lunar.fromYmd(year, lh.m, lh.d).getSolar(); holidays.push({ name: lh.n, date: new Date(solarDate.getYear(), solarDate.getMonth() - 1, solarDate.getDay()) }); }); const lunarNewYearSolar = Lunar.fromYmd(year, 1, 1).getSolar(); holidays.push({ name: 'é™¤å¤•', date: new Date(lunarNewYearSolar.getYear(), lunarNewYearSolar.getMonth() - 1, lunarNewYearSolar.getDay() - 1) }); const qingmingJieqi = getJieqiForYear(year).find(jq => jq.name === 'æ¸…æ˜'); if(qingmingJieqi) holidays.push({ name: 'æ¸…æ˜ç¯€', date: qingmingJieqi.date }); const mayFirst = new Date(year, 4, 1); const mothersDay = new Date(year, 4, 1 + (7 - mayFirst.getDay() + 7) % 7 + 7); holidays.push({ name: 'æ¯è¦ªç¯€', date: mothersDay }); return holidays.sort((a, b) => a.date.getTime() - b.date.getTime()); } // è¨ˆç®—æŒ‡å®šå¹´ä»½çš„æ‰€æœ‰ä¸»è¦ç¯€æ—¥
		function getJieqiForYear(year) { const jieqiPinyinMap = { 'LI_CHUN': 'ç«‹æ˜¥', 'YU_SHUI': 'é›¨æ°´', 'JING_ZHE': 'é©šèŸ„', 'CHUN_FEN': 'æ˜¥åˆ†', 'QING_MING': 'æ¸…æ˜', 'GU_YU': 'ç©€é›¨', 'LI_XIA': 'ç«‹å¤', 'XIAO_MAN': 'å°æ»¿', 'MANG_ZHONG': 'èŠ’ç¨®', 'XIA_ZHI': 'å¤è‡³', 'XIAO_SHU': 'å°æš‘', 'DA_SHU': 'å¤§æš‘', 'LI_QIU': 'ç«‹ç§‹', 'CHU_SHU': 'è™•æš‘', 'BAI_LU': 'ç™½éœ²', 'QIU_FEN': 'ç§‹åˆ†', 'HAN_LU': 'å¯’éœ²', 'SHUANG_JIANG': 'éœœé™', 'LI_DONG': 'ç«‹å†¬', 'XIAO_XUE': 'å°é›ª', 'DA_XUE': 'å¤§é›ª', 'DONG_ZHI': 'å†¬è‡³', 'XIAO_HAN': 'å°å¯’', 'DA_HAN': 'å¤§å¯’' }; const jieqiSimplifiedMap = { 'æƒŠè›°': 'é©šèŸ„', 'å°æ»¡': 'å°æ»¿', 'èŠ’ç§': 'èŠ’ç¨®', 'å¤„æš‘': 'è™•æš‘', 'è°·é›¨': 'ç©€é›¨' }; const jieqiTable = Lunar.fromYmd(year, 1, 1).getJieQiTable(); return Object.entries(jieqiTable).map(([name, dateStr]) => { const traditionalName = jieqiPinyinMap[name] || jieqiSimplifiedMap[name] || name; return { name: traditionalName, date: new Date(dateStr) }; }).sort((a, b) => a.date.getTime() - b.date.getTime()); } // è¨ˆç®—æŒ‡å®šå¹´ä»½çš„æ‰€æœ‰ç¯€æ°£
        function s2t(input) { if (typeof input !== 'string' && !Array.isArray(input)) return input; const s2tMap = { 'è§': 'è¦‹', 'è´µ': 'è²´', 'æ— ': 'ç„¡', 'å¼€': 'é–‹', 'çº³': 'ç´', 'è´¢': 'è²¡', 'æŒ‚': 'æ›', 'æ¢': 'æ¨‘', 'åŠ¨': 'å‹•', 'ç§': 'ç¨®', 'å¯': 'å•Ÿ', 'é’»': 'é‘½', 'è®¢': 'è¨‚', 'ç«–': 'è±', 'é—¨': 'é–€', 'è¯': 'è©', 'è®¼': 'è¨Ÿ', 'å‘': 'é«®', 'å…»': 'é¤Š', 'é©¬': 'é¦¬', 'ç»': 'ç¶“', 'ç»œ': 'çµ¡', 'ç›–': 'è“‹', 'ä¼š': 'æœƒ', 'å­¦': 'å­¸', 'è‰º': 'è—', 'åŒ»': 'é†«', 'è£…': 'è£', 'ç»“': 'çµ', 'ç½‘': 'ç¶²', 'æ¸”': 'æ¼', 'çŒ': 'çµ', 'äº²': 'è¦ª', 'è¿›': 'é€²', 'æ‰«': 'æƒ', 'ç»˜': 'ç¹ª', 'é½': 'é½Š', 'æ–‹': 'é½‹', 'åº™': 'å»Ÿ', 'ç¶': 'ç«ˆ', 'è°¢': 'è¬', 'é—®': 'å•', 'å©¿': 'å£»', 'å½’': 'æ­¸', 'å®': 'å¯§', 'åŸ': 'å¢³', 'å¯¿': 'å£½', 'å': 'å£', 'è¡¥': 'è£œ', 'å•': 'å»', 'ä»“': 'å€‰', 'æ¶‚': 'å¡—', 'æ¡¥': 'æ©‹', 'ç­‘': 'ç¯‰', 'é¥°': 'é£¾', 'å¢™': 'ç‰†', 'ä¹°': 'è²·', 'è½¦': 'è»Š', 'äº§': 'ç”¢', 'é›‡': 'åƒ±', 'ä½£': 'å‚­', 'è´§': 'è²¨', 'æœº': 'æ©Ÿ', 'æ¢°': 'æ¢°', 'é…': 'é†', 'é…¿': 'é‡€', 'é“¸': 'é‘„', 'é’ˆ': 'é‡', 'åº“': 'åº«', 'ç–—': 'ç™‚', 'è¯¸': 'è«¸', 'é¦€': 'é¤˜', 'ä¸§': 'å–ª', 'æ–­': 'æ–·', 'èš': 'èŸ»', 'æˆ·': 'æˆ¶', 'ç‚‰': 'çˆ', 'æ –': 'æ£²', 'å¨': 'å»š', 'èƒœ': 'å‹', 'è´Ÿ': 'è² ', 'ç­': 'æ»…', 'é¾™': 'é¾', 'é¸¡': 'é›', 'çŒª': 'è±¬', 'ä¹Œ': 'çƒ', 'åŒ': 'é›™', 'å®«': 'å®®', 'æƒŠ': 'é©š', 'è›°': 'èŸ„', 'æ»¡': 'æ»¿', 'å¤„': 'è™•', 'æ—¶': 'æ™‚', 'æ°”': 'æ°£', 'å': 'å¾Œ', 'ç¾': 'ç½', 'å¤': 'å¾©', 'è™š': 'è™›', 'è´¼': 'è³Š', 'è´¥': 'æ•—', 'ä»ª': 'å„€', 'ç¥¸': 'ç¦', 'ä¸´': 'è‡¨', 'é˜´': 'é™°', 'é˜³': 'é™½', 'åœ£': 'è–', 'å†²': 'æ²–', 'ç»': 'çµ•', 'å²': 'æ­²', 'ä¼¤': 'å‚·', 'æ€': 'æ®º', 'é»„': 'é»ƒ', 'èŠ‚': 'ç¯€', 'æ ‘': 'æ¨¹', 'å›½': 'åœ‹', 'ä¸‡': 'è¬', 'é•¿': 'é•·', 'å': 'è¯', 'ä¸º': 'ç‚º', 'ç”µ': 'é›»', 'å£°': 'è²', 'å†»': 'å‡', 'è™«': 'èŸ²', 'é±¼': 'é­š', 'é¹°': 'é·¹', 'æ¥': 'ä¾†', 'æ¶¦': 'æ½¤', 'å‡‰': 'æ¶¼', 'éº¦': 'éº¥', 'æ¸©': 'æº«', 'æ”¶': 'æ”¶', 'é—­': 'é–‰', 'é—°': 'é–' }; if (Array.isArray(input)) { return input.map(item => item.split('').map(char => s2tMap[char] || char).join('')); } return input.split('').map(char => s2tMap[char] || char).join(''); } // ç°¡è½‰ç¹
		function getShiChen(h) { const shichenMap = { 23: 'å­', 0: 'å­', 1: 'ä¸‘', 2: 'ä¸‘', 3: 'å¯…', 4: 'å¯…', 5: 'å¯', 6: 'å¯', 7: 'è¾°', 8: 'è¾°', 9: 'å·³', 10: 'å·³', 11: 'åˆ', 12: 'åˆ', 13: 'æœª', 14: 'æœª', 15: 'ç”³', 16: 'ç”³', 17: 'é…‰', 18: 'é…‰', 19: 'æˆŒ', 20: 'æˆŒ', 21: 'äº¥', 22: 'äº¥' }; return shichenMap[h] || ''; } // æ ¹æ“šå°æ™‚è¿”å›æ™‚è¾°
        function getShiChenTimeRange(shichenName) { const timeRanges = { 'å­': '23:00 - 00:59', 'ä¸‘': '01:00 - 02:59', 'å¯…': '03:00 - 04:59', 'å¯': '05:00 - 06:59', 'è¾°': '07:00 - 08:59', 'å·³': '09:00 - 10:59', 'åˆ': '11:00 - 12:59', 'æœª': '13:00 - 14:59', 'ç”³': '15:00 - 16:59', 'é…‰': '17:00 - 18:59', 'æˆŒ': '19:00 - 20:59', 'äº¥': '21:00 - 22:59' }; return timeRanges[shichenName] || ''; } // æ ¹æ“šæ™‚è¾°è¿”å›æ™‚é–“ç¯„åœ
		function getDetailedTimePeriod(hour) { const periodMap = { 0: 'å‡Œæ™¨', 1: 'å‡Œæ™¨', 2: 'å‡Œæ™¨', 3: 'å‡Œæ™¨', 4: 'å‡Œæ™¨', 5: 'æ¸…æ™¨', 6: 'æ¸…æ™¨', 7: 'æ¸…æ™¨', 8: 'æ¸…æ™¨', 9: 'ä¸Šåˆ', 10: 'ä¸Šåˆ', 11: 'ä¸Šåˆ', 12: 'ä¸­åˆ', 13: 'ä¸‹åˆ', 14: 'ä¸‹åˆ', 15: 'ä¸‹åˆ', 16: 'ä¸‹åˆ', 17: 'å‚æ™š', 18: 'å‚æ™š', 19: 'å¤œæ™š', 20: 'å¤œæ™š', 21: 'å¤œæ™š', 22: 'å¤œæ™š', 23: 'æ·±å¤œ' }; return periodMap[hour] || ''; } // æ ¹æ“šå°æ™‚è¿”å›è©³ç´°æ™‚æ®µ
		
        function updateMarquee(text, type) {
            const containerId = type === 'weather' ? 'weatherMarqueeContainer' : 'jieqiHolidayMarqueeContainer';
            const innerId = type === 'weather' ? 'weatherMarqueeInner' : 'jieqiHolidayMarqueeInner';
            const contentClass = type === 'weather' ? 'weather-marquee-content' : 'jieqi-holiday-marquee-content';
            const duplicateClass = type === 'weather' ? 'weather-marquee-content-duplicate' : 'jieqi-holiday-marquee-content-duplicate';
            const container = document.getElementById(containerId), inner = document.getElementById(innerId);
            if (!container || !inner) return;
            const contentSpan = inner.querySelector(`.${contentClass}`), duplicateSpan = inner.querySelector(`.${duplicateClass}`);
            if (!contentSpan || !duplicateSpan) return;

            contentSpan.innerHTML = text;
            
            requestAnimationFrame(() => {
                const contentWidth = contentSpan.scrollWidth;
                const containerWidth = container.offsetWidth;
                
                if (contentWidth > containerWidth) {
                    duplicateSpan.innerHTML = text;
                    container.classList.add('scrolling');
                    inner.style.animationDuration = `${contentWidth / 40}s`;
                } else {
                    duplicateSpan.innerHTML = '';
                    container.classList.remove('scrolling');
                }
            });
        }

		function updateDateTime() {
            const now = new Date();
            const backgroundOverlay = document.getElementById('background-scanline-overlay'), textOverlay = document.getElementById('text-scanline-overlay');
            backgroundOverlay.classList.toggle('active', displaySettings.enableBackgroundScanline);
            if (displaySettings.enableBackgroundScanline) {
                backgroundOverlay.classList.toggle('pattern-a', scanlinePatternIsA);
                backgroundOverlay.classList.toggle('pattern-b', !scanlinePatternIsA);
            }
            textOverlay.classList.toggle('active', displaySettings.enableTextScanline);
            if (displaySettings.enableTextScanline) {
                textOverlay.classList.toggle('pattern-a', !scanlinePatternIsA);
                textOverlay.classList.toggle('pattern-b', scanlinePatternIsA);
            }
            document.documentElement.style.setProperty('--page-background-color', displaySettings.backgroundColor);
            const parts = new Intl.DateTimeFormat('en-US', { hour: 'numeric', minute: '2-digit', second: '2-digit', hour12: false }).formatToParts(now);
            const hourPart = parts.find(p => p.type === 'hour')?.value.padStart(2, '0') || '00',
                minutePart = parts.find(p => p.type === 'minute')?.value || '00',
                secondPart = parts.find(p => p.type === 'second')?.value || '00';
            let displayHour = hourPart;
            let amPmText = '';
            if (displaySettings.showAmPm) {
                const hour12 = parseInt(hourPart, 10);
                amPmText = getDetailedTimePeriod(hour12);
                let displayHour12 = hour12 % 12;
                if (displayHour12 === 0) displayHour12 = 12;
                displayHour = displayHour12.toString().padStart(2, '0');
            }
            document.getElementById('hoursMinutesDisplay').textContent = `${displayHour}:${minutePart}`;
            document.getElementById('secondsDisplay').textContent = secondPart;
            document.getElementById('amPmDisplay').textContent = amPmText;
            document.getElementById('amPmDisplay').style.display = amPmText ? 'block' : 'none';
            document.getElementById('timeTextContainer').style.color = displaySettings.textColor;
            let gregorianParts = [];
            if (displaySettings.showGregorianYear) gregorianParts.push(`<span class="gregorian-year-target" style="color: ${displaySettings.gregorianYearColor}; cursor: pointer;">${now.getFullYear()}å¹´</span>`);
            if (displaySettings.showGregorianMonth) gregorianParts.push(`<span style="color: ${displaySettings.gregorianMonthColor};">${(now.getMonth() + 1).toString().padStart(2, '0')}æœˆ</span>`);
            if (displaySettings.showGregorianDay) gregorianParts.push(`<span style="color: ${displaySettings.gregorianDayColor};">${now.getDate().toString().padStart(2, '0')}æ—¥</span>`);
            if (displaySettings.showGregorianWeekday) gregorianParts.push(`<span class="weekday-target" style="color: ${displaySettings.gregorianWeekdayColor}; cursor: pointer;">å‘¨${['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][now.getDay()]}</span>`);
            document.getElementById('gregorianDateParts').innerHTML = gregorianParts.join('');
            document.getElementById('gregorianDateDisplay').style.display = gregorianParts.length > 0 || displaySettings.showWeather ? 'flex' : 'none';
            let lunarParts = [], combinedJieqiHolidayText = '';
            if (typeof Lunar !== 'undefined') {
                const currentYear = now.getFullYear();
                if (yearlyDataCache.year !== currentYear) {
                    yearlyDataCache = { year: currentYear, holidays: getHolidaysForYear(currentYear), jieqi: getJieqiForYear(currentYear) };
                }
                const solar = Solar.fromDate(now), lunar = solar.getLunar();
                if (displaySettings.showMinguoYear) {
                    const traditionalShengXiao = s2t(lunar.getYearShengXiao());
                    lunarParts.push(`<span class="lunar-year-target" style="color: ${displaySettings.minguoYearColor}; cursor: pointer;">${now.getFullYear() - 1911}å¹´${getShengXiaoEmoji(traditionalShengXiao)}</span>`);
                }
                if (displaySettings.showLunarMonth) lunarParts.push(`<span style="color: ${displaySettings.lunarMonthColor};">${s2t(lunar.getMonthInChinese())}æœˆ</span>`);
                if (displaySettings.showLunarDay) lunarParts.push(`<span class="lunar-day-target lunar-date-clickable" style="color: ${displaySettings.lunarDayColor};">${s2t(lunar.getDayInChinese())}</span>`);
                if (displaySettings.showLunarShiChen) lunarParts.push(`<span class="lunar-shichen-target lunar-shichen-clickable" style="color: ${displaySettings.lunarShiChenColor};">${getShiChen(now.getHours())}æ™‚</span>`);
                let jieQiText = '', holidayText = '';
                if (displaySettings.showJieqi) {
                    const currentJieqi = yearlyDataCache.jieqi.find(jq => jq.date.toDateString() === now.toDateString()) || yearlyDataCache.jieqi.find(jq => jq.date > now);
                    if (currentJieqi) {
                        const daysUntil = Math.ceil((currentJieqi.date - now) / 86400000);
                        jieQiText = (daysUntil === 0) ? `${currentJieqi.name}` : `${daysUntil}â¡${currentJieqi.name}`;
                    }
                }
                if (displaySettings.showHolidays) {
                    const currentHoliday = yearlyDataCache.holidays.find(h => h.date.toDateString() === now.toDateString()) || yearlyDataCache.holidays.find(h => h.date > now);
                    if (currentHoliday) {
                        const daysUntil = Math.ceil((currentHoliday.date - now) / 86400000);
                        holidayText = (daysUntil === 0) ? `${currentHoliday.name}` : `${daysUntil}â¡${currentHoliday.name}`;
                    }
                }
                let marqueeParts = [];
                if(jieQiText) marqueeParts.push(`<span style="color: ${displaySettings.jieqiColor};">${jieQiText}</span>`);
                if(holidayText) marqueeParts.push(`<span style="color: ${displaySettings.holidayColor};">${holidayText}</span>`);
                combinedJieqiHolidayText = marqueeParts.join(' ');
            }
            document.getElementById('lunarDateDisplay').innerHTML = lunarParts.join('');
            document.getElementById('lunarDateDisplay').style.display = lunarParts.length > 0 ? 'inline-block' : 'none';
            
            const jieqiMarqueeIsVisible = displaySettings.showJieqi || displaySettings.showHolidays;
            document.getElementById('jieqiHolidayMarqueeContainer').style.display = jieqiMarqueeIsVisible ? 'block' : 'none';
            if (jieqiMarqueeIsVisible && lastMarqueeContent !== combinedJieqiHolidayText) {
                updateMarquee(combinedJieqiHolidayText, 'jieqi');
                lastMarqueeContent = combinedJieqiHolidayText;
            }

            const weatherMarqueeIsVisible = displaySettings.showWeather;
            document.getElementById('weatherMarqueeContainer').style.display = weatherMarqueeIsVisible ? 'block' : 'none';
            if (weatherMarqueeIsVisible && lastWeatherContent) {
                 if (document.getElementById('weatherMarqueeInner').querySelector('.weather-marquee-content').innerHTML !== lastWeatherContent) {
                    updateMarquee(lastWeatherContent, 'weather');
                }
            }
        }

		function moveRandomly() { const displayElement = document.getElementById('dateTimeDisplay'), viewportWidth = window.innerWidth, viewportHeight = window.innerHeight; const elementRect = displayElement.getBoundingClientRect(), safeMargin = 20; const maxX = (viewportWidth - elementRect.width) / 2 - safeMargin, maxY = (viewportHeight - elementRect.height) / 2 - safeMargin; const newTargetX = Math.random() * (maxX * 2) - maxX, newTargetY = Math.random() * (maxY * 2) - maxY; displayElement.style.transform = `translate(calc(-50% + ${newTargetX}px), calc(-60% + ${newTargetY}px))`; } // éš¨æ©Ÿç§»å‹•
		function resetPosition() { document.getElementById('dateTimeDisplay').style.transform = `translate(-50%, -50%)`; } // é‡ç½®ä½ç½®
		function restoreDefaults() { displaySettings = { ...defaultDisplaySettings }; saveSettings(); updateSettingsModalUI(); if (displaySettings.enableMovement) { moveRandomly(); } else { resetPosition(); } lastMarqueeContent = ''; lastWeatherContent = ''; updateWeather(); updateDateTime(); setupEffectTimers(); } // æ¢å¾©é è¨­
		function getRandomColor() { return '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0'); } // ç”Ÿæˆéš¨æ©Ÿé¡è‰²
		
        function setRandomColors() {
            for (const key in displaySettings) {
                if (key.toLowerCase().includes('color')) {
                    displaySettings[key] = getRandomColor();
                }
            }
            saveSettings();
            updateSettingsModalUI();
            updateWeatherDisplay();
            updateDateTime();
        }

        function showDateDetails(date) { date.setHours(12, 0, 0, 0); const year = date.getFullYear(); const holidaysForYear = getHolidaysForYear(year); const jieqiForYear = getJieqiForYear(year); const isToday = date.toDateString() === new Date().toDateString(); const lunar = Solar.fromDate(date).getLunar(); const dayYi = s2t(lunar.getDayYi()).join('ã€') || 'ç„¡'; const dayJi = s2t(lunar.getDayJi()).join('ã€') || 'ç„¡'; const traditionalShengXiao = s2t(lunar.getYearShengXiao()); const lunarYearText = `${s2t(lunar.getYearInGanZhi())}${traditionalShengXiao}${getShengXiaoEmoji(traditionalShengXiao)}å¹´`; const lunarDateText = `${s2t(lunar.getMonthInChinese())}æœˆ${s2t(lunar.getDayInChinese())}`; const currentJieqi = jieqiForYear.find(jq => jq.date.toDateString() === date.toDateString()); const currentHoliday = holidaysForYear.find(h => h.date.toDateString() === date.toDateString()); const nextJieqi = jieqiForYear.find(jq => jq.date > date); const nextHoliday = holidaysForYear.find(h => h.date > date); let eventHtml = ''; if (currentJieqi) { eventHtml += `<p>${isToday ? 'ä»Šå¤©æ˜¯' : 'é€™å¤©æ˜¯'} <strong>${currentJieqi.name}</strong>ï¼ ${getJieqiDescription(currentJieqi.name)}</p>`; } if (currentHoliday) { eventHtml += `<p>${isToday ? 'ä»Šå¤©æ˜¯' : 'é€™å¤©æ˜¯'} <strong>${currentHoliday.name}</strong>ï¼</p>`; } let countdownHtml = ''; if (nextJieqi) { const daysUntil = Math.ceil((nextJieqi.date - date) / 86400000); countdownHtml += `<p>è·é›¢ä¸‹å€‹ç¯€æ°£ <strong>${nextJieqi.name}</strong> é‚„æœ‰ ${daysUntil} å¤©ã€‚<br><span style="font-size:0.9em; color:#ccc;">${getJieqiDescription(nextJieqi.name)}</span></p>`; } if (nextHoliday) { const daysUntil = Math.ceil((nextHoliday.date - date) / 86400000); countdownHtml += `<p>è·é›¢ä¸‹å€‹ç¯€æ—¥ <strong>${nextHoliday.name}</strong> é‚„æœ‰ ${daysUntil} å¤©</p>`; } if (countdownHtml) { eventHtml += `<div class="countdown-section">${countdownHtml}</div>`; } const detailsHtml = `<p><strong>å…¬æ›†ï¼š</strong>${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥</p><p><strong>è¾²æ›†ï¼š</strong>${lunarYearText} ${lunarDateText}</p><div class="yi-ji-grid"><strong>å®œï¼š</strong><span>${dayYi}</span><strong>å¿Œï¼š</strong><span>${dayJi}</span></div>${eventHtml}<p style="margin-top: 15px; font-size: 0.9em; color: #aaa;">å®œå¿Œåƒ…ä¾›åƒè€ƒï¼Œè«‹é †å¿ƒè€Œç‚ºã€‚</p>`; document.getElementById('dateDetailsModalContent').innerHTML = detailsHtml; document.getElementById('dateDetailsModal').classList.add('is-active'); } // é¡¯ç¤ºæ—¥æœŸè©³æƒ…
        function updateShiChenDetailsView(date) { shichenDetailDate = new Date(date); const lunar = Solar.fromDate(shichenDetailDate).getLunar(); const currentHour = shichenDetailDate.getHours(); const shiChenName = getShiChen(currentHour); const shiChenTimeRange = getShiChenTimeRange(shiChenName); document.getElementById('shichenDetailsModalTitle').textContent = `${shichenDetailDate.getMonth() + 1}æœˆ${shichenDetailDate.getDate()}æ—¥ ${shiChenName}æ™‚`; const currentLunarTime = lunar.getTimes().find(lt => lt.getZhi() === shiChenName); if (currentLunarTime) { const shiChenGanZhi = s2t(currentLunarTime.getGan() + currentLunarTime.getZhi()); const yi = s2t(currentLunarTime.getYi()).join('ã€') || 'ç„¡'; const ji = s2t(currentLunarTime.getJi()).join('ã€') || 'ç„¡'; const detailsHtml = `<p><strong>æ™‚è¾°ï¼š</strong>${shiChenName}æ™‚ (${shiChenGanZhi}) <span style="font-size: 0.9em; color: #ccc;">${shiChenTimeRange}</span></p><div class="yi-ji-grid"><strong>å®œï¼š</strong><span>${yi}</span><strong>å¿Œï¼š</strong><span>${ji}</span></div><p style="margin-top: 15px; font-size: 0.9em; color: #aaa;">æ™‚è¾°å®œå¿Œåƒ…ä¾›åƒè€ƒã€‚</p>`; document.getElementById('shichenDetailsModalContent').innerHTML = detailsHtml; } else { document.getElementById('shichenDetailsModalContent').innerHTML = `<p>æ‰¾ä¸åˆ° ${shiChenName}æ™‚ çš„è©³ç´°è³‡è¨Šã€‚</p>`; } document.getElementById('shichenDetailsModal').classList.add('is-active'); } // æ›´æ–°æ™‚è¾°è©³æƒ…
        function setupEffectTimers() { clearInterval(movementTimer); clearInterval(scanlineTimer); if (displaySettings.enableMovement) { const intervalMs = (parseInt(displaySettings.movementIntervalMinutes) * 60 + parseInt(displaySettings.movementIntervalSeconds)) * 1000; if (intervalMs > 0) { movementTimer = setInterval(() => { if(displaySettings.enableMovement) moveRandomly(); }, intervalMs); } } if (displaySettings.enableBackgroundScanline || displaySettings.enableTextScanline) { const intervalMs = (parseInt(displaySettings.scanlineIntervalMinutes) * 60 + parseInt(displaySettings.scanlineIntervalSeconds)) * 1000; if (intervalMs > 0) { scanlineTimer = setInterval(() => { scanlinePatternIsA = !scanlinePatternIsA; updateDateTime(); }, intervalMs); } } } // è¨­å®šç‰¹æ•ˆè¨ˆæ™‚å™¨
        function applyIntervalValidation() { const validate = (minEl, secEl, key) => { if (minEl.value === '0' && secEl.value < 2) { secEl.value = '2'; displaySettings[key] = '2'; } }; validate(document.getElementById('scanlineIntervalMinutes'), document.getElementById('scanlineIntervalSeconds'), 'scanlineIntervalSeconds'); validate(document.getElementById('movementIntervalMinutes'), document.getElementById('movementIntervalSeconds'), 'movementIntervalSeconds'); } // é©—è­‰æ™‚é–“é–“éš”
		function generateCalendar(year, month) { const grid = document.getElementById('calendarGrid'), monthYear = document.getElementById('calendarMonthYear'), weekdaysEl = document.getElementById('calendarWeekdays'); if(!grid || !monthYear || !weekdaysEl) return; grid.innerHTML = ''; weekdaysEl.innerHTML = ''; ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'].forEach(day => { const el = document.createElement('div'); el.textContent = day; weekdaysEl.appendChild(el); }); monthYear.textContent = `${year}å¹´ ${month + 1}æœˆ`; const firstDay = new Date(year, month, 1).getDay(), daysInMonth = new Date(year, month + 1, 0).getDate(), today = new Date(); const holidays = getHolidaysForYear(year), jieqi = getJieqiForYear(year); for (let i = 0; i < firstDay; i++) { grid.appendChild(document.createElement('div')).classList.add('other-month'); } for (let dayNum = 1; dayNum <= daysInMonth; dayNum++) { const cell = document.createElement('div'); cell.classList.add('calendar-day'); const date = new Date(year, month, dayNum); cell.dataset.date = date.toISOString(); cell.onclick = () => showDateDetails(new Date(cell.dataset.date)); const lunar = Solar.fromDate(date).getLunar(); cell.innerHTML = `<div class="gregorian-day">${dayNum}</div><div class="lunar-day">${lunar.getDay() === 1 ? s2t(lunar.getMonthInChinese()) + 'æœˆ' : s2t(lunar.getDayInChinese())}</div>`; if (today.getFullYear() === year && today.getMonth() === month && dayNum === today.getDate()) { cell.classList.add('is-today'); } const holiday = holidays.find(h => h.date.toDateString() === date.toDateString()); if (holiday) cell.innerHTML += `<span class="event-indicator holiday">${holiday.name}</span>`; const jq = jieqi.find(j => j.date.toDateString() === date.toDateString()); if (jq) cell.innerHTML += `<span class="event-indicator jieqi">${jq.name}</span>`; grid.appendChild(cell); } const remainingCells = 42 - firstDay - daysInMonth; for (let i = 0; i < remainingCells; i++) { grid.appendChild(document.createElement('div')).classList.add('other-month'); } } // ç”Ÿæˆæœˆæ›†
		function generateWeekCalendar(baseDate) { const grid = document.getElementById('weeklyCalendarGrid'), title = document.getElementById('weeklyCalendarTitle'); if (!grid || !title) return; grid.innerHTML = ''; const today = new Date(), startOfWeek = new Date(baseDate); startOfWeek.setDate(baseDate.getDate() - baseDate.getDay()); const endOfWeek = new Date(startOfWeek); endOfWeek.setDate(startOfWeek.getDate() + 6); title.textContent = `${startOfWeek.getFullYear()}å¹´${startOfWeek.getMonth() + 1}æœˆ${startOfWeek.getDate()}æ—¥ - ${endOfWeek.getFullYear()}å¹´${endOfWeek.getMonth() + 1}æœˆ${endOfWeek.getDate()}æ—¥`; const weekdays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­']; const holidays = getHolidaysForYear(baseDate.getFullYear()), jieqi = getJieqiForYear(baseDate.getFullYear()); for (let i = 0; i < 7; i++) { const day = new Date(startOfWeek); day.setDate(startOfWeek.getDate() + i); const cell = document.createElement('div'); cell.classList.add('weekly-calendar-day'); cell.dataset.date = day.toISOString(); cell.onclick = () => showDateDetails(new Date(cell.dataset.date)); if (day.toDateString() === today.toDateString()) { cell.classList.add('is-today'); } const lunar = Solar.fromDate(day).getLunar(); cell.innerHTML = `<div class="weekly-day-header">${weekdays[i]}</div><div class="weekly-gregorian-day">${day.getDate()}</div><div class="weekly-lunar-day">${lunar.getDay() === 1 ? s2t(lunar.getMonthInChinese()) + 'æœˆ' : s2t(lunar.getDayInChinese())}</div>`; const holiday = holidays.find(h => h.date.toDateString() === day.toDateString()); if (holiday) cell.innerHTML += `<span class="event-indicator holiday">${holiday.name}</span>`; const jq = jieqi.find(j => j.date.toDateString() === day.toDateString()); if (jq) cell.innerHTML += `<span class="event-indicator jieqi">${jq.name}</span>`; grid.appendChild(cell); } } // ç”Ÿæˆé€±æ›†
		function generateYearCalendar(year) { const grid = document.getElementById('yearlyCalendarGrid'), title = document.getElementById('yearlyCalendarTitle'); if (!grid || !title) return; grid.innerHTML = ''; title.textContent = `${year}å¹´`; const today = new Date(), weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­']; const holidays = getHolidaysForYear(year), jieqi = getJieqiForYear(year); for (let month = 0; month < 12; month++) { const monthContainer = document.createElement('div'); monthContainer.classList.add('yearly-month-container'); const monthHeader = document.createElement('div'); monthHeader.className = 'yearly-month-header'; monthHeader.textContent = `${month + 1}æœˆ`; monthHeader.style.cursor = 'pointer'; monthHeader.title = `æŸ¥çœ‹ ${month + 1}æœˆ æœˆæ›†`; monthHeader.onclick = () => { document.getElementById('yearlyCalendarModal').classList.remove('is-active'); calendarDate.setFullYear(year, month, 1); generateCalendar(calendarDate.getFullYear(), calendarDate.getMonth()); document.getElementById('calendarModal').classList.add('is-active'); }; monthContainer.appendChild(monthHeader); const weekdaysDiv = document.createElement('div'); weekdaysDiv.classList.add('yearly-weekdays'); weekdays.forEach(day => { const el = document.createElement('div'); el.textContent = day; weekdaysDiv.appendChild(el); }); monthContainer.appendChild(weekdaysDiv); const dayGrid = document.createElement('div'); dayGrid.classList.add('yearly-day-grid'); const firstDay = new Date(year, month, 1).getDay(), daysInMonth = new Date(year, month + 1, 0).getDate(); for (let i = 0; i < firstDay; i++) { dayGrid.appendChild(document.createElement('div')); } for (let dayNum = 1; dayNum <= daysInMonth; dayNum++) { const cell = document.createElement('div'); cell.classList.add('yearly-day'); const date = new Date(year, month, dayNum); cell.dataset.date = date.toISOString(); cell.onclick = () => showDateDetails(new Date(cell.dataset.date)); cell.textContent = dayNum; if (today.getFullYear() === year && today.getMonth() === month && dayNum === today.getDate()) { cell.classList.add('is-today'); } const holiday = holidays.find(h => h.date.toDateString() === date.toDateString()); const jq = jieqi.find(j => j.date.toDateString() === date.toDateString()); if(holiday || jq) { const indicators = document.createElement('div'); indicators.className = 'yearly-indicators'; if(holiday) indicators.innerHTML += '<span class="dot holiday"></span>'; if(jq) indicators.innerHTML += '<span class="dot jieqi"></span>'; cell.appendChild(indicators); } dayGrid.appendChild(cell); } monthContainer.appendChild(dayGrid); grid.appendChild(monthContainer); } } // ç”Ÿæˆå¹´æ›†
        
        // --- å¤©æ°£åŠŸèƒ½ ---
        function getWeatherDescriptionAndEmoji(code) { const map = { 0: { desc: 'æ™´', emoji: 'â˜€ï¸' }, 1: { desc: 'å¤§è‡´æ™´æœ—', emoji: 'ğŸŒ¤ï¸' }, 2: { desc: 'å±€éƒ¨å¤šé›²', emoji: 'â›…ï¸' }, 3: { desc: 'é™°', emoji: 'â˜ï¸' }, 45: { desc: 'éœ§', emoji: 'ğŸŒ«ï¸' }, 48: { desc: 'å‡éœ§', emoji: 'ğŸŒ«ï¸' }, 51: { desc: 'æ¯›æ¯›é›¨', emoji: 'ğŸŒ¦ï¸' }, 53: { desc: 'æ¯›æ¯›é›¨', emoji: 'ğŸŒ¦ï¸' }, 55: { desc: 'æ¯›æ¯›é›¨', emoji: 'ğŸŒ¦ï¸' }, 56: { desc: 'å‡æ¯›æ¯›é›¨', emoji: 'ğŸŒ¨ï¸' }, 57: { desc: 'å‡æ¯›æ¯›é›¨', emoji: 'ğŸŒ¨ï¸' }, 61: { desc: 'é›¨', emoji: 'ğŸŒ§ï¸' }, 63: { desc: 'é›¨', emoji: 'ğŸŒ§ï¸' }, 65: { desc: 'å¤§é›¨', emoji: 'ğŸŒ§ï¸' }, 66: { desc: 'å‡é›¨', emoji: 'ğŸŒ¨ï¸' }, 67: { desc: 'å‡é›¨', emoji: 'ğŸŒ¨ï¸' }, 71: { desc: 'é›ª', emoji: 'â„ï¸' }, 73: { desc: 'é›ª', emoji: 'â„ï¸' }, 75: { desc: 'å¤§é›ª', emoji: 'â„ï¸' }, 77: { desc: 'å†°é›¹', emoji: 'ğŸŒ¨ï¸' }, 80: { desc: 'é™£é›¨', emoji: 'ğŸŒ¦ï¸' }, 81: { desc: 'é™£é›¨', emoji: 'ğŸŒ¦ï¸' }, 82: { desc: 'å¤§é™£é›¨', emoji: 'ğŸŒ¦ï¸' }, 85: { desc: 'é™£é›ª', emoji: 'ğŸŒ¨ï¸' }, 86: { desc: 'å¤§é™£é›ª', emoji: 'ğŸŒ¨ï¸' }, 95: { desc: 'é›·é™£é›¨', emoji: 'â›ˆï¸' }, 96: { desc: 'é›·é™£é›¨ä¼´å†°é›¹', emoji: 'â›ˆï¸' }, 99: { desc: 'é›·é™£é›¨ä¼´å†°é›¹', emoji: 'â›ˆï¸' } }; return map[code] || { desc: 'æœªçŸ¥', emoji: 'â“' }; } // å¤©æ°£ä»£ç¢¼è½‰æ›
        async function fetchCoordinates(locationName) { if (!locationName) return null; const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(locationName)}&count=1&language=en&format=json`; try { const response = await fetch(url); if (!response.ok) throw new Error('åœ°ç†ç·¨ç¢¼APIè«‹æ±‚å¤±æ•—'); const data = await response.json(); return data.results?.[0] || null; } catch (error) { console.error("ç²å–åº§æ¨™å¤±æ•—:", error); return null; } } // ç²å–åº§æ¨™
        async function fetchWeather(lat, lon) { const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code&hourly=temperature_2m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto&forecast_days=8`; try { const response = await fetch(url); if (!response.ok) throw new Error('å¤©æ°£APIè«‹æ±‚å¤±æ•—'); return await response.json(); } catch (error) { console.error("ç²å–å¤©æ°£å¤±æ•—:", error); return null; } } // [ä¿®æ”¹] ç²å–å¤©æ°£(å¢åŠ æ¯å°æ™‚è³‡æ–™)
        
        function getChineseLocationName(englishName) {
            for (const countyName in taiwanLocations) {
                const countyData = taiwanLocations[countyName];
                for (const districtName in countyData.districts) {
                    if (countyData.districts[districtName].toLowerCase() === englishName.toLowerCase()) {
                        return countyName === districtName ? countyName : districtName;
                    }
                }
            }
            return englishName;
        }

        function updateWeatherDisplay() {
            if (!displaySettings.showWeather || !weatherDataCache) {
                lastWeatherContent = '';
                return;
            }
            const { desc, emoji } = getWeatherDescriptionAndEmoji(weatherDataCache.current.weather_code);
            const temp = Math.round(weatherDataCache.current.temperature_2m);
            const displayName = getChineseLocationName(displaySettings.weatherLocation);

            const locationPart = displaySettings.showWeatherLocation ? `<span style="color: ${displaySettings.weatherLocationColor};">${displayName}</span>` : '';
            const weatherInfoPart = `<span style="color: ${displaySettings.weatherColor};">${desc}${emoji}${temp}Â°C</span>`;
            lastWeatherContent = `${locationPart} ${weatherInfoPart}`;
        }

        async function updateWeather() {
            const locationName = displaySettings.weatherLocation.trim();
            if (!displaySettings.showWeather || !locationName) {
                updateWeatherDisplay();
                updateDateTime();
                return;
            }
            const coordsData = await fetchCoordinates(locationName);
            if (coordsData) {
                const { latitude, longitude } = coordsData;
                const data = await fetchWeather(latitude, longitude);
                if (data) {
                    weatherDataCache = data;
                    updateWeatherDisplay();
                } else {
                    lastWeatherContent = `<span style="color: ${displaySettings.weatherColor};">ç„¡æ³•å–å¾—å¤©æ°£è³‡è¨Š</span>`;
                }
            } else {
                lastWeatherContent = `<span style="color: ${displaySettings.weatherColor};">æ‰¾ä¸åˆ°åœ°é»: ${locationName}</span>`;
            }
            updateDateTime();
        }

        function showWeatherForecast() {
            if (!weatherDataCache) {
                const weatherContainer = document.getElementById('weatherMarqueeContainer');
                weatherContainer.style.backgroundColor = '#552222';
                setTimeout(() => { weatherContainer.style.backgroundColor = '' }, 500);
                return;
            }
            const grid = document.getElementById('weatherForecastGrid');
            const title = document.getElementById('weatherForecastModalTitle');
            grid.innerHTML = '';
            const displayName = getChineseLocationName(displaySettings.weatherLocation);
            title.textContent = `${displayName} ä¸€é€±é å ±`;

            for (let i = 0; i < 7; i++) {
                const date = new Date(weatherDataCache.daily.time[i]);
                const dayName = i === 0 ? 'ä»Šå¤©' : `å‘¨${['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][date.getDay()]}`;
                const { desc, emoji } = getWeatherDescriptionAndEmoji(weatherDataCache.daily.weather_code[i]);
                const tempMax = Math.round(weatherDataCache.daily.temperature_2m_max[i]);
                const tempMin = Math.round(weatherDataCache.daily.temperature_2m_min[i]);

                const dayCell = document.createElement('div');
                dayCell.classList.add('forecast-day');
                dayCell.innerHTML = `<p class="day-name">${dayName}</p><p>${date.getMonth() + 1}/${date.getDate()}</p><p class="weather-icon">${emoji}</p><p>${desc}</p><p><span class="temp-high">${tempMax}Â°</span> / <span class="temp-low">${tempMin}Â°</span></p>`;
                
                dayCell.onclick = () => showHourlyWeather(i);
                
                grid.appendChild(dayCell);
            }
            document.getElementById('weatherForecastModal').classList.add('is-active');
        }

        // [ä¿®æ”¹] é¡¯ç¤ºæŒ‡å®šæ—¥æœŸçš„æ¯ä¸‰å°æ™‚å¤©æ°£é å ±ï¼Œä¸¦é«˜äº®ç•¶å‰æ™‚æ®µ
        function showHourlyWeather(dayIndex) {
            if (!weatherDataCache || !weatherDataCache.hourly) return;
            
            const grid = document.getElementById('hourlyWeatherGrid');
            const title = document.getElementById('hourlyWeatherModalTitle');
            grid.innerHTML = '';

            const selectedDate = new Date(weatherDataCache.daily.time[dayIndex]);
            const tempMax = Math.round(weatherDataCache.daily.temperature_2m_max[dayIndex]);
            const tempMin = Math.round(weatherDataCache.daily.temperature_2m_min[dayIndex]);
            
            title.innerHTML = `${selectedDate.getMonth() + 1}æœˆ${selectedDate.getDate()}æ—¥ é å ± <span style="font-size: 0.7em; color: #ccc;">(é«˜ <span class="temp-high">${tempMax}Â°</span> / ä½ <span class="temp-low">${tempMin}Â°</span>)</span>`;

            const now = new Date();
            const startIndex = dayIndex * 24;
            const endIndex = startIndex + 24;

            // æ¯ä¸‰å°æ™‚é¡¯ç¤ºä¸€æ¬¡
            for (let i = startIndex; i < endIndex; i += 3) {
                const hourDate = new Date(weatherDataCache.hourly.time[i]);
                const { desc, emoji } = getWeatherDescriptionAndEmoji(weatherDataCache.hourly.weather_code[i]);
                const temp = Math.round(weatherDataCache.hourly.temperature_2m[i]);

                const hourCell = document.createElement('div');
                hourCell.classList.add('hourly-item');
                
                // æª¢æŸ¥æ˜¯å¦ç‚ºç•¶å‰æ™‚æ®µ (åƒ…é‡å°ä»Šå¤©)
                if (dayIndex === 0) {
                    const currentHour = now.getHours();
                    const blockStartHour = hourDate.getHours();
                    if (currentHour >= blockStartHour && currentHour < blockStartHour + 3) {
                        hourCell.classList.add('is-now');
                    }
                }

                hourCell.innerHTML = `<p class="hour-time">${hourDate.getHours().toString().padStart(2, '0')}:00</p><p class="weather-icon">${emoji}</p><p>${desc}</p><p>${temp}Â°C</p>`;
                grid.appendChild(hourCell);
            }

            document.getElementById('weatherForecastModal').classList.remove('is-active');
            document.getElementById('hourlyWeatherModal').classList.add('is-active');
        }

        function setupWeatherUpdater() { clearInterval(weatherUpdateTimer); updateWeather(); weatherUpdateTimer = setInterval(updateWeather, 10 * 60 * 1000); }
        
        function updateDistrictSelector(selectedCounty) {
            const districtSelect = document.getElementById('districtSelect');
            districtSelect.innerHTML = '';
            const districts = taiwanLocations[selectedCounty]?.districts || {};
            for (const districtName in districts) {
                const option = document.createElement('option');
                option.value = districtName;
                option.textContent = districtName;
                districtSelect.appendChild(option);
            }
        }
        
        function syncLocationControls() {
            const countySelect = document.getElementById('countySelect');
            const districtSelect = document.getElementById('districtSelect');
            const locationInput = document.getElementById('weatherLocation');
            
            const selectedCounty = countySelect.value;
            const selectedDistrict = districtSelect.value;
            const englishLocation = taiwanLocations[selectedCounty]?.districts[selectedDistrict] || 'taiwan';

            locationInput.value = englishLocation;
            displaySettings.weatherLocation = englishLocation;
            saveSettings();
            updateWeather();
        }

        function setLocationSelectorsFromEnglish(englishLocation) {
            const countySelect = document.getElementById('countySelect');
            const districtSelect = document.getElementById('districtSelect');
            const locationInput = document.getElementById('weatherLocation');
            if (!countySelect || !districtSelect) return;

            locationInput.value = englishLocation;

            let foundCounty = null;
            let foundDistrict = null;

            for (const countyName in taiwanLocations) {
                const countyData = taiwanLocations[countyName];
                for (const districtName in countyData.districts) {
                    if (countyData.districts[districtName].toLowerCase() === englishLocation.toLowerCase()) {
                        foundCounty = countyName;
                        foundDistrict = districtName;
                        break;
                    }
                }
                if (foundCounty) break;
            }

            if (foundCounty) {
                countySelect.value = foundCounty;
                updateDistrictSelector(foundCounty);
                districtSelect.value = foundDistrict;
            } else {
                countySelect.value = 'å°ç£';
                updateDistrictSelector('å°ç£');
                districtSelect.value = 'å°ç£';
            }
        }
        
        function initializeLocationControls() {
            const countySelect = document.getElementById('countySelect');
            const districtSelect = document.getElementById('districtSelect');
            const locationInput = document.getElementById('weatherLocation');

            for (const countyName in taiwanLocations) {
                const option = document.createElement('option');
                option.value = countyName;
                option.textContent = countyName;
                countySelect.appendChild(option);
            }

            countySelect.addEventListener('change', () => {
                updateDistrictSelector(countySelect.value);
                syncLocationControls();
            });

            districtSelect.addEventListener('change', syncLocationControls);

            locationInput.addEventListener('change', () => {
                const manualLocation = locationInput.value.trim();
                displaySettings.weatherLocation = manualLocation;
                setLocationSelectorsFromEnglish(manualLocation);
                saveSettings();
                updateWeather();
            });
        }

        // --- é é¢è¼‰å…¥èˆ‡äº‹ä»¶ç¶å®š ---
		window.onload = function () { 
            const controlIcons = document.querySelectorAll('.control-icon'); 
            function populateTimeSelectors(minuteId, secondId) { const minuteSelect = document.getElementById(minuteId), secondSelect = document.getElementById(secondId); for (let i = 0; i <= 59; i++) { if (minuteSelect) { const option = document.createElement('option'); option.value = i; option.textContent = i; minuteSelect.appendChild(option); } if (secondSelect) { const option = document.createElement('option'); option.value = i; option.textContent = i; secondSelect.appendChild(option); } } } 
            populateTimeSelectors('movementIntervalMinutes', 'movementIntervalSeconds'); 
            populateTimeSelectors('scanlineIntervalMinutes', 'scanlineIntervalSeconds'); 
            
            initializeLocationControls();
            
            loadSettings(); 
            updateSettingsModalUI(); 
            applyIntervalValidation(); 
            saveSettings(); 
            updateDateTime(); 
            setInterval(updateDateTime, 1000); 
            setupEffectTimers(); 
            setupWeatherUpdater(); 
            if (!displaySettings.enableMovement) { resetPosition(); } 
            document.querySelectorAll('.modal').forEach(modal => { const closeButton = modal.querySelector('.action-button[id^="close"], .action-button[id^="done"]'); if (closeButton) { closeButton.onclick = () => modal.classList.remove('is-active'); } modal.addEventListener('click', (event) => { if (event.target === modal) { modal.classList.remove('is-active'); } }); }); 
            document.getElementById('todayCalendarBtn').onclick = () => { calendarDate = new Date(); generateCalendar(calendarDate.getFullYear(), calendarDate.getMonth()); }; 
            document.getElementById('todayWeeklyBtn').onclick = () => { weeklyCalendarDate = new Date(); generateWeekCalendar(weeklyCalendarDate); }; 
            document.getElementById('todayYearlyBtn').onclick = () => { yearlyCalendarDate = new Date(); generateYearCalendar(yearlyCalendarDate.getFullYear()); }; 
            document.getElementById('prevMonthBtn').onclick = () => { calendarDate.setMonth(calendarDate.getMonth() - 1); generateCalendar(calendarDate.getFullYear(), calendarDate.getMonth()); }; 
            document.getElementById('nextMonthBtn').onclick = () => { calendarDate.setMonth(calendarDate.getMonth() + 1); generateCalendar(calendarDate.getFullYear(), calendarDate.getMonth()); }; 
            document.getElementById('prevWeekBtn').onclick = () => { weeklyCalendarDate.setDate(weeklyCalendarDate.getDate() - 7); generateWeekCalendar(weeklyCalendarDate); }; 
            document.getElementById('nextWeekBtn').onclick = () => { weeklyCalendarDate.setDate(weeklyCalendarDate.getDate() + 7); generateWeekCalendar(weeklyCalendarDate); }; 
            document.getElementById('prevYearBtn').onclick = () => { yearlyCalendarDate.setFullYear(yearlyCalendarDate.getFullYear() - 1); generateYearCalendar(yearlyCalendarDate.getFullYear()); }; 
            document.getElementById('nextYearBtn').onclick = () => { yearlyCalendarDate.setFullYear(yearlyCalendarDate.getFullYear() + 1); generateYearCalendar(yearlyCalendarDate.getFullYear()); }; 
            document.getElementById('prevShichenBtn').onclick = () => { shichenDetailDate.setHours(shichenDetailDate.getHours() - 2); updateShiChenDetailsView(shichenDetailDate); }; 
            document.getElementById('nextShichenBtn').onclick = () => { shichenDetailDate.setHours(shichenDetailDate.getHours() + 2); updateShiChenDetailsView(shichenDetailDate); }; 
            document.getElementById('nowShichenBtn').onclick = () => { updateShiChenDetailsView(new Date()); }; 
            
            // [æ–°å¢] è¿”å›é€±é å ±æŒ‰éˆ•äº‹ä»¶
            document.getElementById('backToWeeklyForecastBtn').onclick = () => {
                document.getElementById('hourlyWeatherModal').classList.remove('is-active');
                document.getElementById('weatherForecastModal').classList.add('is-active');
            };

            function handleSettingChange(event) { 
                const target = event.target; 
                const key = target.id; 
                if (key === 'weatherLocation') return;
                let value; 
                if (target.type === 'checkbox') { value = target.checked; } else { value = target.value; } 
                displaySettings[key] = value; 
                applyIntervalValidation(); 
                if (key === 'enableMovement' && !value) { resetPosition(); } 
                saveSettings(); 
                updateDateTime(); 
                setupEffectTimers(); 
                if (key === 'showWeather' || key === 'showWeatherLocation') { 
                    updateWeatherDisplay();
                    updateWeather();
                } 
            } 
            
            document.querySelectorAll('.switch input[type="checkbox"], .interval-select:not(#countySelect):not(#districtSelect)').forEach(el => { el.onchange = handleSettingChange; }); 
            
            document.querySelectorAll('input[type="color"]').forEach(colorInput => {
                colorInput.addEventListener('input', (event) => {
                    const key = event.target.id;
                    const value = event.target.value;
                    displaySettings[key] = value;
                    updateWeatherDisplay();
                    updateDateTime();
                    saveSettings();
                });
            });
            
            document.getElementById('useCurrentLocationBtn').addEventListener('click', () => { 
                if (navigator.geolocation) { 
                    updateMarquee('æ­£åœ¨å®šä½...', 'weather'); 
                    navigator.geolocation.getCurrentPosition( (pos) => { 
                        const { latitude, longitude } = pos.coords; 
                        fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=en`)
                        .then(response => response.json())
                        .then(geoData => { 
                            const city = geoData.locality || geoData.city; 
                            if (city) { 
                                displaySettings.weatherLocation = city;
                                setLocationSelectorsFromEnglish(city);
                                saveSettings(); 
                                updateWeather(); 
                            } else { 
                                console.error("ç„¡æ³•å¾åå‘åœ°ç†ç·¨ç¢¼ç²å–åŸå¸‚ã€‚"); 
                                updateMarquee(`<span style="color: ${displaySettings.weatherColor};">å®šä½å¤±æ•—</span>`, 'weather'); 
                            } 
                        }).catch(error => { 
                            console.error("åå‘åœ°ç†ç·¨ç¢¼å¤±æ•—:", error); 
                            updateMarquee(`<span style="color: ${displaySettings.weatherColor};">å®šä½å¤±æ•—</span>`, 'weather'); 
                        }); 
                    }, () => { 
                        console.warn("åœ°ç†å®šä½å¤±æ•—ã€‚è«‹æª¢æŸ¥ç€è¦½å™¨æ¬Šé™ã€‚"); 
                        updateMarquee(`<span style="color: ${displaySettings.weatherColor};">å®šä½å¤±æ•—ï¼Œè«‹æª¢æŸ¥æ¬Šé™</span>`, 'weather'); 
                    }, { timeout: 10000 } ); 
                } else { 
                    alert("æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´åœ°ç†ä½ç½®åŠŸèƒ½ã€‚"); 
                } 
            }); 
            
            document.getElementById('restoreDefaultsBtn').onclick = restoreDefaults; 
            document.getElementById('randomColorsBtn').onclick = setRandomColors; 
            document.getElementById('dateTimeDisplay').addEventListener('click', function(event) { const target = event.target; if (target.closest('#weatherMarqueeContainer')) { showWeatherForecast(); } else if (target.closest('.lunar-shichen-clickable')) { updateShiChenDetailsView(new Date()); } else if (target.closest('.lunar-date-clickable') || target.closest('#jieqiHolidayMarqueeContainer')) { showDateDetails(new Date()); } else if (target.closest('.gregorian-year-target') || target.closest('.lunar-year-target')) { yearlyCalendarDate = new Date(); generateYearCalendar(yearlyCalendarDate.getFullYear()); document.getElementById('yearlyCalendarModal').classList.add('is-active'); } else if (target.closest('.weekday-target')) { weeklyCalendarDate = new Date(); generateWeekCalendar(weeklyCalendarDate); document.getElementById('weeklyCalendarModal').classList.add('is-active'); } else if (target.closest('.gregorian-date-text') || target.closest('.lunar-date-static-text')) { calendarDate = new Date(); generateCalendar(calendarDate.getFullYear(), calendarDate.getMonth()); document.getElementById('calendarModal').classList.add('is-active'); } }); 
            document.getElementById('settings-icon').addEventListener('click', () => { document.getElementById('settingsModal').classList.add('is-active'); updateSettingsModalUI(); }); 
            
            const fullscreenIcon = document.getElementById('fullscreen-icon'), docElement = document.documentElement; 
            function toggleFullScreen() { const isFullscreen = document.fullscreenElement || document.webkitFullscreenElement; if (!isFullscreen) { const req = docElement.requestFullscreen || docElement.webkitRequestFullscreen; if (req) { req.call(docElement).catch(err => console.warn(`ç„¡æ³•é€²å…¥å…¨è¢å¹•æ¨¡å¼: ${err.message}`)); } } else { const exit = document.exitFullscreen || document.webkitExitFullscreen; if (exit) { exit.call(document).catch(err => console.warn(`ç„¡æ³•é€€å‡ºå…¨è¢å¹•æ¨¡å¼: ${err.message}`)); } } } 
            fullscreenIcon.addEventListener('click', toggleFullScreen); 
            
            function handleFullscreenChange() { const isFullscreen = document.fullscreenElement || document.webkitFullscreenElement; fullscreenIcon.style.display = isFullscreen ? 'none' : 'block'; if (lastMarqueeContent) { updateMarquee(lastMarqueeContent, 'jieqi'); } if (lastWeatherContent) { updateMarquee(lastWeatherContent, 'weather'); } } 
            document.addEventListener('fullscreenchange', handleFullscreenChange); 
            document.addEventListener('webkitfullscreenchange', handleFullscreenChange); 
            
            let inactivityTimer; 
            function hideIconsOnIdle() { controlIcons.forEach(icon => icon.style.opacity = '0'); } 
            function resetIdleTimer() { controlIcons.forEach(icon => { if (window.getComputedStyle(icon).display !== 'none') { icon.style.opacity = '0.5'; } }); clearTimeout(inactivityTimer); inactivityTimer = setTimeout(hideIconsOnIdle, 10000); } 
            ['mousemove', 'keydown', 'touchstart'].forEach(evt => document.addEventListener(evt, resetIdleTimer)); 
            resetIdleTimer(); 
        };
	</script>
</body>
</html>
